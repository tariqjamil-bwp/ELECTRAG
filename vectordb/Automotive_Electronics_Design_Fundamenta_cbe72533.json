["Najamuz/uni00A0Zaman\nAutomotive \nElectronics \nDesign \nFundamentals\n  Automotive Electronics Design Fundamentals zamann@us.panasonic.com\n     zamann@us.panasonic.com\n       Najamuz     Zaman     \n Automotive Electronics \nDesign Fundamentals                     zamann@us.panasonic.com\nAdditional material to this book can be downloaded from   http://extras.springer.com    \n ISBN 978-3-319-17583-6      ISBN 978-3-319-17584-3 (eBook) \n DOI 10.1007/978-3-319-17584-3 \n Library of Congress Control Number: 2015938697 \n Springer Cham Heidelberg New York Dordrecht London \n \u00a9 Springer International Publishing Switzerland   2015 \n This work is subject to copyright. All rights are reserved by the Publisher, whether the whole or part of \nthe material is concerned, speci\ufb01  cally the rights of translation, reprinting, reuse of illustrations, recitation, \nbroadcasting, reproduction on micro\ufb01  lms or in any other physical way, and transmission or information \nstorage and retrieval, electronic adaptation, computer software, or by similar or dissimilar methodology \nnow known or hereafter developed. \n The use of general descriptive names, registered names, trademarks, service marks, etc. in this publication \ndoes not imply, even in the absence of a speci\ufb01  c statement, that such names are exempt from the relevant \nprotective laws and regulations and therefore free for general use. \n The publisher, the authors and the editors are safe to assume that the advice and information in this book \nare believed to be true and accurate at the date of publication. Neither the publisher nor the authors or the \neditors give a warranty, express or implied, with respect to the material contained herein or for any errors \nor omissions that may have been made. \n Printed on acid-free paper \n Springer International Publishing AG Switzerland is part of Springer Science+Business Media \n(www.springer.com )    Najamuz     Zaman     zamann@us.panasonic.com\nv    1     Vehicle Electronics Architecture  ..............................................................  1   \n    1.1  Introduction ......................................................................................  1   \n    1.2  Instrument Cluster ............................................................................  2   \n    1.3  Heating and Cooling ........................................................................", " Electronics Architecture  ..............................................................  1   \n    1.1  Introduction ......................................................................................  1   \n    1.2  Instrument Cluster ............................................................................  2   \n    1.3  Heating and Cooling ........................................................................  2   \n    1.4  Airbag Safety ...................................................................................  2   \n    1.5  Antilock Brake, Traction and Stability ............................................  3   \n    1.6  Power Assist Steering ......................................................................  3   \n    1.7  Avionics Fly-By-Wire (FBW) ..........................................................  4   \n    1.8  Automotive X- By-Wire...................................................................  5   \n  1.8.1 Brake- By-Wire .....................................................................  5   \n  1.8.2 Steer- By-Wire ......................................................................  6   \n  1.8.3 Drive- By-Wire .....................................................................  6   \n    1.9  Tire Pressure Monitoring .................................................................  7   \n    1.10  Modules Count .................................................................................  8   \n    1.11  Straight-Wire-Switch Topology .......................................................  9   \n    1.12  Embedded Function .........................................................................  11   \n    1.13  A Conventional Radio ......................................................................  13   \n    1.14  An Embedded Radio ........................................................................  13   \n    1.15  Distributed Vehicle Architecture ......................................................  16   \n    1.16  Custom Built Modules .....................................................................  18   \n    1.17  Modules Cross Compatibility ..........................................................  18   \n    1.18  Integrating Dissimilar Functions ......................................................  19   \n    1.19  Integrating Identical Functions: A Universal Module .....................  19   \n    1.20  Key-Off Load Current ......................................................................  20   \n    1.21  12V/42V Electrical Supply System .................................................  21   \n    1.22  Vehicle Input Sensors and Switches ................................................  22   \n    1.23  Vehicle Output Devices ....................................................................  23   \n    1.24  Vehicle Interior Lights Dimming .....................................................  24   \n    1.25  H-Bridge Motor Driver ....................................................................  26     Contents zamann@us.pan", " Vehicle Output Devices ....................................................................  23   \n    1.24  Vehicle Interior Lights Dimming .....................................................  24   \n    1.25  H-Bridge Motor Driver ....................................................................  26     Contents zamann@us.panasonic.com\nvi\n    1.26  Communication Link .......................................................................  28   \n  1.26.1 Inter-Module Information Sharing .....................................  30   \n  1.26.2 Diagnostics and Testing .....................................................  30   \n  1.26.3 Flash Programming and Data Download Features ............  32   \n    1.27  Microcontrollers Programming Options ..........................................  36   \n  1.27.1 One-Time-Programmable (OTP) .......................................  36   \n  1.27.2 Masked Read Only Memory (MROM) ..............................  37   \n  1.27.3 EPROM Microcontrollers ..................................................  37   \n  1.27.4 Flash EEPROM Microcontrollers ......................................  38   \n  1.27.5 Stand-Alone Non-Flash Type EEPROM ...........................  39   \n    1.28  Vehicle Programming .......................................................................  39   \n  1.28.1 Embedded Systems Booting ..............................................  40   \n  1.28.2 Primary and Secondary Boot Methods ..............................  41   \n  1.28.3 Vehicle Modules Programming ..........................................  42   \n  1.28.4 Generalized Programming Procedure ................................  43   \n    1.29  Software Download Time ................................................................  43   \n    1.30  Vehicle Operating Software .............................................................  45   \n  1.30.1 OSEK .................................................................................  46   \n  1.30.2 AUTOSAR .........................................................................  46   \n    1.31  High Level Software Context Diagram ............................................  48   \n  1.31.1 DFD Ignition Processing ....................................................  48   \n  1.31.2 DFD Battery Processing ....................................................  49   \n  1.31.3 DFD Abnormal Shutdown .................................................  49   \n  1.31.4 DFD Switch De-Bounce ....................................................  50   \n  1.31.5 DFD Temperature Sensor ..................................................  ", ".3 DFD Abnormal Shutdown .................................................  49   \n  1.31.4 DFD Switch De-Bounce ....................................................  50   \n  1.31.5 DFD Temperature Sensor ..................................................  50   \n  1.31.6 DFD Communication Bus Activity....................................  50   \n  1.31.7 DFD: Watch Dog Timer .....................................................  51   \n  1.31.8 DFD Internal Self-Test .......................................................  52   \n  1.31.9 DFD Output Driver ............................................................  52   \n    1.32  Background/Foreground Loop .........................................................  52   \n    1.33  Modules Physical Placements ..........................................................  54   \n  1.33.1 An Airbag Module .............................................................  54   \n  1.33.2 An Instrument Cluster ........................................................  54   \n  1.33.3 Multimedia, Location .........................................................  55   \n  1.33.4 Climate Controls ................................................................  56   \n  1.33.5 Engine Controller ...............................................................  56   \n  1.33.6 Anti-Lock Brake (ABS) Module .......................................  56   \n  1.33.7 Power Steering Module Location ......................................  57   \n    1.34  Vehicle Harnesses ............................................................................  57   \n    1.35  Overview Layout of Harnesses, Devices and Modules ...................  58   \n    1.36  Case Study Nissan Quest., Mini Van Modules ................................  59   \n  1.36.1 Intelligent Power Distribution Module (IPDM) .................  59   \n  1.36.2 ABS/TCS/VDC Control Unit ............................................  61   \n  1.36.3 Supplemental Restraint System (SRS)...............................  61   \n  1.36.4 Body Control Module (BCM) ............................................  63   Contentszamann@us.panasonic.com\nvii\n  1.36.5 Sliding Door Control Unit (SDCU) .................................  63   \n  1.36.6 Engine Control Module (ECM) ........................................  63   \n  1.36.7 Automatic Drive Positioner Control Unit (ADP) .............  65", ") .................................  63   \n  1.36.6 Engine Control Module (ECM) ........................................  63   \n  1.36.7 Automatic Drive Positioner Control Unit (ADP) .............  65   \n  1.36.8 Driver Seat Control Unit (DSCU) ....................................  65   \n  1.36.9 Front Air Control Unit (FACU) ........................................  66   \n  1.36.10 Transmission Control Unit (TCU)....................................  68   \n  1.36.11 Combination Unit (CU) ....................................................  69   \n  1.36.12 Input and Output Devices Audit .......................................  70   \n    1.37  Exercise ............................................................................................  71   \n     2     Fundamental Module Blocks  ...................................................................  75   \n    2.1  Introduction ......................................................................................  75   \n    2.2  Module Hardware Block 1: The Safety and Protection ...................  78   \n    2.3  Module Hardware Block 2: The Switched Battery ..........................  79   \n    2.4  Module Hardware Block 3: The Power Reservoir ...........................  79   \n    2.5  Module Hardware Block 4: The Power Supply ...............................  80   \n    2.6  Module Hardware Block 5: The Ignition Switch, Start Interface.....  80   \n    2.7  Module Hardware Block 6: The Ignition Switch Run \nand Accessory Interface ...................................................................  81   \n    2.8  Module Hardware Block 7: Input Interface Circuits .......................  81   \n    2.9  Module Hardware Block 8: The Processing Power .........................  82   \n    2.10  Module Hardware Block 9: Reset and Watch Dog Timer ...............  85   \n    2.11  Module Hardware Block 10: The Program Storage ........................  87   \n    2.12  Module Hardware Block 11: The Critical Data Storage ..................  87   \n    2.13  Module B Hardware Block 12: The Flash Programming Port ........  88   \n    2.14  Module Hardware Block 13: Speci\ufb01  c Function Drivers ..................  88   \n    2.15  Module", "  Module B Hardware Block 12: The Flash Programming Port ........  88   \n    2.14  Module Hardware Block 13: Speci\ufb01  c Function Drivers ..................  88   \n    2.15  Module Hardware Block 14: Communication Node .......................  89   \n    2.16  Module Software Component 15: Application Software .................  91   \n    2.17  Module Software Component 16: Primary Boot Loader .................  91   \n    2.18  Module Software Component 17: The Real Time Operating \nSystem (RTOS) ................................................................................  91   \n    2.19  Module Software Component 18: The Network Operating \nSystem (NOS) ..................................................................................  92   \n    2.20  Vehicle Interface 20C: Vehicle Alternator .......................................  92   \n    2.21  Vehicle Interface: 20A Relays and Solenoids, 20B Battery, \nand 20D Starter Motor .....................................................................  92   \n    2.22  Vehicle Interface 21: Vehicle Speci\ufb01  c Input Functions ...................  93   \n    2.23  Vehicle Interface 22: Vehicle Ignition Switch .................................  94   \n    2.24  Vehicle Interfaces 23: Vehicle Speci\ufb01  c Output Functions ...............  95   \n    2.25  Vehicle Interfaces 25, 26, 27: Vehicle Modules ...............................  95   \n    2.26  Vehicle Interface 27: Diagnostics Connector ...................................  96   \n    2.27  Outside World 29: Service Tools .....................................................  96   \n    2.28  Outside World 30: Secondary Boot loader ......................................  97   \n    2.29  Outside World 31: Software Development Tools.............................  97   \n    2.30  Summary ..........................................................................................  98   \n    2.31  Exercise ............................................................................................  99   Contentszamann@us.panasonic.com\nviii\n     3     Fundamental Blocks Topology  .................................................................  101   \n    3.1  Introduction ......................................................................................  101   \n    3.2  Safety and Protection .......................................................................  101   \n    3.3  Power Supply ...................................................................................  103   \n  ", "  101   \n    3.1  Introduction ......................................................................................  101   \n    3.2  Safety and Protection .......................................................................  101   \n    3.3  Power Supply ...................................................................................  103   \n  3.3.1 Electronic Switch S1 .............................................................  105   \n  3.3.2 Low Pass Filter .....................................................................  105   \n  3.3.3 Regulators .............................................................................  105   \n  3.3.4 Power Reservoir ....................................................................  105   \n  3.3.5 EMC Filters ..........................................................................  106   \n  3.3.6 Software Component ............................................................  106   \n    3.4  Battery Power Switching .................................................................  107   \n    3.5  Sensor Power Switching ..................................................................  108   \n    3.6  Ignition Switch Interface ..................................................................  109   \n    3.7  Input Interface Architecture .............................................................  110   \n    3.8  Speci\ufb01  c-Function Driver ..................................................................  110   \n    3.9  Low-Side Driver ...............................................................................  112   \n    3.10  Pulse Width Modulated Driver ........................................................  113   \n    3.11  Watch Dog Timer .............................................................................  114   \n    3.12  Reset Topology ................................................................................  115   \n    3.13  Digital Communication Architecture ...............................................  117   \n    3.14  CAN Communication Node Architecture ........................................  118   \n    3.15  CAN Protocol Controller .................................................................  119   \n    3.16  Controller Area Network Transceiver ..............................................  120   \n    3.17  CAN Bus Implementation Strategies ...............................................  121   \n    3.18  CAN Bus V oltage Levels .................................................................  123   \n    3.19  CAN Bus Software Components .....................................................  123   \n    3.20  Battery V oltage Monitoring .............................................................  126   \n    3.21  Abrupt Power Failure .......................................................................  126   \n    3.22  Exercise ............................................................................................  127   \n     4     Power Delivery and Functional Attributes  .............................................  135   \n    4.1  Introduction ......................................................................................  135   \n    4", "126   \n    3.22  Exercise ............................................................................................  127   \n     4     Power Delivery and Functional Attributes  .............................................  135   \n    4.1  Introduction ......................................................................................  135   \n    4.2  Power Delivery Mechanism .............................................................  135   \n    4.3  Type 2 Modules Operation ...............................................................  136   \n    4.4  Type 1 Modules Operation ...............................................................  138   \n    4.5  Type 2 Modules Vehicle Life ...........................................................  139   \n    4.6  Module Functional Attributes ..........................................................  139   \n     5     Fundamental Blocks Design  .....................................................................  143   \n    5.1  Introduction ......................................................................................  143   \n    5.2  Battery Switching Block De\ufb01  nition .................................................  146   \n  5.2.1 Abstraction Level 3: A Short Description ............................  146   \n  5.2.2 Abstraction Level 2: A Simple Block Diagram \nwith a Truth Table .................................................................  147   \n  5.2.3 Abstraction Level 1: Designed Blocks and Interfaces ..........  147   \n  5.2.4 Abstraction Level 0: Switched Battery Schematics ..............  148   \n  5.2.5 Temperature Envelop Testing ...............................................  151   Contentszamann@us.panasonic.com\nix\n    5.3  Ignition Start Sensing Block De\ufb01  nition ...........................................  151   \n  5.3.1 Abstraction Level 3: A Descriptive Statement .....................  152   \n  5.3.2 Abstraction Level 2: A Simple Block Diagram \nwith a Truth Table .................................................................  152   \n  5.3.3 Abstraction Level 1: Designed Blocks and Interfaces ..........  152   \n  5.3.4 Abstraction Level 0: Ignition Switch Start Schematics ........  152   \n  5.3.5 Bias Point Analysis ...............................................................  154   \n  5.3.6 Temperature Envelop Testing ...............................................  156   \n    5.4  Sensors Power Switching Block De\ufb01  nition .....................................  157   \n  5", "...............................  154   \n  5.3.6 Temperature Envelop Testing ...............................................  156   \n    5.4  Sensors Power Switching Block De\ufb01  nition .....................................  157   \n  5.4.1 Abstraction Level 3: Descriptive Statement .........................  159   \n  5.4.2 Abstraction Level 2: Sensors Switch Block Diagram \nwith a Truth Table .................................................................  159   \n  5.4.3 Abstraction Level 1: Sensor Switch Designed Blocks \nand Interfaces ........................................................................  160   \n  5.4.4 Abstraction Level 0: Sensor Switch Schematics ..................  160   \n  5.4.5 Bias Point Analysis ...............................................................  161   \n  5.4.6 Temperature Envelop Testing ...............................................  164   \n    5.5  Low-Side Output Device Driver ......................................................  165   \n  5.5.1 Abstraction Level 3: Descriptive Statement .........................  165   \n  5.5.2 Abstraction Level 2: A Low-Side Driver Block Diagram \nwith a Truth Table .................................................................  165   \n  5.5.3 Abstraction Level 1: Low-Side Driver Designed Blocks \nand Interfaces ........................................................................  166   \n  5.5.4 Abstraction Level 0: Low-Side Driver Schematics ..............  166   \n  5.5.5 Bias Point Analysis Low-Side Switch Is Off ........................  168   \n  5.5.6 Bias Point Analysis: Low-Side Switch Is On .......................  169   \n    5.6  High-Side Output Device Driver .....................................................  170   \n  5.6.1 Abstraction Level 3: Descriptive Statement .........................  170   \n  5.6.2 Abstraction Level 2: A High-Side driver Block Diagram \nwith a Truth Table .................................................................  171   \n  5.6.3 Abstraction Level 1: High-Side Driver Designed Blocks \nand Interfaces ........................................................................  171   \n  5.6.4 Abstraction Level 0: High-Side Driver Schematics ..............  172   \n  5.6.5 Bias Point Analysis: High-Side Switch-On ........................", " ........................................................................  171   \n  5.6.4 Abstraction Level 0: High-Side Driver Schematics ..............  172   \n  5.6.5 Bias Point Analysis: High-Side Switch-On ..........................  173   \n  5.6.6 Bias Point Analysis: High-Side Switch Cut-Off ...................  174   \n  5.6.7 Simulation Analysis: High-Side Switch ...............................  175   \n    5.7  B+ Detection Block..........................................................................  176   \n  5.7.1 Abstraction Level 3: Descriptive Statement .........................  176   \n  5.7.2 Abstraction Level 2: B+ Detection Block Diagram \nwith a Truth Table .................................................................  176   \n  5.7.3 Abstraction Level 1: B+ Detection Designed Blocks \nand Interfaces ........................................................................  177   \n  5.7.4 Abstraction Level 0: B+ Detection Schematics ....................  177   \n  5.7.5 Temperature Envelop Testing ...............................................  178   \n    5.8  B+ Monitoring Block .......................................................................  179   \n  5.8.1 Abstraction Level 3: Descriptive Statement .........................  179   Contentszamann@us.panasonic.com\nx\n  5.8.2 Abstraction Level 2: B+ Monitoring Block Diagram \nwith a Truth Table ..............................................................  180   \n  5.8.3 Abstraction Level 1: Designed Blocks and Interfaces .......  180   \n  5.8.4 Abstraction Level 0: B+ Monitoring Schematics ..............  180   \n    5.9  Input Signal Senor Block .................................................................  181       \n    5.10  Reset Block ......................................................................................  182   \n  5.10.1 Abstraction Level 3: Descriptive Statement.......................  183   \n  5.10.2 Abstraction Level 2: Reset Block Diagram \nwith a Truth Table ..............................................................  183   \n  5.10.3 Abstraction Level 1: Reset Block Designed Blocks \nand Interfaces .....................................................................  183   \n  5.10.4 Abstraction Level 0: Reset Block Schematics ...................  184   \n", "  5.10.3 Abstraction Level 1: Reset Block Designed Blocks \nand Interfaces .....................................................................  183   \n  5.10.4 Abstraction Level 0: Reset Block Schematics ...................  184   \n    5.11  Reverse Battery ................................................................................  186   \n  5.11.1 Abstraction Level 3: Descriptive Statement.......................  188   \n  5.11.2 Abstraction Level 2: Reverse Battery Series Diode \nBlock Diagram with a Truth Table .....................................  188   \n  5.11.3 Abstraction Level 1: Reverse Battery Designed \nBlocks and Interfaces .........................................................  190   \n    5.12  Power Supply Block.........................................................................  195   \n  5.12.1 Abstraction Level 3: Descriptive Statement.......................  199   \n  5.12.2 Abstraction Level 2: Buck Convertor Block Diagram \nwith a Truth Table ..............................................................  199   \n  5.12.3 Abstraction Level 1: Buck Convertor Topology \nDemonstration ....................................................................  200   \n  5.12.4 Abstraction Level 0: Buck Convertor TI TPS40200 \nSchematics .........................................................................  204   \n  5.12.5 Boost Convertor Block Diagram with a Truth Table .........  206   \n  5.12.6 Abstraction Level 1: Boost Convertor \nBlock Schematics ...............................................................  207   \n     6     Lincoln Motor Company: Case Study 2015 Lincoln\u2014MK C ................  209   \n    6.1  Introduction ......................................................................................  209   \n    6.2  Lincoln Motor Company 2015 Lincoln Brand MK C .....................  211   \n    6.3  MK C Communication Backbone Architecture ................................  212   \n    6.4  Body Control Module (BCM) ..........................................................  212   \n    6.5  Restraint Control Module (RCM) ....................................................  212   \n    6.6  Instrument Panel Cluster (IPC) ........................................................  216   \n    6.7  Park Aid Module (PAM) ..................................................................  216   \n    6.8  Tire Pressure Monitoring System (TPMS) .......................................  217   \n    6.9  Shift by Wire", "216   \n    6.7  Park Aid Module (PAM) ..................................................................  216   \n    6.8  Tire Pressure Monitoring System (TPMS) .......................................  217   \n    6.9  Shift by Wire System .......................................................................  218   \n    6.10  In-Vehicle Invertor ...........................................................................  218   \n    6.11  Powertrain Control Module ..............................................................  220   \n    6.12  Cruise Control Module (CCM) ........................................................  220   \n    6.13  Steering Column Control Module (SCCM) .....................................  220   \n    6.14  Collision Avoidance System ............................................................  222   Contentszamann@us.panasonic.com\nxi\n    6.15  Blind Spot Monitoring System (BLIS) ............................................  222   \n    6.16  Climate Control System ...................................................................  222   \n    6.17  Passive Anti-theft System (PATS) ....................................................  224   \n    6.18  Lane Departure Warning ..................................................................  224   \n    6.19  Battery Charging ..............................................................................  225   \n    6.20  Anti-lock Brake System and Stability Control .................................  225   \n    6.21  Exterior Lighting System .................................................................  226   \n     7     Module and Vehicle EMC Compliance  ...................................................  227   \n    7.1  Introduction ......................................................................................  227   \n  7.1.1 Radiated Emissions (RE) ...................................................  228   \n  7.1.2 Conducted Emissions (CE) ................................................  229   \n  7.1.3 Radiated Immunity (RI) .....................................................  229   \n  7.1.4 Conducted Immunity (CI) ..................................................  229   \n    7.2  Automotive Radiated Emission .......................................................  230   \n    7.3  Automotive Conducted Emission ....................................................  231   \n    7.4  Automotive Radiated Immunity .......................................................  231   \n    7.5  Automotive Conducted Immunity ...................................................  231   \n    7.6  Automotive Radiated Emissions Testing .........................................  232   \n    7.7  Automotive Conducted E", "  231   \n    7.5  Automotive Conducted Immunity ...................................................  231   \n    7.6  Automotive Radiated Emissions Testing .........................................  232   \n    7.7  Automotive Conducted Emissions Testing ......................................  236   \n    7.8  Testing RF Radiated Immunity Above 400\u20133,100 MHz .................  236   \n    7.9  Testing Radiated Immunity Bulk Current Injection Method ...........  238   \n    7.10  Cellular Phone Immunity Tests ........................................................  239   \n    7.11  Testing Conducted Immunity ...........................................................  240   \n    7.12  Testing Automotive Conducted and Coupled Immunity ..................  240   \n    7.13  Immunity Tests Operational Classi\ufb01  cations .....................................  246   \n  7.13.1 Operational Classi\ufb01  cation 1 ...............................................  246   \n  7.13.2 Operational Classi\ufb01  cation 2 ...............................................  246   \n  7.13.3 Operational Classi\ufb01  cation 3 ...............................................  247   \n  7.13.4 Operational Classi\ufb01  cation 4 ...............................................  247   \n    7.14  Module Wire Coupling Tests ...........................................................  247   \n    7.15  Module ESD Test .............................................................................  250   \n    7.16  Module Conducted Immunity Tests .................................................  252   \n  7.16.1 Fixed Frequency Noise to B+ ............................................  253   \n  7.16.2 B+ V oltage Fluctuations .....................................................  254   \n  7.16.3 GND Shift to B+ ................................................................  255   \n  7.16.4 Controlled B+ Threshold and Transient Noise ..................  256   \n  7.16.5 Load Dump Pulse ...............................................................  256    \n   Index  .................................................................................................................  259    Contentszamann@us.panasonic.com\n1 \u00a9 Springer International Publishing Switzerland 2015 \nN. Zaman, Automotive Electronics Design Fundamentals , \nDOI 10.1007/978-3-319-17584-3_1    Chapter 1   \n", ".panasonic.com\n1 \u00a9 Springer International Publishing Switzerland 2015 \nN. Zaman, Automotive Electronics Design Fundamentals , \nDOI 10.1007/978-3-319-17584-3_1    Chapter 1   \n Vehicle Electronics Architecture \n1.1                          Introduction \n    Early designs of automobiles used to have very little electrical content with very \nfew electrical parts, a bunch of connectors and a couple of harnesses with simple \nelectrical layouts. There were no microprocessors, or so to speak, no embedded \nsoftware. As a result of the growing needs and wants of the customer, car manufac-\nturers, government regulations and the availability of the analog, digital and micro-\nprocessor based integrated electronics kicked off the successful launch of an internal \ncombustion  engine controller ; a fairly sophisticated, mission critical, real-time com-\nputer located under the hood. The success of engine controller spawned the devel-\nopment of many critical vehicle functions by utilizing the embedded design like \nautomatic transmission and vehicle cruise control. An  automatic transmission  is an \nintriguing combination of \ufb02  uid dynamics, mechanics, electro-magnetic and \n electronics\u2014managing the power transfer between the engine and the gear train for \noptimal vehicle motion. The real challenge for this design is the precise control of \nhydraulic valves and the sensitive torque detection mechanism to select the optimal \ngear-speed. The  cruise control  is a function that manages the engine throttle to \nmaintain a constant vehicle speed selected by the user. An advanced version of \ncruise control has been recognized as an  adaptive cruise control  that adapts to the \nspeed of a slow-moving vehicle ahead of you by automatically reducing your vehi-\ncle speed to maintain a safer distance. The radar detection based sensors are used to \nmeasure the vehicle speed moving ahead of you. An intriguing feature of  auto paral lel \npark assist  is a glowing example of incorporating electronics, electric motor steer-\ning, and object detection sensors. The function of auto parallel park assist is an \n Electronic supplementary material :   The online version of this chapter (doi:  10.1007/978-3- 319- \n17584-3_1    ) contains supplementary material, which is available to authorized users. zamann@us.panasonic.com\n2\nimpressive feature in a manner that it assists the driver to do parallel parking in a", " 319- \n17584-3_1    ) contains supplementary material, which is available to authorized users. zamann@us.panasonic.com\n2\nimpressive feature in a manner that it assists the driver to do parallel parking in a \nvacant, even tightly-spaced parking spot by relinquishing the steering wheel control \nto the embedded controller, the only example of hands-free reversing. At the end of \nthe vehicle maneuvers, you will \ufb01  nd yourself safely parked between the cars.  \n1.2     Instrument Cluster \n This is the most visible device of any vehicle. It displays information such as the \nvehicle speed, fuel quantity, engine temperature, engine rpm and gear position, \namong other features. It used to be a \u2018dumb\u2019 display with dial-pointers coupled \nmechanically to the mechanical sensors\u2014but today\u2014it has turned into an intelli-\ngent embedded device that has a direct \u2018hot line\u2019 to the engine controller, and a few \nother modules. It conveys critical early warnings and cautions to the driver by means \nof dial pointers, visual displays, audible tones and telltales. Added features include, \nbut are not limited to: seat-belt status, fuel consumption computations, oil change \nwarnings, tire pressure information, multiple trip mileage logging, and operational \nstatus monitoring of other vehicle systems.  \n1.3     Heating and Cooling \n The heating and air conditioning in a typical vehicle requires an engine driven air- \nconditioning compressor pump and a speed-controlled blower motor to distribute \nwarm and cool air through air outlet registers. Is there a reason for electronics or \nembedded design to be added to this simple application? The answer is both yes and \nno, depending on the type of vehicle or manufacturer. Some  HV AC  ( H eating \n V entilating &  A ir  C onditioning) systems are simple and do not require embedded \ncontroller, but some require an embedded controller to provide better system perfor-\nmance, enhanced temperature control, additional informed-display, system self- \ntests, diagnostics, troubleshooting features and more.  \n1.4     Airbag Safety \n Fatal car accidents and crashes triggered the need to improve passenger road safety. \nThe airbag, a cushion of air in a bag, can protect the occupant from accident impact \nif opens in timely moment. The decision to trigger the airbag \ufb01  ring circuits that \ndeploy the airbag", " passenger road safety. \nThe airbag, a cushion of air in a bag, can protect the occupant from accident impact \nif opens in timely moment. The decision to trigger the airbag \ufb01  ring circuits that \ndeploy the airbag to save the occupant\u2019s life must be made within a fraction of sec-\nond to mitigate the impact of a potentially deadly force. Today in the world of \nembedded design, it is possible to trigger the airbag \ufb01  ring circuits with the aid of a \nmicrocontroller by utilizing the vehicle movement sensors, impact detection mech-\nanisms, and complex deterministic software algorithms. Here rests the need of 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n3\nairbag embedded software, electronics and positional accelerometers packaged in a \nseparate mechanical housing attached to the rigid vehicle chassis. Further interfaces \nto the airbag module are seatbelt position sensing circuits, sophisticated airbag \ufb01  r-\ning mechanisms and a backup power supply. The airbag system is safety-critical \nequipment, and in the realm of automotive electronics it enjoys the highest level of \nfault-tolerant system with least possible dependency on other vehicle resources due \nto nature of its intended safety task.  \n1.5     Antilock Brake, Traction and Stability \n If you live in a place where snow is second nature, then you are the right candidate \nfor a vehicle with an  anti-lock brake  mechanism. Antilock brake systems can miti-\ngate undesirable vehicle slip movements during icy and slippery conditions that \npervade this season. This slippage occurs when one drives on slippery road condi-\ntions and applies brakes that tend to lock one or more wheels due to the low traction. \nThe loss of even traction\u2014on top of a slippery road\u2014causes the vehicle to spin out \nof control. In order to control the wheel skidding motion, the skidding-wheel brake \nmust be released swiftly and automatically to prevent the vehicle from going out of \ncontrol. Indeed, that is the function of a typical antilock brake system. The antilock \nsystem performs tasks to avoid wheel locking conditions while the brakes are \napplied, and it does this automatically by measuring the angular velocity of each \nwheel, thereby calculating the potential slip conditions. An anti-locking brake sys-\ntem is composed of sensors which are able to sense the rotational speed of each \nwheel, perform computations", ", and it does this automatically by measuring the angular velocity of each \nwheel, thereby calculating the potential slip conditions. An anti-locking brake sys-\ntem is composed of sensors which are able to sense the rotational speed of each \nwheel, perform computations based on parameters like vehicle speed and vehicle \nattitude and then use the solenoid controlled valves to apply and release respective \nbrakes to counter the wheel locking conditions. The mechanism provides self- \ngoverning, single or multiple wheel brake control without any efforts from the \ndriver as long as the brake pedal is pressed. \n This has been made possible by virtue of an embedded controller developed to \nsupport a powerful closed-loop control algorithm along with the system compo-\nnents mentioned earlier and a motor controlled pump to generate the brake pressure \nhydraulics. An added feature within this domain of sensors, augmented by few more \ndevices has been recognized as  traction control  where it helps to maintain and \nenhance the vehicle stability.  \n1.6     Power Assist Steering \n Power steering is not new for vehicles requiring power-assist steering efforts during \nturns and maneuvers. It is a system based on the \ufb02  uid dynamics torque characteris-\ntics utilized in the steering system to assist the driver in steering the vehicle by \nuniform optimum efforts. The hydraulic steering system uses the engine-driven \npump to create hydraulic pressure to realize the vehicle power steering efforts. 1.6 Power Assist Steeringzamann@us.panasonic.com\n4\nAt higher vehicle speeds, the steering system adds low power assistance whereas \nmore power assistance is added when the vehicle is moving slowly or parked. \nAutomotive manufacturers have been working on two different topologies to \ndevelop an advanced steering system. One works on the principal of hydraulics \ufb02  ow \nmetering and the other uses a high torque electric motor. Both topologies could be \naugmented by embedded design. Development has not stopped here. OEM\u2019s are \nnow debating to disconnect the complete mechanical linkage from the steering col-\numn, and wish to steer the vehicle by means of electrical motors and actuators. The \nfully integrated system will not have any mechanical linkages but rather it will func-\ntion by utilizing the electronic sensors, motors, actuators and an embedded design. \nA buzz- word in the automotive industry \u2018x-by-wire\u2019 has been used to classify such \nsystems that utilizes electronic sensors to capture the customer", " will func-\ntion by utilizing the electronic sensors, motors, actuators and an embedded design. \nA buzz- word in the automotive industry \u2018x-by-wire\u2019 has been used to classify such \nsystems that utilizes electronic sensors to capture the customer commands and con-\ntrols the vehicle systems with the aid of actuators and motors by incorporating \nembedded design. \n Before we explore more on \u2018x-by-wire\u2019 systems, let\u2019s review the concept of \u2018\ufb02  y-\nby- wire\u2019 which was introduced much earlier than \u2018x-by-wire\u2019 systems. Historically \nthe word \u2018\ufb02  y-by-wire\u2019 was \ufb01  rst coined in Avionics design segment ( Avi ation \nElectr onics  ) where it refers to the \ufb02  ight control surfaces like ailerons, elevators, and \nrudder\u2014controlled by actuators and commanded by computers, when a pilot issues \nthe command by moving the control yoke or rudder pedal. In essence, the pilot input \ngoes to the sensors and not directly to the conventional mechanical linkages attached \nto the control surfaces. \n    So, what is a conventional mechanical system? A conventional mechanical sys-\ntem is drawn in    Fig.  1.1 . The mechanical linkages are attached to the cables and \nmove control surfaces proportional to the pilot\u2019s command. The mechanical feed-\nback allows the control surfaces to achieve the applied requested position.\n1.7        Avionics Fly-By-Wire (FBW) \n Unlike conventional mechanical systems, \ufb02  y-by-wire systems do not use mechanical \nlinkages that need to be attached to the pilot controls. Instead, the pilot commands \ngo to the electronic sensors and are transmitted as a proportional electrical quantity Feedback Control Surfaces Primary Flight Controls\n(Pilot Commands)Mechanical Linkage\nHydraulic Actuators Control Valves \n     Fig. 1.1    Conventional mechanical system. Source: Boeing: Fly-By-Wire Flight Controls (B777: \nPublic Domain Publications)        1 Vehicle Electronics Architecturezamann@us.panasonic.com\n5\nto the respective electronics interface unit that digitizes the signals. The digitized \nsignals are then fed to the primary \ufb02  ight computers where the appropriate process-\ning is done. Once the processing is furnished, the computers then sends the elect", " the respective electronics interface unit that digitizes the signals. The digitized \nsignals are then fed to the primary \ufb02  ight computers where the appropriate process-\ning is done. Once the processing is furnished, the computers then sends the electri-\ncal commands to actuate the actuators that move the control surfaces to the required \ndesired position. The feedback mechanism monitors the  operation of control sur-\nfaces. A simpli\ufb01  ed block is shown in Fig.  1.2 \n1.8        Automotive X- By-Wire \n Conventionally, vehicle controls such as the brake, steering and acceleration are \nmechanically connected to their relevant systems. The brake pedal is attached to the \nbrake system, the steering wheel is coupled to the steering system, and the accelera-\ntor pedal is linked to the engine throttle by means of mechanical linkages or cable. \nThe basic design philosophy behind \u2018x\u2019 by wire in the minds of automotive OEMs \nis to remove the mechanical linkage between the driver and the systems, and use \nelectrical controls to perform all functions. The \u2018x-by-wire' is the buzz word, which \nharnesses all three systems, namely Brake, Drive or Steer. Buzz words like \u2018Brake-\nby- wire\u2019, \u2018Drive-by-wire\u2019 and \u2018Steer-by-wire\u2019 and are often synonymously used for \nthis purpose. \n1.8.1     Brake- By-Wire \n A brake-by-wire is the concept of using electrical actuators to actuate the brake \npads. The concept is sketched in Fig.  1.3 . The brake pedal is no longer coupled \ndirectly to the brake system, but rather it is connected to the brake pedal sensors. \nThe sensor transforms the electrical signal to the proportional brake pedal demand \nand feeds it to the embedded controller. The embedded controller drives the electri-\ncal actuators to push the brake pads. A feedback is required to know the rate of \ndeceleration that is furnished by the aid of a wheel speed sensor.Control Surfaces Control Yoke &\nRudder Pedal \nSensors ComputersActuators\nFeedback InterfaceActuator\nControl\nElectronics\n  Fig. 1.2    Avionics \ufb02  y-by-wire system. Source: Boeing: Fly-By-Wire Flight Controls (B777: \nPublic Domain Publications)       ", "Actuator\nControl\nElectronics\n  Fig. 1.2    Avionics \ufb02  y-by-wire system. Source: Boeing: Fly-By-Wire Flight Controls (B777: \nPublic Domain Publications)        1.8 Automotive X- By-Wirezamann@us.panasonic.com\n6\n1.8.2        Steer- By-Wire \n The steer-by-wire (SBW) is the concept of steering the vehicle with the aid of an \nelectric motor. The steering wheel position sensor senses the steering position, \ntransmits electrical demand to the embedded controller. This enables the software to \ndrive the motor to steer the wheels. The wheel position sensor transmits the feed-\nback signal to the embedded controller to perform the closed-loop functions. Please \nsee Fig.  1.4  for a one possible solution.\n1.8.3        Drive- By-Wire \n The drive-by-wire is the concept of using an electric motor to control the engine \nthrottle and remove the mechanical linkage to the throttle. One possible solution is \nshown in Fig.  1.5 . It is similar to preceding example. However, the control-loop is \nsensing multiple parameters of the throttle-position sensor, the engine torque and \nrpm to verify and validate the intended operational command by the customer.Wheel Speed Sensor Brake Pedal Sensors Embedded ControllerActuators Brake PadsBrake Pedal\n  Fig. 1.3    Automotive Brake-by-wire (BBW)       \nWheel Position SensorSteering Position SensorEmbedded ControllerMotorsFront WheelsSteering Wheel\n  Fig. 1.4    Automotive Steer-by-wire (SBW)        \n 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n7\n   The OEM\u2019s are debating whether or not to disconnect the complete mechanical \nlinkage from the steering wheel. However, it is a safety-critical issue that requires a \nfederal safety board review and approval. It is worth noting that the aerospace \nindustry still kept the mechanical linkages in the \ufb02  y-by-wire systems as a back-up \nsafety should there is a complete \ufb02  y-by-wire system failure. \n Another intriguing application in the \ufb01  eld of steering controls is the rejuvenation \nof a 4-wheel steering system. The initial concept, developed many years ago, has \nl", " \ufb02  y-by-wire system failure. \n Another intriguing application in the \ufb01  eld of steering controls is the rejuvenation \nof a 4-wheel steering system. The initial concept, developed many years ago, has \nlately received more attention due to easy accessibility of advanced embedded \ndesign tools and software that could be used to develop better systems. The 4-wheel \nsteering system augments the driver\u2019s efforts in a large wheel-base vehicle to reduce \nturning radius and maintain better stability control.   \n1.9     Tire Pressure Monitoring \n The increased roll-over accidents involving a number of fatalities had triggered seri-\nous concerns by the federal government agencies. Low tire pressure was blamed as \nthe major contributor to many unfortunate losses of life. The US congress passed an \nauto safety bill called the  T ransportation  R ecall  E nhancement  A ccountability and \n D ocumentation act (TREAD) mandating the National Highway Transportation \nSafety Administration (NHTSA) to develop a safety standard for the OEM\u2019s to \ninstall the tire pressure monitoring system. The vehicle manufactures were then \ngiven a time period of 3 years to complete the TPMS installations. The 3 years \ndeadline that expired in 2006 had forced the OEMs\u2019 to implement the tire pressure \nmonitoring system in vehicles sold across the United States of America. \n The tire pressure monitoring system uses two different topologies to calculate \nthe tire pressure and alert the driver for a low tire-pressure warning: (1) indirect \nmethod; and (2) direct method.\n    1.    The  indirect-method  measures the angular velocity of each tire and computes the \ncircumference of the tire and compares it to the pre-de\ufb01  ned tire circumference 1. Throttle Position Sensor\n2. Engine torque, rpmPedal Position SensorEmbedded ControllerMotorsEngine Throttle Accelerator Pedal\n  Fig. 1.5    Automotive Drive-by-wire (DBW)        1.9 Tire Pressure Monitoringzamann@us.panasonic.com\n8\nknown previously at an accurate in\ufb02  ate radius. By knowing the difference of \nradius the embedded software calculates the tire pressure. \n This method employs continuous software tasks to measure the rotational tire \nspeed of all four tires in order to compute in real-time the tire pressure. In real \nworld it is extremely slow and", " difference of \nradius the embedded software calculates the tire pressure. \n This method employs continuous software tasks to measure the rotational tire \nspeed of all four tires in order to compute in real-time the tire pressure. In real \nworld it is extremely slow and time-consuming algorithm.   \n   2.    The  direct method  uses the tire pressure sensors installed on each tire. The sensor \nuses self-contained long-life battery (5\u201310 years) to power the senor electronics \nmounted on each tire. The battery operated sensor measures the tire pressure and \ntransmits that information by modulating the data over radio frequency carrier \n(global G5 or G6 band) to the receiver. The transmitter is positioned inside the tire \nor mounted at the tire valve-stem. The receivers are positioned inside the vehicle \nelectronics module. The data transmitted over the RF signal includes coded infor-\nmation proportional to the tire pressure with proper wheel identity. All four tire \npressure sensors installed on each tire sends-out the identity information of the \ninstalled wheel location. At the receiving end, the embedded controller or the \nvehicle electronics module with the aid of an RF receiver decodes that informa-\ntion, and then processes it to alert the occupants for the low tire- pressure cautions \nand warnings. The cautions may include an aural sound, chime or a message \ndisplayed at a convenient location to warn about the low tire pressure.      \n1.10     Modules Count \n So far we have captured eight major electronics and embedded design applications \nrelated directly to vehicle function. These are summarized below:\n    1.    Engine Controller   \n   2.    Transmission Controller   \n   3.    Instrument Display   \n   4.    Heating, Ventilation and Air-conditioning Controls   \n   5.    Airbag Deployment   \n   6.    Anti-lock brake   \n   7.    Power Steering   \n   8.    Tire Pressure Monitoring     \n As listed, a minimum of eight microcontrollers are needed to implement all of \nthe vehicle-related functions, assuming the fact that we intend to develop eight sep-\narate modules. \n At this time you might want to ask a question: Why would we need eight micro-\ncontrollers? Why can\u2019t just one single processor like in today\u2019s personnel computer \nand the windows CE Operating system by Microsoft or any other real time operat-\ning system (RTOS) to implement all automotive functions? \n The answer is not", " micro-\ncontrollers? Why can\u2019t just one single processor like in today\u2019s personnel computer \nand the windows CE Operating system by Microsoft or any other real time operat-\ning system (RTOS) to implement all automotive functions? \n The answer is not that simple, and requires thorough understanding of many \n factors like module functionalities, module installation locations, safety, redun-\ndancy, wiring lengths, operating zones, harness routing schemes, and realization of 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n9\na  powerful real time operating system. All of these factors must be understood in \ngreat detail before \ufb01  nalizing an informed decision on a single computing architec-\nture. By the time you \ufb01  nished reading this book, you may be able to conclude by \nyourself the answers to this question and many others you might have. \n Here is another quick question you might like to ask at this moment:\n   Is this all for embedded functions in a typical vehicle?\n \u2013    The answer is a de\ufb01  nite no.       \n Every vehicle has door-locks, window-glasses, window-heaters, wiper-motors, \nheadlamps, tail lamps, turn signals, interior lights and numerous other functions. \nAutomotive manufacturers have assigned a separate module to integrate all of these \nfunctions by incorporating electronics and embedded controllers. Sometimes all of \nthese functions are called out as vehicle-body-functions. In the early days of auto-\nmobiles, these functions used to be \u2018straight-wire-switch\u2019 topology where a lamp is \nconnected to the battery through a fuse with a switch. However, in advanced auto-\nmotive electronics architecture, it has been integrated as an embedded function \nrequiring hardware and software-tasks that has to be developed and deployed. \n Additional features like motorized-seats, temperature-controlled seats, motor-\nized side-view mirrors, solenoid-operated door locks, solid-state lamps, motorized-\nsun- roof, and reverse parking assistance\u2014collision avoidance, lane change warning \nand smart headlamps have been implemented as embedded functions. These embed-\nded functions add value and customer convenience like when the customer turns \nremote keyless entry to lock or unlock the vehicle, or utilizes the dimming switch to \ncontrol the interior lights or invokes the remote car starter.  \n1.11     Straight-Wire-Switch Topology \n The rule of thumb, \u2018straight-w", " keyless entry to lock or unlock the vehicle, or utilizes the dimming switch to \ncontrol the interior lights or invokes the remote car starter.  \n1.11     Straight-Wire-Switch Topology \n The rule of thumb, \u2018straight-wire-switch\u2019 topology was the \u2018old fashion\u2019 way of \ndoing things and embedding a function is a new paradigm. Nevertheless, before you \ndecide to jump on to the embedded-functions bandwagon, make sure that the cost \nand time-to-market is not an issue and that your customer is willing to pay the price \nso the function is not just a  lamp on the vanity mirror . \n A \u2018straight-wire-switch\u2019 topology is shown in the Fig.  1.6 , where the battery \npower feeds the lamp in-series to a fuse with a switch. When the switch was placed \nFuse\nBattery+SwitchBatteryHead\nLamps\n  Fig. 1.6    \u2018Straight-wire-switch\u2019 Topology        1.11 Straight-Wire-Switch Topologyzamann@us.panasonic.com\n10\nat a closed position, the lamps turned-off, and when it was switched to an open \n position, the lamps turned-off. The fuse protects the wiring and battery against \nfaulty conditions. For example, an excessive current draw due to a short-to-ground \ncondition. The fuse \u2018blows\u2019 if the current exceeds its rated value after a pre-de\ufb01  ned \nperiod of time, thus opening up the circuit to avoid catastrophic damage to the active \ncomponents, which may cause \ufb01  re or turn into a safety hazard.\n   In the early day of automobiles, almost all electrical contents in a typical vehi-\ncle like window-glass-motors, defrost heater, door-lock-solenoids, turn signals, \nheadlamps, and many others\u2014have traditionally used 'straight-wire-switch' topol-\nogy. However, this has changed over the past couple of years in the highly com-\npetitive market, where the customers are willing to pay the price and are ready to \naccept the changes. \n United States of America, Japan, Europe, and Australia are examples where \ntough competitions have forced OEMs to adapt to the embedded functions. \n The embedded functions have been realized and generally categorized in the fol-\nlowing areas:\n\u2022    Engine controls, Power Train and Cruise Controls  \n\u2022   Safety, Security and", " \ntough competitions have forced OEMs to adapt to the embedded functions. \n The embedded functions have been realized and generally categorized in the fol-\nlowing areas:\n\u2022    Engine controls, Power Train and Cruise Controls  \n\u2022   Safety, Security and Comforts  \n\u2022   Driveline & Axle  \n\u2022   Motion, Stability and Chassis Control  \n\u2022   Radio, Audio, Video and Navigation  \n\u2022   Consumer to Automotive Interface    \n It is interesting to note that the automotive market in developed markets intro-\nduced advanced concepts much earlier than the developing or emerging markets. \nSome good examples are adaptive cruise controllers and 3D GPS navigation sys-\ntems, which have successfully been introduced in Japan earlier than many other \nmarket segments. \n Some of the concepts and designs have been embedded as a result of homologa-\ntion requirements. For example, the European market has the homologation require-\nments of maintaining the headlamp-beams aim toward way-points, and must not \naim unnecessarily upwards or downwards while the vehicle is travelling through an \nuneven terrain. The European regulation requires that the headlamps aiming must \nbe compensated throughout the entire phase of vehicle upward or downward move-\nments due to uneven terrain. Indeed, in order to furnish headlamp aiming tasks, a \nmotorized headlamp assembly with vehicle pitch-attitude sensor is required to work \nwith an embedded controller. \n Another intriguing example is an auto-parking feature to demonstrate the use of \nimage processing sensors to furnish the parallel parking capabilities. Recently an \nadaptive headlight feature has been introduced where the headlights turns before the \nvehicle turns in order to show the way-points ahead of you in advance. Just on the \nsame principle collision avoidance, and lane departure warnings have been added in \nautomotive domain. \n The list of advanced and intriguing features goes on. 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n11\n Some parts of the world where technology, life style, marketing strategy, target \ncustomers and the industrial infrastructure have not grown matured enough to \n handle advance automotive electronics functions, the \u2018straight-wire-switch\u2019 topol-\nogy has still its merits. \n If you happen to live in a place where automotive electronics is a \u2018never heard \nbefore!\u2019 phrase with a shrug, then you have an entire new market segment waiting \nto take up the challenge. If you wish to accept the challenge and have desire to \nintroduce embedded functions to attract", " automotive electronics is a \u2018never heard \nbefore!\u2019 phrase with a shrug, then you have an entire new market segment waiting \nto take up the challenge. If you wish to accept the challenge and have desire to \nintroduce embedded functions to attract a customer\u2019s attention then you might want \nto research how to generate value added results by selecting the functions that could \ngenerate real tangible results. \n Historically, automotive radio was the most visible and interactive introduction \nto the customer, and by its nature, added for convenience to the customer. However, \nthe tangible results were achieved when the engine controller was introduced. The \nengine controller had not only facilitated the engine to work and operate ef\ufb01  ciently, \nbut also relieved customers from the recurring engine maintenance cost.  \n1.12     Embedded Function \n Embedding a lamp function requires an embedded controller, embedded software, \nand an electronic-switch to supply battery-power to the lamp. The software code, \nstored inside the controller, adds intelligence to perform extended functions such \nas fused-lamps detection, system faults, and automatic switching of the lamp. As \ncan be seen from Fig.  1.7 , the embedded controller is controlling the headlamp \ndirectly, and the switch is only used to signal the embedded controller to turn on/\noff the headlamps. Recall in a \u2018straight-wire-switch\u2019 topology the switch was \ndirectly connected to the battery, fuse and the headlamps. However, with an embed-\nded application, the headlamp turn on/off- switch is no longer connected to the \nbattery instead detected by the intelligence of the microcontroller. The intelligence \nthen uses an additional electronic-switch to control the headlamp to be turned-off \nand turned-on.\n   Also note how the power to the headlamps is drawn directly from the battery. \nLater, we will explore why this direct power-drive to the headlamps is controlled by \nBattery+\nFuse\nSwitchBattery\n Embedded\nController\nHead\nLamp\nElectronic\nSwitch\n  Fig. 1.7    An embedded functional block        1.12 Embedded Functionzamann@us.panasonic.com\n12\nthe embedded controller as well. Indeed, embedding a function does add  complexity, \nbut with more bene\ufb01  ts. The bene\ufb01  ts in the longer run are helpful and intriguing. \n A brief overview of embedded functions verses its overheads are tab", " well. Indeed, embedding a function does add  complexity, \nbut with more bene\ufb01  ts. The bene\ufb01  ts in the longer run are helpful and intriguing. \n A brief overview of embedded functions verses its overheads are tabulated in \n   Table  1.1 . As summarized in the table the activities of product development \ncycle have many overheads. There are tasks and challenges for the development \nteam to de\ufb01  ne hardware & software requirements, system interfaces, write code, \nand struggle through hardware and software integration process to prove that the \nproduct is working as intended. While the electronics team is performing these \ntasks, the mechanical design team has to enclose the electronics in a proper \ufb01  t, \nform and \ufb01  nish.\n   When the design meets the needs and wants of the intended function, and a \nprototype module is available, then it is tested at various test set-ups and \ufb01  nally \nconnected to the vehicle interfaces by using wiring and connectors. Testing, veri-\n\ufb01 cation and validations are conducted at the basic module level and then carried \nup to the vehicle level. At the vehicle level, weight and space is also a signi\ufb01  cant \nfactor. The wiring and connectors are mandatory requirements to realize a mod-\nule\u2019s physical installation so that it could be connected to the vehicle interfaces \nand other harnesses. \n However, nothing is free in the design and development world, so cost and time \nare additional factors one has to consider before switching to embedded paradigm \n An interesting application of embedded lamp function is the auto-lamp function, \nwhere the headlamps can be turned-on automatically when the ambient light condi-\ntion falls below a certain lighting threshold. Additional bene\ufb01  ts of embedding a \nfunction includes, but is not limited to, system fault-detection, fused-lamp detec-\ntion, self-test and automatic lamp shut-off. Please see the Table  1.1  for an overview \nof head lamp embedded features verses overheads. \n If it is desired to use High Intensity Discharge (HID) type head lamps, then the \nembedded controller can be \ufb01  tted with HID drivers, and when it is desired to use an \narray of light emitting diodes (LED) then it will have to be driven by LED drive \ncircuitry. An interesting feature of lamps or LED", " be \ufb01  tted with HID drivers, and when it is desired to use an \narray of light emitting diodes (LED) then it will have to be driven by LED drive \ncircuitry. An interesting feature of lamps or LED\u2019s is its light dimming control. The \nlight dimming control of lamps, or LED\u2019s, requires modulation to the power driving \npulses. Hence, in any application of lighting, if it is desired to control the light dim-\nming control then the embedded controller should be \ufb01  tted with  P ulse  W idth \n M odulated (PWM) drive circuitry to control the lamp intensity. The pulse width \n    Table 1.1    Head Lamp embedded features verses the overheads   \n Head lamp embedded features  Overheads \n \u2022 Fault detection  \u2013 Design  \u2013 Development \n \u2022 Automatic lamp control  \u2013 Hardware  \u2013 Software \n \u2022 Automatic shut-off  \u2013 Weight  \u2013 Space \n \u2022 Fused-lamp detection.  \u2013 Wiring  \u2013 Connector \n \u2022 Software Function/Upgrade  \u2013 Test  \u2013 Validate \n \u2022 Self-test 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n13\nmodulation is manageable with the aid of an embedded controller and a piece of \nsoftware code. The LED headlamps and tail lamps have already been introduced in \nthe automotive industry, and are increasingly showing strong market demand for \nvariety of automotive applications. A strong presence of cockpit-related applica-\ntions are indicating that the vehicle instruments and lighting systems will eventually \nbe using high-power LED\u2019s even for exterior lights in a typical vehicle.  \n1.13     A Conventional Radio \n The passion of embedding automotive functions had grown so strong that today \nsound features of a car-audio like volume, base, fader, treble and balance are no \nlonger simple analog-type applications\u2014rather all the sound functions of a decent \ncar-radio are carried out by the digital signal processors (DSP) with the assistance \nof an embedded controller. \n In order to present a comparison of a conventional radio verses the embedded \nradio, a block diagram of a conventional radio is shown in Fig.  1.7 . As can be seen \nin the block diagram, the RF (Radio Frequency) tuner is connected to the antenna in \norder to capture the radio frequency signal energy. The tuning knob connected to the \ntuner is used to tune the incoming radio signal", " As can be seen \nin the block diagram, the RF (Radio Frequency) tuner is connected to the antenna in \norder to capture the radio frequency signal energy. The tuning knob connected to the \ntuner is used to tune the incoming radio signal (FM 98.5 or 105.1 \u2026 radio station \nfor example). Once the station is tuned to the desired channel, the carrier frequency \nis demodulated, and the signal is fed to the intermediate frequency (IF) ampli\ufb01  er. \nThe signal is then fed to the audio power ampli\ufb01  er to drive the speakers. The \nswitches and knobs control the audio sound features by adjusting the gains and tun-\ning frequencies using variable active or passive components, which are basically \nconnected to the tuning circuits and ampli\ufb01  ers. The dials and pointers are the status \ninformation for the user to know the station tuned, volume level and band. \n Note the absence of microcontroller, Digital Signal Processor (DSP) and how the \nsound features are controlled by switches and knobs\u2014connected directly to the \npower ampli\ufb01  er.  \n1.14     An Embedded Radio \n As stated earlier, the embedded-radio sound functions are carried out by software \nwith the aid of a Digital Signal Processor (DSP) and a microcontroller. Both, work-\ning as a team with other peripherals, furnish all the functions associated with a radio \ndrawn in Fig.  1.8 . The software plays a huge role in an embedded radio. Software \ntasks are shared by the DSP and the microcontroller. The signal-processing, math- \nintensive calculation tasks and powerful stored algorithms are executed by the DSP; \nhowever, the control over all other peripherals including user interaction is managed \nby the microcontroller. The embedded controller on one hand interacts with the \nuser, and on the other hand communicates with the DSP, programmable radio fre-\nquency (RF) tuner, audio power ampli\ufb01  er and other peripherals.1.14 An Embedded Radiozamann@us.panasonic.com\n14\n   It is interesting to note that the user controls like power On-Off switch, station \ntuning and volume controls are inputs to the microcontroller, and are no longer \ndirectly connected to the tuner or the ampli\ufb01  er, which is different than what has \nbeen done in the conventional radio.", " switch, station \ntuning and volume controls are inputs to the microcontroller, and are no longer \ndirectly connected to the tuner or the ampli\ufb01  er, which is different than what has \nbeen done in the conventional radio. The radio station-tuning is achieved by sending \ndigital commands to the programmable tuners. The signal \ufb01  ltering, audio and radio \nprocessing is primarily performed by the digital signal processor \n The customer requests, in the form of key-presses and knob-adjustments, go \ndirectly to the microcontroller as depicted in Fig.  1.8 . \n The output of the DSP feeds the audio ampli\ufb01  er either through a pre-ampli\ufb01  er or \ndirectly to the power ampli\ufb01  er, which drives the speakers. Now, the question comes \nto your mind: \n How do I see which station I tuned to? How do I control other settings like vol-\nume, base, treble, balance, fader and more? \n The answer to this and many other user interactions and requirements are \nresolved by adding a switch-matrix and a display. The switch matrix allows the \nuser-commands to be read by the microcontroller. The display shows the status \nof adjustments, thereby enabling the customer to dynamically interact with the \nradio functions. The block diagram of an embedded radio is shown in Figs.  1.8  \nand  1.9 .Antenna\nSWITCHES\nKNOBS\nRF\nTUNER\nIFAMP,\nDETECTOR, AGC\nAUDIO\nPOWER\nAMP\nSPEAKERS\nDIALS, POINTERS\n  Fig. 1.8    A conventional radio        1 Vehicle Electronics Architecturezamann@us.panasonic.com\n15\nSIGNAL\nPROCESSING\nSOFTWARE *\nSwitch-Matrix\nAudio\nAntenna\nData RF Signal\nAPPLICATION\nSOFTWAREKey:\nSoftware Control sSWITCHESMICRO  DSPPOWER AMP \nTUNER SPEAKERS\nDISPLAY Volume Knob \nTune Knob\n  Fig. 1.9    An embedded approach to audio and radio functions       \nApplica/g415on Code Network Opera/g415ng So/g332ware\nPOWER SUPPLY\n PROTECTIONS\n RESET\nMODULE COMMUNICATION NODE\nIGNITION CIRCUIT\nINPUT CIRCUITS\nWARNINGS & \n", " functions       \nApplica/g415on Code Network Opera/g415ng So/g332ware\nPOWER SUPPLY\n PROTECTIONS\n RESET\nMODULE COMMUNICATION NODE\nIGNITION CIRCUIT\nINPUT CIRCUITS\nWARNINGS & \nCAUTIONS \nELECTRONIC \nSWITCHES\nA\nN\nPROCESSING\nN A\n  Fig. 1.10    General Block Diagram of a module        \n 1.14 An Embedded Radiozamann@us.panasonic.com\n16\n1.15        Distributed Vehicle Architecture \n An overview of electrical layout of the distributed processing architecture is shown \nin Fig.  1.11 . Each module uses a dedicated microcontroller to sense and control its \nown domain of input sensing circuits (sensors, switches\u2026), and output control IGNITION\nSWITCH\nFUSE\nFUSE\nFUSE\nFUSE\nFUSE\nFUSE\nFUSE\nKEY:\nNetwork Operating Software\nModule Application Software\nModule  BATTERY ( B+ ) COMMUNICATION LINK\n  Sensors,Switches  Actuators,Lamps\nEngine Controller\nTransmission Controller\nInstruments & Displays\nTire Pressure Monitor\nVehicle Body FunctionsHVAC Controls & Displays\nAirbag Logic & Drive\nAntiskid Logic & Controls\nPower Steering Assist\n A  A \n N N  \n A  N  \n A  N  \n A  N  \n A  N  \n A  N  \n A  N  \n A  N  \n A  N  \n  Fig. 1.11    Modules distributed vehicle architecture        1 Vehicle Electronics Architecturezamann@us.panasonic.com\n17\ndevices (actuators, lamps, motors, heaters\u2026). Modules share fuses, an igni tion switch, \nbattery power and a serial communication bus to talk to each other. The block shows \nonly a single communication backbone, but in the real world multiple backbones \nhave been used in a typical vehicle. However, for the sake of clarity, only a single \nbus is shown in the Fig.  1.11 .\n    As can be seen, the vehicle battery is the primary source of power for the elec-\ntronic modules. The ignition switch is the primary-switch to apply power to the \nmodules. \n The battery feed going directly to the module through the fuses does not mean \nthat every module is consuming full power at all times. There are electronic switches \ninside some", " The ignition switch is the primary-switch to apply power to the \nmodules. \n The battery feed going directly to the module through the fuses does not mean \nthat every module is consuming full power at all times. There are electronic switches \ninside some of the modules that only allow full or partial power needed to be used. \nFor example in case of \u2018Delayed Accessory\u2019 feature of a typical car\u2014electronic \nswitches inside the modules keep the module power on for a de\ufb01  ned period of \ntime\u2014even after the ignition switch is turned-off. The software application code \n(A) and the network operating software (N) rests inside the modules ful\ufb01  lls few \nmajor requirements: (Fig.  1.10 ).\n\u2022    It must hold the application code to ful\ufb01  ll the intended functional requirements.  \n\u2022   It must hold the diagnostics code to ful\ufb01  ll the diagnostics requirements.  \n\u2022   It must keep a copy of the network operating software.  \n\u2022   It must keep the database of the messages needed to be sent or received.  \n\u2022   It must keep the calibration \ufb01  le if it is needed for that particular module  \n\u2022   It must keep the module nomenclature, and module related identi\ufb01  cations    \n In the distributed processing of vehicle electronics architecture, the following \nblocks are essential for every module:\n\u2022    Microcontroller and its associated hardware  \n\u2022   Application speci\ufb01  c software code  \n\u2022   Diagnostic related functions and features  \n\u2022   Electronics interface for the input sensors and switches  \n\u2022   Electronics interface for the output devices and interfaces    \n The physical existences of modules are realized by developing the following \nitems:\n\u2022    Printed Circuit Board (s)  \n\u2022   Physical Dimensions  \n\u2022   Housing & Cover  \n\u2022   Module connector (s)  \n\u2022   Mounting and installation scheme    \n In a typical vehicle, modules are installed at a different mounting location across \nthe vehicle. The wiring harness that connects the modules to the relevant devices \nvaries in lengths and routing schemes. Modules differ in \ufb01  t, form and function sub-\nject to the physical realization of the embedded functions. 1.15 Distributed Vehicle Architecturezamann@us.panasonic.com\n18\n It is important to understand that automotive manufacturers are not vertically \nintegrated to the vehicle electronics architecture. The electronic modules have \nbeen designed and developed by different companies (\u201c", "1.15 Distributed Vehicle Architecturezamann@us.panasonic.com\n18\n It is important to understand that automotive manufacturers are not vertically \nintegrated to the vehicle electronics architecture. The electronic modules have \nbeen designed and developed by different companies (\u201csuppliers\u201d is the com-\nmon term used about these companies) by incorporating their own platform of \nprocessing architectures, algorithms, and electronics. This essentially means that \ncommon electronic-blocks like H-Bridges, pulse-width modulated controllers, \n high-side- switches, low-side-switches, signal-conditioners, microcontrollers, mem-\nory address space of RAM, ROM, EEPROM, and Flash memory\u2014embedded code \nsize, compilation tools and vehicle depended functional electronic-blocks may not \nbe the    \u2018copy-exactly 1 \u2019 circuits to the competitor\u2019s electronics design. So to speak, \nthis means that a fundamental electronics block for a precisely identical function \ncould be using a distinctly different technology, and an entirely different embedded \nsoftware among the competitors.  \n1.16     Custom Built Modules \n Every car manufacturer de\ufb01  nes their own set of requirements for the proposed \n module functions. The module external vehicle interfaces, connectors, wiring, har-\nness, fusing strategy and physical sizes are developed as spelled out by the respective \ncar OEM\u2019s hardware & software requirements speci\ufb01  cations. The requirements \nspeci\ufb01  cations development by each car OEM\u2019s are considered to be highly-\ncon\ufb01 dential in-house solutions. The paradigms of using in-house solutions are \ncopyright protected by every car manufacturer. Consequently in-house solution has \nmade it very dif\ufb01  cult to share the common designs and standards, which ultimately \nresulted with no cross-compatibility of modules across different car OEMs for the \nidentical-set of functions. Restating in other words, this means that you could not \nreplace an airbag module in an OEM \u2018A\u201d vehicle by removing an airbag module \nfrom the OEM \u2018B\u2019 vehicle or vice versa.  \n1.17     Modules Cross Compatibility \n You must be thinking that if there is no cross-compatibility of modules by different \ncar manufacturer then there must be a cross-compatibility within the frame-work of \na typical manufacturer? \n The answer is \u2018yes\u2019 and \u2018no\u2019. \n The modules are not necessarily designed to keep the upward or downward com-\npatibility even in an identical vehicle platform.", " must be a cross-compatibility within the frame-work of \na typical manufacturer? \n The answer is \u2018yes\u2019 and \u2018no\u2019. \n The modules are not necessarily designed to keep the upward or downward com-\npatibility even in an identical vehicle platform. In other words, it means that you \nmay not be able to replace an identical function module in an identical vehicle \n1   Copy exactly is an Intel term used to describe a methodology that matches the processes; it is used \nhere to make a point about dissimilar processes. 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n19\n platform owing to the differences incorporated due to the \u2018model year\u2019 changes or \nelse . The differences could either be that the new model year had deleted, added or \nmodi\ufb01  ed the hardware, software or a diagnostics feature. Nevertheless, exceptions \nare always possible\u2014yet obviously dependent upon the vehicle manufacturer.  \n1.18     Integrating Dissimilar Functions \n We now discuss some of the practical issues of combining the dissimilar functions \nat one common place in the vehicle by invoking some basic questions that will \nclarify the distributed functional needs and scope. \n The questions come to mind:\n   Why can some of the multiple dissimilar functions not be combined?  \n  Why can\u2019t a universal solution be materialized by developing a common module?    \n To answer this, we take the example of two well de\ufb01  ned modules namely \n \u2018headlamp leveling module\u2019 and the \u201cairbag module\u201d. \n In case of module controlling the headlamp leveling tasks, it requires motor \nadjustment mechanism be installed inside the headlamp assembly and it is compul-\nsory that it must be located at the front corners of the vehicle. The installation location \ncould not be compromised, so does the motor and electronics to control the move-\nment of headlamps. \n Now take the example of an airbag module, where, for all the good engineering \nreasons, airbag module must be mounted in the center of the vehicle chassis to assist \naccelerometers for precise measurements of vehicle \u201cpitch\u201d, \u201croll\u201d and \u201cyaw\u201d atti-\ntude. So the electronics and processing must have to be placed inside the module. \nFurthermore there is another rule that must be applied here that the airbag electronics \nand its controller are highly safety critical functions which must not be in\ufb02  uenced \nby any other module. There", " to be placed inside the module. \nFurthermore there is another rule that must be applied here that the airbag electronics \nand its controller are highly safety critical functions which must not be in\ufb02  uenced \nby any other module. There is no room for any other function to be shared with the \nairbag module. \n If you are convinced that these two dissimilar functions could not be combined \nto share installation location and electronics then you are correct in your judgment. \nAnd these are the basis on the decisive role for hardware, software, and mechanical \ndissimilarity in the module design. Therefore, it could be safe to say that  positional  \nsensitive non-identical functions are less likely candidates to become the functions \nof a universal module.  \n1.19     Integrating Identical Functions: A Universal Module \n Now comes the next logical question\u2014is it possible to design a single universal \nsolution for identical functions? The answer is \u2018yes\u2019 and \u2018no\u2019 depending upon the \nresponse from academics verses industry. The current trend in the automotive 1.19 Integrating Identical Functions: A Universal Modulezamann@us.panasonic.com\n20\nindustry is that all the major players are busy developing in-house solutions to \nimplement embedded functions. Consequently, there is no universal module that \nexists today for the identical functions where it could be used by other vehicle man-\nufacturer\u2014let\u2019s say, just by changing the software code. \n In the consumer industry, however, products have been developed to support \nuniversal solutions like USB, Wi-Fi, Bluetooth, or many other PCI based devices. \n No such universal automotive module came to life to be known famously. \nHowever, there are consortiums exploring the possibility of common standards and \npractices to achieve a consensus on a common platform. \n At this time, we hope that you must have already gotten the perception of \u2018in- \nhouse\u2019 solutions in the automotive industry. This paradigm, which had evolved for \nmany years eventually had resulted non-compatibility of electronics modules across \nthe board. The overall impact to the customer is parts availability from a limited \nsource, and a redundant competition among OEMs. Custom design solutions are not \neasy to handle in the maintenance phase of the vehicles. Any module failure in the \n\ufb01 eld requires real \u2018genuine\u2019 replacement due to lack of interoperability. \n The upward or downward compatibility is a big concern if the repair", " not \neasy to handle in the maintenance phase of the vehicles. Any module failure in the \n\ufb01 eld requires real \u2018genuine\u2019 replacement due to lack of interoperability. \n The upward or downward compatibility is a big concern if the repair and main-\ntenance model in the target market demands interoperability. The customer-base in \nNorth America or similar markets have much less worries about the interoperability \nof electronic control modules because they have the mind-set of going to the dealer-\nship to \ufb01  x any vehicle related issue. Therefore, the maintenance mechanism is pretty \nmuch transparent from the customer base. However, the mind set of going to the \ndealership is not entirely true for many different parts of the world and if you hap-\npen to be residing in a place where cross-compatibility is a huge concern then you \nmight want to develop a universal-module based on a pre-de\ufb01  ned set of interfaces, \nwhere a software change could add or delete the feature set, and the end-user will \nhave the options to \ufb01  t intended design with minimal interface changes. This could \nbe possible by adapting to well-de\ufb01  ned standards that are agreed on by the industry, \nregulators and the major stake holders  \n1.20     Key-Off Load Current \n As stated earlier, vehicle battery is the primary source of power feeding power to all \nthe modules. Furthermore, the ignition switch is the primary switch to turn-on or \nturn-off the power to the modules. However, there are modules installed in any \nvehicle that are independent of ignition switch turn-on status\u2014and these modules \nget power even after the ignition switch is turned-off. So, an added function in such \ntype of modules is an electronic switch inside the module that can actually turn off \nthe unnecessary battery drain when the intended function (s) is not needed. \nNonetheless, to control the electronic switch inside the module, it is essential to \nkeep the microcontroller powered up in sleep mode to continue functioning by 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n21\nutilizing the relevant hardware. The terminology of \u2018Keep Alive\u2019 is used to de\ufb01  ne \nthe hardware current consumption requirement to power-up the necessary hardware \nwhile performing \u2018keep-alive\u2019 activities of the operation. Modules, however, do \nconsume power even when the \u2018keep-alive\u2019 hardware is active. The module current \n", " ne \nthe hardware current consumption requirement to power-up the necessary hardware \nwhile performing \u2018keep-alive\u2019 activities of the operation. Modules, however, do \nconsume power even when the \u2018keep-alive\u2019 hardware is active. The module current \nconsumption while in this mode of operation is universally recognized as the key-\noff load 2  current (meaning that ignition key is OFF, but the module is \u2018loading\u2019). \nOne of the critical performance measurements of today\u2019s vehicle electronics archi-\ntecture is the total current draw when the ignition key is off. It is highly recom-\nmended that when the vehicle is parked for a longer period of time, for example, 30 \ndays, then the battery must not drained itself completely past 30 days period rather \nit must be able to crank the engine even it had been loaded by the key-off current for \n30 days duration of time. \n Side Bar: The good design practice is to keep the KOL as low as possible. \nAssume a vehicle that is equipped with all the modules as shown in Fig.  1.9 . Let\u2019s \nsay that four (4) modules are required to be \u2018kept alive\u2019 at all times while each con-\nsuming a key-off load current of 1 mA then the total current of 4 mA is the overall \nvehicle key-off load. Under this constant load of current if the battery can sustain 30 \ndays of current drain then it is an acceptable design required by the Federal Motor \nVehicle Safety and Standards (FMVSS). This formula of 30 days is one of the fac-\ntors used when calculating the size of the battery for a particular vehicle.    \n1.21     12V/42V Electrical Supply System \n One of the serious concerns today is the size of the battery in terms of delivering \npower. Additional battery need had kicked off 42 V electrical supply system. \nA 42 V system is actually a topology of three batteries added in series to get 36 V . \nAs every battery needs to be charged around 14 V , its charging system must deliver \n14 multiplied by 3 = 42 V , the reason to call it 42 V system. A 12 V battery system \nlikewise can also be called as 14 V system. \n Added multimedia functions, family entertainment systems, high-torque motors \nand more functions are some of the motivators to add the extra power.", " system. A 12 V battery system \nlikewise can also be called as 14 V system. \n Added multimedia functions, family entertainment systems, high-torque motors \nand more functions are some of the motivators to add the extra power. There are \ncompanies doing business in the market that either has developed 42 V devices or in \nthe process of acquiring this technology. The progress towards 42 V supply system \nhas not been as enthusiastic as it was thought previously, some forums complained \nwhy an already established system of 12 V batteries and infrastructure allowed to be \nreplaced?\u2014But\u2014it is still not completely off the table yet because electric and \nhybrid cars have merits for high electrical energy needs, and some are launched \nwith 14 V/42 V electrical systems.  \n2   Key-off load current is also known as the dark-current in some target markets. The other names \nare quiescent current, or sleep current. 1.21 12V/42V Electrical Supply Systemzamann@us.panasonic.com\n22\n1.22     Vehicle Input Sensors and Switches \n A variety of sensors in a typical vehicle are used to transfer physical quantities into \nelectronic quantities measurable by a computing node. For example, engine tem-\nperature, engine revolutions per minute, mass air-\ufb02  ow, fuel quantity, vehicle speed, \nsteering wheel position, wheel angular velocity, steering wheel tactile switches so \non and so forth. Regardless of what type of sensors and technology is selected and \nused, the output to the microcontroller must represent a well-de\ufb01  ned voltage signal \nlevel either digital or analog. The signal must remain de\ufb01  ned throughout the varying \nvehicle environments in its well-de\ufb01  ned operational envelop. The vehicle external \nmechanical surroundings are largely classi\ufb01  ed as  N oise,  V ibration, and  H arshness \n(NVH). The NVH is the technical term used in the automotive industry to de\ufb01  ne \neffects of engine vibration, wind, road, and other mechanical parts that could cause \nunwanted noise and vibration onto the vehicle performance thereby impacting the \noverall vehicle performance. The vehicles are tested for noise, vibration and harsh-\nness at extreme temperatures under varying operating conditions. \n The signal representation of the physical quantity must demonstrate the repeti-\ntive transfer function over a well-de", " thereby impacting the \noverall vehicle performance. The vehicles are tested for noise, vibration and harsh-\nness at extreme temperatures under varying operating conditions. \n The signal representation of the physical quantity must demonstrate the repeti-\ntive transfer function over a well-de\ufb01  ned period of time. In case the signal accom-\npanies an electrical noise factor, it must be conditioned and \ufb01  ltered to get to the best \nclean signal possible. If for any reason like temperature or intrinsic variations where \nthe sensor transfer function is affected then the sensors have to have an offset cor-\nrection to the measured value. In such case the software based compensation method \nmust be developed and implemented. \n The conditioned signal should then be level shifted, and scaled to microcon-\ntroller input ports\u2014in case it is above and beyond the de\ufb01  ned range of the micro-\ncontrollers input ports. The module inputs pins must be protected from any \nshort-circuit condition of the sensors, short to battery positive, negative terminal \nvehicle chassis. (Vehicle chassis is always fed to battery negative terminal) \n If the excitation voltages of the sensors are above the safe operating limit of con-\nditioner circuits, then the additional protection is required to safeguard the signal \nconditioning circuits. Every input signal to the module from the vehicle harness \nmust be protected from the unwanted energy transients and spikes (Fig.  1.12 ).\nExcitation Voltage\nOptical \nHall-Effect\nAnalog to Digital Conversion   \nTime Capture \nAnalog to Digital Conversion     \nDigital Inputs/Outputs\nConditioner\nConditioner\nSoftware\nProcess\nSwitch \nConditioner\nMagnetic\n Conditioner\n  Fig. 1.12    Input sensors & switches interface        1 Vehicle Electronics Architecturezamann@us.panasonic.com\n23\n   The excitation voltage and current requirements depend on the type of sensors \nand con\ufb01  guration of switch. In some cases, switches do not require any excitation \nvoltage rather are connected to ground or the negative terminal of the battery. \nThe trick is to sense zero potential when the contact is closed.  \n1.23     Vehicle Output Devices \n In a typical vehicle, variety of actuators has been used to actuate a device. An actua tor \ncould be a door-lock-solenoid, fuel-injector-solenoid, a dial-pointer, a relay or an \nignition coil. Other", ", variety of actuators has been used to actuate a device. An actua tor \ncould be a door-lock-solenoid, fuel-injector-solenoid, a dial-pointer, a relay or an \nignition coil. Other types of output devices could be a stepper motor, servo driver, \nheadlamps or a high-torque motor. The high power devices usually get direct battery \nfeed through the fuse. If the device needs to be controlled by applying the battery \npositive terminal, then it requires a high side-driver (an electronic switch). If it \nneeds to be controlled by applying the battery negative terminal (ground), then it \nrequires a low-side driver (an electronic switch). The Fig.  1.13  shows an example \nwhere two unique devices are connected to be energized by a high-side switch and \na low-side switch respectively independent of each other. Nonetheless, Device A \ngets power when the high side switch is placed in closed-position, and Device B \ngets power when the low-side switch is placed at closed-position. Both switches are \nunder the control of a microcontroller digital port and all the switching actions are \nperformed by a software process.\n   In the world of electronics, an electronic switch means a transistor con\ufb01  g-\nured as a switch. The transistor could be of any type: Digital, Bi-Polar Junction \n(BJT), Field Effect Transistor (FET) or (MOSFET). The MOSFET switches are \nwell known in industry for their high speed, low resistance, and high current \nswitching characteristics. A TOPFET is a type of MOSFET with added features \nof \u2018 T emperature and  O verload  P rotection\u2019. A TOPFET by  Philips Semiconductor \n(now NXP)   is worth sur\ufb01  ng the internet. The commercial-off-the-shelf (COTS) \nautomotive devices are available from many different electronics design & semi-\nconductor manufacturing companies like  Texas Instruments, In\ufb01  neon  ,  Toshiba  , \nB+\nHigh Side Switch Software command\nSoftware\nProcedure\nLow side switchBattery\nDevice \u2018A\u2019 Device \u2018B\u2019Micro\nDigital Port\n  Fig. 1.13    High-side & low-side topology        1.23 Vehicle Output Deviceszamann@us.panasonic.com\n24\n Fujitsu  ,  Fairchild ", " Device \u2018B\u2019Micro\nDigital Port\n  Fig. 1.13    High-side & low-side topology        1.23 Vehicle Output Deviceszamann@us.panasonic.com\n24\n Fujitsu  ,  Fairchild  ,  On-Semiconductor, International Recti\ufb01  er  ,  ST Microelectronics, \nMaxim Semiconductor, Microchip, ROHM,Intersil, Renesas, Linear Technology, \nPanasonic, Atmel, NXP and Freescale etc.    \n1.24     Vehicle Interior Lights Dimming \n No modern vehicle today gets manufactured without the use of lighting system \ninside the cabin for switches, gauges, climate control knobs, radio functionality and \nmany other human machine interfaces\u2014herein referred as interiors lighting. A criti-\ncal feature of interior lighting is the dimming control for each light source. The most \ncommon technique used to regulate the light-intensity is to control the light-source- \ncurrent by switching the applied electrical energy. \n The switching method to provide the dimming function utilizes the pulse width \nmodulation (PWM) technique. Every light source that requires dimming control \nmust be switched using the PWM technique, either separately or in a group \n In the PWM technique, the device receives energy from the battery passing \nthrough a switching circuit\u2014controlled by a software procedure. In Fig.  1.14 , one \nsuch topology is shown where a lamp is connected to the battery through the elec-\ntronic switch. The electronic switch gets the switching-pulses controlled by the \nmicrocontroller\u2019s PWM output channel by the aid of a software procedure. This is \nhow the lamp dimming function in a typical vehicle is being performed.\n   The software procedure is used to toggle the electronic switch to transfer battery \nenergy to the lamp. The pulse width determines the duration of time it takes for the \nenergy to transfer to the lamp. When the switch is permanently ON, it equates to \n100 % duty-cycle or full brightness. If the switch is toggling at 50 % duty-cycle then \nit is half of the brightness. Similarly a 10 % duty cycle means that the electronic \nswitch is ON only for 10 % of the time and stays OFF for rest of the 90 % time as \nshown in Fig.  1.15 . At 10 % duty cycle we expect to see lower intensity level.\nB+\nSoftware\n", " ON only for 10 % of the time and stays OFF for rest of the 90 % time as \nshown in Fig.  1.15 . At 10 % duty cycle we expect to see lower intensity level.\nB+\nSoftware\nProcedureBatteryLampElectronic SwitchMicro Port\nPWM Channel\n  Fig. 1.14    Lamps or LED control & dimming        1 Vehicle Electronics Architecturezamann@us.panasonic.com\n25\n   In Fig.  1.15  (a) pulses are captured at the pulse width modulated output channel \nwhen the software is generating a 100 Hz pulse. The 50 % modulated pulse meaning \nthe electronic switch is ON for half of the time or 5 ms. \n Figure  1.15  (b) is captured when the pulse is modulated for 10 % meaning the \nelectronic switch is ON only for 10 % of the time or a total of 1 ms. However the \nfrequency of operation is exactly at 100 Hz, but the pulse-width has changed by the \naid software inside the microcontroller. \n The software can control the modulation from 0 % to 100 %, which equates to \nthe brightness of LED from complete darkness to full brightness. Switching the \nfrequency, and the modulation of pulse plays a vital role for the lamp brightness. \nPlease note that the selection of 100 Hz frequency is for educational purposes only. \n The light intensity and color control of LED\u2019s and lamps plays a critical role in \nvehicle electronics architecture. A lighting harmony across the vehicle-interiors is \nrequired at all times from each light source on a \u2018class A\u2019 surface, where \u2018class A\u2019 \nsurface is roughly de\ufb01  ned as the surface inside the cabin, seen and touched by the \ncustomer. \n The dimming function is achieved by utilizing a single dimmer control switch. \nThe dimmer control switch gets interfaced to the complex vehicle electronics archi-\ntecture by means of a hardwired circuit. The hardwired circuit must be capable of \nsending electrical signal to all the electronic circuits needed that information to \ncontrol the light-intensity \n By the virtue of the fact that vehicle electronics today is a distributed architecture \nwhere many modules are installed in a typical vehicle, each applicable module has \nto control the light-sources that are under its hardware control. Nevertheless, light \nsources are scattered", " By the virtue of the fact that vehicle electronics today is a distributed architecture \nwhere many modules are installed in a typical vehicle, each applicable module has \nto control the light-sources that are under its hardware control. Nevertheless, light \nsources are scattered all across the vehicle therefore, multiple pulse width \nmodu lated signals are generated by various dissimilar modules in order to drive the \nlamp or LED intensity. The PWM signal received by the relevant modules is further \nmodi\ufb01  ed by each module to adjust the dimming. 10ms\nON ON                    T=1/f      1=1/100 = 10ms\n5ms (a) ON=50%, OFF=50% @100Hz\n          On Time = 5ms,   \n          Off Time = 5ms\n(b) ON=10%, OFF=90% @100Hz\n      On Time=1ms, \n        Off Time=9msOFF           OFF\n  Fig. 1.15    Modulated pulses to the electronic switch        1.24 Vehicle Interior Lights Dimmingzamann@us.panasonic.com\n26\n By using the Foot Lambert (FT/L) light intensity scale verses the applied volt-\nage; intensity of light source is plotted on the graph. However an additional work is \nneeded to re-de\ufb01  ne the steps of the dimming switch steps verses the percentage of \npulse modulated signal. It is commonly referred as the dimming curve. The dim-\nming curve gets stored in the relevant module memory as a look-up table. \n The dimming switch-steps control must demonstrate harmonized intensity and \ncolor control throughout its operational envelop. Given the fact that there are vari-\nations in lamps, LED\u2019s, light-pipes, electronics, plastics, color, \ufb01  lters, back-\nground, and dimming curves, it is quite a challenge to harmonize the internal \nvehicle lighting system. Vehicle manufacturers spend time, energy and costly \nequipment to harmonize the vehicle lighting systems across all light-sources from \ndifferent modules inside the cabin. It is a very lengthy process in vehicle studio, \nand suppliers have to achieve the certi\ufb01  cate of compliance for their products feed-\ning the light sources before their products are allowed to be installed in the vehicle \nmeant for public sale. \n A typical in-vehicle topology of interior lights dimming control is shown in \nFig", "\ufffd\ufffd  cate of compliance for their products feed-\ning the light sources before their products are allowed to be installed in the vehicle \nmeant for public sale. \n A typical in-vehicle topology of interior lights dimming control is shown in \nFig.  1.16 . The dimming switch is the master-switch accessible for the customer, \nfeeding electronics circuit and converting each dimming step as pulse modulated \nfrequency duty-cycle. The PWM signal is fed to every module requiring that infor-\nmation. Furthermore to this, the PWM could additionally be converted to transmit \nas a CAN message available on the vehicle communication bus thereby eliminating \nthe need of extra electrical wiring. An example of redundant dimming signal scheme \nis drawn where a CAN message as well as hardwired PWM signal is fed to the \nmodule D. As can be seen that vehicle CAN bus is receiving the dimming steps \nwhich could be used by other vehicle systems.\n1.25        H-Bridge Motor Driver \n It is often required to spin a motor in both directions like the one that opens and \nshuts the vehicle door glass-window. To turn the motor in both directions (clock-\nwise, or anti-clockwise) an H-Bridge con\ufb01  guration is used. The H-Bridge con\ufb01  gu-\nration is a set of 4-switches pre-arranged to switch the polarity of DC current motor \nas shown in the Fig.  1.17 . It shapes like the alphabetical letter \u2018H\u2019, and works like a \npolarity reversal switch by energizing the motor-armature in both directions. When \nswitches F1 & F2 are placed in closed position the positive terminal gets connected \nto the motor brush \u2018A\u2019 and negative terminal to motor brush \u2018B\u2019. This turns the \nmotor in forward direction. (Assume \u2018forward\u2019 just for the sake of understanding) \nand when the switches R1 & R2 are placed in closed positions, motor turns to the \nreverse direction. The \u2018H\u2019 bridge is a classic example of using high-side switches \nand low-side switches in a simple application; as you can note that F1 & R1 are \nhigh-side switches and R2, F2 are low-side switches. H-Bride driver circuits have \nbeen used in many automotive applications.\n   Headlamp leveling is another example of using motors to spin in both directions. \nThe European regulation requires that", "high-side switches and R2, F2 are low-side switches. H-Bride driver circuits have \nbeen used in many automotive applications.\n   Headlamp leveling is another example of using motors to spin in both directions. \nThe European regulation requires that headlamp leveling compensations must be 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n27\nVehicle CAN Bus\nDimming Switch \nSteps\nModule A\nPWM Duty-Cycle \nConversion\nCAN Data \nConversion\nLight \nSources \nGroup A\nLight \nSources \nGroup B\nLight \nSources \nGroup C\nLight \nSources \nGroup D\nModule B\nModule C\nModule D\n  Fig. 1.16    Vehicle level dimming topology       \nF1      R1\nA   \nR2 F2Battery\nDC MOTOR    \n  Fig. 1.17    H-Bridge con\ufb01  guration        \n 1.25 H-Bridge Motor Driverzamann@us.panasonic.com\n28\nexercised to offset headlamp beams aiming unnecessarily upward or downward\u2014\nmainly due to uneven terrain or added trunk loading. \n The embedded controller is used to apply corrections for the headlamp aiming \nbased on the inputs received from the vehicle pitch-attitude sensors mounted in the \nvehicle suspension system. Another example where H-bridge con\ufb01  guration being \nused is seat adjustment motors and side view mirrors. \n A commercial-off-the-shelf (COTS) H-Bridge integrated circuit  TLE 4206   \ndeveloped by  In\ufb01  neon  \u2014particularly for the headlamp leveler could be studied fur-\nther to know more about this \u2018cool\u2019 device. The other semiconductor manufacturers \nlike  Philips Semiconductor (NXP Semiconductor), Motorola (now Freescale \nSemiconductor), Intersil, Texas Instruments  ,  On-Semiconductor, International \nRecti\ufb01  er, ST Microelectronics, Fairchild, Linear Technology, ROHM, Fujitsu, \nRenesas, Microchip, and Atmel have   products in the market to support many similar \nor different types of automotive applications.  \n1.26     Communication Link \n The integral part of overall electronics architecture of today\u2019s automobile is the \ncommunication link that has experienced several historical evolutions. Automotive \nmanufacturers spent time, energy and money to develop many different types of \nserial data communication buses mainly for two reasons:\n\u2022    To", " of overall electronics architecture of today\u2019s automobile is the \ncommunication link that has experienced several historical evolutions. Automotive \nmanufacturers spent time, energy and money to develop many different types of \nserial data communication buses mainly for two reasons:\n\u2022    To share data among modules i.e. inter module communication or message passing  \n\u2022   To transfer sensors data to the modules    \n Over the past several years, the efforts of automotive OEMs along with their \nsupply-base partners have evolved many different buses. In order to give our valued \nreader a glimpse into the buses that have been developed for the automotive applica-\ntions; few are listed below:\n\u2022    Standard Corporate Protocol ( SCP)    \n\u2022   Audio Control Protocol  (ACP)    \n\u2022   Motorola Interconnect  (MI Bus)    \n\u2022   Distributed Systems Interface  (DSI)    \n\u2022   Bosch-Siemens-Temic  (BST Bus)    \n\u2022   Byte Flight  (SI \u2013Bus)    \n\u2022    Flex Ray   \n\u2022   Domestic Digital Data Bus  (D2B)    \n\u2022   SMARTwireX  \n\u2022   IE Bus  \n\u2022    LIN bus (Local Interconnect Network  )   \n\u2022   Boeing Intellibus  \n\u2022    CAN (Controller Area Network)   \n\u2022   Time Triggered CAN (TTCAN)  \n\u2022   ISO9141  \n\u2022    GM LAN     1 Vehicle Electronics Architecturezamann@us.panasonic.com\n29\n You must be wondering; why have so many buses been developed? Why couldn\u2019t \nOEMs have developed just two universal buses, a  data bus  for data transfer among \nmodules, and a  data bus  to transfer sensor information to the module? \n The answers to this and for many other questions you might have over the buses \nare beyond the scope of this book. However, it is quite interesting to note that auto-\nmotive sector was not able to develop a common standard platform for the vehicle \ndata communication bus (unlike the PC world where USB is the de facto standard \nor unlike the Avionics design segment where ARINC 429 had established pretty \nstrong foundation for a long haul of 25 years). \n The ultimate result for not having a standard communication platform across the \nautomotive OEM\u2019s is not so very helpful to assist maintenance, repair and compat-\nibility across the board; including but limited to similar set of tools and test \n platforms. It is indeed an issue that had forced OEM", " standard communication platform across the \nautomotive OEM\u2019s is not so very helpful to assist maintenance, repair and compat-\nibility across the board; including but limited to similar set of tools and test \n platforms. It is indeed an issue that had forced OEM\u2019s to develop communication \nmessage-sets based on their unique requirements. The vehicle bus communication \nmessage-set compatibility across the board does not exist in the market today. \n Every manufacturer develops and incorporates its own set of message set regard-\nless of common physical layers. The most common physical layer that continues to \nlead the automotive industry for the purpose of sharing data among the modules is \nController Area Network (CAN) with variety of \ufb02  avors in data transfer speed. The \nsensors data transfer is being handled by single wire LIN communication. So, in the \nreal world CAN and LIN are dominating the automotive market. \n Controller Area Network (CAN), which was initially developed by Bosch is the \ngrowing trend in the automotive sector, primarily used to transfer data among \n modules. It is mainly used as a half-duplex topology, and physically realized by \nusing differential pair of twisted cable with  N on  R eturn to  Z ero (NRZ) encoding \nformat. The access control is based on  C arrier  S ense,  M ultiple  A ccess with  C ollision \n D etection (CSMA/CD). The bus voltage varies from 0 to 5 V max. The bus speed \nvaries from 125Kb/s to 1 Mb/s. A typical vehicle may utilize multiple speed CAN \nnodes. The modules requiring high-speed message transfer-rate uses high speed \nCAN bus and the modules requiring medium-speed message transfer-rate uses the \nmedium speed. In a typical vehicle, multiple backbones could be used to support \noverall communication architecture. \n Side Bar\nIn the consumer industry like personnel computer design space has been using \na serial bus standard for many years commonly known as Universal Serial Bus \n(USB). Similarly, the Avionics industry has seen for well over 25 years a serial \ninterface called ARINC 429 to transfer information between airplane comput-\ners. Now at the writing of this book, the automotive industry looks settled on \ncontroller area network (CAN) communication bus where only the physical \nlayer is universally recognized, but message formats, standard hand-shake pro-\ntocols, diagnostics and operational software interfaces are", " the writing of this book, the automotive industry looks settled on \ncontroller area network (CAN) communication bus where only the physical \nlayer is universally recognized, but message formats, standard hand-shake pro-\ntocols, diagnostics and operational software interfaces are highly con\ufb01  dential.   1.26 Communication Linkzamann@us.panasonic.com\n30\n There are three major applications of serial data bus communication in a typical \nvehicle as listed below:\n\u2022    Inter-module information sharing  \n\u2022   Diagnostics and testing  \n\u2022   Flash programming downloads    \n1.26.1     Inter-Module Information Sharing \n The modules share information to help complement each other\u2019s functional opera tion \nvia serial data bus communication. An example is engine temperature\u2014primarily a \nparameter computed by engine controller sensor. However, it is required that the \nengine temperature must be displayed by the instrument cluster to alert driver about \nthe engine temperature. The Instrument Cluster rather than using an additional sen-\nsor to sense the engine temperature could actually request engine controller to \nrelease this information via inter-module communication bus. Another example is \nengine revolution per minute information from engine controller as shown in the \n   Fig. 1.13. The information is read by the instrument cluster. \n Thousands of messages could appear on the communication bus at peak time \nwhile the vehicle is in full operational mode, and the information gets shared by \ndifferent kind of modules. Messages like wheel speed, engine coolant temperature, \ndoor ajar, tire pressure and so on so forth.  \n1.26.2     Diagnostics and Testing \n A \u201cSERVICE ENGINE SOON\u201d light (sometimes called Malfunction Indicator \nLamp, MIL) when turned on in your vehicle indicates that the Instrument cluster \nhad received a message from a module for an error condition related to the engine \nparameters. Your next step would be to go to a service center where the diagnostic \ntools can be used to read the diagnostics trouble code (DTC)\u2014stored in the module \nmemory\u2014by connecting to the vehicle serial bus communication port via a diag nostics \nconnector. The diagnostic tool can then tell you the speci\ufb01  c details about the type of \nfailure (i.e. oxygen sensor, knock sensor, failed spark plug, etc.). The diagnostics \ntrouble code is nothing, but a unique identity number expressed in hexadecimal \nformat allocated to that particular failure, and gets logged into the module memory \nat", " (i.e. oxygen sensor, knock sensor, failed spark plug, etc.). The diagnostics \ntrouble code is nothing, but a unique identity number expressed in hexadecimal \nformat allocated to that particular failure, and gets logged into the module memory \nat the time of failure. Likewise an \u201cABS light\u201d if turned on indicates some error \nconditions existed in ant-lock brake system, so and so forth \n This method of storing these faults had been introduced in the early days of \n automotive electronics; when the displays and the message-centers were not that 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n31\ncommon in the vehicles. Today in the world of cutting edge technology it is possible \nto develop more elegant solutions; like for example an audible warning or a mes-\nsage displayed to alert the customer about the fault conditions or the most probable \ncause (s) of failure rather in addition to just logging the DTC codes. \n Nevertheless, before you quickly jump to this conclusion, you must make sure \nthat there are no regulatory compliance requirements to implement this topology. \n In Figures  1.18 , we have shown how the modules of a typical vehicle could be \naccessed in a service center so that the diagnostics tool could read the DTC. The \nvehicle when parked in the service center must be connected to the diagnostic tool \nthrough the diagnostic port mounted inside the vehicle. Diagnostics port is the \n physical connection, routed to the vehicle communication buses, battery power and \nthe battery ground. Once the communication is established to any of the module, the \nDTC code from that module is pulled and read to get to the details of the failure. \nThere is no mechanism inside a modern vehicle today to dump all the failures to a \ncentral storage area in order to \ufb01  nd the DTC code. Consequently, each module must \nhave to be accessed, one by one, to get to the fault code (s) by means of an external \nservice tool. The diagnostics features discussed so far have been standardized by the \nSociety of Automotive Engineer (SAE) as On-board diagnostics II (OBD-II); \nendorsed by California Air Research Board (CARB), and concurred by the \nEnvironmental Protection Agency (EPA). The main original theme of OBD II is to \nmaintain a failure log and caution driver about the potential emissions issues to the \nvehicle. However, today the scope has been extended", " and concurred by the \nEnvironmental Protection Agency (EPA). The main original theme of OBD II is to \nmaintain a failure log and caution driver about the potential emissions issues to the \nvehicle. However, today the scope has been extended to almost every vehicle sys-\ntem; thereby enabling other system to take advantage of DTC strategy to log the \nfault codes (Fig.  1.19 ).RPM Message (\u202600 03 0A FF\u2026\u2026.)ECMIC\nHVAC TPMS A...Z\n  Fig. 1.18    Messages on the communication bus        1.26 Communication Linkzamann@us.panasonic.com\n32\n1.26.3         Flash Programming and Data Download Features \n1.26.3.1     Fault Code Data Storage \n An important feature of a vehicle module is the requirements of using selected \nmemory space in the module, so that it can be used as the storage for the diagnostics \ntrouble codes. As explained earlier, diagnostics trouble code (DTC) is nothing, but \njust a binary code expressed in a hexadecimal format\u2014the sole purpose is to record \na system malfunction; detected by the module operational software. The module \noperational software always runs the system integrity tests in the background, and if \nat any time faulty conditions are detected; either permanent or temporary\u2014the fault \ncode gets stored in the module EEPROM. This is the basis of our actions performed \nin the vehicle service center explained in earlier    Sect. 1.1.5. \n In essence, the module diagnostics software runs the memory read-write integ-\nrity tests, maintains log of information referred as diagnostics trouble codes. The \nmodule diagnostics software can also perform DTC read-write and erase operations \nas needed. A fault code log is maintained by the module diagnostics software. The \nlogged DTC, erase-operation is required if the actual fault has been disappeared \nover a certain period of time, or if the service center has repaired the faulty system. \nWhen the fault is disappeared over a certain period of time\u2014say for example a \nperiod of 80 ignition cycles, then the DTC gets erased by the module diagnostics \nsoftware itself. However, if the fault has been repaired at the service center then the \nexternal tools must have to be used to erase the fault code.  \nVehicle Diagnostics\nConnector\nModule A\nModule ZDiagnostics Tool\nVEHICLECUMM", " However, if the fault has been repaired at the service center then the \nexternal tools must have to be used to erase the fault code.  \nVehicle Diagnostics\nConnector\nModule A\nModule ZDiagnostics Tool\nVEHICLECUMMUNICATION BUS\n  Fig. 1.19    Access to the modules when the vehicle is parked at the service center        1 Vehicle Electronics Architecturezamann@us.panasonic.com\n33\n1.26.3.2     Calibration, Con\ufb01  guration and Nomenclature Data Storage \n In addition to a memory reserved area allocated for the DTC logs, a memory space is \nreserved to download (download means to put data or code into the module appropriate \nmemory locations) con\ufb01  guration and calibration data into the module memory. \nCon\ufb01  guration data is required to con\ufb01  gure the module for its intended features and \nfunctions in a typical vehicle. Calibration data is needed to be stored in some modules \nto optimize control system performance associated with vehicle interfaces. Finally, \nnomenclature data must be stored for the module identi\ufb01  cation information. The mod-\nule nomenclature data includes but not limited to manufacturing date code, part num-\nber, software release date, and version. In all cases, information must be stored in the \nmodule memory by using a well-de\ufb01  ned software download procedure. \n There are many ways to download the calibration, con\ufb01  guration and nomencla-\nture data, but two common ways are listed below:\n\u2022    Serial Communication Bus  \n\u2022   Stand-alone Direct Processor Access     \n1.26.3.3     Serial Communication Bus Method \n If the \u2018downloads\u2019 were to happen in a vehicle assembly plant; the serial bus is the \npreferred mode of operation. The vehicle serial bus is accessible through the diag-\nnostics receptacle\u2014an essential part of every modern vehicle built today. The \nFig.  1.20  is showing how the modules of a vehicle positioned in an assembly line \ncould be accessed via the diagnostics port attached to the end-of-line (EOL) tester. \nEOL TESTERSerial\nCommunication\nPCM \nIC ModuleVEHICLETPMS File\nANTI SKID Module\nTCU ModuleDiagnostics\nReceptacleDiagnostics\nConnector\nAIRBAG Module\nPOWER Module\nHVAC Module\nTPMS Module", "ERSerial\nCommunication\nPCM \nIC ModuleVEHICLETPMS File\nANTI SKID Module\nTCU ModuleDiagnostics\nReceptacleDiagnostics\nConnector\nAIRBAG Module\nPOWER Module\nHVAC Module\nTPMS ModuleHVAC File\n  Fig. 1.20    Vehicle in the assembly line receiving calibration and con\ufb01  guration data        1.26 Communication Linkzamann@us.panasonic.com\n34\nMajority of OEM\u2019s uses the download procedure to transfer calibration and con-\n\ufb01 guration data only. The module program code download is carried out by the mod-\nule manufacturing site at the time of module manufacturing. Occasionally it is \nrequired to update the software at the vehicle assembly plant as well.\n   The application software code gets loaded in the module manufacturing plant not \nin the vehicle assembly plant. A complete software-code downloading to the mod-\nule rarely happens in the vehicle assembly plant, but there is always a possibility to \ndo that for variety of reasons ranging from error corrections, bug \ufb01  xes, improve-\nments, robustness or a \u2018killer application\u2019 speedy launch. The main issue with the \ncomplete software download in the vehicle assembly plant is the manufacturing \nthroughput. An addition time is required for the complete \ufb02  ash-download, which \nwill reduce the throughput to the overall productivity. However in an emergency \nsituation where software update is highly needed the complete software code down-\nload could happen in the vehicle assembly plant. \n In Fig.  1.20  the TPMS module is being highlighted while it was selected for the \ndownload from the EOL tester. However, other vehicle modules get connected to \nthe end-of-line tester\u2014selected one at a time and con\ufb01  gured by the software to get \ntheir share of information. The communication bus by the aid of network operating \nsoftware helps to establish peer-to-peer connection to download the calibration and \ncon\ufb01 guration data. Once the EOL tester veri\ufb01  es the data integrity of the down-\nloaded \ufb01  les, it then relinquishes control back to vehicle modules.  \n1.26.3.4     Stand-Alone Flash Programming Method \n If the downloads were to happen in a module manufacturing line then there are \n different types of tools to program the microcontroller\u2019s \ufb02  ash memory. \n If a low-volume is the desired", ".4     Stand-Alone Flash Programming Method \n If the downloads were to happen in a module manufacturing line then there are \n different types of tools to program the microcontroller\u2019s \ufb02  ash memory. \n If a low-volume is the desired-intention then the off-the-shelf programmers \ncould be used to program the microcontroller. If high-volume is the desired- intention \nthen sophisticated equipment is needed to program tens of thousands or millions of \nmicrocontrollers in a timely fashion. \n An off-the-shelf \ufb02  ash programming device is like a stand-alone programming sta-\ntion having the functionality of placing one or many microcontrollers on a row of \nsockets recognized as zero-insertion force socket (ZIF) sockets. The purpose of using \nthe ZIF sockets is to install and remove the devices quickly from the programming sta-\ntion. The hardware inside the stand-alone station enables the external device to manage \nprogramming functions. The programming functions include, but are not limited to \ndownloading and veri\ufb01  cation of object \ufb01  le into the microcontroller memory. However, \nthe \ufb02 ash programmer itself connects to the external device using standard SCSI inter-\nfaces like USB, RS232, IEEE-488 or else. Once the programming function is achieved, \nthe microcontrollers could be removed to be used in the target module or systems. \n Stand-alone type of programming is wide spread in the industry during the \ndevelopment phase in the research & development facilities. Nevertheless, it can \nalso be used for a small scale proto-type production of the parts. There are compa-\nnies out there in the market who make their living by doing \ufb02  ash programming as \ntheir core business. The Fig.  1.21  is drawn to show how this procedure works.1 Vehicle Electronics Architecturezamann@us.panasonic.com\n35\nPC/LAPTOPPC to Tester\nINTERFACEOBJECT FILE\nZIF\nZIF\n ZIF\nZIF\n ZIF\nZIF\n ZIF\nZIF\nZIFPush Button to initiate programming\nZero Insertion Force Socket to place \u2018microcontrollers\u2019\n  Fig. 1.21    Programming eight processors in parallel using gang programmer             \n    Salient Features of a typical programmer or burner \n\u2022    Programming method turns logic 1 to logic 0  \n\u2022   Object \ufb01  le resides in the personnel computer or the laptop  \n", "    Programming eight processors in parallel using gang programmer             \n    Salient Features of a typical programmer or burner \n\u2022    Programming method turns logic 1 to logic 0  \n\u2022   Object \ufb01  le resides in the personnel computer or the laptop  \n\u2022   Processors can be inserted into the ZIF socket eight at a time in this burner  \n\u2022   After downloading the \ufb01  le in the programmer/burner, the user can start program-\nming using control switches  \n\u2022   A program time of  x  seconds is needed to program all the micros  \n\u2022   A bootstrap loader is not required in stand-alone programming.  \n\u2022   A blank check by the \ufb02  ash programmer means veri\ufb01  cation of all one\u2019s  \n\u2022   A blank processor means all ones in the memory locations. ($FF each location)  \n\u2022   PC interface may be RS232C or USB or IEEE-488 (HPIB)  \n\u2022   To change a memory location to \u2018zero\u2019 requires the application of a pre-de\ufb01  ned \nprogramming pulse, and a higher voltage level in a timely fashion while the \naddress bus, data bus, and the memory enable lines are active.    \n  http://www.aecouncil.com/AECDocuments.html      The Automotive Electronics Council mandates the semiconductor industry to \nfollow AEC Q100 quali\ufb01  cation process in the automotive design space. It is \nmandated across all semiconductors manufacturers to test and qualify semi-\nconductors used in harsh automotive environment in accordance with the \nadded testing, validation and automotive quali\ufb01  cation process. The detailed \nAEC documents details are linked to the following web-site. 1.26 Communication Linkzamann@us.panasonic.com\n36\n1.27     Microcontrollers Programming Options \n The modules developed for automotive applications utilize microcontrollers with \nconventional features like:\n \u2013    Instruction execution speed (MIPS)  \n \u2013   An instruction set like Complex Instruction Set Computer (CISC) verses  \n \u2013   Reduced Instruction Set Computer (RISC)  \n \u2013   The size of RAM  \n \u2013   Flash memory size  \n \u2013   ROM size & functions  \n \u2013   Number of digital and analog ports  \n \u2013   Pulse width modulated channels  \n \u2013   Timer ports  \n \u2013  I  2 C, SCI and SPI buses.  \n \u2013   CAN bus Protocol Controller  \n \u2013   Harvard Architecture or  \n \u2013", " \u2013   Number of digital and analog ports  \n \u2013   Pulse width modulated channels  \n \u2013   Timer ports  \n \u2013  I  2 C, SCI and SPI buses.  \n \u2013   CAN bus Protocol Controller  \n \u2013   Harvard Architecture or  \n \u2013   V on Neumann Architecture    \n Nevertheless, the unique additional feature of CAN bus protocol controller \nembedded in the microcontroller makes it very attractive for the automotive com-\nputing design space. \n Irrespective of the features offered for a typical processor, one signi\ufb01  cant feature \nthat stands out noticeably is how the internal programmable memory contents of the \nprocessor gets to store the program code? \n There could be identical microcontroller-types with different memory variants \navailable to write binary data into its non-volatile programmable memory addresses \nspace as listed below:\n\u2022    One Time Programmable (OTP) microcontrollers  \n\u2022   MROM (Masked Read Only Memory) microcontrollers  \n\u2022   Flash Memory microcontrollers  \n\u2022   EPROM microcontrollers    \n1.27.1     One-Time-Programmable (OTP) \n OTP type of processors only allow single memory write cycle, which means no \nroom for error and mistakes, the software code must be released with high degree of \ncon\ufb01 dence after a rigorous software veri\ufb01  cation and validation testing. The one-\ntime- programmable processors can be \u2018burned\u2019 utilizing off-the-shelf programming \ndevices. The data-write operation is similar to the Programmable Logic Array \n(PLA), where the fusible-links alters the binary-value changed from logic 1 to logic \n0 and follows the data pattern as needed. Once the microcontroller is fully pro-\ngrammed, it  cannot  be erased or re-programmed for any other application. 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n37\n The one-time programmable memories are also known as the Programmable \nRead Only memory (PROM). The trend to use OTP processors in the automotive \nindustry is losing grounds in recent years due to the fact that rapid changes in the \nsoftware functions require re-programming within a very short period of time and \nOTP processors are not the fastest way of achieving the task. Furthermore it is not a \ncost effective way to deliver the product in the market.  \n1.27.2     Masked Read Only Memory (MROM) \n MROM type of processors requires that the software", " fastest way of achieving the task. Furthermore it is not a \ncost effective way to deliver the product in the market.  \n1.27.2     Masked Read Only Memory (MROM) \n MROM type of processors requires that the software code must be released to the \nsemiconductor manufacturing company no less than 4\u20136 weeks in advance. This \nlead time is required by the semiconductor manufacturing companies to mask the \nROM code for that particular processor. The high-volume, cost-saving is the pri-\nmary enabler for this option. However, this option is not feasible in the current \nautomotive marketing segment due to continually increasing challenges of software \nupdates. The time plenty of 4\u20136 weeks leaves little,\u2014or no room for additional \nsoftware patch and has no \ufb02  exibility of code change once the ROM code is masked. \n Nevertheless if you have an application where the software code has been  veri\ufb01  ed, \nand validated, and the product has been functioning quite well over the years\u2014as per \nneeds and wants of the customer then it is worth spending time to prepare the business \ncase to switch to MROM version of processor. The main deciding factor to switch to \nMROM version of the processor is the determination of the fact that the future code \nrelease has deemed unnecessary throughout the product lifecycle, and that the addi-\ntional cost saving could be achieved by switching to MROM version of the processor.  \n1.27.3     EPROM Microcontrollers \n The EPROM (Electrically Programmable Read Only Memory) microcontrollers have \nEPROM space built-in for the programmable storage. These are  electrically  program-\nmable, but are  not  electrically  erasable  rather require erasing under the exposure of \nultra-violet light source or the \u2018sun-shine\u2019. The word \u2018sun-shine\u2019 is intentionally used \nto describe the fact that ultra-violet light exposure is possible if these microcontrollers \nare exposed to sunlight for a longer period of time. It is for this reason that these \nmicrocontrollers\u2019 glass-window must be covered with a black- tape after the \ufb01  nal pro-\ngramming is done. In the real world the erase operation is performed by placing the \nmicrocontroller under the ultra-violet light source in an enclosed box. \n The EPROM based microcontrollers are easily noticeable by the small-glass- \nwindow exposing", "ming is done. In the real world the erase operation is performed by placing the \nmicrocontroller under the ultra-violet light source in an enclosed box. \n The EPROM based microcontrollers are easily noticeable by the small-glass- \nwindow exposing the EPROM to the external world. Whenever it is desired to erase \nthe memory contents, the glass window must be exposed under the ultra-violet light \nsource for about 15\u201320 min. The erase operation erases the entire memory contents, \nall blocks, each and every memory cell, so there is no room for a partial, or selective 1.27 Microcontrollers Programming Optionszamann@us.panasonic.com\n38\nmemory-space erase. The EPROM based microcontrollers are not suitable as the \n\ufb01 nal product to be delivered to the vehicles due to multiple erasing tasks, and \nextended time-consuming constraints. Imagine yourself in a situation where you \nhave to upgrade a module software operating in EPROM installed in a vehicle. It \nwould be very dif\ufb01  cult to remove processors from the systems already installed in \nthe vehicles and perform a lengthy procedure like removing the module, opening up \nthe electronics board, unplugging the EPROM, placing it under the UV source light \nand wait for 15\u201320 min to perform the erase-operation. And \ufb01  nally, it requires \nreprogramming each processor with a programmer. This is a time consuming pro-\ncess not aligned very well with the automotive design space.  \n1.27.4     Flash EEPROM Microcontrollers \n The most commonly used microcontrollers in the automotive electronic space are \nintegrated with the Flash EEPROM. The Flash,  E lectrically  E rasable  P rogrammable \n R ead  O nly  M emory does not require ultra-violet light source to erase the memory \ncells rather consumes electrical energy to perform the quick erase. \n The process of erasing is so fast that it is analogous to the speed of a camera-\ufb02  ash \nas envisioned at the time of invention in Toshiba Semiconductor Company. It is \ntruly the reason that had in\ufb02  uenced the inventor to call it \u2018Flash Memory\u2019. The \nfunctional behavior of \ufb02  ash memory is similar to the Electrically Programmable \nRead Only Memory (EPROM)\u2014But, by the advantages of \ufb02  oating-gate and \ncontrol-", " call it \u2018Flash Memory\u2019. The \nfunctional behavior of \ufb02  ash memory is similar to the Electrically Programmable \nRead Only Memory (EPROM)\u2014But, by the advantages of \ufb02  oating-gate and \ncontrol- gate MOSFET transistor technology the program-cycle, and erase-cycle is \nsimple. The \ufb02  oating gate transistor has galvanized the memory industry. The \nFowler-Nordheim electron-tunneling method of current \ufb02  ow is the key-enabler \nwhile the erase-cycle is realized by applying the electrical energy. Moreover at the \ntime of write-cycle, channel hot-injection method is utilized that changes \nthe transistor- cell state to a logic-one 3 . \n Furthermore to this, the memory cell topology allows the memory-block access \nthereby achieving faster erase cycles, which is a great advantage to reduce the pro-\ngramming throughput in the \ufb01  eld. It is by the far the  best option for the automotive \ncomputing design space , and has been widely used across the board. \n The microcontrollers that have been utilizing \ufb02  ash memories for the program \nstorage could be labeled as the \u2018FLASH\u2019 processors (although it is not the of\ufb01  cial \nname). Flash processors, are more expensive than their OTP, MROM or EPROM \ncounterparts; however, they have the huge bene\ufb01  t of re-programming the software- \ncode pretty quickly without removing the automotive modules in the \ufb01  eld. The pro-\ngramming could be done while the systems are already installed in the vehicles, \nwhich makes it a very attractive choice in the automotive embedded software down-\nloads. Flash programming the microcontroller at the last minute is like a dream \ncome true for the embedded software developers.  \n3   Roberto Bez et al., ST Microelectronics Proceedings of the IEEE, V ol. 91 no. 4, April 2003 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n39\n1.27.5     Stand-Alone Non-Flash Type EEPROM \n The subject of programmable memories will stay incomplete without introducing \nthe role of stand-alone  non-\ufb02  ash  type EEPROM. We have to introduce this concept \ndue to a fundamental design principle related to the usefulness of non-\ufb02  ash type \nstand-alone EEPROM in an automotive module.", " of stand-alone  non-\ufb02  ash  type EEPROM. We have to introduce this concept \ndue to a fundamental design principle related to the usefulness of non-\ufb02  ash type \nstand-alone EEPROM in an automotive module. Recall that \ufb02  ash-type memory \nworks on the  block-write  when the write-cycle is executed, which is quite an advan-\ntage for fast erase and program blocks of data. Yet, there are occasions in the \noperational- life of an automotive electronics module where a byte of data or word \nof data write-cycle is necessary on a  single-memory  location in a timely fashion\u2014\ncontrary to  block-memory  access where data-write to a  block-size  is more advan tages. \nThe best option to write quickly, and ef\ufb01  ciently \u2013a single location\u2014is by utilizing a \nnon-\ufb02  ash type memory to achieve single-location, read-write operation. A quick \nexample of such scenario is to record a diagnostics trouble code that must be placed \nin the EPROM as a single-write. \n The organization of non-\ufb02  ash type EEPROM places two transistors per memory \ncell-structure to achieve the task of write, and erase cycles electrically. The biggest \nadvantage of non-\ufb02  ash EEPROM is the ability to write and erase a single memory \nlocation, which has an essential use in the automotive modules. Although the non- \n\ufb02 ash type stand-alone EEPROM\u2019s are slow, not so compact, and rather expensive \ncompared to \ufb02  ash-type EEPROM, the use in automotive electronics is inevitable for \nmany good engineering reasons (Table  1.2 ).\n1.28         Vehicle Programming \n Flash programming using the vehicle network bus has gained momentum lately; in \nfact it is in full motion, and has solid footing in the industry today. The idea is to \ndownload the entire module application code into the microcontroller\u2019s \ufb02  ash mem-\nory by utilizing the network communication bus. \n Well! How the network could function if there are no program instructions stored \nin the microcontroller memory?\n \u2013    A blank microcontroller with no program instructions in the memory could not \nfunction at all!  \n \u2013   So, what is the solution?       Table 1.2    Automotive modules programmable memory types   \n Memory  Programming  Er", "?\n \u2013    A blank microcontroller with no program instructions in the memory could not \nfunction at all!  \n \u2013   So, what is the solution?       Table 1.2    Automotive modules programmable memory types   \n Memory  Programming  Erasable  Automotive use  Technology \n Flash  Electrical  Electrical  High  1 \ufb02  oating-gate transistor/cell \n EEPROM  Electrical  Electrical  High  2 Transistors/cell \n EPROM  Electrical  UV Light  Rare  1 Transistor/cell \n PROM  Fusible link  No  Very Low  1 Transistor/cell \n ROM  Masked  No  Rare  1 Transistor/cell 1.28 Vehicle Programmingzamann@us.panasonic.com\n40\n How about a microcontroller that has already been loaded with a tiny program \nstored in its memory locations? \n Yes\u2014it is called a bootstrap loader! Bootstrap loader is a small piece of code \nrequired to instruct the instruction execution unit of a typical computing engine to \nexecute the series of tasks that assists the computer to \u2018boot\u2019. The word \u2018boot\u2019 is \nused to de\ufb01  ne the operational phase of a computer when it performs the task of load-\ning the operating software. Your personal computer or laptop boots the operating \nsystem from the hard disk, or CD-ROM after invoking a short program stored in the \nnon-volatile memory or stored in the hard drive boot-sector. \n In the early days of computers, the external \u2018bootloader\u2019 was used to load the \nmonitor program, kernel or a device driver in the form of a binary code; read through \nthe paper-tape reader into the computer memory (the paper tape had been used to \nstore the binary code; quite interesting isn\u2019t it?) There had been other ways as well \nlike magnetic tape, magnetic drum or magnetic memory. The technology of mag-\nnetic tape, drum memory, magnetic memory, and magnetic ampli\ufb01  ers had been core \nbuilding blocks of many \u2018miracles\u2019 of systems in the early days of computing. \n1.28.1     Embedded Systems Booting \n In today\u2019s world of embedded systems; different type of booting methods are \nemployed. An I 2 C bus boot, SPI bus boot, Ethernet bus boot, CAN bus boot, USB \nbus boot, UART bus boot, so on and so forth. The automotive industry", " systems; different type of booting methods are \nemployed. An I 2 C bus boot, SPI bus boot, Ethernet bus boot, CAN bus boot, USB \nbus boot, UART bus boot, so on and so forth. The automotive industry, however has \npreference over CAN-bus-boot as the accepted candidate to perform variety of tasks \nrelated to modules re-programming. The CAN bus boot thus far has proved out-\nstanding success over the past so many years. \n It is important to understand that the boot-code and module application-code are \ntwo separate and distinctively isolated programs stored at two separate address- \nspace in the microcontroller\u2019s memory. The boot-code remains completely inert, \nuntouchable and write-protected while module performs its routine operational \ntasks. The boot-code never gets executed until the \u2018reset vector\u2019 is modi\ufb01  ed. The \nmodi\ufb01  cation to the reset vector requires control instructions to be issued to the mod-\nule by an external device via a proper handshake (a computer or a hand-held device). \n Furthermore it is to clarify that \u201cbooting\u201d has a slightly different meaning in \ncomputer industry compared to embedded systems of automotive industry. \n In the computer industry, booting is executed to attain a high-level of operational \nintelligence from a low-level of machine-level intelligence like for example loading \nthe operational software, operating software, kernel, monitor or some form of a driver \ninto the memory storage area. However in the realm of automotive computing it means \nloading utility software, which helps to download the new code through serial means \nand eventually programs new or updated operational software in the module memory. \n In short, we can re-de\ufb01  ne a two stage booting \ufb02  ow for a vehicle module:\n\u2022    Boot to establish contact with the external device de\ufb01  ned as primary bootloader  \n\u2022   Boot to write program code in the \ufb02  ash memory de\ufb01  ned as secondary bootloader     1 Vehicle Electronics Architecturezamann@us.panasonic.com\n41\n1.28.2     Primary and Secondary Boot Methods \n Primary bootloader (PBL) and the secondary bootloader (SBL) are two important \nexecutable codes required to work through the process of vehicle module program-\nming. The  primary bootloader  hereby referred as CAN bootloader establishes the \ncommunication to the external tool. In short it is a network device-driver meant", "SBL) are two important \nexecutable codes required to work through the process of vehicle module program-\nming. The  primary bootloader  hereby referred as CAN bootloader establishes the \ncommunication to the external tool. In short it is a network device-driver meant for \na particular processor\u2019s communication node. Accordingly, when the primary boot-\nloader is executed; it uses the module communication channel to download a sec-\nondary program called the secondary-bootloader. The secondary-bootloader is an \nanother short-program comprises of tasks related to memory read, write, erase, and \nverify operations in order to self-program the module \ufb02  ash memory application \ncode. Both bootloader are depended upon the type of microcontroller, its instruction- \nset, and memory address space. \n The primary bootloader is always stored in the microcontroller\u2019s \u201cprotected \nboot-sector\u2019 memory in order to safeguard it from an accidental eraser. Nevertheless, \nwhenever it is desired to execute the tiny program, it would \ufb01  rst access the network \nchannel to communicate with the external intelligent device, completes the hand shake, \nreads the secondary bootloader, and stores it in a temporary location of module \nrandom access memory. Once the secondary bootloader gets completely loaded \ninto the random access memory, it is activated to assist performing \ufb02  ash memory \nread, write, and erase operations\u2014consequently downloading the entire software \ncode into the module memory from the e xternal device through the CAN commu-\nnication channel. \n Needless to say when this capability is achieved then the external device or test \nequipment can download the entire software code into the module memory with \nease of operation. Such an incredible feature could have a profound impact at the \nfollowing locations:\n\u2022    Module manufacturing assembly line  \n\u2022   Vehicle manufacturing assembly line  \n\u2022   Vehicle service centers  \n\u2022   Module test and upgrade centers  \n\u2022   Research and development facilities  \n\u2022   Warranty and repair service centers  \n\u2022   In-vehicle software upgrading    \n Irrespective of \ufb02  ash programming locations, the external device or computer \nmust have to access the module \ufb02  ash memory by means of a network physical layer. \nThe physical layer is the CAN interface between the module and the external device. \nThe module must keep optimum intelligence to send and receive digital data through \nthe physical layer. At the other end, the test station must be able to initiate dialog \nbetween the corresponding modules. Once the", " interface between the module and the external device. \nThe module must keep optimum intelligence to send and receive digital data through \nthe physical layer. At the other end, the test station must be able to initiate dialog \nbetween the corresponding modules. Once the handshake is established, the test \nstation could then download the object \ufb01  le into the module memory. A zoom view \nof \u2018A\u2019 module is shown here, which is connected to end-of-line tester. The test sta-\ntion connects through the vehicle, diagnostics port connecter as shown in Fig.  1.22 .1.28 Vehicle Programmingzamann@us.panasonic.com\n42\n   The sequence of operation depicted in Fig.  1.22  listed below:\n\u2022    External tester send command to stop operational code execution  \n\u2022   External tester send command to execute PBL program  \n\u2022   PBL execution loads the SBL into the microcontrollers RAM space  \n\u2022   PBL and SBL functions together to begin Flash memory blocks access  \n\u2022   PBL and SBL \ufb01  nishes the erase/write operations to all blocks  \n\u2022   External tester send command to reset the module  \n\u2022   Module begins operational code execution     \n1.28.3     Vehicle Modules Programming \n The vehicle module programming for an urgently needed software patch, or an \nextremely important software upgrade or bug \ufb01  xes to an existing software has \ncaught serious attention by vehicle OEM\u2019s and suppliers. It had cost time, money \nand delayed deliveries due to an urgently needed upgrade to the vehicles parked \nat the outside lot of vehicle assembly plants. The method of programing by physi-\ncal connection to the OBD II connector requires 100\u2019s of laptops and work force Protected Memory Space\nSecondary bootloader\nCode\nRAM Space\nFlash Memory Space\nCAN Physical LayerRx                       TxOBD II\nConnectorObject FileCAN \nInterface\nTest Station or EOL \nMicrocontrollerInterrupt VectorsPrimary bootloader Code\nReset VectorApplication Code\nOperational\nModeProgramming\nMode\n  Fig. 1.22    Module connected to the external device to get the software download        1 Vehicle Electronics Architecturezamann@us.panasonic.com\n43\nto re- program vehicles. This mode of manual vehicle programming operation is \nnot so, clearly de\ufb01  ned, and does not have strong business case for a permanent \nsolution. Alternately, OEM\u2019s are positioning themselves to", "\n43\nto re- program vehicles. This mode of manual vehicle programming operation is \nnot so, clearly de\ufb01  ned, and does not have strong business case for a permanent \nsolution. Alternately, OEM\u2019s are positioning themselves to add Wi-Fi connectiv-\nity to the vehicles in order to re-\ufb02  ash the module through the internet and get it \n\ufb01 xed for a long haul. \n In short, the modules installed in vehicles, programmed by the following \nmethods:\n\u2022    Direct physical access to the module CAN bus through the OBD II Connector  \n\u2022   Direct physical access to the module through the USB bus if available  \n\u2022   Wi-Fi installed gadgets installed on to the OBDII connector  \n\u2022   Wi-Fi installed vehicles     \n1.28.4     Generalized Programming Procedure \n The generalized programming method of direct physical access de\ufb01  ned as a typical \nprogramming procedure to download data into the module:\n\u2022    Invoke software user interface to talk to the vehicle communication bus  \n\u2022   Establish communication with the vehicle bus.  \n\u2022   Establish communication with the module needed to be programmed  \n\u2022   Select software download menu  \n\u2022   Select module identi\ufb01  cation and enter security code  \n\u2022   Select appropriate secondary bootloader  \n\u2022   Select the applicable object code \ufb01  le  \n\u2022   Initiate programming sequence  \n\u2022   Request to enter in the programming mode  \n\u2022   Request to access \ufb02  ash memory blocks  \n\u2022   Erase the memory blocks that needed reprogramming  \n\u2022   Re-\ufb02  ash the memory blocks, and continue until \ufb01  nish  \n\u2022   Prepare checksum, or cyclic redundancy check and store results  \n\u2022   Request to terminate programming mode  \n\u2022   Initiate module reset to execute the new code by entering in operational mode \n(Fig.  1.23 )\n1.29            Software Download Time \n Before you get too excited with this \u2018cool\u2019 feature, it would be worth stating that the \nsoftware download in any manufacturing line consumes time eventually reducing \nthe overall throughput to the assembly process. Indeed, if the modules were pro-\ngrammed right before it reached to the assembly plant then it would be a great 1.29 Software Download Timezamann@us.panasonic.com\n44\nsaving of time. However, based on the business case and the availability of engi-\nneering tools the module microcontrollers can", " then it would be a great 1.29 Software Download Timezamann@us.panasonic.com\n44\nsaving of time. However, based on the business case and the availability of engi-\nneering tools the module microcontrollers can be \u2018\ufb02  ashed\u2019 before shipped to the \nmodule manufacturing location. Flash programming the microcontrollers before \nkicking off the module manufacturing line is faster than programming the micro-\ncontrollers while in the module manufacturing process. Additional time in seconds \nor minutes is needed to program a microcontroller. Overall time consumed for a \nsingle module, multiplied by the number of modules produced equates to a \nEstablish Vehicle Bus\nCommunication  Invoke \nProgramming \nApplication\nCommunication \nEstablihed\nSelect Software \nDownload MenuSelect Module \nEnter Security Code\nLoad\nSecondary \nBootLoader\nLoad\nObject FileSecondary \nBootLoader\nObject File\nInitiate \nProgramming Enter Programming \nModeAccess Flash \nMemory BlocksErase \nMemory BlocksWrite\nMemory BlocksAre all blocks \ndone?Prepare Checksum \nStore ChecksumExit  Programming \nModeEnter  Operational \nModeEnd\nSoftware\nControlsManual\nControlsNo\nYes Yes\nNo\n  Fig. 1.23    A typical \ufb02  ow chart to \ufb02  ash module memory blocks        1 Vehicle Electronics Architecturezamann@us.panasonic.com\n45\nsigni\ufb01  cant time factor in an overall productivity of the assembly line. However, this \ntime plenty has one big advantage over the fact that the late software changes can be \nimplemented at the last minute thereby shortens the time-to-market the product, \nwhich keeps the embedded software team happy and smiling. \n The software development, testing, validation and veri\ufb01  cation are some of the \ncritical components of modern  AUTONICS   systems (The term derived from  auto-\n motive electro nics).   Today, the goal of automobile OEM\u2019s is to download the entire \napplication software code in every module using the serial communication link. \nThis gives many advantages including quick software updates, new functions, \nservice updates, and late software releases.  \n1.30     Vehicle Operating Software \n The software development is not the core business of automotive manufacturers; \nhowever, strategically important software development of engine and transmission \ncontrollers have kept many manufacturers busy developing complex algorithms to \nedge competitive advantages over the engine and power train performance. Unlike \na", " \n The software development is not the core business of automotive manufacturers; \nhowever, strategically important software development of engine and transmission \ncontrollers have kept many manufacturers busy developing complex algorithms to \nedge competitive advantages over the engine and power train performance. Unlike \naerospace and defense industries, where software development standards like DOD-\nSTD- 2167A and likewise are part of the culture, automotive software developers are \nstill catching up to sound software engineering principles. The MISRA (Motor \nIndustry Software Reliability Association) is one good step to standardize the pro-\ngramming aspects of software development processes within the automotive indus-\ntry. Capability Maturity Model (CMM) levels, and SPICE (Software Process \nImprovement and Capability Determination )  have also been introduced in the auto-\nmotive software development space. \n Distributed processing in a vehicle does not come with a distributed vehicle \noperating system. In fact, no such thing exists today like a universal vehicle oper-\nating system. There is no equivalent of Microsoft windows existed to be called \nas \u201cAutomotive Modules Operating Software\u201d. The embedded software develop-\ners have traditionally relied on their own version of kernels, task-schedulers, and \nbackground/foreground loop techniques. A recent addition of Microsoft embed-\nded Operating Software introduced by Ford Motor Company has been focusing \nmainly around multi-media, which includes but not limited to speech recognition, \nBluetooth connectivity, and many more cool features. There are some general pur-\npose embedded systems real time operating systems like QNX, ThreadX, VxWorks, \nNucleus RTOS, RTLinux, uITRON and Android to support many similar or diversi-\n\ufb01 ed applications. \n There have been discussions, platforms, forums and consortiums to develop \nstandard operating software architecture; so that a common operating system could \nef\ufb01 ciently function in an automotive environment . One such example is OSEK. \n The OSEK is an open architecture for the automotive distributed operating sys-\ntem; introduced in 1993 in Germany. The OSEK German acronym has the English \ntranslation \u201cOpen Systems and the Corresponding Interfaces for Automotive \nElectronics\". 1.30 Vehicle Operating Softwarezamann@us.panasonic.com\n46\n Many automotive embedded software developers claim that their software is \nOSEK compliant. \n A quick Google search on OSEK is pasted below: \n1.30.1     O", " Operating Softwarezamann@us.panasonic.com\n46\n Many automotive embedded software developers claim that their software is \nOSEK compliant. \n A quick Google search on OSEK is pasted below: \n1.30.1     OSEK \n From Wikipedia, the free encyclopedia \n  OSEK   ( O  ffene    S  ysteme und deren Schnittstellen f\u00fcr die    E  lektronik in   \n K  raftfahrzeugen  ; English: \"Open Systems and their Interfaces for the Electronics in \nMotor Vehicles\") is a standards body that has produced speci\ufb01  cations for an embedded \noperating system, a communications stack, and a network management protocol for \nautomotive embedded systems. It has also produced other related speci\ufb01  cations. \nOSEK was designed to provide standard software architecture for the various elec-\ntronic control units (ECUs) throughout a car. \n OSEK was founded in 1993 by a German automotive company consortium \n(BMW, Robert Bosch GmbH, DaimlerChrysler, Opel, Siemens, and V olkswagen \nGroup) and the University of Karlsruhe. In 1994, the French cars manufacturers \nRenault and PSA Peugeot Citro\u00ebn, which had a similar project called VDX \n(Vehicle Distributed eXecutive), joined the consortium. Therefore, the of\ufb01  cial \nname is OSEK/VDX. \n OSEK is an open standard, published by a consortium founded by the automo-\nbile industry. \n OSEKtime speci\ufb01  es a standard for time-triggered real-time operating systems. \n Some parts of OSEK are standardized in  ISO 17356  . \n AUTOSAR introduced just recently is the next step towards the standards.  \n1.30.2     AUTOSAR \n  From Wikipedia, the free encyclopedia  \n  AUTOSAR   (Automotive Open System Architecture) is open and standardized auto-\nmotive software architecture, jointly developed by automobile manufacturers, suppli-\ners and tool developers. It is a partnership of automotive OEMs, suppliers and tool \nvendors whose objective is to create and establish open standards for automotive E/E \n(Electrics/Electronics) architectures that will provide a basic infrastructure to assist \nwith developing vehicular software, user interfaces and management for all application \ndomains", " and tool \nvendors whose objective is to create and establish open standards for automotive E/E \n(Electrics/Electronics) architectures that will provide a basic infrastructure to assist \nwith developing vehicular software, user interfaces and management for all application \ndomains. This includes the standardization of basic systems functions, scalability to \ndifferent vehicle and platform variants, transferability throughout the network, integra-\ntion from multiple suppliers, maintainability throughout the entire product lifecycle \nand software updates and upgrades over the vehicle's lifetime as some of the key goals. \n The AUTOSAR consortium re-uses the OSEK speci\ufb01  cations: the operating sys-\ntem is a backwards compatible superset of OSEK OS.  1 Vehicle Electronics Architecturezamann@us.panasonic.com\n47\n1.30.3     Automotive Operating Systems \n Every operating system comes with a well-de\ufb01  ned memory space requirement and \nin the domain of automotive distributed computing it has to reside in the module \nmemory. Module developers, who have simple and less complex functions to imple-\nment, do not see any major bene\ufb01  t to keep the copy of a real time operating system \n(RTOS) in the module memory. Rather, they worry about overheads like licensing \nfee, memory usage, compatibility issues and additional software overheads to pro-\ntect the operating software code safe, and guarded. \n The only exception to this paradigm is Network Operating System (NOS), which is \na mandatory requirement to run a successful network-node to share and distribute criti-\ncal operational and network integrity messages on to the communication link. The most \nwell-known network operating software is based on Vector CAN operating system. \nAcross the board every car OEM uses the similar network operating system with differ-\nent names by tweaking needs and wants of the OEM. By far it is the most successful \nnetwork mechanism ever introduced in automotive industry. The success story rests on \nVector Company http://vector.com/ as well, who has a very strict quality and operational \nprocedures in place before accepting any changes or tweaks to their systems. \n QNX http://www.qnx.com/ real time operating software is another bright star \nmaking its place in the automotive design space; the QNX RTOS has successfully \nbeen launched by some major OEM\u2019s incorporating the richness of QNX features in \nmultimedia and human machine interface. \n ITRON http://www", " bright star \nmaking its place in the automotive design space; the QNX RTOS has successfully \nbeen launched by some major OEM\u2019s incorporating the richness of QNX features in \nmultimedia and human machine interface. \n ITRON http://www.ertl.jp/ITRON/home-e.html and micro ITRON (uITRON) is \nanother real time kernel originated in Japan, and has a very strong foundation in embedded \ndesign segment. It is a de-facto standard in Japanese market and claimed to be the most \npopular worldwide. Renesas Semiconductor Company, which has strong presence in auto-\nmotive industry, offers computing architectures supporting uITRON kernel globally. \n Irrespective of how the different RTOS have been developed or in the process of \nbeing developed, a comprehensive solution similar to one offered by Bill Gates or \nSteve Jobs to the computing industry does not seem to be on the radar screen. One \nof the biggest drawbacks that automotive hardware is not common across the board \ncould be used as the primary reason, however there are other issues like multiple \ncomputing nodes of a vehicle distributed architecture, and an extremely determinis-\ntic approach to perform real time tasks in an orderly, and timely fashion . \nNevertheless, it seems that Apple Computer Company or Microsoft have not devel-\noped or paid serious attention in developing a comprehensive real time operating \nsystem based on automotive modules distributed architecture. \n In one case, however, Microsoft partnered with Ford Motor Company and devel-\noped a solution mainly based on multi-media architecture, like USB audio, radio, \nnavigation, speech recognition, cell-phone pairing with a user display to provide \ncustomer visual and touch screen interactions. Microsoft utilized the real-time oper-\nating system namely Windows CE to develop the application. \n General Motors have introduced \u201cMYLINK\u201d, and Daimler Chrysler introduced \n\u201cUCONNECT as similar products using real time operating system, but not utiliz-\ning the Microsoft CE operating system.   1.30 Vehicle Operating Softwarezamann@us.panasonic.com\n48\n1.31     High Level Software Context Diagram \n A context level DFD-0 (Data Flow Diagram\u2013 0) is shown in Fig.  1.24 . Ignition \nswitches and the battery monitoring processing are common for every module. The \nsensors, actuators, lamps, relays and motors are speci\ufb01  c to a particular module. The \nsoftware", " 1.24 . Ignition \nswitches and the battery monitoring processing are common for every module. The \nsensors, actuators, lamps, relays and motors are speci\ufb01  c to a particular module. The \nsoftware procedures are required to control lamps, relays, heaters, motors, solenoids \nand actuators. A modular approach has always its advantages over integrated \napproach. The feedback circuits are mainly for control loop feedback; however, in \nsome cases it could be for the self-test channels to do diagnostics.\n   In the following section we will review how each process is expressed as data \n\ufb02 ow diagram. \n1.31.1     DFD Ignition Processing \n In Fig.  1.25 , some of the functional partitioning of overall software architecture of \na typical module is shown. As can be seen that ignition key switch inputs (OFF, \nRUN/ACCESSARY , START) requires a software process to monitor the key posi-\ntions on timely basis as appropriate for the module operations (P.1.0.0).\nDrivers Circuits\nBattery\nFeedback\nIgnition Switch ApplicationWatchdog Timer\nSensors Network Physical\nLayer Software Interface\nNetwork Operating Software\n(NOS) Network Physical\nLayerOutgoing messages\nIncoming\nmessages\n  Fig. 1.24    Software context DFD-0        1 Vehicle Electronics Architecturezamann@us.panasonic.com\n49\n1.31.2        DFD Battery Processing \n The battery monitoring requires a software process to measure the battery voltage \nto stay operational as long as the battery voltage stays in between a safe operational \nwindow (P.1.0.1) (Fig.  1.26 ).\n   Battery and ignition key switching processes are required for every module.  \n1.31.3     DFD Abnormal Shutdown \n In the event of sudden power loss an abnormal shutdown process (P.1.0.2) should be \ninvoked to save critical system status information in a non-volatile memory (Fig.  1.27 ).Ignition Switch Positions RunAccTrue\nP.1.0.0\nIgnition  \nProcessingStartTrue\nIgnCycles\n  Fig. 1.25    DFD-0.1 (Ignition)       \nBattery Voltage BattVoltMax\nP.1.0.1\nBattery\nProcessingBattVoltNom\nB", "ProcessingStartTrue\nIgnCycles\n  Fig. 1.25    DFD-0.1 (Ignition)       \nBattery Voltage BattVoltMax\nP.1.0.1\nBattery\nProcessingBattVoltNom\nBattVoltMin\n  Fig. 1.26    DFD-0.2 (Battery)       \nBattVoltMin SysStatus\nP.1.0.2\nAbnormal \nShutdown\nProcessingMicroRegisters\nFaultCode\n  Fig. 1.27    DFD-0.3 (Shutdown)        \n \n 1.31 High Level Software Context Diagramzamann@us.panasonic.com\n50\n1.31.4        DFD Switch De-Bounce \n Input sensors processing varies by each module depending upon the type and num-\nber of sensing circuits. Each process veri\ufb01  es the functionality and validity of the \nincoming data. A typical example is switch verses temperature sensor. A switch \nrequires de-bouncing process (P.2.0.1) and a temperature sensor requires A/D read-\ning process (P.2.0.2) (Fig.  1.28 ).\n1.31.5        DFD Temperature Sensor \n Temperature sensor requirements are pretty common in many different automotive \nsystems and many modules utilizes single or multiple temperature sensor (s). A \ntypical DFD is shown in Fig.  1.29 .\n1.31.6        DFD Communication Bus Activity \n In some cases of module, waking up by communication bus activity (which is \nanother form of input sensing), a separate process (P 2.0.3) is required to do the \ntasks it needed to do, after the bus wake-up. It includes, but is not limited to, mes-\nsage recognition, message task execution and bus activity monitoring (Fig.  1.30 ).Door Switch DoorOpen\nP.2.0.1\nSwitch \nDe-bounce\nProcessing\nDoorClosed\n  Fig. 1.28    DFD-0.4 (Switch De-bounce)       \nTemperature Sensor SensorFault\nP.2.0.2\nA/D Channel \nProcessing\nSensorValue\n  Fig. 1.29    DFD-0.5 (Sensor)        \n 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n51\n1.31.7        DFD:", " Channel \nProcessing\nSensorValue\n  Fig. 1.29    DFD-0.5 (Sensor)        \n 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n51\n1.31.7        DFD: Watch Dog Timer \n How good the embedded software would be if it does not know about its own health? \nYou would say no good!\u2014To monitor the software health, the watch-dog- timer has \nbeen used in almost every critical real-time application, and of course, automotive \nsoftware design is no exception. Unlike windows based computers; automotive \ndesign engineers do not have the \u2018luxury\u2019 to ask their customer to press  Ctrl ,  Alt  and \n Delete   to \u2018reboot\u2019 the \u2018vehicle engine\u2019\u2014rather than they rely on the watch dog \n timers. The only way to get out of any software \u2018runaway\u2019 is to keep \u2018bugging\u2019 the \nmicrocontroller. The watch-dog-timer keeps on sending an interrupt signal to \nthe micro-controller (just like asking: how is going?) and the microcontroller keeps \non responding by resetting a \ufb02  ag bit in the watchdog timer circuit (just like saying: \nit\u2019s going all right). \n If the \ufb02  ag bit does not get reset within a pre-de\ufb01  ned time interval then it is a \n\u2018software runaway\u2019 condition and the watchdog timer issues a hard reset to the \nmicrocontroller (P.3.0.0) (Fig.  1.31 ).\n   Another way of monitoring the software is to monitor by inserting a software \nprocedure within a main process. The procedure \ufb01  rst set a bit in a register to enable \na software interrupt. If the monitored processes fail to reset the bit in a well-de\ufb01  ned \ntime interval then it is a \u2018software runaway condition\u2019 and a  soft-restart  should begin \nat this point (Fig.  1.32 ).Bus Activity MsgRecog\nP.2.0.3\nBus Off/On \nProcessingBusAwake\nMsgDirective\n  Fig. 1.30    DFD-0.6 (Bus)       \nHard Reset\nWatch Dog Timer WatchEnable\nP.3.0.0\nWatch Dog\nProcessingHow is going? SetFlagTrue\nGoing all right? SetFlagFalse\n  Fig. 1.31   ", "6 (Bus)       \nHard Reset\nWatch Dog Timer WatchEnable\nP.3.0.0\nWatch Dog\nProcessingHow is going? SetFlagTrue\nGoing all right? SetFlagFalse\n  Fig. 1.31    DFD-0.7 (Watch Dog Timer)        \n 1.31 High Level Software Context Diagramzamann@us.panasonic.com\n52\n1.31.8        DFD Internal Self-Test \n Additional internal self-tests like integrity of RAM/EEPROM, code check-sum, \nmemory block protection are some of the processes always included in almost every \nembedded design; let alone automotive software design (P.4.0.0) (Fig.  1.33 ).\n1.31.9        DFD Output Driver \n Figure  1.34 .\n1.32         Background/Foreground Loop \n As mentioned earlier, the majority of embedded software runs under background/\nforeground loop architecture. An example (Fig.  1.35 ) of one high-level diagram is \nshown. A background loop runs some tasks, but when polled-input signals invoke a \ntask, it executes the high priority task inside the foreground loop. The foreground \nloop has preemptive priority scheme meaning that the highest priority task runs \ufb01  rst. \nAn example of highest priority interrupt in the I/O domain is a sudden battery volt-\nage drop.Finish your job in 10ms\nI/O ProcessMain Process\nI am done. Please, do not restart.\n  Fig. 1.32    \u2018Software Watch\u2019       \nCodeCheckSum\nP.4.0.0\nInternal Self-test\nProcessingRamStatus\nTestFlagBit \nEEStatus\n  Fig. 1.33    DFD-0.8 (self-test)        \n 1 Vehicle Electronics Architecturezamann@us.panasonic.com\nDriverTurnOn\nSensorValue P.4.0.0\nDriver\nProcessingDriverTurnOff\nSensorFault\nDriverFault\n  Fig. 1.34    DFD-0.9 (output drive)       \nBackground LoopInitialization\nInternal Self \nTests\nEnable Software \nInterruptsReset\nPolled Input \nSignals\nInput Signal \nActive ?\nProcess Input \nSignal\nDetermine Task \nPriority\nSchedule Task\nExecute Task\nAll Tasks \nExecuted?Foreground Loop Yes\nNoNo\nYes\n  Fig. 1.35    Background/foreground loop", "\nInput Signal \nActive ?\nProcess Input \nSignal\nDetermine Task \nPriority\nSchedule Task\nExecute Task\nAll Tasks \nExecuted?Foreground Loop Yes\nNoNo\nYes\n  Fig. 1.35    Background/foreground loop architecture        \n zamann@us.panasonic.com\n54\n1.33        Modules Physical Placements \n In the previous section, the electrical layout of the module interconnects were \ndepicted in Fig.  1.9 , which is the representation of how the modules are electrically \ninterconnected in a typical vehicle. In this section we will try to give you a brief \nsummary about where the modules are physically installed at different mounting \nlocations and how the modules are connected through the harness and connectors. \n A vehicle module is normally attached to the vehicle body or chassis or to the \nvehicle cockpit by a mounting scheme. The mounting scheme may or may not use \na bracket depending upon many factors i.e. space, weight, function and mounting \nlocation. An air suspension module, for example, can be attached to the vehicle \nbody by using a bracket; however, an airbag must not be attached to the vehicle \nbody rather it has to be attached to the vehicle chassis directly. Instrument panel on \nthe other hand must be \ufb01  tted inside the cockpit, visible to the driver at all times and \nthe engine controller must have to be \ufb01  tted inside the engine compartment to gain \nall the electrical advantages. \n We now review some of the modules locations in a typical vehicle. \n1.33.1     An Airbag Module \n An air bag module, for example, must be rigidly attached to the vehicle chassis \nand does not require any bracket attachment. The module electronic circuits are \nmounted inside a safe-casing comprises of a cover and the housing. The cover \nand the housing must be made up of metal or rigid material to get the accurate \nvehicle movements. \n Plastic material could also be used on a simple rule: if the module is installed inside \nthe passenger cabin or inside the trunk. It is safe from the external environment (dust, \ndirt, water, chemicals, and large variations of temperature), then it can be encapsulated \nin a plastic cover. However, this is just one key factor, and there are many other factors \nthat need to be considered before deciding about the type of casing. \n An example of airbag module is", "), then it can be encapsulated \nin a plastic cover. However, this is just one key factor, and there are many other factors \nthat need to be considered before deciding about the type of casing. \n An example of airbag module is shown in the Fig.  1.36 . The airbag module is \nrigidly attached to the chassis because the accelerometers that are mounted inside \nthe module demand accurate readings of vehicle movements. The module installa-\ntion location and x, y, z directions are highly critical for the crash impact detection, \nand measurement. The module connector mating harness is  not  shown for the sake \nof clarity.\n1.33.2        An Instrument Cluster \n The instrument cluster is installed in the instrument panel (IP) with the aid of \nmounting screws or by other mechanical means or by a well-de\ufb01  ned mounting \nscheme. The instrument cluster is located in front of the driver. However, in 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n55\nrecent years, some manufacturers have tried to shift the instrument cluster \ntowards the center of the cockpit. Nevertheless majority of vehicles still have \ninstruments clusters installed in front of the driver. Irrespective of where you \nplace the instrument cluster, the basic philosophy is to show the clear display of \ncritical vehicle parameters. The Fig.  1.37  shows the Instrument Cluster com-\nprises of engine temperature indicator, engine revolutions indicator, Fuel tank \nindicator and Odometer clearly placed right in front of the driver. If the vehicle \nis driven by right-hand rules in the target market then all the instruments must \nfollow right-hand rules of the cockpit.\n1.33.3        Multimedia, Location \n The radio, cassette, compact disc, USB or any other audio related functions are \ngrouped as multimedia components. The multimedia components are generally \nmounted in the center of instrument panel near the center pedestal. The basic Direction of Impact\nMating Connector\nDirection of Impact\nAirbag Module\nDirection of Impact                                Vehicle Chassis\nTop View\n  Fig. 1.36    Airbag module installation location       \nMULTIMEDIA\nRPM       SPEED\nTEMP.  FUELHVAC CONTROLS\nMessage Center\n  Fig. 1.37    Cockpit or instrument panel ( front view  )         \n 1.33 Modules Physical Placementszamann@us.panasonic.com", " SPEED\nTEMP.  FUELHVAC CONTROLS\nMessage Center\n  Fig. 1.37    Cockpit or instrument panel ( front view  )         \n 1.33 Modules Physical Placementszamann@us.panasonic.com\n56\nphilosophy of the installation location is to have easy access by the customer for \nthe display and the controls (Buzz word \u2192 HMI \u2192 meaning human Machine \nInterface). In    Fig.  1.37 , the multimedia components are placed to the center of \nthe cockpit  \n1.33.4     Climate Controls \n The heating ventilation and air-conditioning (HV AC) controls are mounted to the \ncenter of the cockpit or closer to the center pedestal. Again, the basic philosophy of \nthe installation location is to have easy access by the customer for the display and \nthe controls (Fig.  1.37 )  \n1.33.5     Engine Controller \n The  engine controller  is typically installed in the engine compartment\u2014a location \nvery well-justi\ufb01  ed for many reasons, and has proved that the location closer to the \nengine makes it closer to sensors & actuators which are critical for many engineer-\ning underlying principles. For example, a shorter distance to the controlling and \nsensing mechanism shortens the overall wiring lengths, increases the ef\ufb01  ciency for \nthe high current switching with better controls and electro-magnetic compliance \nperformance. The location of engine controller shown in the Fig.  1.38  is one exam-\nple. However, the location varies as per needs and wants of the design and develop-\nment team. No matter where the \ufb01  nal location could be selected by the OEM for a \nvehicle platform, the engine controller resides inside the engine compartment (under \nthe hood). The functions and features governing the \ufb01  nal decision to select the loca-\ntion are governed by the technology, engine type, and physical-size, wiring and real \nstate in the compartment.\n1.33.6        Anti-Lock Brake (ABS) Module \n The anti-lock brake electronics module is frequently married to the hydraulic- \nassembly that is attached to the pump-motor. The pump-motor generates the neces sary \nbrake \ufb02  uid pressure transfers through the hydraulic lines to the hydraulic valves, \nwhich acts as a gateway to the \ufb02  uid dynamic forces to operate on individual wheel-\n", ". The pump-motor generates the neces sary \nbrake \ufb02  uid pressure transfers through the hydraulic lines to the hydraulic valves, \nwhich acts as a gateway to the \ufb02  uid dynamic forces to operate on individual wheel-\nbraking mechanism. The preferred installed location ought to be closer to the brake-\nbooster and master-cylinder (Fig.  1.38 ).  1 Vehicle Electronics Architecturezamann@us.panasonic.com\n57\n1.33.7     Power Steering Module Location \n The electrical steering assisted electronics-module is typically placed next to the \nsteering control assembly, thus making it easy to connect to the high-current motor \nto a shorten the electrical distance, which is a great bene\ufb01  t for the high current \npower devices. As mentioned earlier, the steering system still keeps the mechanical \nlinkage to the wheels; however, the electrical motor is used to assist steering efforts. \nIn Fig.  1.38  the steering control module is shown mounted on top of the steering \nassist motor\u2014clearly showing the steering wheel mechanically connected to the \nsteering system as well. Failure to the motor or the electronics may cause extra \nefforts needed to steer the vehicle, but total system failure would not occur.   \n1.34     Vehicle Harnesses \n The conduit of electrical signals among the modules is the wiring. The wiring route \naround the vehicle consequently shapes, and forms the harnesses. The harness with \nthe aid of mating connectors connects to the electronic control modules with the \nrest of the vehicle electronic components. The components include, but not lim-\nited to, sensors, actuators, solenoids, lamps, battery, fuses and switches. The mat-\ning connectors are required for an easy installation and removal of the modules, \ncomponents, and other essentially attached devices. Furthermore, it is helpful to do \n maintenance, repair, troubleshooting and replacement of the faulty components. The \nharnesses and wirings are tailored-made to size, dimensions, and routing- shapes be \nEngine Controller\nABS Module    \nM Steering Control Module\nSteering Assist Motor\nSteering Wheel \nEEC\n  Fig. 1.38    Engine compartment ( top view  )         1.34 Vehicle Harnesseszamann@us.panasonic.com\n58\ngoverned by the geometry of the intended area. The overall routing, shapes, and \nmating connectors", ".38    Engine compartment ( top view  )         1.34 Vehicle Harnesseszamann@us.panasonic.com\n58\ngoverned by the geometry of the intended area. The overall routing, shapes, and \nmating connectors of the harnesses are depended upon the vehicle dimensions, \ninstalled modules, possible-routing-schemes and the number of electronic systems \ninstalled. Harnesses are developed, tested, and veri\ufb01  ed in advance\u2014long before the \n\ufb01 nal assembly process of the vehicle begins. In the early stage of vehicle prototype \nbuilds, the harnesses are attached, routed, and mated to the vehicle chassis, and \nbody to verify the correct functional operations and testing. \n The connectors to each component are carefully designed and chosen to avoid \nwrong mating connections. A possibility of human error could happen, while the \nmating connections are being laid out in the vehicle manufacturing operations. \nThere is a preferred method of using connector keying scheme throughout the \nindustry in order to avoid wrong mating connections. The connector keying scheme \nallows only the correct mating connections be made possible and prevent incorrect \nmating. An incorrect mating connection may cause damage to the system or \n malfunction to the vehicle electronic devices. A term \u201cpoke-yoke\u201d is often used to \ndescribe the actions needed to be performed to avoid error conditions.  \n1.35     Overview Layout of Harnesses, Devices and Modules \n A general vehicle overview of the harnesses, modules, and electronic devices of \nsome of the installed systems are shown in Fig.  1.35 . The electronic components \nmounted at the door require either one or more mating points preferably a connector \nto be connected with the rest of the vehicle harness. Similarly, wiring harnesses \nwithin the cockpit are routed together and mated with the rest of the vehicle wiring. \nThe cockpit in itself is made and wired as a separate assembly. The cockpit wiring \nincludes, but not limited to, many electrical devices. For example, glove compart-\nment lamps and switches, steering control switches, turn signals, steering wheel \nposition sensor, radio, airbag \ufb01  ring squibs, radio and multimedia controls, instru-\nment cluster, and so on so forth. \n The vehicle wiring and routing shown in the diagram looks so straight is not \u2018that \nstraight\u2019 and must be laid out after a careful planning. The harness length measure-\nments, routings,", "-\nment cluster, and so on so forth. \n The vehicle wiring and routing shown in the diagram looks so straight is not \u2018that \nstraight\u2019 and must be laid out after a careful planning. The harness length measure-\nments, routings, attachments to secure the harnesses, design, and testing of each \nelectrical contact have now turned into an automotive discipline needed great deal \nof attention before the vehicle electrical systems are \ufb01  nally put in place. The overall \ncost and weight of the harness and connectors plays a signi\ufb01  cant role on the reli-\nability and robustness of a typical vehicle electronics architecture. The purpose of \nshowing some of the installed locations is to give the reader a general idea how the \ndifferent devices could be placed in that particular region. \n It is no way a representation of the entire electrical systems; however it tries to \nopen up a general awareness of components, devices and their installed locations in \nthat particular area in a typical vehicle. \n It is interesting to note here that module installation locations, wiring, connec-\ntors, functions and pin assignments varies from manufacturer to manufacturer and, 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n59\neven sometimes, varies within the similar vehicle type due to the features and func tions \noffered to the market. \n Vehicle wiring, harnesses, connectors, and mating pins must be robust enough to \nwithstand harsh vehicle environments., vibration, heat, dust, snow, salt, or chemi-\ncals, water-ingress, oil, grease, temperature variations, thermal expansion, contrac-\ntion, pull-off force, stress, so on and so forth \n Wirings and harness development are not the core business of car manufacturers. \nThey are usually handled by the outside companies. The system level testing and \nveri\ufb01 cation is done by the respective car OEM\u2019s (Fig.  1.39 ).\n1.36        Case Study Nissan Quest., Mini Van Modules \n In this section we will review the electronics architecture of Nissan-Quest minivan \nto learn more about the nomenclature, functions and systems. However, in this \nsection we will restrict ourselves to non-audio applications\u2014intentionally avoid-\ning multi-media components. Information presented here is purposely modi\ufb01  ed to \nfamiliarize the reader with the industry. However the topology and theme was \noriginated from the Nissan", " to non-audio applications\u2014intentionally avoid-\ning multi-media components. Information presented here is purposely modi\ufb01  ed to \nfamiliarize the reader with the industry. However the topology and theme was \noriginated from the Nissan service manual and meant strictly for educational pur-\nposes. Each module\u2019s functionality has been redrawn with a simple block diagram \nto get the reader\u2019s attention; however the Nissan\u2019s actual nomenclature has been \nretained. In case of errors, omissions or con\ufb02  icts, the Nissan manual supersedes \nall information presented here. Refer to Nissan Quest 2004 maintenance & repair \nprocedures manual # SM4E-1V42UO published by Nissan North America Inc., \nTechnical Publication Department Gardena, California, USA; for any clari\ufb01  cation \nor further explanation. \n1.36.1     Intelligent Power Distribution Module (IPDM) \n This module is \u2018jammed-packed\u2019 with relays, fuses, and electronic-switches (relay \ndrivers) controlled by a microcontroller. The relays are the part of several vehicle \nsystems and are designed to be controlled by the applicable modules, but integrated \ninto the IPDM fuse/relay box. The IPDM along with its microcontroller and embed-\nded software can actuate any relay provided the appropriate command is issued by \nthe \u2018needy\u2019 module. The \u2018needy\u2019 module can issue the appropriate command \nby sending a CAN message on to the vehicle multiplex bus. The CAN message thus \nacts like a request to turn-on or turn-off the corresponding relay. \n The fuses are also integrated into the IPDM feeding several vehicle systems. \nQuite interestingly, the only input interface to IPDM is the CAN bus, however, \n outputs are many, and gets interfaced to 16 relays\u2014driven by low-side drivers. \nA simple block diagram of the IPDM is depicted in Fig.  1.40 .1.36 Case Study Nissan Quest., Mini Van Moduleszamann@us.panasonic.com\n60\nHeadlamps\nHeadlamp\nAnti-skid\nController\nEngine\nController\nFire Wall\nMultimedia\nInstrument\nClusterHVAC \nMotors\nSwitches\nActuatorsCockpit or Instrument PanelMotors\nSwitches\nActuatorsAirbag\nModule\nDoor. Door.\nWiring", "\nController\nFire Wall\nMultimedia\nInstrument\nClusterHVAC \nMotors\nSwitches\nActuatorsCockpit or Instrument PanelMotors\nSwitches\nActuatorsAirbag\nModule\nDoor. Door.\nWiring & Harnesses\nMotors\nSwitches\nActuatorsMotors\nSwitches\nActuators\nDoorDoor\nMotors\nSwitches\nActuators\nHeaters\nTail lampsBattery Fuse box\n  Fig. 1.39    Vehicle overview showing logical placements       \nBatt + Fuses\nCAN BUS Vehicle CAN Bus BackboneRelay CoilsRelay  \nContacts\nSeveral SystemsCAN Physical Layer PROCESSING RELAY DRIVERS 1Contacts \n  Fig. 1.40    Intelligent power distribution module block diagram        \n 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n61\n   The nomenclature of each relay is tabulated in Table  1.3 . The relays are mainly \ncontrolled by engine control computer, and by the body control module. The inter-\nnal IPDM diagnostics functionality is performed by IPDM itself.\n1.36.2        ABS/TCS/VDC Control Unit \n The main function of Anti-lock Brake System (ABS) is to countermeasure wheel- \nlockup conditions while brakes are applied, so it is accomplished by releasing brake \npressure from the respective brake-pad thereby selecting the appropriate solenoid \nvalve. The rotational wheel-speed is monitored by the wheel-sensors installed at \neach wheel. The motor works as a pump to generate hydraulic pressure available to \nthe system. \n The traction control systems (TCS) function kicks in when potential wheel- \nspinning is detected by the module software fed back by the appropriate wheel- sensor. \nThe corrections are applied to mitigate wheel spinning by modifying the brake pres-\nsure, throttle & fuel control and by sending appropriate messages to the respective \nmodules. The vehicle dynamics control (VDC) monitors the steering wheel  position, \nand vehicle yaw-rate accelerometer to determine its roll attitude. The embedded \nfunctions are designed to counter measure vehicle instability conditions by control-\nling the brake system hydraulic valves via vehicle dynamics control solenoids. The \nVDC functions could only manage vehicle stability in a well-de\ufb01  ned operational \nenvelope bearing in mind that vehicle dynamics control cannot defy the laws of \nphysics. A simple block diagram is depicted in Fig.  1.41", " \nVDC functions could only manage vehicle stability in a well-de\ufb01  ned operational \nenvelope bearing in mind that vehicle dynamics control cannot defy the laws of \nphysics. A simple block diagram is depicted in Fig.  1.41 \n   The sensors, switches, motor, relay and solenoids are listed in Table  1.4 \n1.36.3        Supplemental Restraint System (SRS) \n The SRS is meant for airbag deployment. All of its sensors and accelerometers \nare used to monitor vehicle dynamics, and occupant\u2019s safety. In the event of a crash, \nthe airbag \ufb01  ring-circuit triggers the squib that eventually deploys the airbag. While    Table 1.3    List of relays controlled by different vehicle systems   \n CAN messages  Relay coils \n Originating from different \nvehicle systems  01: AC relay  02: Starter relay \n 03: ECM relay  04: Cooling fan relay #1 \n 05: Fuel pump relay  06: Throttle control relay \n 07: Cooling fan relay #2  08: Cooling fan relay #3 \n 09: Tail lamp  10: Front wiper Lo RELAY \n 11: Front wiper Hi relay  12: Headlamp Lo relay \n 13: headlamp Hi relay  14: Cornering lamp LH relay \n 15: front Fog relay  16: Cornering lamp RH relay 1.36 Case Study Nissan Quest., Mini Van Moduleszamann@us.panasonic.com\n62\nthe airbag is being deployed, the module turns on the airbag fault indicator lamp \nlocated inside the combination meter. In Fig.  1.42 , sensors, and output devices are \nshown connected to the processing engine, however, please note absence of com-\nmunication bus that makes it less depended on any other vehicle resources thereby \ndecreasing the risk of SRS failure.\n   The seat sensors monitor the occupant\u2019s seat-belt buckle-position, seat-belt ten-\nsion, occupant\u2019s weight, and position. The crash sensor monitors the crash event, \nand when activated enables one of the logic needed to take \ufb01  nal deployment deci-\nsion. The accelerometers are used to determine the vehicle acceleration. When all \nthe pre-requisites to the \ufb01  ring-logic are s", "and when activated enables one of the logic needed to take \ufb01  nal deployment deci-\nsion. The accelerometers are used to determine the vehicle acceleration. When all \nthe pre-requisites to the \ufb01  ring-logic are satis\ufb01  ed the occupant\u2019s seat-belt webbing \ngets automatically tightened by means of a pre-tensioner mechanism to overcome CAN BUS\nVehicle CAN Bus BackboneSwitches \n(brake,VDC,Fluid)\nSteering Angle \nSensorPROCESSING\nSLIP Indicator CAN Physical LayerVDC Solenoid Valves\nWheel Solenoid Valves\nMotor & RelaysDrivers\nDriversDriversSteering Position \nSensor\nYaw Rate SensorWheel SensorsLevel Shift\nLevel Shift\nLevel ShiftLevel Shift\n  Fig. 1.41    ABS/TCS/VDC block diagram       \n   Table 1.4    List of vehicle interface to ABS/TCS/VDC module   \n Sensors  Switches  Motor  Relay  Solenoids \n Yaw rate  Stop switch  ABS motor  ABS relay  FL IN \n Steering angle  Brake level  FL OUT \n Wheel # 1  ASCD  FR IN \n Wheel # 2  VDC on/off  FR OUT \n Wheel # 3  RL IN \n Wheel # 3  RL OUT \n RR IN \n RR OUT \n HSV1 \n HSV2 \n USV1 \n USV2  1 Vehicle Electronics Architecturezamann@us.panasonic.com\n63\nthe seat-belt slack in order to tighten the positions of passenger or the driver. \nAfter \ufb01  nishing these tasks the airbag \ufb01  ring mechanism triggers the sealed in\ufb02  ator to \n\ufb01 ll nitrogen gas inside the airbag (Table  1.5 ).\n1.36.4        Body Control Module (BCM) \n Door locks, switches and window-glass motors are the primary features for this \nmodule (Figs.  1.43  and  1.44 ). However, BCM gets augmented by power drive \nunits to serve its functionality. The power drive units are power window con-\ntrol units, sliding door control units, and back door control. Furthermore it \nc ontrols the lamps inside the cabin.\n1.36.5         Sliding Door Control Unit (SDCU) \n The mini-van sliding door are controlled by the processing inside the BCM. Both \nsliding", " control. Furthermore it \nc ontrols the lamps inside the cabin.\n1.36.5         Sliding Door Control Unit (SDCU) \n The mini-van sliding door are controlled by the processing inside the BCM. Both \nsliding door control units gets the control signals to move the sliding door as shown \nin Fig.  1.44 .  \n1.36.6     Engine Control Module (ECM) \n Engine functionality on one hand requires input sensors to sense engine parameters \nlike critical temperatures, crankshaft position, and vital pressures during engine \ncrank, start and run phases. On the other hand, it sprays fuel by the aid of fuel injec-\ntors, burns fuel on thereby transferring high energy to the spark plugs, and uses \nseveral solenoid valves to monitor and control engine timing (Fig.  1.45 ) (Table  1.6 ).Airbag with sealed \ninflator\nPre-tensioner Crash Sensor PROCESSING  Driver\nAirbag Lamp Airbag Firing \nCircuits\n Driver AccelerometersSeat senosrs  Level Shift\nLevel Shift\nLevel Shift\n  Fig. 1.42    SRS Block diagram       \n  Table 1.5    List of vehicle \ninterface to airbag module   Sensors  Drivers  Lamp \n Accelerometer  Pre-tensioner  Airbag \n Crash  Squib \n Seat buckle  1.36 Case Study Nissan Quest., Mini Van Moduleszamann@us.panasonic.com\n64\n5\n5\nCA N BUS\nVehicle CAN Bus BackbonePower Window \nControl Unit (LH)\nPower Window \nControl Unit (RH)Door Lock Motors\nFront Door Lock \nAssembly Back Door Control \nUnit Control Signal\nCAN Physical LayerH-Bridges\nControl SignalUser Switches\nCombination \nSwitchesAutolamp Sensor\nProcessingLevel ShiftLevel Shift\n  Fig. 1.43    Partial BCM block diagram       \n5\n5\nCA N BUS\nVehicle CAN Bus BackboneCombination \nSwitches\nCAN Physical LayerSliding Door Control \nUnit (LH)\nUser Switches\nControl SignalSliding Door Control \nUnit (RH)\nSliding Door \nSwitchesProcessing H-BridgesSliding Door Lock \nActuatorLevel ShiftLevel Shift\n  Fig. 1.44    Partial BCM block diagram       \nCAN BUS\nVehicle CAN Bus BackboneCAN Physical LayerEngine Sensors  Relays", "iding Door \nSwitchesProcessing H-BridgesSliding Door Lock \nActuatorLevel ShiftLevel Shift\n  Fig. 1.44    Partial BCM block diagram       \nCAN BUS\nVehicle CAN Bus BackboneCAN Physical LayerEngine Sensors  RelaysControl Switches PROCESSING  DRIVERS  Solenoid ValvesCruise Control \nSwitches\nCritical Sensors Fuel InjectorsThrottle Control \nMotor\nLevel Shift\nLevel Shift\nLevel Shift\n  Fig. 1.45    Electronic engine controller        \n \n 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n65\n1.36.7         Automatic Drive Positioner Control Unit (ADP) \n This module is designed for the embedded functions required to assist the driver for \nremote operations of side-view mirrors, accelerator and brake pedal positions. It is \nalso connected to a separate module called driver seat control unit to assist motor-\nized seat-position adjustments. In realistic terms, functionality of both modules is to \nadjust driver\u2019s driving position. The DSCU and ADP talks to each other via UART \n(Universal Asynchronous Receiver Transmitter) channel dedicated to share infor-\nmation. Seat Memory switches are used to recall previously stored settings, up to \ntwo settings could be stored & recalled. Door mirror switches are use to adjust both \nside-view. The pedal adjustment switches are interfaced through the Driver Seat \nControl Unit (Fig.  1.46 ) (Table  1.7 ).\n1.36.8         Driver Seat Control Unit (DSCU) \n Driver Seat Control Module is designed to adjust driver seat positions by controlling \nthe \u201cslide\u201d, \u201crecline\u201d and \u201clift\u201d motors. In addition to that DSCU is connected to the \npedal adjustment switches to read the switches status, translates in the digital for-\nmat, and sent in digital format on a UART channel to feed Automatic Drive \nPositioner (Fig.  1.47 ) (Table  1.8 ).   Table 1.6    List of vehicle interfaces to ECM   \n Engine sensors  Switches  Motors  Relays  Solenoids \n Cam shaft position 1  On/off  EGR control valve  Cooling fan 1  Fuel injector 1 \n Cam shaft position 2  Cancel  Fuel pump  Cooling fan 2  Fuel injector 2 \n Crank shaft position  Set/coast  Throttle control  Cooling fan 3", " valve  Cooling fan 1  Fuel injector 1 \n Cam shaft position 2  Cancel  Fuel pump  Cooling fan 2  Fuel injector 2 \n Crank shaft position  Set/coast  Throttle control  Cooling fan 3  Fuel injector 3 \n Intake air temp.  Resume/accel.  ECM relay  Fuel injector 4 \n Mass air \ufb02  ow  Park/neutral  Ignition relay  Fuel injector 5 \n Knock sensor  Fuel pump  Fuel injector 6 \n EGR temperate  Ignition coil 1 \n Air/fuel ratio 1  Ignition coil 2 \n Air/fuel ratio 2  Ignition coil 3 \n Heated oxygen 1  Ignition coil 4 \n Heated oxygen 2  Ignition coil 5 \n Engine coolant  Ignition coil 6 \n Power steering press.  VIAS valve \n EV AP control press.  EV AP valve \n Refrigerant press.  Intake valve 1 \n Accelerator pedal 1  Intake valve 2 \n Accelerator pedal 2 \n Throttle position 1 \n Throttle position 2 1.36 Case Study Nissan Quest., Mini Van Moduleszamann@us.panasonic.com\n66\n1.36.9         Front Air Control Unit (FACU) \n The HV AC functions are achieved by sensing the exterior temperature, interior tem-\nperature, user requests and then using the embedded controller to adjust the required \ntemperature settings. The hot/cold air is mixed by an air-mixture valve controlled by \nthe actuator motor. The actuator door-motors are used to direct air to the respective \noutlets selected by the user. The blower motor is used to re-circulates the air. Door Mirror Switches\nDoor Mirrors (RH)\nUART Driver Seat Control UnitSeat Memory \nSwitchesPadel Motor\nPROCESSING  DRIVERS Door Mirrors (LH)Level Shift\nLevel Shift\n  Fig. 1.46    Automatic drive positioner block diagram       \n  Table 1.7    Automatic drive \npositioner control unit vehicle \ninterface   Switches  Motors \n Memory recall 1  Pedal adjust \n Memory recall 2  Up/down motor [LH] \n Set memory  Left/right motor [LH] \n Mirror left  Up/down motor [RH] \n Mirror right  Left/right motor [RH] \n", "1  Pedal adjust \n Memory recall 2  Up/down motor [LH] \n Set memory  Left/right motor [LH] \n Mirror left  Up/down motor [RH] \n Mirror right  Left/right motor [RH] \n Mirror up \n Mirror down \nF1\nF1 F2\nF2\nF3\nF4 F3\nF4\nCAN BUS\nVehicle CAN Bus BackboneCAN Physical LayerAutomatic Drive \nPositioner  Control.. \nPadel Adjustment \nSwitches\nMotor Position \nFeedbacksSliding Motor\nReclying Motor\nLifting Motor (RH) DRIVERS PROCESSING\nPower Seat Control \nSwitchesLifting Motor (LH)UART\nLevel Shift\nLevel Shift\n  Fig. 1.47    Driver seat control module block diagram        \n 1 Vehicle Electronics Architecturezamann@us.panasonic.com\n67\nThe air-conditioning compressor motor is required to compress the Freon refrigerant \nin order to obtain cooler air. The compressor motor is mechanically driven by the \nengine, however the engage & disengage clutch (a solenoid coil) is controlled by an \nA/C relay (Fig.  1.48 ) (Table  1.9 ).  Table 1.8    DSCU switches \nand motors   Switches  Motors \n Pedal adjust forward  Slide \n Pedal adjust backward  Recline \n Seat slide forward  Lift front \n Seat slide backward  Lift rear \n Seat recline forward \n Seat recline backward \n Seat lift front up \n Seat lift front down \n Seat lift rear up \n Seat lift rear down \n Park \nCAN BUS\nVehicle CAN Bus BackbonePosition Sensors Relays\nCAN Physical LayerActuator Door Motors\nUser Controls PROCESSING  DRIVERS Blower MotorTemperature \nSensorsLevel Shift\nLevel Shift\nLevel Shift\n  Fig. 1.48    Front air control unit block diagram       \n   Table 1.9    Front air control unit interface   \n Sensors  Switches  Motors  Relays \n Ambient temperature  7-Position rotary (front)  Blower motor (front)  Blower relay (F) \n Intake temperature  5-Position rotary (rear)  Blower motor (rear)  Blower relay (R) \n Defroster motor  A/C relay \n Intake (driver) \n Intake (passenger) \n Mode door motor \n Air mix motor \n Heater motor", " (rear)  Blower motor (rear)  Blower relay (R) \n Defroster motor  A/C relay \n Intake (driver) \n Intake (passenger) \n Mode door motor \n Air mix motor \n Heater motor  1.36 Case Study Nissan Quest., Mini Van Moduleszamann@us.panasonic.com\n68\n1.36.10         Transmission Control Unit (TCU) \n Automatic gear transfers are performed by an electro-mechanical hydraulic \nunit controlled by electronics and embedded software. The electronics and the \nembedded controller are housed in a separate package, and installed near the \nhydraulic assembly unit. Few sensors are hardwired directly to the embedded \ncontroller, but some are shared by the aid of engine control module, and com-\nbination meter via the CAN message scheme. The block diagram is shown in \nFig.  1.49 .\n   The sensors, switches, solenoids and other modules required for the automatic \ngear transfer function are listed in Table  1.10 . The engine revolutions sensor, throt-\ntle position sensor, vehicle speed sensor, stop-lamp switch, and overdrive switch \nare connected to engine control module and combination meter, however, sensor \ninformation is shared by the transmission control unit by utilizing CAN bus mes-\nsages. The accelerator pedal position, transmission \ufb02  uid temperature, engine revo-\nlutions and throttle position are critical sensor requirements for the automatic \ntransaxle operation.\nCAN BUS\n        Vehicle CAN Bus BackboneSwitches\nControl Solenoids System Sensors PROCESSING  DRIVERS\nPosition Sensors\nCAN Physical Layer\nECM Combination MeterLevel Shift\nLevel Shift\nLevel Shift\n  Fig. 1.49    Transmission control unit block diagram       \n   Table 1.10    Transmission control unit interface   \n Sensors  Switches  Solenoids  Sensors/signals\u2014(source) \n Acc. Pedal Pos  Park/neutral  Line pressure  RPM\u2014(ECM) \n Fluid temp  Overdrive  Torque clutch  Throttle position\u2014(ECM) \n RPM  Overrun clutch  Stop lamp switch\u2014(CU) \n Throttle  Shift valve A  Overdrive switch\u2014(CU) \n Shift valve B  Vehicle speed\u2014(ECM)  1 Vehicle Electronics Architecturezamann@us.panasonic.com\n69\n1.36.11        Combination Unit (CU)", " valve A  Overdrive switch\u2014(CU) \n Shift valve B  Vehicle speed\u2014(ECM)  1 Vehicle Electronics Architecturezamann@us.panasonic.com\n69\n1.36.11        Combination Unit (CU) \n The combination unit interacts with the driver. It houses all the conventional gauges \nlike speedometer, tachometer, engine temperature, fuel quantity and different sys-\ntems status indicator-lamps sometimes called telltales. The calibrated gauges are \nfrequently driven by the stepper motors, but they may be driven differently. \n An interesting feature of the combination meter is its unique \u2018self-contained\u2019 \nfunctionality of displaying information to the driver without requiring any external \ndevice be controlled outside the module; the dial pointers and indicators are self \ncontained inside the unit. There are many vehicle input signals needed by the com-\nbination unit to perform its functionality. Several input signals are hardwired \ndirectly, but some are available on the CAN bus by the courtesy of IPDM, ABS, \nECM and BCM. Also notice that steering angle sensor sends steering angle infor-\nmation onto the CAN bus (Fig.  1.50 ). In Table  1.11  sensors & signals, the origin of \nsignal is listed as source like BCM, ECM & CU.\nCAN BUS\n        Vehicle CAN Bus BackboneGenerator\nPROCESSINGSwitches LED Drivers\nFuel Level Sensor DriverLED Indicators\nSRS ModuleStepper Motor \nDrivers\nBuzzer\nCAN Physical Layer\nSteering Angle \nSensorIPDM ABS Module\nOil Pressure SwitchBody Control Module\nDoor SwitchesEngine Control \nModuleLevel Shift\nLevel Shift\nLevel ShiftLevel Shift\n  Fig. 1.50    Combination unit block diagram       \n   Table 1.11    Combination unit vehicle interfaces   \n Lamps  Switches  Sensors/signals\u2014(source)  Lamps \n Fuel  Stop lamp switch  Oil pressure switch\u2014(IPDM)  Security \n Oil  Brake \ufb02  uid level switch  Wheel sensors\u2014(ABS)  Tire pressure \n Cruise  Parking brake switch  Sliding door switch RH\u2014(BCM)  O/D off \n Set  Seat belt buckle switch  Sliding door switch LH\u2014(BCM)  Pax airbag off \n Washer  Washer \ufb02  uid level switch  Front door switch LH\u2014(BCM)  ABS \n Charge  A/T device switch ", "  Seat belt buckle switch  Sliding door switch LH\u2014(BCM)  Pax airbag off \n Washer  Washer \ufb02  uid level switch  Front door switch LH\u2014(BCM)  ABS \n Charge  A/T device switch  Front door switch RH\u2013 (BCM)  VDC off \n Brake  Generator  Fuel level sensor\u2014(CU)  SLIP \n Service  Airbag fault signal\u2014(SRS)  Belt \n Airbag  Diagnostics messages\u2014(ECM)  Door \n Right turn  TCS off \n Left turn  High beam  1.36 Case Study Nissan Quest., Mini Van Moduleszamann@us.panasonic.com\n70\n1.36.12         Input and Output Devices Audit \n                        \n ECU  Switches  Sensors  Relays  Solenoids  Motors  Lamps  CAN  Micro \n ECM  5  19  6  16  3  3  1  1 \n TCU  2  4  0  5  0  2  1  1 \n FACU  12  2  3  0  8  4  1  1 \n CU  2  0  0  0  0  22  1  1 \n DSCU  11  0  0  0  4  4  1  1 \n BCM  39  1  0  0  5  1  1  1 \n SRS  0  3  0  0  0  2  0  1 \n ABS  4  6  1  12  1  2  1  1 \n IPDM  0  0  16  0  0  2  1  1 \n SDCU  1  0  0  0  2  1  0  3 \n ADP  7  0  0  0  5  1  1  1 \n Total  83  35  26  33  28  44  9  13 \n", " 7  0  0  0  5  1  1  1 \n Total  83  35  26  33  28  44  9  13 \nSide bar\nCost is a primary consideration factor in every discipline of automotive engi-\nneering and automotive electronics is no exception. Total Quality Cost \nManagement (TQCM) is a quality discipline used to kick-in, whenever a \ncross-functional team meets and brainstorm opportunities, risks and risks- \nmitigation in order to reduce parts count to save cost. The real driving force \nfor this effort is to reduce cost & parts complexity. As an example, if a unit \nproduction volume is 2 million per annum then a cost cut of 3 cents per unit \nis a saving of $60K.\n      Side bar \n A very important concept of veri\ufb01  cation and validation used in the indus-\ntry is simply explained below: \n Veri\ufb01  cation: \u201cAre we building the product right \n Validation: \u201cAre we building the right product\u201d     1 Vehicle Electronics Architecturezamann@us.panasonic.com\n71\n1.37     Exercise \n    Q1: Which module is the most logical candidate to embed cruise control \nfunctions?  \n  Engine related control functions are embedded in engine control computer. Since \ncruise control features require using engine RPM, throttle position, vehicle speed \nand gas-pedal position to acquire the cruise control functionality, it is pretty logi-\ncal to integrate cruise control functions in the engine control computer.  \n  Q2: Draw a simple block diagram of cruise control functions showing all sensors \nand control devices?  \n  Q3: What is required to enhance the cruise control functional block as depicted in \nFig.  1.51  to make it an adaptive cruise control?\n     In order to add adaptive cruise control functions, it is essential to monitor the \nspeed of the vehicle moving ahead of the subject vehicle in the same lane. \nThe speed sensing mechanism required to do the embedded function uses \ntwo methods:\n    1.    Radar Detection   \n   2.    Image Capture \n In order to enhance the simple cruise control system, added detection and \ncontrol functions are needed to achieve the level of adaptive cruise control.      \n  Q4: Modify the high level vehicle electronics architecture below by adding a power \nsupply", "    Image Capture \n In order to enhance the simple cruise control system, added detection and \ncontrol functions are needed to achieve the level of adaptive cruise control.      \n  Q4: Modify the high level vehicle electronics architecture below by adding a power \nsupply module feeding all modules from the vehicle battery. Show all the dele-\ntions and additions as necessary. \nPROCESSINGThrottle DrivePedal Position\nThrottle PositionEngine RPM\nVehicle Speed\nControl SwitchesBrake Switch\n  Fig. 1.51    Cruise control functional block        1.37 Exercisezamann@us.panasonic.com\n72\n   Q5: What are the advantages & disadvantages of a central load dump topology?  \n  Q6: Why the ignition switch is connected to every module in a distributed vehicle \narchitecture?  \n  Q7: Write down the path to transfer a program \ufb01  le into the module memory from \nan end-of-line tester being utilized in a vehicle assembly plant?  \n  Q8: How would a defective electronics module is detected in the vehicle assembly \nplant\u2014if it gets faulty while the vehicle is rolling off the assembly process?  IGNITION \nSWITCH\nFUSE\nFUSE\nFUSE\nFUSE\nFUSE\nFUSE\nFUSE\nKEY:\nNetwork Operating Software\nModule Application Software\nModule  BATTERY ( B+ ) COMMUNICATION LINK\n  Sensors, Switches  Actuators, Lamps\nEngine Controller\nTransmission Controller\nInstruments & Displays\nTire Pressure Monitor\nVehicle Body FunctionsHVAC Controls & Displays\nAirbag Logic & Drive\nAntiskid Logic & Controls\nPower Steering Assist\n A  A \n N N  \n A  N  \n A  N  \n A  N  \n A  N  \n A  N  \n A  N  \n A  N  \n A  N  1 Vehicle Electronics Architecturezamann@us.panasonic.com\n73\n  Q9: If you were to make a decision on the vehicle battery size (amps/hour), what \nengineering factors would you consider to \ufb01  nalize the size of the battery?  \n  Q10: What options a module manufacturer could consider when developing the \nmodule operating software?  \n  Q11: List a few advantages of a universal airbag module?  \n  Q12 List few common hardware and software parameters that can be realized in a \nuniversal airbag module?  \n  Q13: What has been", " operating software?  \n  Q11: List a few advantages of a universal airbag module?  \n  Q12 List few common hardware and software parameters that can be realized in a \nuniversal airbag module?  \n  Q13: What has been the progress on 42 V vehicle electrical system?  \n  Q14: What are the enablers to drive more electrical energy?  \n  Q15: Compare and contrast the \u2018embedded\u2019 verses \u2018straight-wire-switch\u201d topology?  \n  Q16: What is the main assignment of a watch dog timer?  \n  Q17: What is the relationship between the \u201cWatch-Dog-Timer\u201d and the \u201cReset\u201d to \na microcontroller?  \n  Q18: List some of the module nomenclatures used by Nissan Quest.  \n  Q19: Are the nomenclatures used in the industry vary by each OEM?  \n  Q20: What is the common conduit in a distributed module processing to share \ninformation?  \n  Q21: De\ufb01  ne a Bootstrap loader?  \n  Q22: De\ufb01  ne a Primary Boot Loader (PBL)?  \n  Q23: De\ufb01  ne a Secondary Boot Loader (SBL)?  \n  Q24: Explain the use cases of MROM, EPROM, EEPROM and Flash Memory type \nmicrocontrollers in an automotive engineering design?  \n  Q25: What is a real time operating software?  \n  Q26: Explain the difference between Complex Instruction Set Computer and \nReduced Instruction Set Computer Architectures?  \n  Q27: Why a RISC processor is a better selection for a real time operating software?  \n  Q28: What are the different sets of harnesses used in a typical vehicle?  \n  Q29: What is the difference between vehicle chassis and vehicle body?  \n  Q30: What is the difference between \u201cunibody\u201d verses\u201d \u2018body-on-frame\u201d vehicles?  \n  Q31: If the automotive module is equipped with a \ufb02  ash memory space within the \nmicrocontroller then why it is critical to use an external EEPROM space as \nwell?  \n  Q32: If two dissimilar microcontrollers have different memory address space, can \nthere be an identical secondary bootloader?  \n  Q33: If two dissimilar microcontrollers have different CAN interfaces, can there be \nan identical primary bootloader?  \n     Q34: Draw a simple analog radio diagram          ", " address space, can \nthere be an identical secondary bootloader?  \n  Q33: If two dissimilar microcontrollers have different CAN interfaces, can there be \nan identical primary bootloader?  \n     Q34: Draw a simple analog radio diagram          1.37 Exercisezamann@us.panasonic.com\n75 \u00a9 Springer International Publishing Switzerland 2015 \nN. Zaman, Automotive Electronics Design Fundamentals , \nDOI 10.1007/978-3-319-17584-3_2    Chapter 2   \n Fundamental Module Blocks \n2.1                              Introduction \n An electronics control module in a typical vehicle is dependent upon the vehicle \nbattery for its power requirements. The battery power  must not  be applied to the \nmodule electronics without passing through the safety and protection electronics, \nwhich is the \ufb01  rst line of defense against unwanted energy transients, and battery \ninadvertent operations from the vehicle electrical systems. The safety and protec-\ntion circuits are mandatory requirements for an electronics control module designed \nfor motor vehicle applications. It essentially shapes the \ufb01  rst block of any vehicle \nelectronics module. \n The following fundamental hardware blocks (Fig.  2.1 ) typically reside in an \nautomotive control module. However, some exceptions do apply when the module \ndesign-scope and functions are initially de\ufb01  ned. \n    1.    Safety and Protection   \n   2.    Switched Battery   \n   3.    Power reservoir   \n   4.    Power supply   \n   5.    Ignition switch \u2018Start\u2019 position interface   \n   6.    Ignition switch \u2018Run and Accessory\u2019 interface   \n   7.    Speci\ufb01  c Input function Interface   \n   8.    Processing engine   \n   9.    Reset and watch dog timer   \n   10.    Program storage   \n   11.    Critical data storage   \n   12.    Flash programming port   \n   13.    Speci\ufb01  c output function driver   \n   14.    Communication node    zamann@us.panasonic.com\n76\n   12V\nOff Run\n            P4\nSENSORS SWITCHES   P3\nx1 x2            P2\n  P1\nLAMPS   RELAYS MOTORS  SOLENOIDS\nLx Rx Mx Sx\nKEY:\nFIRMWARE\nSOFTWARE DRIVER         ", "ORS SWITCHES   P3\nx1 x2            P2\n  P1\nLAMPS   RELAYS MOTORS  SOLENOIDS\nLx Rx Mx Sx\nKEY:\nFIRMWARE\nSOFTWARE DRIVER         24.CAN BUS\nHARDWARE BLOCK\nSOFTWARE REQUIREMENT\nTWISTED PAIR CAN BUS28.DIAGNOSTICS CONNECTOR\nPROCESSING POWER \nVEHICLE INTERFACE\nPOWER FEED23.Vehicle Specific, Output Functions  08.PROCESSING POWER\n  13.SPECIFIC FUNCTION DRIVERS\n31.Developement tools\nDevelopmental Phase Only 20A:Relays,Solenoids\n               14.COMMUNICATION NODE  03.POWER  RESERVOIR     02.SWITCHED BATTERY  \n22.Ignition Switch\n  09.RESET & WATCHDOG TIMER  04.POWER SUPPLY \n    27.VEHICLE MODULE 'N'    25.VEHICLE MODULE 'A'\n    26.VEHICLE MODULE 'B' 20B:Vehicle Battery\n  06.RUN/ACC INTERFACE\n  07.INPUT INTERFACE CIRCUITS  05.START INTERFACE\n  12.FLASH PROGRAMMING PORT  10.PROGRAM  STORAGE  01.SAFETY & PROTECTION \n 20C:Alternator\n  12V - 14V DC\n29 Service Tools \n(Downloads, Diagnostics, Secondary bootlaoder)   FUNDEMENTAL MODULE BLOCKS  20D:Starter Motor\n21.Vehicle Specific\nInput Functions\n  11.CRITICAL DATA STORAGE17.RTOS, Kernal,\nFOREGROUND/\nBACKGROUND\nLOOP15.APPLICATION \nSOFTWAREMIPS\n18.NETWORK\nOPERATING\nSOFTWARE16.PRIMARY\nBOOTLOADER\n30.SECONDARY\nBOOTLOADER Fuse\nStart Acc\n  Fig. 2.1       Module hardware and software architecture with interfaces        2 Fundamental Module Blockszamann@us.panasonic.com\n77\n  In an embedded design space, hardware blocks without the software controls \ncould not furnish the intended functions. So, in order to intelligently use the hard-\nware blocks, the following fundamental software components exist inside the mod-\nule memory:\n\u2022    Application Software  \n\u2022   RTOS, or Kernel, or Foreground/Background Loop  \n\u2022   Network Operating Software (NOS).", "ently use the hard-\nware blocks, the following fundamental software components exist inside the mod-\nule memory:\n\u2022    Application Software  \n\u2022   RTOS, or Kernel, or Foreground/Background Loop  \n\u2022   Network Operating Software (NOS).  \n\u2022   Primary Bootloader    \n In order to understand the true picture of a module, it is indeed necessary to \nreview the vehicle environments where the module needs to be installed. The vehi-\ncle environments play a vital role to the design of the modules. The interfaces of \nmodule in a vehicle environment are listed below:\n\u2022    Battery  \n\u2022   Alternator  \n\u2022   Relays  \n\u2022   Solenoids  \n\u2022   Starter Motor  \n\u2022   Ignition switch multiple positions  \n\u2022   Vehicle speci\ufb01  c input devices  \n\u2022   Vehicle speci\ufb01  c output devices  \n\u2022   Vehicle communication connectivity    \n An external world of connectivity, where some are used at the vehicle level and \none at the module level are listed below:\n\u2022    Diagnostics or OBD II connector  \n\u2022   JTAG or serial bus or UART\u2014(module level)  \n\u2022   Service Tools  \n\u2022   Secondary Bootloader    \n A very interesting feature that may be noted is that a few blocks do not require \nany software component needed for their operation like:\n\u2022    Safety and protection block  \n\u2022   Power supply reservoir block  \n\u2022   Hard Reset    \n The safety and protection is purely a hardware block that requires no software \ncontrols due to its unique function of using the passive electronic components \nagainst electrical noise factors. The power supply reservoir block is another hard-\nware block that needs to support the back-up processing for the short-term power \nneeds of the electronics and the processing engine in the event of a sudden power \nfailure. \n The hard reset input is purely a hardware input required to signal the processing \nengine to begin executing the machine code from the \ufb01  rst instruction of the program \nstored in a memory space; pointed to by the reset vector. 2.1  Introductionzamann@us.panasonic.com\n78\n Another form of reset called software reset needs a software component. It is \nused in conjunction with an external interrupt-port of the microcontroller\u2014con\ufb01  g-\nured to act like a non-mask-able interrupt. The interrupt service-routine directs the \nprogram \ufb02  ow to follow it from the known section of the program by modifying the \ninterrupt vector.", "controller\u2014con\ufb01  g-\nured to act like a non-mask-able interrupt. The interrupt service-routine directs the \nprogram \ufb02  ow to follow it from the known section of the program by modifying the \ninterrupt vector.  \n2.2     Module Hardware Block 1: The Safety and Protection \n As can be seen from the module hardware and software interaction diagram, \nFig.  2.1 , the vehicle battery power is the only source of power when the engine is \nnot running. However, additional charging energy is available when the engine is \nrunning, eventually turning the rotating magnetic \ufb01  eld of the alternator. Once the \nalternator is up and running, the voltage rail hits 14 V\u2014thereby starts charging \nthe battery, and in parallel feeds safety and protection block of every module in the \nvehicle. \n It is extremely important to safeguard module electronics from electrical noise \nfactors emerging from other devices connected in parallel with the battery power- \nfeed like alternator, relays, solenoids, and starter motor (Please refer to Blocks 20A, \n20C, 20D) \n The other electrical devices shown in Block 20A, C and D are the source of some \nunwanted electrical disturbances such as low-to-high energy transients, over- voltage \nelectrical stresses, and high-current switching. These disturbances could prove det-\nrimental to the module hardware if the modules are not appropriately designed in \nadvance to get \u2018immune\u2019 to the disturbances originating from the vehicle electrical \nsystems. \n The need to \u2018immunize\u2019 the modules, and protect modules from the external \nunwanted electrical disturbance mandates the requirement of adding the safety and \nprotection circuits. The safety and protection circuits have dual roles to play. On one \nhand it protects the module components against unwanted electrical disturbance \noriginating from the vehicle electrical system, and on the other hand; it guards the \nmodule electronics from inadvertent battery connections. The inadvertent battery \nconnection could be de\ufb01  ned as a condition where the battery terminals may get con-\nnected to the vehicle electrical system in reverse polarity. The reverse polarity \napplied to the module may cause catastrophic damage to the sensitive electronic \ndevices inside the module if not carefully protected. \n Furthermore in this scenario another inadvertent battery connection is a \u2018double\u2019 \nbattery connection that could cause serious damage to the module electronic devices", "plied to the module may cause catastrophic damage to the sensitive electronic \ndevices inside the module if not carefully protected. \n Furthermore in this scenario another inadvertent battery connection is a \u2018double\u2019 \nbattery connection that could cause serious damage to the module electronic devices. \nDouble battery is a condition where two batteries electrically connected in-series \nare unintentionally connected to the vehicle electrical systems. This usually hap-\npens when people try to jump start a dead-vehicle battery by connecting an external \nbattery terminals\u2014either by utilizing an additional battery or get assistance of other \nvehicle battery.  2 Fundamental Module Blockszamann@us.panasonic.com\n79\n2.3     Module Hardware Block 2: The Switched Battery \n The switched-battery block 2 is de\ufb01  ned as an electronic switch that is used to trans-\nfer battery voltage to an external device or devices as shown in Fig.  2.1 . The solid \nline drawn out from the switched-battery block 2 to the speci\ufb01  c function drivers \nblock 13 emphasis the fact that function drivers get the power feed from the battery \nthrough this switch. \n It is always useful to have this battery-switch under the control of application \nsoftware, so that an application code may turn-on or turn-off in the event of the fol-\nlowing scenarios:\n\u2022    Software has detected a failed operational condition of an external device and it \nis wise to turn-off power to the external devices to stay safe.  \n\u2022   Software has determined that there is no need to power up the external devices, \nso it is wise to turn-off the power to avoid unnecessary battery drain.  \n\u2022   Software has detected a need to turn-on the external devices.    \n Some modules where pre-de\ufb01  ned functions, and design scope does not have the \nneed to energize the external devices by the vehicle battery, the battery switch- \ncircuit is not required at all. A good example of one such module is Instrument \nCluster where all of its switched-loads like stepper motors, lamps, light emitting \ndiodes, liquid crystal TFT displays are kept inside the module.  \n2.4     Module Hardware Block 3: The Power Reservoir \n The power reservoir is an optimal size energy storage reservoir to hold electrical \nenergy to power-up critical components when a sudden loss of battery power has \noccurred. This helps to maintain the processing engine stay \u2018alive\u2019", "3: The Power Reservoir \n The power reservoir is an optimal size energy storage reservoir to hold electrical \nenergy to power-up critical components when a sudden loss of battery power has \noccurred. This helps to maintain the processing engine stay \u2018alive\u2019 for a period of \ntime usually lasts few seconds to complete executing critical software tasks\u2014like \nstoring important information into the processor registers and memory. A good \nexample is the airbag module, where an accident impact could cause sudden discon-\nnection of battery terminals that may render all the safety related features com-\npletely useless. Such a sudden loss of power to the airbag module demands a \nshort-term back-up power supply to allow critical electronics, and the processing \nengine be kept alive to continue computing for the extended period of time. This \nextended period of time enables the software to continue executing safety algo-\nrithms to furnish the critical tasks. The highest priority task for the airbag module at \nthis critical stage is to trigger the \ufb01  ring squib to deploy the airbag for a lifesaving \nevent. To augment this event, an additional back-up power supply within the module \nis also needed to energize the \ufb01  ring squibs. \n This is just one example of an air bag module. However, a majority of other \nmodules may utilize different mechanisms of energy storage to let the processing \nengine running the critical features of that particular module in the event of a \nsudden battery failure. This includes energy storage capacitors, for example.  2.4  Module Hardware Block 3: The Power Reservoirzamann@us.panasonic.com\n80\n2.5     Module Hardware Block 4: The Power Supply \n The power supply ful\ufb01  lls the voltage requirement to start-up the electronics, com-\nprises of analog and digital circuits, fundamental processing block, memories and \nthe communication node. Generally, off-the-shelf switching or linear regulators are \nused to convert battery voltage, which is stepped-down to the required level of oper-\nation needed for digital, analog or discrete components. \n In distributed architecture of vehicle electronics, power supply block is the inte-\ngral part of every electronic module installed in a typical vehicle. In other words if \na vehicle is equipped with ten distinct modules installed at ten different locations \nthen each module will have its own power supply\u2014a total of ten separate power \nsupplies. \n It can be seen", " module installed in a typical vehicle. In other words if \na vehicle is equipped with ten distinct modules installed at ten different locations \nthen each module will have its own power supply\u2014a total of ten separate power \nsupplies. \n It can be seen from the module hardware and software interaction diagram \n(Fig.  2.1 ) that the circle drawn inside the power-supply is also dotted-lined to the \napplication software. The dotted-line signi\ufb01  es the importance of a software compo-\nnent needed to execute various tasks related to module power-supply to conserve \nvehicle batter energy, and execute module power management algorithm. An addi-\ntional feature of power regulators integrated circuit offered by Semiconductor \nCompanies for the automotive design segment are the integrated features of reset, \nand battery voltage threshold monitoring to ease up module design.  \n2.6     Module Hardware Block 5: The Ignition Switch, \nStart Interface \n The ignition switch has multiple-switched connections inside the ignition switch \nassembly. The most commonly known detent positions are \u201cRUN\u201d, \u201cSTART\u201d and \n\u201cACC\u201d, where \u201cACC\u201d stands for accessory. Depending upon the type of module one \nor more positions are required to be recognized by the appropriate modules. The \n\u201cSTART\u201d connection when made by the ignition-switch actually cranks the engine \nby utilizing the starter motor. \n However the starter motor is an extremely powerful motor, and requires a current \nin excess of 100 A. In order to provide such a high-current the battery-feed must be \nprovided directly to the starter motor, so in real world, it is powered by the aid of a \nstarter-relay that energizes a very powerful solenoid mounted on to the starter motor. \nThe combination of relay contacts, switching the powerful solenoid kicks off the \nstarter motor to crank the engine. In addition to the function of \u2018START\u2019 connection \nmade inside the ignition-switch-assembly to crank the engine, it is also required by \nthe modules needed that information for functions attributed to the design. \n In Fig.  2.2 , an ignition switch start interface is shown with a broader picture to \nshow all the critical interfaces.   2 Fundamental Module Blockszamann@us.panasonic.com\n81\n2.7     Module Hardware Block 6: The Ignition Switch Run \nand Accessory Interface \n As explained earlier, ignition switch assembly has multiple outputs, so", "   2 Fundamental Module Blockszamann@us.panasonic.com\n81\n2.7     Module Hardware Block 6: The Ignition Switch Run \nand Accessory Interface \n As explained earlier, ignition switch assembly has multiple outputs, so in this case \nthe \u201cRUN\u201d is a connection made inside the assembly, indicates that the engine has \nalready started and running normally. Few modules wanted to know the status of the \nengine in order to execute critical software functions. But few uses that position to \nturn the internal module power supply\u2014indeed it is another use of \u2018RUN\u2019 position \nto actually turn on the module power. \n Furthermore, the ignition switch assembly has one more contact output namely \n\u2018ACC\u2019 or accessory. The accessory contacts are used when the engine is turned-off \nand the customer wanted to use the few electrical loads inside the vehicle cabin like \nradio, fan, window glass and many more to continue functioning.  \n2.8     Module Hardware Block 7: Input Interface Circuits \n The vehicle speci\ufb01  c inputs are dependent upon the type of function a module has to \nperform. For example, in an electronic controlled suspension system the processor \nmust know the height of the vehicle; so module input interface circuits must be con-\nnected to the height-sensors positioned at pre-de\ufb01  ned locations. Likewise in the \ninstrument cluster the processor should constantly receive the vehicle-speed infor-\nmation or in case of anti-lock brake module, processor must be able to know the \nrotational speed of each wheel\u2014just to name a few. To Modules\nOFF ACC RUN START\nP4\nP3\nP2\nP1\n12VDC\nGND +12V\nGND BATTERY STARTER RELAY\nSOLENOID\nSTARTER MOTOR\n  Fig. 2.2    Ignition switch \u201cSTART\u201d interface feeding modules        2.8  Module Hardware Block 7: Input Interface Circuitszamann@us.panasonic.com\n82\n The input interface circuits are level translators with a proper protection mecha-\nnism to safeguard the microcontroller inputs. The input vehicle interfaces fed to the \nanalog to digital converter, digital ports, and timer capture ports are required to be \nscaled accordingly before each input is fed to the microcontroller. The signal condi-\ntioning is the core theme of the input interface circuit where level, scaling and pro-\n", " to digital converter, digital ports, and timer capture ports are required to be \nscaled accordingly before each input is fed to the microcontroller. The signal condi-\ntioning is the core theme of the input interface circuit where level, scaling and pro-\ntection must be designed in accordance with the vehicle level noise sources likely to \nbe in\ufb02  uenced by the sensors. Every input inside the module is fully protected for \nshorted, inverted and overvoltage connections inherent in the vehicle systems.  \n2.9     Module Hardware Block 8: The Processing Power \n The processing power of every module is dependent upon the type of microcon-\ntroller and its ability to execute millions of instructions per second (MIPS). \nSemiconductor manufacturers like Panasonic, ROHM, NXP, Renesas, Freescale, \nMaxim Semiconductor, ST Microelectronics, In\ufb01  neon, Siemens, Fujitsu, Texas \nInstruments, Microchip, NXP, Toshiba, Atmel, Silicon Labs and many more have \nalready developed line of processors primarily meant for the AEC Q100 quali\ufb01  ed \nautomotive applications. Renesas and Freescale Semiconductor (formerly Motorola) \nhave captured the biggest market share of automotive microcontrollers. \n In Fig.  2.1 , the processing block is drawn separately from the memories, but in \nreal world, a major share of microcontrollers keeps the program storage of code and \ncritical data inside the microcontroller (RAM, EEPROM and Flash EEPROM). The \ntypes of microcontrollers used in the industry are optimally packaged for hardware \nand software features. There is a trend of integrating more and more functionality \nbe packaged inside the silicon chips. More functionality with less pin count means \nadded software commands to con\ufb01  gure the ports properly before the intended fea-\nture is to work in a typical microcontroller. Majority of microcontrollers share com-\nmon pins to allow multiple functions. \n Computing architectures like V on Neumann, Harvard or modi\ufb01  ed-Harvard with \npipelining, multi-stage pipelining or no-pipelining have been used in automotive \ncomputing. \n As a brief note to the current trend in the industry, some of the salient functions \nand features of a typical automotive computing architectures and resources are \nlisted below:\n\u2022    V on-Neumann Architecture, Freescale STAR12, Fig.", " a brief note to the current trend in the industry, some of the salient functions \nand features of a typical automotive computing architectures and resources are \nlisted below:\n\u2022    V on-Neumann Architecture, Freescale STAR12, Fig.  2.3    \n\u2022   V on-Neumann Architecture, Renesas R32C Family, Fig.  2.4    \n\u2022   Modi\ufb01  ed-Harvard Architecture, Microchip PIC18F Fig.  2.5      \n In terms of computational speed, a mission critical control computer like elec-\ntronic engine controllers must be fast enough to compute: Proper operational func-\ntions; process background self-tests for the system integrity\u2014and must maintain \nactive communication link with vehicle modules connected to system interfaces like \nsensors and actuators. The core operation of engine controller is to calculate best 2 Fundamental Module Blockszamann@us.panasonic.com\n83\nfuel-to-air mixture ratio, and an intelligent ignition-\ufb01  ring-algorithm for the optimal \nengine performance under varying vehicle power, and load-demands\u2014at all \ntimes\u2014in all weather conditions. The secondary operational features of engine \ncomputing node are to monitor, and control the battery charging by controlling the \nalternator magnetic \ufb01  eld strength\u2014with added energy management tasks. Last, but \nnot the least it maintains a proper handshake with safety and security electronics \nmechanism to permit or prohibit an engine start sequence. \n It has been recognized that engine controllers require higher computational \nneeds compared to any other real-time application installed in a typical vehicle. \nHowever, this excludes the multi-media components not discussed so far. D EEPROM=4K\nA Flash=256K\nRAM=12K\nClock WDT\nReset PWM(5)\nADC(8) I2C bus (1)\nSCI (2) SPI bus (3)\nTimers (8) CAN bus (5)Von Neuman Architecture\nCISC Instruc/g415ons\nProgram Counter\nInstruc/g415ons & Decode\nArithma/g415c & Logic Unit\nStatus Register\n Ports & serial buses\nFreescale Star12 CPU  Fig. 2.3    Freescale 16 bit \nSTAR12       \nD ROM=8K\nA Flash=640K\nRAM=48B\nClock WDT\nDAC (2) GPIO (24)\nADC (34)", " Fig. 2.3    Freescale 16 bit \nSTAR12       \nD ROM=8K\nA Flash=640K\nRAM=48B\nClock WDT\nDAC (2) GPIO (24)\nADC (34) I2C bus (7)\nReset SPI bus (7)\nTimers (11) CAN bus (1) Ports & serial buses\nRenesas R32C Von Neuman Architecture\nCISC Instruc/g415ons\nProgram Counter\nInstruc/g415ons & Decode\nArithma/g415c & Logic Unit\nStatus Register  Fig. 2.4    Renesas R32C \nFamily CISC Processor        \n 2.9  Module Hardware Block 8: The Processing Powerzamann@us.panasonic.com\n84\n Another good example to recognize the signi\ufb01  cance of computational power is \nthe functions of an airbag module\u2014a safety-critical computer, which requires an \nextremely fast processing speed to execute an inevitable algorithm to safely, and \nrapidly deploy the airbag (s). Such a fast demand of program-instructions execu-\ntions is needed during the event of an imminent vehicle crash, where an airbag \ncomputational node is forced to do extensive decision-making algorithm within a \nshort duration of time in order to deploy the airbag (s). The event begins when the \nvehicle crash-sensor gets triggered; and from that point onwards a short-window of \ntime is available, where the module processing node has to execute the most sophis-\nticated algorithm of \u2018its life time\u2019 to take the airbag deployment decision\u2014in an \nattempt to save an occupant\u2019s life. \n Another semiconductor company named Microchip has developed line of micro-\ncontrollers suited for automotive applications that uses Harvard architecture offer-\ning Reduced Instruction Set Computer (RISC). A similar set of resources are \navailable like the one Renesas and Freescale microcontrollers offers, but offered \nwith Harvard architecture where data-memory, and instructions-memory are sepa-\nrately accessed. In some cases multi-stage pipeline computing is also offered. \nHowever multi-stage pipeline computing in real-time applications require thorough \nreview of architecture to meet the worst case deterministic tasks scheduling risks, \nand risks mitigation due to inherent perils of pipeline hazards like stalls, and data- \ndependencies. Smart compilers can take care of many issues, but not always; all \nuse", "review of architecture to meet the worst case deterministic tasks scheduling risks, \nand risks mitigation due to inherent perils of pipeline hazards like stalls, and data- \ndependencies. Smart compilers can take care of many issues, but not always; all \nuse-cases could be tested and comprehended in real-time dynamic challenges of \ndistributed vehicle processing. D D\nAA\nFlash= 96K Flash=3K\nClock WDT\nI2CT i m e r s  ( 4 )\nECAN (1) PWM (4)\nReset GPIO (30)\nADC(11) SPIHarvard Arhitecture\nMicrochip PIC18F4685EEPROM=1K\nArithma/g415c & Logic Unit\nStatus RegisterInstruc/g415ons & DecodeProgram CounterRISC Instruc/g415onsPipelining Op/g415on\n Ports & serial busesInstruc/g415ons\nMemory (Bytes)Data Memory\n(Bytes)\n  Fig. 2.5    Microchip PIC18Fxx        2 Fundamental Module Blockszamann@us.panasonic.com\n85\n It is important to understand the distinction of two similar names by learning \ntheir simple attribute namely  MIPS architecture , and  MIPS performance . \n The MIPS stands for \u201c M icroprocessor without  I nterlocked  P ipeline  S tages\u201d \nbased on the hardware architecture originally pioneered in 1980s by Stanford \nUniversity; the elegance of MIPS is based on a single-cycle machine with Reduced \nInstruction Set Computer (RISC). The RISC instruction set means less-numbers, \nand simple type of instructions compared to more-numbers and complex-type, \n C omplex  I nstructions  S et  C omputer. \n RISC architecture is recognized as \u2018load\u2019 and \u2018store\u2019 architecture as well, where \nsimple instructions are required to execute complex operations like multiplication \nof 2 \u00d7 4 could be achieved by adding 2 + 2 + 2 + 2. \n A quick example of 75 instructions in PIC18F verses well over 200 instructions \nof R32C or STAR12 \n  MIPS performance  measurement matrix is completely a different parameter. It is \na method of evaluating speed of the processing architecture based on a simple cal-\nculation, where number of instructions are divided by the execution-time and then \nmultiplied by million. So, if a CPU is executing one million instructions", ". It is \na method of evaluating speed of the processing architecture based on a simple cal-\nculation, where number of instructions are divided by the execution-time and then \nmultiplied by million. So, if a CPU is executing one million instructions per second \nthen it could be de\ufb01  ned in MIPS term as MIPS rated speed of 1. Likewise a CPU \nexecuting one thousands instruction per second means it is at MIPS rated speed of \n0.001. So, the MIPS stands for Million Instructions per Second. \n In the domain of automotive computing, where real time tasks are essential and \nat times critical for the module operational needs many factors govern the comput-\ning performance. These factors include an architectural difference of Harvard verses \nV on Neumann, pipelined verses no-pipelining, CISC verses RISC, RTOS verses \nno-RTOS, and range of many other software architectural design factors that makes \na difference in the overall throughput of computing. \n So, keep in mind that MIPS measurement-matrix is not the true measurement \ncriterion across all platforms of microcontrollers; rather it is just one factor that \ncould be counted. 1   \n2.10     Module Hardware Block 9: Reset and Watch \nDog Timer  \n Hardware Reset Block 9 is extremely critical input to any microcontroller, it is an \ninterrupt that cannot be ignored, and it means \u2018start-all-over-again\u2019. The Reset cir-\ncuit when tested in controlled environments like stabilized power-source at room \ntemperature, free of electrical, magnetic, and high-current surges\u2014works perfectly \n\ufb01 ne. But in the realm of automotive harsh electrical environment this means lots of \ndetailed analysis before a robust reset circuit could be designed. Over the past many \n1   Computer Organization and Design by Hennessy & Peterson, Morgan Kaufman Publishers, Inc. 2.10  Module Hardware Block 9: Reset and Watch Dog Timer zamann@us.panasonic.com\n86\nyears \ufb01  eld and warranty issues in the automotive electronics design segment have \nbeen attributed to the short-comings in the reset circuit design across the board. \n Semiconductor companies have developed highly robust and specialized circuits \nmeant solely to perform hardware reset under a well-de\ufb01  ned operational envelop. \nHowever it is the job of automotive module design team to make sure that reset \ncircuit does not falsely triggers when subject to supply voltage \ufffd", " circuits \nmeant solely to perform hardware reset under a well-de\ufb01  ned operational envelop. \nHowever it is the job of automotive module design team to make sure that reset \ncircuit does not falsely triggers when subject to supply voltage \ufb02  uctuations, radiant \nenergy in\ufb02  uences, and vehicle electrical and magnetic interferences. Power-On- \nReset (POR) is he term used when the module is \ufb01  rst powered up and gets the hard- \nreset. A POR could happen when the battery is \ufb01  rst-time connected to the vehicle \nelectrical system in the vehicle assembly line. \n A hard reset could also be initiated by the watch dog timer external circuit. There \nis no such thing like reset-switch used in automotive environments, so if you were \nrequired to reset a particular module installed in a vehicle, you need to pull fuse for \nthat particular module. Alternately you can disconnect and reconnect battery to \nreset each and every module in the system. \n Watch Dog Timer (WDT) or interchangeably called Computer Operating \nProperly (COP) is essential for an error free operation of software; it is a \u2018must- \nhave\u2019 component that is needed to monitor the software activities for \u2018run-away\u2019 \nconditions. A \u2018run-away\u2019 scenario could be de\ufb01  ned as a condition where the \nmicrocontroller- software enters in an endless loop or start executing the instructions \nmaking no sense to the intended application with unpredictable results. Recall your \nexperience with a personal computer when it freezes\u2014frustration of no response\u2014\n\ufb01 nally you press \u201cCtrl, Alt and Del\u201d to invoke task manager or at times turn-off \npower to do restart. The watch-dog timer does the similar task automatically by \nsending a hard reset to the processor while detecting a software anomaly\u2014However \nit, does it in an automatic fashion without needing any human intervention. \n The watch dog timer is physically a hardware timer, keeping an eye on the soft-\nware activities of the processor for any abnormal operation. The abnormal activity \ndetection is made possible by monitoring a known software response from the \nmicrocontroller to constantly trigger the watch dog timer to get it reinitialized on \nregular basis. In the event of any abnormal software condition, the WDT never gets \ninitialized in-time thereby forcing the WDT to issue a hard-reset to the \nmicrocontroller \n The", " trigger the watch dog timer to get it reinitialized on \nregular basis. In the event of any abnormal software condition, the WDT never gets \ninitialized in-time thereby forcing the WDT to issue a hard-reset to the \nmicrocontroller \n The majority of the microcontrollers today also support the features of watch dog \ntimer as an  internal function  to initiate reset internally but an  external hardware  \nwatch dog timer has its own advantages. In Fig.  2.6 , one such watch dog timer made \nby Maxim Semiconductor is shown connected to a microcontroller.  \n In essence microcontroller sends a periodic signal to the watch dog timer using \none of its port-bit, connected to WDI input of MAX 6369. In return for this \u2018favor\u2019 \nMax 6369 never reset the microcontroller. However, if this \u2018favor\u2019 is not received by \nthe WDT in a pre-de\ufb01  ned interval of time, WDT sends a hard-reset to the microcon-\ntroller. The pre-de\ufb01  ned period of time is adjustable by the set inputs labeled S1, S2 \nand S3 of MAX 6369, and is depended on the embedded software tasks timing and \nscheduler.  2 Fundamental Module Blockszamann@us.panasonic.com\n87\n2.11     Module Hardware Block 10: The Program Storage \n It is the essential section of the memory space required to get \ufb01  lled with the applica-\ntion code. Depending on the type of processing architecture, it may or may not be \nresident to the processing engine. However, the majority of the microcontroller \narchitectures like the one shown earlier namely Reneses R32C family or STAR12 \nCPU or Microchip PIC18Fx have the capacity to store application program internal \nto processor. \n The program code can be \u2018\ufb02  ashed\u2019 either before building the modules or during \nthe process. If it is preferred to \ufb02  ash the parts during the module manufacturing \nprocess than it must be \ufb02  ashed through the JTAG or equivalent communication bus \nby using the external tools and pin jig probing. If the primary bootloader is already \nstored in the microcontroller then the CAN bus download procedure may be per-\nformed to download the program load. However this procedure will immediately \nadd up time that could make manufacturing team not so happy.  \n2.12", " the primary bootloader is already \nstored in the microcontroller then the CAN bus download procedure may be per-\nformed to download the program load. However this procedure will immediately \nadd up time that could make manufacturing team not so happy.  \n2.12     Module Hardware Block 11: The Critical Data Storage \n It is the portion of EEPROM where calibration data, fault code data, and critical \ndata may get stored. It is a prudent for some type of modules to utilize an external \nmemory rather than using internal processor memory to store the diagnostics and \ncritical data. The purpose of this guideline is to have a robust design where the mod-\nule internal contents could be read even if there is a catastrophic damage to the \nprocessor. Generally the safety critical modules must follow this guideline. \n Some microcontrollers like Freescale STAR12 offer on-chip non-\ufb02  ash EEPROM \nto allow critical data storage, however if on-chip non-\ufb02  ash EEPROM is not avail-\nable to the preferred choice of the microcontroller than off-chip EEPROM could be \nutilized. One such example of off-chip non-\ufb02  ash EEPROM space is BR24L02 man-\nufactured by ROHM.  WDI\nHard RESET  \nWATCH DOG TIMER\nMAX 6369\nMICROCONTROLLER\nSET INPUTS S1, S2, S3 (/g415me)  Fig. 2.6    External Watch Dog \nTimer used to reset the \nMicrocontroller        2.12  Module Hardware Block 11: The Critical Data Storagezamann@us.panasonic.com\n88\n2.13     Module B Hardware Block 12: The Flash \nProgramming Port \n The \ufb02  ash programming port is the direct connection to the microcontroller pro-\ngramming ports. It is the \u201cumbilical cord\u201d of the module electronics while it is being \ndeveloped. However in place of \u2018food\u2019, it gets binary code that goes in microcon-\ntroller\u2019s memory space. In majority of the cases the \u201cumbilical cord\u201d is the serial or \nUART or JTAG connectivity on the printed circuit board. It is physically realized by \nplacing a mini-connector or header-pins on the board, which goes directly to the \nmicrocontroller serial, or JTAG ports or equivalent UART ports. This method of \nfeeding the \u2018food\u2019 is well suited until the", " physically realized by \nplacing a mini-connector or header-pins on the board, which goes directly to the \nmicrocontroller serial, or JTAG ports or equivalent UART ports. This method of \nfeeding the \u2018food\u2019 is well suited until the \u2018baby\u2019 has grown enough to have a decent \nintelligence. \n JTAG or any serial port like I 2 C, SPI or UART allows the external device to get \nconnected to the microcontroller programming session to download the program in \nbinary code format into the well-de\ufb01  ned memory locations. It is a physical connec-\ntion to the microcontroller hardware directly onto the printed circuit board for the \nexternal software development system. Depending upon the preference of develop-\nment team, \u2018in-circuit\u2019 emulators could also be used to kick-off the development \nprocess. In-Circuit emulator is a method of \u2018emulating\u2019 the embedded computing \nengine by the external software run through the personnel computer. \n During the development process a separate mini header connector could suf\ufb01  ce \non the board. However, while going through the module manufacturing assembly \nline, bed of nails could be attached to the board to access the \ufb02  ash programming \npins of the microcontroller.  \n2.14     Module Hardware Block 13: Speci\ufb01  c Function Drivers \n The Vehicle-speci\ufb01  c Output Functions are depended upon the type of functions \nmodule has to perform, like for example a suspension module must control power \nactuation devices to adjust the height of the vehicle by the aid of hydraulic pump if \nthe system is based on hydraulics\u2014or by the aid of an air-compressor if the system \nis based on pneumatics. In the example of instrument cluster, the instrument cluster \nmust have to move a pointer either by actuating a coil or by using a stepper motor. \nSimilarly in an antilock brake module the output driver could be a solenoid actuated \nvalve meant to control the brake \ufb02  uid direction. \n Function drivers electronics are usually installed inside the module; however the \ndevices like motors, solenoids, and heaters are carefully placed outside the module \nat the required locations.    Please review the Fig.  2.7 , where an example of transmis-\nsion control module is sketched to show the output function drivers and the solenoid \nloads used in a typical vehicle.   ", " required locations.    Please review the Fig.  2.7 , where an example of transmis-\nsion control module is sketched to show the output function drivers and the solenoid \nloads used in a typical vehicle.   2 Fundamental Module Blockszamann@us.panasonic.com\n89\n2.15     Module Hardware Block 14: Communication Node \n Modules are installed at different mounting locations across the vehicle. Some are \nplaced far or short distance with each other. The communication bus is required \namong the modules to share information to augment each other and satisfy the \nneeds of system design. The serial communication standard like controller area net-\nwork (CAN) have gained leading role in automotive vehicle networks. It has suc-\ncess storied over the past so many years of experience. It has surpassed the \nusage-factor over and above all other serial data buses introduced earlier in Chap.   1    . \nA physical layer of integrated circuit is required to get to the vehicle bus to have \nproper operational electrical characteristics. A protocol controller mostly resides \ninside the microcontroller. \n The communication node block 14 connects the module with other modules \ninstalled at different locations in a vehicle like module \u2018A\u2019, to module \u2018B\u2019 to module \n\u2018N\u2019 by incorporating the Controller Area Network (CAN) bus. Theoretically a total \nof 110 nodes could be connected to the bus; however, due to the bandwidth issues it \nis less likely to have a vehicle that even utilizes 50 nodes on a single backbone. The \nnumber of modules in a typical vehicle varies from OEM to OEM. \n The high-speed bus speed operates at 500 kb/s, but in a network with so many \nmodules on a single-backbone the overall throughput determines the actual operat-\ning speed of message transfers among the modules. Theoretically, the CAN bus \narchitecture is divided into multiple speeds: low, medium and high. Yet, realisti-\ncally, the chosen speeds are medium and high unless there is a genuine need to add \na low speed bus. A typical vehicle would use multiple-speed networks, which \nclearly divides the vehicle modules as medium and high speed nodes. \n In order to realize the implementation of buses, it requires two different back-\nbones, and two separate physically laid-out twisted pair of cables\u2014running across \nthe vehicle harness scheme. Some modules communicate on medium speed, and \nsome on high speed.", " In order to realize the implementation of buses, it requires two different back-\nbones, and two separate physically laid-out twisted pair of cables\u2014running across \nthe vehicle harness scheme. Some modules communicate on medium speed, and \nsome on high speed. In addition to that many OEM\u2019s still have merits to use the \ncarry-over proprietary serial buses, which may perhaps have been used by the OEMs \nin the past for one reason or other. Summarized in a nutshell the communication Microcontroller Ports Function Drivers Line Pressure Solenoid Valve\nOverrun Clutch Solenoid Valve\nShift Solenoid  ValveTorque Converter Solenoid Valve\nShift Position Drive\n  Fig. 2.7    Transmission Control Module Output functional drivers        2.15  Module Hardware Block 14: Communication Nodezamann@us.panasonic.com\n90\narchitecture today uses the CAN communication bus as the de facto standard, but \nalso keeps some additional buses\u2014if needed by the OEM. \n As shown in Fig.  2.8 . CAN bus physical connections runs all across the vehicle \nto connect every module with its appropriate bus, and then gets terminated with the \ntermination resistors at the farthest points on both ends. The CAN bus termination \nrequires 120 \u2126 resistor needed to counter bus re\ufb02  ections to sustain proper opera-\ntional characteristics. The bus termination resistors (Fig.  2.8 ) are shown electrically \nplaced outside the modules, in real world; the bus termination resistor for each bus \nis installed in one of the module corresponding to that bus. The value of the termina-\ntion resistor for other types of bus depends upon the electrical speci\ufb01  cations for that \nparticular bus.  \n As explained earlier vehicle network architecture can have multiple bus back-\nbone as shown in Fig.  2.8 . Each bus physical connections must have to be carried \nout at the diagnostic port (OBD II receptacle) to gain access to the external hand- \nheld service tools for diagnostics, trouble-shooting, and software download pur-\nposes. Also note, how the modules I, J, and K are connected to high-speed CAN bus, \nand the modules A, B, C, D, and E are connected to the medium-speed CAN bus. \nSimilarly the module Y is connected to an OEM bus (a proprietary bus standard). Module E\n(M", " to high-speed CAN bus, \nand the modules A, B, C, D, and E are connected to the medium-speed CAN bus. \nSimilarly the module Y is connected to an OEM bus (a proprietary bus standard). Module E\n(MS-CAN)Module A\n(MS-CAN)\nModule B \n(MS-CAN)\nModule C\n(MS-CAN)\nModule D\n(MS-CAN)\nDiagnostics ConnectorModule I\n(HS-CAN)\nModule J\n(HS-CAN)\nModule K\n(HS-CAN)Module X\nGateway \nModule Y\n(OEM BUS)\nModule Y\n(OEM BUS)CAN High SpeedCAN Medium SpeedTermination*\n* Termination ResistorsTermination*\nTermination*\nTermination* Termination* Termination*\n  Fig. 2.8    Vehicle communication backbone        2 Fundamental Module Blockszamann@us.panasonic.com\n91\n Interestingly the most important thing to note is that the Module X is connected \nto all three buses i.e. medium, high and an OEM bus. Thus the module X has the \nability to talk to any other module on three different buses, and act as a facilitator to \nlet all other modules to get information from each other, and that is why it is catego-\nrized as the gateway module.  \n2.16     Module Software Component 15: Application Software \n The Application Software is the intelligence of module stored in \ufb02  ash memory as \nper module functional design-intent. The intelligence of a module is initially written \nby a human programmer\u2014almost certainly using C language using an appropriate \nC compiler. The module intelligence includes the set of tasks required to keep the \nfunctional integrity of the module within its operational envelop and maintain com-\nmunication link with other vehicle module\u2014while performing background diag-\nnostics, and functional integrity tests. The diagnostics software performs the tasks \nto detect the failed conditions of module, and its interfaces. When the failed condi-\ntions are detected, the job of the application software is to mitigate the severity and \nimpact of the operational functionality that are challenging the module integrity. \nNonetheless once the failure has been detected, the application software must store \nthe failure code into the module memory for diagnostics and troubleshooting pur-\nposes by the service centers. The portion of the software code added to the applica-\ntion code to help maintain the diagnostics features is commonly referred as \ndi", " application software must store \nthe failure code into the module memory for diagnostics and troubleshooting pur-\nposes by the service centers. The portion of the software code added to the applica-\ntion code to help maintain the diagnostics features is commonly referred as \ndiagnostics software. Diagnostics tasks could either be requested by the user or runs \nin the background automatically.  \n2.17     Module Software Component 16: Primary Boot Loader \n It is a small piece of pre-programmed software code stored inside the processor\u2019s \nprotected memory space to enable the external device to download the application \nprogram code. The purpose of this code is to read the source \ufb01  le and self-program \nprogram-memory contents. The self-programming is assisted by the secondary \nbootloader depicted in Block 31  \n2.18     Module Software Component 17: The Real Time \nOperating System (RTOS) \n It is normally used in complex applications where hundreds of challenging real- \ntime tasks are required to be scheduled, monitored and executed in a deterministic \nfashion. Many such applications need not only the real time operating system, but \nalso the powerful processing architecture where enough memory space is available 2.18  Module Software Component 17: The Real Time Operating System (RTOS)zamann@us.panasonic.com\n92\nto keep a copy of the RTOS in the memory address space. The majority of vehicle \nmodules today are not using commercial-off-the-shelf (COTS) real time operating \nsystem rather rely on their own version of software solutions. Modules manufactur-\ners may have variety of reasons to defend themselves for not using the RTOS; how-\never two important such factors are\u2014cost and memory size. Simpler applications \nmostly use Foreground-background loop architecture, round-robin time-sliced task- \nscheduling or could utilize rate-monotonic system. 2   \n2.19     Module Software Component 18: The Network \nOperating System (NOS) \n Network Operating System is the backbone of any vehicle multiplex bus communi-\ncation, and it is the essential software component for modules required to get con-\nnected to the vehicle bus. The CAN (Controller Area Network) bus protocol operates \nunder the management of network operating system (NOS). The network operating \nsystem must be integrated with the module application code to enable the modules \nto talk to each other with network management protocol. Automotive OEM\u2019s have \nmodi\ufb01", " operates \nunder the management of network operating system (NOS). The network operating \nsystem must be integrated with the module application code to enable the modules \nto talk to each other with network management protocol. Automotive OEM\u2019s have \nmodi\ufb01  ed the CAN operating system software using core CAN network operating \nsystem initially introduced by Robert Bosch in 1986.  \n2.20     Vehicle Interface 20C: Vehicle Alternator \n A vehicle alternator is a high-current DC generator meant for battery charging, \nwhere the connection to the battery makes it an automatic connection to each elec-\ntronic module. A notable negative impact to the electronics inside the module is a \nscenario when the alternator is charging the battery, and a sudden disconnection of \nthe battery terminal occurs. This sudden disconnection of battery terminals causes \nhigh-voltage spike to inject unwanted energy to the module electronics. The techni-\ncal term to describe the scenario is called \u2018load dump\u2019. Here load means the \u2018battery \nas the load to the alternator\u2019, and \u2018dump\u2019 signi\ufb01  es the fact that the high-energy tran-\nsient must be \u2018dumped\u2019 safely by the electronics devices connected to the battery.  \n2.21     Vehicle Interface: 20A Relays and Solenoids, 20B \nBattery, and 20D Starter Motor \n A vehicle battery is the primary source of power available in every vehicle when \nengine is not running. A starter motor is the motorized way to crank engine for a \nsuccessful engine start up sequence. Only a single starter motor is utilized in a typi-\ncal vehicle. \n2   Real-Time Systems, Design and Analysis (Philip A. Laplante by IEEE Press 2nd Edition). 2 Fundamental Module Blockszamann@us.panasonic.com\n93\n Relays and solenoids are used extensively in every modern vehicle today, so does \nthe motors. Across the board, one thing is common; an inductive loading in the form \nof relay coils, solenoids and motor windings. In-rush current of inductive loads \nrequires counter-measures; likewise a relay-coil collapsing magnetic \ufb01  eld needed a \nreverse polarity diode to counter energy barrier threats to the module junction devices. \n All devices except the battery are the source of electrical noises, where a low-to- \nhigh-energy transients are detrimental for the module electronics if", " eld needed a \nreverse polarity diode to counter energy barrier threats to the module junction devices. \n All devices except the battery are the source of electrical noises, where a low-to- \nhigh-energy transients are detrimental for the module electronics if not properly \ncounter measured.  \n2.22     Vehicle Interface 21: Vehicle Speci\ufb01  c Input Functions \n The input interface for any particular module can have variety of sensors, and \nswitches as tabulated in Fig.  2.1 . It is marked as \u2018x1\u2019 and \u2018x2\u2019, where \u2018x1\u2019 stands for \nthe number of sensors and \u2018x2\u2019 stands for the number of switches attached to the \nmodule essential for the module functionality. \n To get a better insight about how the sensors are being used in the industry, we \npresent an example of engine related sensors, and switches used by Nissan, Quest \nMini Van. The sensors and switches portion of the engine control module is re- \ndrawn with added information for the purpose of education (Fig.  2.9 ). Each sensor \nSignal ConditionersMicrocontrollerAir Fuel Mixture Sensor \nHeated Oxygen Sensor\nIntake Air Temperature\nSensor\nThrottle Position Sensor\nCoolant Temperature\nSensor\nFuel Temperature Sensor\nPark/Neutral Switch\nEGR Temperature Sensor\nMass Airflow SensorCamShaft Position Sensor\nKnock Sensor\nSteering Position Switches\n  Fig. 2.9    Engine controller switches and sensors        2.22  Vehicle Interface 21: Vehicle Speci\ufb01  c Input Functionszamann@us.panasonic.com\n94\nand switch must pass through the signal conditioning network to condition the \n signal level, safety and timing as per microcontroller ports hardware and software \ninterface speci\ufb01  cations.   \n2.23     Vehicle Interface 22: Vehicle Ignition Switch \n Vehicle Ignition key is a single-pole, multi-contacts rotary switch. The possible \nsequential combinations are tabulated as P1, P2, P3, P4, and P5 in Fig.  2.1 . However \nfor the sake of clarity, it is zoomed-in with switching-contact details (Fig.  2.10 ). The \nignition switch\u2014though a simple device\u2014has been a primary source of malfunc-\ntions in many vehicle electronics systems. We must pay careful attention to the", "ed-in with switching-contact details (Fig.  2.10 ). The \nignition switch\u2014though a simple device\u2014has been a primary source of malfunc-\ntions in many vehicle electronics systems. We must pay careful attention to the \nignition switch characteristics and its interfaces to other modules when designing \nmodule electronics. It has caused lots of engineering failures resulting vehicle \nrecalls in recent history. A quick Google search will give you some scenarios related \nto the ignition switch recalls. Google keyword \u2018ignition switch problems\u2019  \n Ignition switch failures may happen due to the variety of reasons. Some could be \naf\ufb01 liated to wrong engineering estimates about the switch, and its interfaces or \nbecause of a faulty switch-design or by the virtue of faulty switch itself. Nevertheless, \nit can be stated here with caution that \u2018low-tech\u2019 switches could not \u2018get along\u2019 very \nwell with \u2018high-tech\u2019 vehicle electronics architecture\u2014unless the system interactions \nof hardware, software and electrical interconnections are fully understood and \napplied correctly. Unfortunately sometimes simple details in automotive electronics \ndesign segment are often ignored\u2014that leads to failures, and ultimately costly recalls. \n A typical ignition switch possible contact with its design intent is shown in \nFig.  2.10 . \n The key-switch rotations connect the contacts at  Run ,  Accessory  , and  Start   posi-\ntions when placed in the appropriate position. The key-switch disconnects all connec-\ntions when placed at  off  position. The battery line feeds the common terminal P5, so \nwhen the switch is placed at position \u2018ACC\u2019; it transfers battery voltage to P2. \nSimilarly it transfers power to P3 and P4 respectively upon actuation. Bear in mind \nthat it is physically designed in a way that it does not break the contacts from the previ-\nously held positions except when it is in \u2018 OFF  \u2019 position. The ignition switch is inter-\nnally mounted to the steering column using a sturdy mounting. In the new generation \nof advance vehicles the mounting holds the passive anti-theft electronics to handshake \nAccessory Off Run Start\nP4\nP3\nP2\nP1\nP5 - 12VDCTo engine start system &\nfew modules\nTo accessary control systemTo modules\n  Fig. 2.10    Ignition switch positions        2 Fundamental Module Blockszamann@us.panasonic", "1\nP5 - 12VDCTo engine start system &\nfew modules\nTo accessary control systemTo modules\n  Fig. 2.10    Ignition switch positions        2 Fundamental Module Blockszamann@us.panasonic.com\n95\nwith the \u2018smart keys\u2019 to enable vehicle starting system by the engine control module. \nIt is practically impossible in the presence of passive anti-theft electronics that wires \nare shorted to battery-power, and start the engine as can be seen in movies.  \n2.24     Vehicle Interfaces 23: Vehicle Speci\ufb01  c Output Functions \n Vehicle speci\ufb01  c output functions are depended upon the type of functions module \nhas to perform. For example a suspension module must control power actuation \ndevices to control the height of the vehicle by the aid of hydraulic pump or an air \ncompressor. An instrument cluster must to move a pointer either by actuating a coil \nor by using a stepper motor. Similarly in an antilock brake module the output driver \ncould be a solenoid actuated metering device meant to control the brake \ufb02  uid direc-\ntion. Functional driver electronics are usually installed inside the module. But the \ndevices like motors, solenoids, and heaters are carefully installed outside the mod-\nule. In case the high-current switching inside the module is an issue then different \nmethods are being utilized. \n Please review the earlier Fig.  2.7 , where an example of transmission control \nmodule is sketched to show the output function drivers and the solenoid loads used \nin industry. \n The output interfaces shown as speci\ufb01  c function drivers are driving the vehicle \nloads are tabulated in the Fig.  2.1 . The table actually represents the vehicle-speci\ufb01  c \noutput functional devices. The devices can be categorized as lamps, relays, motors, \nand solenoids connected to a particular module, and are marked as \u2018Lx\u2019, \u2018Rx\u2019, \u2018Mx\u2019, \nand \u2018Sx\u2019 respectively. The functionality of a module determines the number of out-\nput devices needed for that particular module. An example is the airbag module \nwhere only two main output devices (\ufb01  ring squibs) are required to deploy the driver \nand passenger side airbags. In the example of engine control module twenty four \n(24) device drivers are", " example is the airbag module \nwhere only two main output devices (\ufb01  ring squibs) are required to deploy the driver \nand passenger side airbags. In the example of engine control module twenty four \n(24) device drivers are required by the engine controller to control variety of output \ndevices in a six-cylinder fuel-injected gasoline engine. However this is just an \nexample for the sake of education. \n Another example (Fig.  2.7 ) of transmission control module requires \ufb01  ve (5) dis-\ncrete output devices to assist carrying out automatic transmission functionality. \nPlease note that output devices tabulated as Lx, Rx, Mx and Sx when referring to \nFig.  2.1  are the representation of lamps, relays, motors and solenoids. Since Sx \nrepresents solenoids therefore Sx equates to 5 are the number of solenoids, trans-\nmission control module is controlling.  \n2.25     Vehicle Interfaces 25, 26, 27: Vehicle Modules \n The modules are abundant in a modern vehicle today, so are the communication \nnodes to share information among modules. The number of total modules \u2018A\u2019, \u2018B\u2019 \nto \u2018N\u2019 depends upon the features and functions offered for that particular vehicle. 2.25  Vehicle Interfaces 25, 26, 27: Vehicle Moduleszamann@us.panasonic.com\n96\nThe total number of modules in a typical vehicle rests on the vehicle platforms, \nmodel year built and the target market needs and wants as envisioned by the manu-\nfacturer\u2019s marketing group.  \n2.26     Vehicle Interface 27: Diagnostics Connector \n Diagnostic port is a receptacle installed under the dashboard towards left side of the \ndriver. It is well known in the industry as the OBDII connector, a common provision \nacross the automotive domain to attach external service tools to connect to the vehi-\ncle CAN buses, +12 V and battery power. The service tools, a computer or a hand-\nheld device are mainly used to read the diagnostics trouble codes to view the vehicle \nmalfunctions, however it can also be used to re-\ufb02  ash a new program using CAN bus \nconduit available at the diagnostics port. A photograph of an OBDII connector is \nshown in Fig.  2.11 .   \n2.27    ", " be used to re-\ufb02  ash a new program using CAN bus \nconduit available at the diagnostics port. A photograph of an OBDII connector is \nshown in Fig.  2.11 .   \n2.27     Outside World 29: Service Tools \n On the one hand, the service-tools are used by the dealership after the vehicle is \nbuilt and available for customers in order to furnish many tasks related to the vehi-\ncle electronics system faults and troubleshooting. On the other hand, the service \ntools have also been utilized for software-downloads diagnostics and debugging. \nThe software-downloads includes, but not limited to software-patches, upgrades, \nand module calibrations. \n Vehicle development is not a one day job. It takes well over 18 months to develop \na new vehicle. While the vehicle is in the phase of development, the development \ntools could perform system level integration testing, validation and new code \ndevelopment. \n  Fig. 2.11    OBDII Receptacle \nunder the dashboard        2 Fundamental Module Blockszamann@us.panasonic.com\n97\n During the time of vehicle development stage, when the modules have already \nbeen installed and operational, the external tools can also be used to test and moni-\ntor the vehicle communication bus for variety of reasons like supporting the vehicle \nnetwork messaging or to download a revised code, or to write a calibration \ufb01  le or to \nupload the diagnostics information via wireless connectivity. Furthermore, at times \nit is required to log and store the critical message-bus-log, where a storage device \ncould be connected to the OBDII connector to store the bus-log to analyze the data \nfor later review. A specialized device like a GPS locator could be attached to OBD \nII connector to track the vehicle location for \ufb02  eet test planning. A Wi-Fi adaptor \ncould also be attached to upload newly developed software within the range of pro-\ntotype build stations. \n However, once the vehicle has been fully built and it is in the hands of the end- \nuser, the maintenance phase kicks-in. From that point onwards; service tools have \nbeen used to run the diagnostics, download calibration-data, read fault codes and \nmonitor bus communication activity for the troubleshooting purposes.  \n2.28     Outside World 30: Secondary Boot loader \n The secondary bootloader is a software component typically not stored anywhere in", " used to run the diagnostics, download calibration-data, read fault codes and \nmonitor bus communication activity for the troubleshooting purposes.  \n2.28     Outside World 30: Secondary Boot loader \n The secondary bootloader is a software component typically not stored anywhere in \na typical module, this is why; it is shown as a separate component \u2018outside-the-box\u2019 \nto emphasis the fact that it gets loaded through the external tool meant to upgrade a \nnew code into the module memory. The secondary boot loader is used in conjunc-\ntion with primary load loader as explained earlier in Block 16-primary boot loader  \n2.29     Outside World 31: Software Development Tools \n It generally means an external computer along with integrated development environ-\nment (IDE) used by the software team to develop a new code. The software develop-\nment team also uses IDE to download the test code by utilizing the software drivers \nthat downloads the program code into the module memory reserved for program \nstorage. In some instances it can be used to download test and debugging cases to \nverify the program code integrity with the system interfaces. By and large this feature \nis utilized while developing test code during the development phase of the module. \n Once the hardware and software integration process gets furnished and the mod-\nule is up and running at each design phase then the external test program jigs and \nassociated on-board hardware could be removed to optimize cost, and part \ncomplexity. \n A high-performance embedded workshop (HEW) developed for Renesas line of \nprocessors is an example of a classic integrated development environment. MPLAB \nis the example of IDE developed for Microchip processors, and likewise CodeWarrior \nIDE is offered by Freescale. 2.29  Outside World 31: Software Development Toolszamann@us.panasonic.com\n98\n Salient features of integrated development environments are listed below:\n\u2022    An editor to write high level source code  \n\u2022   A compiler to generate machine level object code  \n\u2022   A debugging method to \ufb01  nd and remove software bugs  \n\u2022   A method to download the executable code into the target processor  \n\u2022   A method to store multiple \ufb01  les as a project  \n\u2022   A method to view processor registers, and memory contents  \n\u2022   A method to transfer object code into the microcontroller \ufb02  ash memory.  \n\u2022   A Graphical User Interface running under windows to provide all the features     \n2.", "   A method to view processor registers, and memory contents  \n\u2022   A method to transfer object code into the microcontroller \ufb02  ash memory.  \n\u2022   A Graphical User Interface running under windows to provide all the features     \n2.30     Summary \n The electronic control module in a typical vehicle comprises of many hardware \nblocks like safety and protection, power supply, processing-engine, ignition switch \ninterface, communication node, and variety of interfaces connected to different \ntypes of inputs and outputs. Module functionalities determine the number of sen-\nsors, and actuators required for the intended operation. Ignition key switch is the \nmost critical input to the modules. Some modules process ignition switch as a signal \ninput and others used it as a switch to apply and remove power to the module. \n Almost every hardware block in a typical module requires a software control to \nperform its functionality\u2014except power-reservoir, the safety block and power-on- \nreset. An application code, a network operating software, a primary bootloader are \nthe essential software components needed for module operational functionalities. \nA diagnostics software code is part of every module. \n Modules installed in a typical vehicle are of two types\u2014some always gets power \nfrom the battery regardless of ignition switch position, and others get power only \nwhen the ignition switch is turned-on. Ignition switch has many positions and each \nposition has an assigned role. Module internal power supply essentially requires \nadditional safety and protection mechanisms to protect the electronics inside the \nmodule. The safety and protection systems safeguard the module sensitive electron-\nics from unwanted disturbances of vehicle electrical systems. \n Programmable memories; commonly integrated inside the microcontroller are \nused to store program, data and calibration \ufb01  les. A method of programming is used \nto program \ufb02  ash-EEPROM or non-\ufb02  ash EEPROM. An application code could be \nexecuted under a real time operating software or by incorporating non-RTOS based \nembedded tasks scheduler. Modules are installed across the vehicle at different \nlocations, and talk to each other by utilizing a serial bus. The growing established \ntrend in the automotive industry is Controller Area Network (CAN) serial bus. In \norder to ef\ufb01  ciently use the message passing through controller area network, net-\nwork software is being utilized. Network Operating Software is the software back-\nbone of network systems. A typical vehicle could have multiple backbones of \ndifferent CAN speeds", " to ef\ufb01  ciently use the message passing through controller area network, net-\nwork software is being utilized. Network Operating Software is the software back-\nbone of network systems. A typical vehicle could have multiple backbones of \ndifferent CAN speeds. An OBD II connector accesses the CAN buses for variety of \nreasons like for example development, testing, troubleshooting and software \nprogramming. 2 Fundamental Module Blockszamann@us.panasonic.com\n99\n An integrated development environment is used to develop code for the intended \nmodule design. An IDE consists of computer, appropriate microcontroller compiler, \nand access to the target-board hardware to download, and run the test codes. In \nsome cases an in-circuit emulator could be exploited to run software by emulating \nthe actual processor. In such a case, the target-board does not require a real proces-\nsor, but rather an in-circuit emulator pod on the empty socket of the processor.  \n2.31     Exercise \n     1.    What are the critical noise factors in a typical vehicle that could impact module \nelectronics?   \n   2.    What is the function of ignition switch?   \n   3.    What are the types of microcontrollers used in automotive industry?   \n   4.    What is the importance of AECQ100 quali\ufb01  cation?   \n   5.    Compare and contrast primary bootloader and secondary bootloader?   \n   6.    If primary boot loader gets corrupted, how would you repair it?   \n   7.    Compare and contrast RISC verses CISC based architectures?   \n   8.    What is the function of a watch dog timer?   \n   9.    What are the functions of OBD II connector at different vehicle built stages?   \n   10.    Why there is a need to add non-\ufb02  ash EEPROM?   \n   11.    What additional resources are required to house real time operating system?   \n   12.    Why it is needed to provide load dump protection?   \n   13.    How many different network speeds are possible in a vehicle network system?   \n   14.    What is the function of Network Operating Software?   \n   15.    What is the distinction between MIPS Architecture and MIPS Performance?   \n   16.    What are the advantages of \ufb02  ash EEPROM memory storage?   \n   17.   ", " the function of Network Operating Software?   \n   15.    What is the distinction between MIPS Architecture and MIPS Performance?   \n   16.    What are the advantages of \ufb02  ash EEPROM memory storage?   \n   17.    What is the difference between power-on-reset (POR) and an external watch \ndog timer reset?   \n   18.    Why there is a need to have \u201cswitched-battery\u201d controlled by the software?   \n   19.    What are the reasons that a back-up power supply is required in a typical \nmodule?   \n   20.    De\ufb01  ne and explain battery inadvertent connections?        2.31  Exercisezamann@us.panasonic.com\n101 \u00a9 Springer International Publishing Switzerland 2015 \nN. Zaman, Automotive Electronics Design Fundamentals , \nDOI 10.1007/978-3-319-17584-3_3    Chapter 3   \n Fundamental Blocks Topology \n3.1                               Introduction \n In this chapter, we will explore the internal topology of each fundamental block we \nstudied in Chap.   2    . In addition, we will study two additional blocks, namely battery \nvoltage monitoring, and abrupt power shutdown, which we had intentionally \navoided to keep the chapter 2 simpler.  \n3.2     Safety and Protection \n As stated earlier, safety and protection is required for the safety of the sensitive \ndevices inside the module including power supply itself. Always keep in mind that \nbefore you \ufb01  re up module electronics by the help of power supply regulators, you \nmust protect and safeguard power supply, and module electronics with some well- \nknown unwanted conditions inherently existed in the vehicle environment. These \nunwanted conditions, if not properly counter-measured, could prove detrimental to \nthe entire module design. These unwanted conditions are categorized as  high-energy \ntransients  ,  reverse battery connections  , and  double battery conditions  . If any of \nsuch events come to pass, catastrophic damage could occur to the module electron-\nics. Consequently, it is mandatory, and absolutely necessary to add protection cir-\ncuits to safeguard the module power supply and electronics from the catastrophic \ndamage. The essential protection circuits needed to do the job are shown in the \nshaded portion of    Fig.  3.1 , and listed as follows: \n\u2022    Load Dump Protection  \n\u2022   Reverse Battery", " electronics from the catastrophic \ndamage. The essential protection circuits needed to do the job are shown in the \nshaded portion of    Fig.  3.1 , and listed as follows: \n\u2022    Load Dump Protection  \n\u2022   Reverse Battery Protection  \n\u2022   Dual Battery Protection    zamann@us.panasonic.com\n102\n The safety and protection block input is connected to the vehicle battery through \na fuse. The output of safety and protection block is connected to the module power \nsupply. Finally the output of the power supply is delivered to the module electron-\nics, and the processing engine. The shaded portion is the zoom view of safety and \nprotection blocks. \n The power supply of the module and its electronics with processing engine are \nshown in the diagram to give our reader high-level perspective of the vehicle and \nmodule interfaces. However, bear in mind that the safety and protection block is part \nof the module itself. \n The rationale behind each protection block is stated as follows:\n\u2022    A load dump protection is required to safeguard the module electronics from \nhigh energy transients. These are caused by the sudden removal of the battery \nterminals when the alternator is running. The high energy transient could cause \nserious damage to the module sensitive semiconductor devices. The protection \ncould just be an electronic component that can limit and absorb unwanted tran-\nsient energy to a safer level. The term \u2018dump\u2019 points towards the fact the high \nenergy catastrophic impacts are safely dumped by the protection device (s).  \n\u2022   A reverse battery safety protection is required to protect the module power supply \nand electronics against inadvertent reverse battery connections. The protection could \njust be a reverse current blocking diode or an alternate path to open-circuit the pre-\nde\ufb01 ned weakest link in the system like a fuse. A blown fuse actually opens up the \ncircuit, thereby protecting the electronics; however it must act fast enough to open \nup the weakest link at the appropriate required current within a pre-de\ufb01  ned time.  \n\u2022   A dual battery voltage (24 V) protection is required to protect the module power \nsupply and electronics against accidentally applying dual battery in-series \n(12 + 12 = 24VDC), which could cause serious damage to the sensitive devices. \nThis usually happens when people try to jump-start the vehicles using additional \nexternal battery either separately or by using another vehicle.    \n Please note that there is no software component", " = 24VDC), which could cause serious damage to the sensitive devices. \nThis usually happens when people try to jump-start the vehicles using additional \nexternal battery either separately or by using another vehicle.    \n Please note that there is no software component used or needed for the safety and \nprotection block.  Vehicle Resources\n MODULE ELECTRONICS &\nPROCESSING\nREVESRSE BATTERY\nPROTECTION\nDUAL BATTERY\nPROTECTIONFUSELOAD DUMP\nPROTECTION VEHICLE BATTERY \nPOWER SUPPLY\n  Fig. 3.1    S   afety and protection block        3 Fundamental Blocks Topologyzamann@us.panasonic.com\n103\n3.3     Power Supply \n In the distributed processing architecture, every module requires a built-in power \nsupply block residing in the module. The power supply topology presented here \napplies to all modules installed in a typical vehicle. The module power supply inter-\nnal functional topology, with interface to vehicle battery and module electronics is \ndepicted Fig.  3.2 .  \n Please note that the battery and the fuse are outside of the module. The shaded \nportion is the zoom view of the power supply functional block. Also note that the \npower supply gets the power after safety and protection functional block as explained \nin Sect.  3.1 , and then delivers power to the module electronics and processing block. \nAs stated earlier, the power supply is integral part of the module. The essential and \noptional power supply blocks are listed as follows:\n\u2022    Software Controlled Switch (S1)  \n\u2022   Low Pass Filter (LPF)  \n\u2022   Regulator  \n\u2022   Power Reservoir  \n\u2022   Power-On-Reset pulse (Optional)  \n\u2022   EMC Filters  \n\u2022   Software component    \n         SOFTWARE COMMAND\nPath B\nPath A\n      RESET (POR)Vehicle Resources\nSAFETY & \nPROTECTIONELECTRONIC\nSWITCH S1 EMC FILTERS\nREGULATOR (S) VEHICLE BATTERY \nFUSE MODULE ELECTRONICS &\nPROCESSING\nPOWER RESERVOIR\nLOW PASS\nFILTERApplication\nSoftware\n  Fig. 3.2    Power supply essential blocks shown with vehicle battery and fuse        3.3  Power Supplyzamann@us.panasonic.com\n104\n All functional blocks listed above are applicable to the modules that needed \npower be always available irrespective of vehicle ignition switch positions.", " blocks shown with vehicle battery and fuse        3.3  Power Supplyzamann@us.panasonic.com\n104\n All functional blocks listed above are applicable to the modules that needed \npower be always available irrespective of vehicle ignition switch positions. On the \ncontrary, a module that gets power from the ignition switch does not need an S1 \nswitch and corresponding software to control that switch. \n The microcontroller hardware reset signal\u2014power on reset (POR)\u2014is also a \nfeature that is available in some power supply regulators. However, it is an option \nnot always found in every commercially available off-the-shelf regulator. The off-\nthe- shelf regulator, such as In\ufb01  neon TLE4470G, is an example of one having the \npower-on reset feature. \n Starting from the vehicle battery the power is fed through the fuse to the safety \nand protection block of the module, which then feeds two different parallel paths:\n\u2022    Low-Current Path B  \n\u2022   High-Current Path A    \n The Low-Current Path B is meant to provide biasing to the software-controlled \nelectronic switch, and a minimal power to the essential processing block. The pur-\npose of this scheme is to execute the power management software algorithm to do \nmodule power-on or power-off command by controlling the S1 switch. This soft-\nware algorithm is very useful in order to help switch the module in different opera-\ntional modes that are needed while the modules are installed in the vehicle. \n The Low-Current Path B is also used to apply power to the circuits that are \nrequired to be kept energized in order to control the \u2018S1\u2019 switch. These essential \ncircuits are occasionally referred as the \u2018keep-alive\u2019 circuits; like for example\u2014in \nthis particular case\u2014the microcontroller along with the electronic switch (S1) with \nproper electronic switch biasing. \n The Low-Current Path B remains active throughout the entire period of the vehi-\ncle life-cycle as long as the vehicle battery is fully operational and connected. If \nyour vehicle is equipped with a 48 months maintenance-free battery then a Low- \nCurrent Path B would stay active for 48 months irrespective of ignition switch on \nand off toggling. \n Consequently, it is critical in terms of energy consumption and vehicle safety that \nLow-Current Path B must be designed carefully by analyzing every detail of vehicle \ninterfaces, wirings, printed", " months irrespective of ignition switch on \nand off toggling. \n Consequently, it is critical in terms of energy consumption and vehicle safety that \nLow-Current Path B must be designed carefully by analyzing every detail of vehicle \ninterfaces, wirings, printed circuit board traces, and every component that is placed \nin the path of keep-alive circuit. A quick proverb could be quoted here that when \ndesigning the keep-alive circuits\u2014\u201cMake sure i\u2019s are dotted and t\u2019s are crossed\u201d. \n Another interesting thing to note is that the continuous battery energy consump-\ntion is more commonly called out as the key-off load current, which is actually the \ncurrent passing through the Low-Current Path B. Nevertheless, there are many dif-\nferent alternate technical terms used for the key-off load current like quiescent- \ncurrent, Q-current, dark-current, sleep-current, and leakage-current. \n The High-Current Path A is meant to actually deliver power to the module. The \nreal operation of the module begins when the power is available through S1 switch. \nThe power gets \ufb01  ltered by a low-pass \ufb01  lter, thereby releasing undesired transient \nenergy to the \ufb01  lter, which is required to smooth-up the incoming noise, and an in- \nrush dc current. After getting through this \ufb01  ltration circuit, the incoming voltage is \nnow available to the voltage regulator (s). Notice that up to this point the battery 3 Fundamental Blocks Topologyzamann@us.panasonic.com\n105\nvoltage is still not up to the required level to energize the module electronics and \nprocessing components. \n An off-the-shelf voltage regulator at this stage now gets the power and converts \nthe safely-protected battery voltage to the required level of module operation. It \nthen delivers power to other module blocks like the communication node, process-\ning engine, active components biasing-circuits, and rest of the electronics. In addi-\ntion to delivering power to the module functional electronics, the regulator output \nalso feeds the energy storage devices to store energy for an emergency use. It is \nprudent for the application software to add and compensate stabilization time for \nevery device under its control not just S1 switch as shown in Fig.  3.2 . \n Following is the quick summary of each individual sub-block: \n3.3.1     Electronic Switch", " to add and compensate stabilization time for \nevery device under its control not just S1 switch as shown in Fig.  3.2 . \n Following is the quick summary of each individual sub-block: \n3.3.1     Electronic Switch S1 \n The software controlled electronic switch is the entry point of the external power \nsource\u2014by now\u2014safely protected by the protection block, and is controlled by the \nprocessor to switch power input to the power supply regulator.  \n3.3.2     Low Pass Filter \n A low frequency  \ufb01  lter  is required to absorb low frequency switching transient and \ninstantaneous change originating from power-on switching. It can be realized just \nby adding a simple LC \ufb01  lter.  \n3.3.3     Regulators \n The regulator is the actual hardware used to convert battery voltage to the desired volt-\nage levels (+5, +8.5, +3.3, +1.2 are some of the options). The standard off the shelf \nvoltage regulators have been used in the industry, however, it is always an option, \nwhere possible, to design a voltage regulator using discrete electronic components.  \n3.3.4     Power Reservoir \n A power supply reservoir is an energy storage device, which holds limited power to \ndrive critical circuits for short period of time in order to manage emergency shut- \ndown procedures. Microcontroller is the primary device needed this sustained \npower. It is important to compute the total execution time with enough margins \nbefore backup energy ramps down to absolute minimum rating of the microcon-\ntroller operation.  3.3  Power Supplyzamann@us.panasonic.com\n106\n3.3.5     EMC Filters \n The  Electromagnetic Compliance  is a regulatory requirement to ful\ufb01  ll and comply \nwith the electromagnetic interference (EMI) limits set forth by Federal \nCommunications Board (FCC) of United States of America. The purpose is to pro-\ntect Continental United States Radio Frequency Spectrum from the harmful radiant \nenergy imparted by any newly developed electronic device, furthermore FCC also \nexpects that any newly developed electronics device must not negatively affected by \nthe existing radiant energy imparted by US frequency spectrum,\u2014and off course, \nautomotive modules are no exception. \n When developing a system or sub-system to be used in United States of America, \nthe developers should make sure", " negatively affected by \nthe existing radiant energy imparted by US frequency spectrum,\u2014and off course, \nautomotive modules are no exception. \n When developing a system or sub-system to be used in United States of America, \nthe developers should make sure that their product is in compliance to FCC regula-\ntions. Developers in Canada, Europe, Japan, Asia Paci\ufb01  c, Australia, Korea and else-\nwhere over the globe must have to follow their regulatory requirements to comply \nwith their standards. Homologation is the term used in automotive design space to \ncomply with the regulatory requirements of a particular region or area or country, it \napplies to all aspects of design not just the EMC compliance. \n Vehicle OEM\u2019s have successfully de\ufb01  ned and speci\ufb01  ed the EMC guidelines, and \ntest requirements for the automotive electronic modules. The test limits governing \nthe \u2018Fail and Pass\u2019 criteria resides well within the FCC guidelines. \n The EMC \ufb01  lters shown in Fig.  3.2  are not just limited to \ufb01  lters only, rather a \nreminder to the reader that lots of upfront design work is needed to comply with \nelectromagnetic interference (EMI). It is not an easy affair and requires analysis at \nan overall design topology, selection of components, switching frequencies, pulse \nshapes, pulse rise and fall times, printed circuit board layers, component place-\nments, copper density, traces and layout. \n The EMC compliance is not just limited to power supply rather it applies to \nentire module design. But the bus does not stop here, in the nutshell the entire \nvehicle electrical vehicle requires to comply with the regulatory requirements. The \noverall compliance includes radiant and conducted energy emissions from the \nsource (power supply, module or vehicle). In addition to that the source (power sup-\nply, module or vehicle) must be able to immune themselves from the external noise \nsources either conducted or radiated. We will discuss more details about all these \nde\ufb01 nitions and requirements later.  \n3.3.6     Software Component \n The S1 switch is required to be controlled by the software. In order to assist soft-\nware to control S1, the software must monitor the battery voltage, ignition key posi-\ntions, and ignition-cycling in order to properly manage the S1 switch \nconnect-disconnect sequence. Furthermore the software also maintains proper", " to assist soft-\nware to control S1, the software must monitor the battery voltage, ignition key posi-\ntions, and ignition-cycling in order to properly manage the S1 switch \nconnect-disconnect sequence. Furthermore the software also maintains proper mod-\nule operating-mode. 3 Fundamental Blocks Topologyzamann@us.panasonic.com\n107\n Power supply development requires lots of upfront design work. Careful design \nassumptions must be made when doing sleep and operating current calculations. \nThe fusing strategy is critical for the module power supply current consumption. \nVehicle OEM\u2019s usually not always allocate separate fuse for every module rather \nshare common fuse for certain group of modules. If a fuse is common for two or \nmore modules then it is labeled as a \u2018shared\u2019 fuse. \n If a fuse is dedicated to a module then it is called a \u2018dedicated\u2019 fuse. When \nreviewing module fuse requirements, we must pay careful attention to the module \nfusing strategy, and sizing. \n Modules are sometimes required to blow the fuse while an overload condition \nexists in a prede\ufb01  ned time\u2014if that is the design intent\u2014then the power supply \ndesign must assist the vehicle fuse to blow within the well-de\ufb01  ned time duration. \n The interaction of vehicle wiring and other interfaces with module power supply \nneeds testing and validation at all design levels. The proper testing and evaluations \nto the battery conditions, vehicle harnesses, fuse ratings, printed circuit board trace \nwidths, temperature variations are required to be reviewed by the design team. \nA computer aided electronic design automation (EDA) software tools have been \nused to simulate normal and extreme value analysis to determine the operational \nenvelop of a particular design. A common engineering term worst-case-circuit- \nanalysis (WCCA) is expressed to classify such efforts. \n The protection devices used in the extreme condition designs like MOV \n(Metal Oxide Varistor), TVS (Transient V oltage Suppressor) or Zenor diodes must \nbe carefully selected by paying careful attention to the incoming electrical over-\nstress voltage pro\ufb01  les, safety component data-sheets and its operating conditions. \n A bad protection circuit design in an automotive module could easily \u2018toast\u2019 the \nprinted circuit board trace, and trace may act like a \u2018fuse\u2019.   \n3.4      Battery Power Switching \n When the engine is not running (i.e. altern", " bad protection circuit design in an automotive module could easily \u2018toast\u2019 the \nprinted circuit board trace, and trace may act like a \u2018fuse\u2019.   \n3.4      Battery Power Switching \n When the engine is not running (i.e. alternator is off) the vehicle battery is the pri-\nmary source of power in a typical application, so it is truly required to conserve that \nenergy, and it must only be used when it is necessary. The fundamental principle \napplies to the automotive module design states that \u201c Apply power to the intended \nloads when needed  \u201d. The switched battery topology is based on this principle. The \nblock diagram of battery power switching, comprises of an electronic switch that \nneeded a microcontroller port bit to control the electronic switch. The overall pic-\nture is shown along with relevant interface to the vehicle and the module is shown \nin    Fig.  3.3 . Please note that vehicle battery through the fuse is feeding the safety and \nprotection block.  \n Here is how the operation takes place\u2014the output of safety and protection is \navailable at the input of electronic switch S2. The switch S2 is controlled by module \nmicrocontroller port digital output (D.O.) 3.4  Battery Power Switchingzamann@us.panasonic.com\n108\n Once the software task \u2018BattSwitch\u2019 is executed, it can either turn the switch to \nopen position or in closed position as needed. So when the switch is in a closed posi-\ntion, the battery power is applied to the vehicle loads (motors, relays, solenoids, \nactuators, heater, lamps etc.). The software task can also remove power when it is no \nlonger needed. Please note if the digital output port bit (D.O.) is set to logic one, it can \nturn the S2 switch to closed position. However, when it is set to logic zero it ulti-\nmately turns the S2 switch to open position; eventually turning off the vehicle loads. \n The vehicle battery power is fed to the safety and protection block and then is \navailable to the electronic switch S2. The S2 switching is based on the software task \n\u2018BattSwitch\u2019. It can either apply or remove the battery power to the vehicle load \nusing the digital output port (D.O.) of the microcontroller. If the vehicle loads, and \nthe S2 switch are pretty robust against", " task \n\u2018BattSwitch\u2019. It can either apply or remove the battery power to the vehicle load \nusing the digital output port (D.O.) of the microcontroller. If the vehicle loads, and \nthe S2 switch are pretty robust against unwanted disturbance from the vehicle elec-\ntrical then a direct battery feed could be connected to the S2 bypassing safety and \nprotection element.  \n3.5     Sensor Power Switching \n A slight variation of this concept is quite practical when power is needed for active \nsensors required by some modules to perform their functions. The similar battery \nswitching block explained in the preceding example could be utilized to do the job, \nhowever with minor changes\u2014to apply and remove sensor power. The only differ-\nence is the regulation of the battery voltage down to the required operating voltage \nof sensors needs to be converted by the sensor power regulator. \n Figure  3.4  illustrates the concept, here the sensor regulator provides the sensor \nvoltage and then applied to the electronic switch S3. The electronic switch S3 trans-\nfers sensor power to the active sensors, once the software task \u2018SenPower\u2019 is \n executed with appropriate digital output.  D.O.VEHICLE BATTERY & \nFUSE\nVEHICLE LOADS\nMODULE MICROSAFETY & \nPROTECTION  \nELECTRONIC \nSWICTH S2\nSoftware\nTask \nBattSwitch\n  Fig. 3.3    Battery power switching to the loads        3 Fundamental Blocks Topologyzamann@us.panasonic.com\n109\n Assume logic \u2018zero\u2019 is required to turn on the S3 switch, so when the software \ntask \u2018SenPower\u2019 is executed it changes the corresponding port bit to logic \u2018zero\u2019, \nthereby turning on the S3 switch. The switch S3 input is connected to the sensor \npower regulator and the output goes to sensors, eventually energizes the sensors. \n The sensor regulator is shown connected to the safely protected power feed \nwhich is getting power from the battery; however, it could also get the power from \nthe module internal power supply if we chose to do so. Bear in mind if sensors are \nmounted far from the module installed location then the voltage drop across the \nvehicle harness scheme should be computed in all design iterations.  \n3.6     Ignition Switch Interface \n Ignition switch is a rotary three-in-one switch, commonly referred as ", "mounted far from the module installed location then the voltage drop across the \nvehicle harness scheme should be computed in all design iterations.  \n3.6     Ignition Switch Interface \n Ignition switch is a rotary three-in-one switch, commonly referred as  Start  ,  Run  and \n Accessory   input positions. Each input if required to be sensed by the module must \npass through the protection mechanism, level shifter, signal conditioning, signal \nscaling and then to the microcontroller before any software procedure could even \nbegin to monitor the input lines. The software procedure either poll the input for a \npre-de\ufb01  ned period of time or may use an interrupt driven procedure to invoke the \ninterrupt service routine; to determine the status of the line. \n Figure  3.5  shows one typical circuit, which can be used for the single-position \ndetection like for example,  Start  . The level shifter translates the +12VDC to the \nrequired level (+5, +3.3 or else), and generates the necessary transients response \n(rise or fall time i.e. Schmitt trigger) for the digital circuits inside the microcon-\ntroller input port to operate correctly. The protection devices are pretty standard \npractice to safeguard the microcontroller ports and level shifter from external unin-\ntended electrical stress in the form of high energy transients or short to battery \nconditions. Similar topology could also be used for other switch positions like  Run  \nand  Accessory   inputs. A signal scaling is required to establish a voltage level.   D.O.SAFETY & \nPROTECTION \nVEHICLE BATTERY & \nFUSEELECTRONIC \nSWICTH S3 SENSOR \nREGULATOR\nACTIVE SENSORS\nMODULE MICROSoftware\nTask\nSenPower\n  Fig. 3.4    Active sensors power regulation and switching        3.6  Ignition Switch Interfacezamann@us.panasonic.com\n110\n3.7     Input Interface Architecture \n Depending on the module functionality, a variety of sensors could be attached with \nappropriate interfaces to the module processing node. Sensor inputs are \ufb01  rst trans-\nlated to the required level of voltages with signal conditioning to get into the micro \nports. Discrete, analog, and pulsed type signals could be connected as shown in \nFig.  3.6 . The relevant ports can then be used to process the information", " of voltages with signal conditioning to get into the micro \nports. Discrete, analog, and pulsed type signals could be connected as shown in \nFig.  3.6 . The relevant ports can then be used to process the information originating \nfrom the sensors. The software task \u2018Conversion\u2019 performs the signal processing \nfrom the corresponding interface port. The analog to digital processing is required \nto sense and understand the external signal by plotting a transfer function. The soft-\nware task \u2018Status\u2019 is to make sure that the sensor is intact and sensor data integrity \nis not compromised, i.e. its sensor information is well within the speci\ufb01  ed range.   \n3.8     Speci\ufb01  c-Function Driver \n Depending on the module function, a variety of output devices could be connected \nthrough the appropriate interfaces to the module processing node, so to speak, the \nmicrocontroller input and output ports. These ports could either be used as digital or \nanalog input or output. 12VDC\nPROTECTION\nSIGNAL SCALINGSIGNAL \nCONDITIONIONERIGNITION SWITCH \nSTART LINE\nLEVEL SHIFTER\nMODULE MICROSoftware  \nTask \nStartSwitch\n  Fig. 3.5    Ignition switch start line interface        3 Fundamental Blocks Topologyzamann@us.panasonic.com\n111\n The microcontrollers today use fewer I/O pins with added functionality, which \nmeans that ports can be con\ufb01  gured by the application software for the appropriate \ncon\ufb01 guration. The block diagram drawn in Fig.  3.7  is using a single bit of an 8-bit \ndigital port of a typical microcontroller con\ufb01  gured as the Digital Output (D.O) to \ncontrol the high-side driver. The high-side driver input is connected to the S2 switch, \nwhich is getting power from the battery through safety and protection block. The \noutput of the driver is connected to the vehicle speci\ufb01  c function load.  \n The speci\ufb01  c load in this topology could be a relay, a solenoid, a heater or a lamp. \nFor the sake of clarity, all other interfaces are also shown, mainly battery transfer \nelectronic switch S2, safety and protection block, battery and fuse. Software task \n\u2018status\u2019 has con\ufb01  gured a single bit to read as an status", " of clarity, all other interfaces are also shown, mainly battery transfer \nelectronic switch S2, safety and protection block, battery and fuse. Software task \n\u2018status\u2019 has con\ufb01  gured a single bit to read as an status in an additional port namely  VEHICLE SENSORS\nMODULE MICROCONTROLLER PORTS LEVEL TRANSLATORS PROTECTIONS\nSoftware \nTask \nConversionSoftware\nTask\nStatus\n  Fig. 3.6    Sensors interface to the microcontroller       \nSTATUS\n        D.I\n  D.O.VEHICLE-SPECIFIC \nFUNCTION LOAD\nVEHICLE BATTERY HIGH SIDE DRIVER\nMODULE MICROCONTROLLER PORTSFUSE              S2\n           D.O.\nSAFETY & \nPROTECTION Software\nTask \nBattSwitchSoftware\nTask\nStatusSoftware \nTask \nToggle\n  Fig. 3.7    An output load with a high-side driver        \n 3.8  Speci\ufb01  c-Function Driverzamann@us.panasonic.com\n112\nDigital Input (D.I) to check the status of the high side driver switch.    Software tasks \n\u2018status\u2019 require an extra hardware to monitor the switch operational condition, \nwhich is extremely important in many critical real time systems. \n The battery electronic switch S2 as explained in Sect.  3.4  is primarily used to \nswitch the battery power to the appropriate load by utilizing the microcontroller \ndigital output (D.O.), thereby executing the software task \u2018 BattSwitch  \u2019. This is the \n\ufb01 rst task the software has to do before it attempts to turn on the intended load. \nPlease bear in mind that at this time load is ready to get energized but is still not \nenergized yet, because path to ground through high-side driver is not complete. \nNonetheless the path to ground may only be completed when the high-side driver is \nturned on. This happens when the software task \u2018 Toggle  \u2019 is executed by sending \nmicrocontroller digital output port (D.O.) to logic-zero or logic-one (depending \nupon the hardware design). The vehicle-speci\ufb01  c function load, now, eventually gets \nenergized at this point. \n The question is how the microcontroller software would know that the operation \nhad successfully executed? In order to validate the correct switching operations exe-\ncuted by the software it is essential to monitor the switch-status to", "energized at this point. \n The question is how the microcontroller software would know that the operation \nhad successfully executed? In order to validate the correct switching operations exe-\ncuted by the software it is essential to monitor the switch-status to detect any unsuc-\ncessful operation. To achieve the capability of switch-status monitoring, additional \nhardware must be added to the high-side driver to get to the status-line output. \n The status-line output is then translated to the desired digital input level where it \nis read by the microcontroller to determine if the intended switching operation was \nindeed successful. The software task \u2018 Status  \u2019 gets executed to read the feedback \nstatus from the high-side driver feedback loop by the application code to also deter-\nmine if the operation was successful. \n If for any reason the switch status does not come out \u2018true\u2019, meaning, the opera-\ntion was not performed as intended, then the operational code logs the fault and \nstores it as a diagnostics trouble code.  \n3.9     Low-Side Driver \n The preceding example has shown a high-side driver to drive a load. A similar \ntopology with a minor change could be used for a low-side driver as shown in \nFig.  3.8 . The software tasks are pretty much alike; however, hardware uses a differ-\nent type of switch. The switch is connected to the load and when actuated, it pro-\nvides a ground path to the load current, thereby enabling the device to become \nenergized. \n Notice the difference of ground, and battery plus (+) line placement between the \ntwo different topologies:\n\u2022    In high-side applications, the High-side driver switches the battery plus (+) to the \nload (Fig.  3.7 ).  \n\u2022   In low-side applications, the Low-side driver switches battery (\u2212) to the load \n(Fig.  3.8 ).     3 Fundamental Blocks Topologyzamann@us.panasonic.com\n113\n The ground placement plays an essential role in any electrical system, so a low- \nside driver switch is no exception. In low-current applications where the vehicle \nspeci\ufb01  c load does not consume heavy current, the majority of the drive circuits \ncould operate by wide margins of voltage tolerances. However, when the high- \npower device gets energized by the low-side driver, a potential drop across the \nground path", " load does not consume heavy current, the majority of the drive circuits \ncould operate by wide margins of voltage tolerances. However, when the high- \npower device gets energized by the low-side driver, a potential drop across the \nground path could reduce the overall operational envelop, so, it is an issue that must \nbe resolved with careful design considerations to the voltage-drop across the low- \nside driver and the ground return path. The voltage across the ground return path has \nto be minimal to ensure that the intended load is getting required operating power at \nall times in extreme circuit value conditions considering temperature, heat, humid-\nity, and component tolerances. In the next chapters we will present one such topol-\nogy for a worst case circuit analysis.  \n3.10     Pulse Width Modulated Driver \n PWM controlled driver is a combination of a switch (either high-side or low-side), \nand a pulse-source to generate duty-cycle modulated pulses. The pulse source must \nbe able to change its duty-cycle. The duty-cycle determines the time to open and \nclose the switch to transfer energy to the load. \n For the sake of simplicity we present an example of a lamp driven by the PWM \ncontroller. In other automotive applications PWM controlled drivers are also uti-\nlized to control fan blower motor speeds. As stated earlier, the microcontroller today \nsupport embedded PWM controller channel embedded inside the microcontroller, \nso in order to use his feature, all you need to do is to con\ufb01  gure the PWM channel \nport, select the PWM frequency and adjust the duty-cycle (Fig.  3.9 ).  STATUS\n                D.I.\n  D.O.VEHICLE BATTERY VEHICLE-SPECIFIC \nFUNCTION LOAD\nLOW SIDE DRIVER\nMODULE MICROCONTROLLER PORTS              S2\n           D.O.\nSAFETY & \nPROTECTION \nFUSESoftware\nTask \nBattSwitchSoftware\nTask\nStatusSoftware\nTask \nToggle\n  Fig. 3.8    An output load with a low side driver        3.10  Pulse Width Modulated Driverzamann@us.panasonic.com\n114\n Once the appropriate frequency is adjusted usually in the range of 100\u2013200 Hz, \nthe switching transistors starts toggling at that rate, however dimming is not entirely \nmanaged by the switching-frequency rather it is the duty-cycle that must be varied to \n", " is adjusted usually in the range of 100\u2013200 Hz, \nthe switching transistors starts toggling at that rate, however dimming is not entirely \nmanaged by the switching-frequency rather it is the duty-cycle that must be varied to \ncontrol the dimming\u2014a standard practice in electronics design segment across-the- \nboard. The duty-cycle is supervised by the software task \u2018dimming\u2019. The dimming \ntask depends on many other factors like type of lamps used, peak applied voltage, \nmounting locations, plastics, light pipes and variety of other mechanical factors. \n It is an open loop system, meaning, the \ufb01  nal determination of dimming cannot be \nmeasured by the human eye. It is an issue for many good engineering reasons. So, \nin order to solve this unknown factor of human eye perception, state of the art light \nmeasurement equipment has been incorporated by the automotive car manufactur-\ners to \ufb01  nalize the dimming controls inside the cabin. As a customer who buys the \nvehicle, it is a simple dimming switch, but for a manufacturer who builds the inte-\nrior design of the car, it is phenomenal job. The OEM studio issues a certi\ufb01  cate of \ncompliance after a dimming and color harmony goals and objectives are achieved \nto all the stake holders. \u2018Great Achievement\u2019 and \u2018Job well done\u2019 are the words \ncome out at that occasion.  \n3.11     Watch Dog Timer \n In Chap.   2     we introduced an external watch dog timer. We now look into the internal \nwatch dog timer. An external WDT is an external hardware; however, the majority \nof microcontroller today also supports the features of an internal watch dog timer as \nwell. Internal WDT works in the similar fashion like the external hardware WDT, \nyet each have its own pros and cons. The major difference is internal clock depen-\ndency for the internal WDT verses no dependency on microcontroller clock by the \nexternal WDT. \n The internal watchdog timer works on the principle of digital counting by an \ninternal counter-timer by the support of software commands, where a timer-counter \nis programmed to work as an elapsed timer. When the time expires, an internal reset PWM \nOUTPUT\nFUSE\nVEHICLE BATTERY Program PWM Channel\nMicrocontroller              S2 HIGH SIDE DRIVER\n           D.O.\nSAFETY & \nPROTECTION", " work as an elapsed timer. When the time expires, an internal reset PWM \nOUTPUT\nFUSE\nVEHICLE BATTERY Program PWM Channel\nMicrocontroller              S2 HIGH SIDE DRIVER\n           D.O.\nSAFETY & \nPROTECTION \nLAMPSSoftware\nTask \nBattSwitchSoftware\nTask\nDimming\n  Fig. 3.9    Lamps driven by PWM dimming procedure        3 Fundamental Blocks Topologyzamann@us.panasonic.com\n115\nis issued to the microcontroller. The main job of the module operational code is \nnever to allow elapsed timer to expire its pre-programmed time, and it does that by \nsending a reset command in the embedded code (CLRWDT instruction in PIC pro-\ncessor) to the elapsed timer or watch dog timer. The process of resetting the WDT \nis hereby stated as servicing the WDT. If, for example, the embedded software is \nutilizing foreground-background loop architecture then the foreground loop could \nservice the WDT at the completion of each foreground loop. 1  \n The topology of internal WDT analogues is like software watching the software, \nso it could be a possibility that both could malfunction, meaning an \u2018overrun condi-\ntion\u2019 of main program could \u2018over-run\u2019 the watch dog software code as well. \nTherefore, it could be stated here with caution that the software watch dog timer is \nless reliable than the external hardware WDT. 1  \n An interesting elegant detail explained by Maxim Semiconductor in its applica-\ntion note 4229 released on June 5, 2008 presents a scenario of failure mechanism of \n\ufb02 ash memory, where an electromagnetic interference could cause memory bit- \nerrors, cascaded to program code eventually executing operands instead of op-codes \nthereby rendering entire processor execution unintelligent, endless and useless. \nSuch a condition warrants a timely fashion recovery of the processor to gain control \nback to a known default state, a compelling justi\ufb01  cation of having a WDT to invoke \nan automatic correction of the system software. \n By looking at the automotive module system software design, however, there \ncould be many different types of reasons that may make module operational software \nto go on a \u2018wild goose chase\u2019. 2  However one of the reasons is memory soft- error that \ncould be introduced by a strong electromagnetic energy pulse imparting radiant \nenergy on to", " types of reasons that may make module operational software \nto go on a \u2018wild goose chase\u2019. 2  However one of the reasons is memory soft- error that \ncould be introduced by a strong electromagnetic energy pulse imparting radiant \nenergy on to the module memory instigating a soft-memory error. Depending upon \nthe memory data being corrupted by the soft-memory error, harmful or harmless \nscenarios could arise. Nevertheless, if this happens, a customer in a vehicle could \nexperience a strange behavior subject to the system and its operational features. \n A vehicle could see strong radiant energy either by its own malfunctioning elec-\ntrical systems or by the radio frequency transmitting towers, cellular phone towers, \nrepeaters, and ground-based radar systems installed near or around the airports, \ndefense installations, research centers, so on and so forth.  \n3.12     Reset Topology \n Hard reset and soft reset are two options available for any vehicle electronic mod-\nule. Generally there are no manual methods to reset the modules. Nevertheless, \noccasionally a speci\ufb01  c system needs that option for long-term maintenance reasons, \nwhich could be treated as a system reset. In principle there is no manual reset switch \nrequired or opted for any of the module. \n1   Maxim Semiconductor, Application Note 4229, June 5, 2008. \n2   A pursuit of something unattainable or non-existent. 3.12  Reset Topologyzamann@us.panasonic.com\n116\n Many different methods are utilized to reset a module, these are listed below, and \nare shown in Fig.  3.10 : \n\u2022    Power-on Reset (POR)  \n\u2022   Hardware watch dog timer Reset  \n\u2022   CAN command Reset  \n\u2022   Interrupt Reset  \n\u2022   Software watch dog timer Reset    \n The two options  POR  and Hardware  WDT  reset falls in the category of hard- \nreset meaning all program execution terminates\u2014all running threads stops, and pro-\ngram counter loads the default reset vector. Furthermore all registers, stack-pointer, \nother memory pointers and ALU condition code \ufb02  ags are initialized at their default \nvalues. After that embedded code begins execution from the beginning of code \npointed to by the unmodi\ufb01  ed reset vector. A typical module performs system initial-\nization routine to start all over again. \n The CAN command reset, and interrupt", " After that embedded code begins execution from the beginning of code \npointed to by the unmodi\ufb01  ed reset vector. A typical module performs system initial-\nization routine to start all over again. \n The CAN command reset, and interrupt reset are controlled resets meaning \nembedded code has control over the program code execution after modifying the \ninterrupt vector register. In other words software could adopt a strategy best suited \nto the application to execute section of the program code deemed critical, addition-\nally soft reset has control over all registers and pointers, where it may or may not \nperform the system initialization routine. \n Power-On-Reset (POR) is a hardwired reset circuit connects directly to the hard \nreset-line of the microcontroller or microprocessor. It works when the power is \ufb01  rst \napplied to the module and POR circuit senses the incoming power and then gener-\nates a well-de\ufb01  ned reset output with perfect timing cascaded to the microcontroller \nreset hardware pin. Some of the off-the-shelf power regulators do support the \npower-on reset output by embedding the function within the regulator. However, it \nis an option not always supported by all the voltage regulators. SOFTWARE WDT RESET\nPOWER ON RESET RESET\nINTERRUPT PORT INTERRUPT RESET\nWDT RESET FreeScale CPU12.\nCAN PROTOCOL CONTROLLER\nCAN TRANSCEIVER\nCAN RESET\n  Fig. 3.10    Reset options in a typical module        3 Fundamental Blocks Topologyzamann@us.panasonic.com\n117\n WDT Reset is generated by the external watch dog timer hardware chip, and \nexecutes the microcontroller reset utilizing the hardware reset line. The effects and \nexecution of external WDT is exactly the same as the power on reset. \n The software reset could be achieved in many ways across platform of micropro-\ncessor and microcontroller. But by the token of vehicle module a reset command \nover the CAN bus is a pretty common scenario  \n3.13     Digital Communication Architecture \n In the world of digital electronics serial buses are ubiquitous. These have been used \nin variety of applications. In the early days of microprocessors when Intel 8085, \nMotorola 6800, Zilog Z-80 and Advanced Micro Devices 6502 were \ufb01  rst introduced, \nthe Universal Asynchronous Receiver and Transmitters (UART) were commonly \navailable in the digital market segment to support serial bus", "Motorola 6800, Zilog Z-80 and Advanced Micro Devices 6502 were \ufb01  rst introduced, \nthe Universal Asynchronous Receiver and Transmitters (UART) were commonly \navailable in the digital market segment to support serial bus communication. In the \nbeginning of that era the option was offered mostly as stand-alone controllers. \nBut, later the function became integral part of many microprocessors and microcon-\ntrollers as well. \n Today the guts of serial communication within the automotive electronics mod-\nules largely rest on the following buses with variety of speeds and types:\n\u2022    SPI bus (Serial Peripheral Interface bus)  \n\u2022   SCI (Serial Communication Interface)  \n\u2022   I 2 C bus (Inter Integrated-Circuit bus)    \n SPI bus, developed by Motorola (now FreeScale) mainly for the microcontroller \napplications, it is a four-wire bus (MOSI, MISO, SS, and SCLK) operates in full- \nduplex mode, and could operate up to 10 MHz bits per second. Nonetheless, the \nspeed of the SPI bus is contingent upon the type of computing architecture offered \nto the customer. Another version of SPI has been recognized as Quad SPI or named \nQueued SPI. It has gained extensive usage to interface with external serial \ufb02  ash \nmemory to improve memory cycle time throughput. Dual channel or quad channel \ncould be exploited to improve the memory read and write cycle operations. \n SCI is a UART protocol mainly embedded in the microcontroller as a general \npurpose serial transmission port. Free scale 68HC11 processor data-sheet de\ufb01  nes it \nas a two wire (TxD, RxD) half-duplex serial bus. The speed of transmission is based \non the baud rate selected by the user after proper con\ufb01  guration to the UART control \nregisters. \n I 2 C is a two-wire (SCK, SDA) half-duplex bus with most commonly recognized \nspeed of 100 kHz bits per second. NXP (formerly Philips), who developed the I 2 C \nbus standard, also offers 400 kHz bits per second and 3.4 MHz bits per second ver-\nsions of I 2 C. Yet, 100 kbps dominates in automotive modules. Historically, it was \ndeveloped by Philips for the TV set application where it was realized in the digital- \nsection", " MHz bits per second ver-\nsions of I 2 C. Yet, 100 kbps dominates in automotive modules. Historically, it was \ndeveloped by Philips for the TV set application where it was realized in the digital- \nsection where it required talking to integrated logic circuits for the TV set electron-\nics. At present it has been recognized and being utilized in the digital industry across 3.13  Digital Communication Architecturezamann@us.panasonic.com\n118\nthe board. It has two signals, namely Serial Clock (SCK) and Serial Data (SDA). \nSingle or multiple channels of I 2 C are offered by many different suppliers in a single \nSystem-On-Chip (SoC) package. Often, depending upon the type of microcon-\ntroller, all or some channels of SCI, SPI and I 2 C buses could also be available in a \nsingle package\u2014which is an added advantage in a typical module. \n The bus voltage levels of SCI, SPI and I 2 C stay well within the speci\ufb01  ed digital \nlevels. Yet, SCI, SPI and I 2 C are only meant for shorter distances, and runs within \nthe printed circuit board or in the closer proximity. These buses have so far proved \nto be the de facto standards in the digital world and have been available in variety \nof microcontrollers, microprocessors, EEPROM, EPROM, RAM, Analog to Digital \nconvertors, Digital to Analog convertors, ampli\ufb01  ers so on and so forth. \n In the microcontroller applications, these buses are available in both options i.e. \nas a stand-alone peripheral or packaged inside the microcontrollers. Some technical \npublication uses the phrases like \u2018on-chip\u2019 when the function is embedded inside the \nmicrocontroller and \u2018off-chip\u2019 if a separate chip is required for the intended func-\ntion. At times \u2018off-board\u2019 and \u2018on-board\u2019 expressions are also exploited interchange-\nably by many publications. All these digital buses have been used in automotive \nmodules, but have restricted short-distance requirements within the modules, and \nhave no role to play outside the modules in a typical vehicle. The question is how \nthe vehicle modules could communicate in a distributed processing across the vehi-\ncle physical space?  \n3.14     CAN Communication Node Architecture \n Vehicle modules are installed at different mounting locations where some are short \nor far distant from", " The question is how \nthe vehicle modules could communicate in a distributed processing across the vehi-\ncle physical space?  \n3.14     CAN Communication Node Architecture \n Vehicle modules are installed at different mounting locations where some are short \nor far distant from each other. The SCI, SPI, QSPI or I 2 C could not easily, economi-\ncally or safely (i.e. without compromising the data integrity) be deployed to transfer \ndata among the modules in a distributed vehicle electronics architecture\u2014so the \nanswer to implement the capability to share information among vehicle modules \nrests on famous serial link recognized as controller area network. \n Controller Area Network communication does not operate in master-salve con-\n\ufb01 guration rather it is a multicast broadcast, asynchronous communication with fea-\ntures like:\n\u2022    Carrier sense,  \n\u2022   Multiple-access,  \n\u2022   Collision Detection    \n Carrier-sense means all the nodes monitor the bus before sending the message, \nstill, while monitoring the bus messages; all nodes have the equal opportunity to \naccess the bus. If there is a message-collision then the sender retries to send the mes-\nsage, based on the retry strategy. Furthermore, CAN protocol is a message-based- \nscheme compared to address-based-scheme, which means that all messages appear on \nthe bus rely on the priority of the frame data distinguished by the message identity. 3 Fundamental Blocks Topologyzamann@us.panasonic.com\n119\n Little but known, there is a scenario, where a transmitting message could address \na particular node directly to request an access for a critical information to a particu-\nlar node by sending a remote transmission request. A remote transmission request, \nfor example, could be initiated by an instrument cluster to inquire about the vehicle \nspeed computed by antilock brake module.    So, the scenario in simple terms could \nbe de\ufb01  ned where \u2018A-module can ask B-module to get information by utilizing \n\u2018remote transmission frame\u2019. \n A typical CAN frame, few basic features are listed below:\n\u2022    An 11-bit identi\ufb01  er, identifying the message identity for example vehicle speed, \ndoor ajar, steering wheel position so and so forth. All messages will have a \nunique identity. An 11-bit identi\ufb01  er means a total of 2,048 uniquely identi\ufb01  ed \nmessages could be de\ufb01  ned", " wheel position so and so forth. All messages will have a \nunique identity. An 11-bit identi\ufb01  er means a total of 2,048 uniquely identi\ufb01  ed \nmessages could be de\ufb01  ned. (2 11  = 2,048). We skip the details of 29-bit identi\ufb01  er.  \n\u2022   An 8-byte of data associated with each message is realized as message content, \nwhere 8-byte of data equates to 64-bits of digital information, which is a decent \nsize of data, and not very many messages really needed to use the full 8-byte of \ndata size. Therefore in order to ef\ufb01  ciently use the frame and data serialization, it \nmust be de\ufb01  ned early on, whether the transmitted data is full or partial. The ques-\ntion is how the receiver would know that the received data is full 8-byte long or \npartial 7, 6, 5, 4, 3, 2 or 1 byte-long? The answer to this question is to add infor-\nmation about the data-size by the transmitting node. The added binary bits infor-\nmation about the data-size is de\ufb01  ned as data length code (DLC), which is \nencapsulated in the message frame. A DLC is 4-bit long binary code.  \n\u2022   As explained earlier a message could either request a particular node to get data \nor appear on the bus to provide data to all the nodes on the bus. When it addresses \na particular node, it is named as \u201cremote frame\u201d, and when it appears on the bus \nto provide data to all the nodes, it is named as \u201cdata frame\u201d. In order to distin-\nguish between data-frame and remote-frame, a bit is added by each transmission \nnode, hereby de\ufb01  ned as remote transmission request (RTR) bit.    \n The message transmission policies, message error handling requires well de\ufb01  ned \ntasks be executed by each module connected to the bus. Such an enormous job \nrequires pretty extensive role be played by the specialized hardware, network oper-\nating software, and the application code. \n The hardware encompasses the following aspects:\n\u2022    Message frame construction  \n\u2022   Message storage, queuing buffers, timing and handling  \n\u2022   Level translation     \n3.", " by the specialized hardware, network oper-\nating software, and the application code. \n The hardware encompasses the following aspects:\n\u2022    Message frame construction  \n\u2022   Message storage, queuing buffers, timing and handling  \n\u2022   Level translation     \n3.15     CAN Protocol Controller \n Message frame digital construction is done in registers, after storing it in the tempo-\nrary storage buffers. On one hand, a fully constructed frame is transferred to the \ncomputing node, and similarly handled when receiving it from the outside world. 3.15  CAN Protocol Controllerzamann@us.panasonic.com\n120\nOn the other hand, these stated tasks are handled by a specialized hardware dis-\ntinctly named as CAN Protocol Controller. It is available as an off-the shelf part, so \nthere is no need to design logic gates, registers, \ufb02  ip-\ufb02 ops or precise timing synchro-\nnization. A CAN protocol controller hardware could be implemented inside the \nmicrocontroller or as an external hardware chip. The CAN protocol controller \nserves the purpose of handling CAN frames, and its \ufb01  elds. It manages temporary \nstorage of transmit and receive messages, operates on incoming digital bit streams \nand generates outgoing digital bit stream. \n The level translator is the physical layer of OSI model, where the \u2018rubber meets \nthe road\u2019 meaning messages are received and transmitted on the physical wires by \nexploiting hardware design on an integrated circuit. \n The software plays vital role in knitting everything together to get the CAN bus \nnodes working in harmony.  \n3.16     Controller Area Network Transceiver \n Looking back at the hardware aspects, the CAN signals are de\ufb01  ned differently than \nfrom the standard TTL levels. In order to generate CAN bus signal level, the mod-\nules use additional translation circuit to convert the digital information into the real \nworld, and vice versa. This additional translation circuit, which is the physical layer \nexplained earlier is commonly referred as \u2018CAN Transceivers\u2019 \n As stated earlier Controller Area Network (CAN) hardware signal is a two-wire \ndifferential pair commonly called as CAN high, and CAN low. Refer Fig.  3.11  dual \ndifferential comparators are used to manage half-duplex transmit and receive tasks.  \n Comparator #1 remains active while receiving a message. Comparator #2 gets \nactive when transmitting. The CAN bus levels are de\ufb01", ".11  dual \ndifferential comparators are used to manage half-duplex transmit and receive tasks.  \n Comparator #1 remains active while receiving a message. Comparator #2 gets \nactive when transmitting. The CAN bus levels are de\ufb01  ned differently than the stan-\ndard TTL levels or unlike the digital buses we have discussed so far. This important \ndistinction necessitates the use of level translators to translate the digital level to the \nCAN bus level during the time when the bus is transmitting messages. On the other \nhand, this process must have to repeat itself when bus levels are required to be read \nby the module i.e. when the messages are received into the digital \u2018world\u2019. So, the \nlevel translators are needed to translate bus levels to digital level. \n The bus is half-duplex, which means it can either perform transmit, or receive \nfunctions\u2014only one at a time. So, in order to support half-duplex operation dual \ntranslators are usually packaged in a typical transceiver as shown in Fig.  3.11  \n When the messages are being received, the translator # 1 converts the CAN HI \nand CAN LO to a single output digital level RxD. When the messages are being \nsent, the translator # 2 converts the single TxD digital output to CAN HI and CAN \nLO differential bus drive. Note how the digital world is always receiving the binary \npatterns on a single-wire. However, the two opposite signals always appear on the \nCAN bus with a different range of voltage levels. FreeScale MC33742, Linear \nTechnology LT1796, NXP TJA1040 and In\ufb01  neon TLE6251G are some of the CAN \ntransceivers available in the market.  3 Fundamental Blocks Topologyzamann@us.panasonic.com\n121\n3.17     CAN Bus Implementation Strategies \n Automotive modules follow three different CAN bus implementation strategies. It \nis based on assumptions that some microcontrollers are available with internal serial \nbus capabilities and some do not, CAN semiconductor manufacturers have success-\nfully come up to the physical realization of CAN bus by offering three different \noptions listed below:\n   Option # 1 Parallel Port to the external Protocol Controller  \n  Option # 2 Serial Port to the external Protocol Controller  \n  Option # 3 Microcontroller internal Protocol Controller   \n\u2022    Option # 1 Parallel Port Interface \n The CAN", ":\n   Option # 1 Parallel Port to the external Protocol Controller  \n  Option # 2 Serial Port to the external Protocol Controller  \n  Option # 3 Microcontroller internal Protocol Controller   \n\u2022    Option # 1 Parallel Port Interface \n The CAN protocol controller, and CAN transceiver are placed external to \nthe microcontroller or microprocessor. However the CAN protocol controller is \ncontrolled by the microcontroller or microprocessor parallel Address, and Data \nbus. Control bus is used to signal the external protocol controller by the micro-\nprocessor/microcontroller. In Fig.  3.12  the address and data buses of Intel 8051 \nare connected to the Philips SJA1000, a stand-alone protocol controller. \nMicrocontroller Data gets transferred to the controller by invoking control \n signals utilizing the control bus. Consequently, CAN protocol transmit and \nreceive lines are then fed to the CAN transceiver Philips TJA1050, a high speed \nCAN bus physical layer. The physical layer TJA 1050 converts the logic levels 3.5V\nCANHI 2.5V\nCANLO2.5V\n5V\n1.5V\nRXD\n0V\n5V\nTXD\n0V\nCAN Trans ceiverMicrocontroller World\n21\n  Fig. 3.11    A typical partial CAN Transceiver        3.17  CAN Bus Implementation Strategieszamann@us.panasonic.com\n122\n(TXD, RXD) at the appropriate bus differential levels (CAN Hi and CAN Lo) \nand manages the direction of \ufb02  ow of messages. Similar components could be \nreplaced to get the same topology.   \n\u2022   Option # 2 Serial Port Interface \n It is similar to option # 1 i.e. identical external CAN protocol controller, and \nexternal CAN transceiver. However the communication between micro and the \nCAN protocol controller is serial rather than parallel. In Fig.  3.13 , the Microchip \nPIC16F883 microcontroller uses its SPI bus to talk to the CAN protocol control-\nler. We chose to show an example of SPI bus; however the CAN controllers and \nmicrocontrollers are available in many options of serial buses interface like SCI, \nSPI or I 2C , which ever the user like to choose for a particular line of processor and \nCAN controller.   \n\u2022   Option # 3: Internal Protocol Controller \n The CAN", " in many options of serial buses interface like SCI, \nSPI or I 2C , which ever the user like to choose for a particular line of processor and \nCAN controller.   \n\u2022   Option # 3: Internal Protocol Controller \n The CAN protocol controller is packaged internally to the microcontroller. But \nthe CAN transceiver is still placed external to the microcontroller. This is, by far \nthe most attractive solution in the automotive industry based on the fact that it \nreduces the part complexity and save space on the printed circuit board. In \nFig.  3.14  a Free Scale microcontroller is shown in this con\ufb01  guration. The Star12 \nor MC9S12DT1228 is a versatile processor with abundance of software con-\ntrolled con\ufb01  guration features.  \n The PM (0\u20137 bits) port has the capability to do many functions and could be \ncon\ufb01 gured for any function other options as well. However, in this diagram the \nPM0 is con\ufb01  gured as CAN receiver and PM1 as CAN transmit. The TXCAN0 \nand RXCAN0 are connected to the CAN transceiver, which is the interface \nbetween the CAN bus and the CAN protocol controller embedded in the CPU12 \nmicrocontroller.     Add/Data TXD CAN Hi\nCAN Lo\nControl RXDCAN Bus\nMICRO\nIntel 8051CAN PROTOCOL\nCONTROLLER\nPhilips SJA1000CAN\nTRANSCEIVER\nNXP TJA1050\n  Fig. 3.12    Option # 1, external CAN Protocol Controller (Parallel Bus)       \nTXCAN CAN Hi\nSPI CAN Lo\nRXCANMICRO\nMicrochip\nPIC16F883CAN PROTOCOL\nCONTROLLER\n Microchip\nMCP2515CAN \nTRANSCEIVER\nNXP TJA1050CAN Bus\n  Fig. 3.13    Option # 2, external CAN Protocol Controller (Serial Bus)        \n 3 Fundamental Blocks Topologyzamann@us.panasonic.com\n123\n3.18     CAN Bus Voltage Levels \n Please note that the CAN protocol controller outputs stays at TTL level. However, \nthe output of CAN transceivers must comply to, CAN HI and CAN LO bus voltage \nlevels as shown in Fig.  3.15    \n3.19     CAN Bus Software Components \n Whichever option you", " TTL level. However, \nthe output of CAN transceivers must comply to, CAN HI and CAN LO bus voltage \nlevels as shown in Fig.  3.15    \n3.19     CAN Bus Software Components \n Whichever option you chose to design, you are not even close to getting the CAN \ncommunication to work in a typical vehicle because some of the software compo-\nnents are missing. The software components play leading role in managing the net-\nwork activities. Two major software components are needed to get the communication \nworking up and running are:\n\u2022    Network Operating Software (NOS)  \n\u2022   Message-set database.    \n To understand both in simple terms, visualize the people around us. How they \ncommunicate with each other, it is the vocabulary of words in the language they \nspeak. Skills of language depend on grammar and vocabulary. The grammar is the \nlanguage tool to remain correct when communicating with others, vocabulary the \nunderstanding of words you must learn to make sense when they are repeated. \n Similarly, in the domain of software activities pertaining to CAN communica-\ntion, the  N etwork  O perating  S oftware (NOS) is the \u2018grammar\u2019 of communication, \nand the messages transferring among the modules is the \u2018vocabulary\u2019. Each module \nmust have to keep the \u2018grammar rules\u2019 (network software) in its memory, and also \nmust have to memorize the \u2018vocabulary words\u2019 (message set). troP\nMPCAN Bus\n8K RAM\nPM1 TXCAN0 CAN Hi\n2K EEPROM CAN Lo\nPM0 RXCAN0\n128K FLASH\nPROCESSINGPM PortCAN  PROTOCOL\nCONTROLLERCAN\nTRANSCEIVER\nNXP TJA1050\n    Microcontroller  Freescale  MC9S12DT128\n  Fig. 3.14    Option # 3, internal CAN Protocol Controller        3.19  CAN Bus Software Componentszamann@us.panasonic.com\n124\n To summarize the tasks the network operating software has to perform, here is \nthe synopsis:\n\u2022    Interfaces with the application code  \n\u2022   Monitor and mitigate the bus access issues  \n\u2022   Log errors  \n\u2022   Support retransmission of messages when errors happened  \n\u2022   Distinguish, and detect frame and understand frame types    \n So far we have captured three major areas of expertise i.e. CAN protocol control", " bus access issues  \n\u2022   Log errors  \n\u2022   Support retransmission of messages when errors happened  \n\u2022   Distinguish, and detect frame and understand frame types    \n So far we have captured three major areas of expertise i.e. CAN protocol control-\nler, CAN transceiver, and CAN operating software. In order to achieve the CAN \ncommunication connectivity among the module nodes, we have to integrate all \nthree pieces together to operate as a working node shown in Fig.  3.16 .  \n The microcontroller, CAN protocol controller, CAN transceiver, bus protection \ncircuits and bus impedance matching are physically residing inside the module. The \nbus impedance matching is actually the combination of overall harness length, bus \nterminations, which majority of the times utilizes the split-termination of 60 \u2126 each, \nmounted in the modules at the farthest corner of the bus length. So, in reality only \ntwo modules at the farthest corner of the corresponding bus have to have the termi-\nnations in place. It is dependent on the vehicle system design whether there is a need \nto add more termination to balance the bus impedance and capacitive coupling to its \ncorrect value to operate the bus correctly the vehicle. The vehicle system design \nvaries from manufacturer to manufacturer, so do the termination nodes in the cor-\nresponding vehicle harness. Vehicle network communication system design man-\ndates all electronics modules to keep the provision to add termination or no \ntermination. \n An interesting feature of many automotive microcontrollers is to have the CAN \nprotocol controller embedded inside the chip. So, the options of off-board and on- \nboard CAN protocol controller solutions are available in the market. \n The network operating software and the bootstrap loader is stored inside the \nmicrocontroller memory. The other modules installed in a typical vehicle have simi-\nlar nodes embedded in each module. 4.5V 4.5V\n3.5V 3.5V\n2.5V 2.5V\n1.5V 1.5V\n0V 0VCAN HIGH\nCAN LO\n  Fig. 3.15    CAN HI and CAN LO speci\ufb01  ed levels        3 Fundamental Blocks Topologyzamann@us.panasonic.com\n125\n The microcontroller uses serial SPI bus to talk to the CAN protocol controller. \nCAN protocol controller generates the appropriate bit-streaming to the CAN trans-\n", " ed levels        3 Fundamental Blocks Topologyzamann@us.panasonic.com\n125\n The microcontroller uses serial SPI bus to talk to the CAN protocol controller. \nCAN protocol controller generates the appropriate bit-streaming to the CAN trans-\nceiver for onward delivery to the CAN bus. Similarly, when the transceiver is in \nreceive mode, the CAN controller receives the bit streaming from the transceiver, \nstores it in buffers and later delivers to the microcontroller using SPI bus. \n Microcontroller is supported by the network operating software to manage bus, \nbus messages errors and many more features. The network operating software \n(NOS) gets stored into the module memory. The Primary boot loader is stored in \nprotected memory boot block inside the microcontroller, and is utilized whenever it \nis required to invoke communication bus\u2014to self-program the microcontroller pro-\ngram memory. Additional protection components are needed to safeguard the mod-\nule bus from the accidental short-to-battery and short-to-ground. CAN transceivers \nare available as commercial-off-the-shelf (COTS) components and some of them \nare available with protections circuits needed in automotive applications. An \n LT1796-Overvoltage Fault Protected CAN Transceiver   made by Linear Technology \nis one such example.     CAN Lo   CAN Hi\n   CAN Lo  CAN Hi\n       TxD  RxD\n            SPIBUS IMPEDENCE MATCHING\nMICROCONTROLLER\nA typical vehicle module CAN architectureCAN PROTOCOL CONTROLLERCAN TRANSCIEVERPROTECTION CIRCUITS\nPrimary  \nBootloaderNetwork \nOperating \nSoftwareOther Vehicle Modules \n  Fig. 3.16    Module CAN node with protection and software        3.19  CAN Bus Software Componentszamann@us.panasonic.com\n126\n3.20     Battery Voltage Monitoring \n A continuous battery voltage monitoring is always required by every electronics \nmodule to determine, and function correctly within the operational envelop of the \nmodule. The software algorithm must perform the battery monitoring throughout \nthe operational envelop of the module. It is different than the abrupt power shut-\ndown block explained in next section, which is fed to the non-maskable interrupt \nport. In battery voltage monitoring the signal is fed to the analog to digital port of \nthe microcontroller (Fig.  3.17 ).   \n3.21     Abrupt Power Failure \n Abrupt battery power failure could occur in the vehicle due to several reasons", " voltage monitoring the signal is fed to the analog to digital port of \nthe microcontroller (Fig.  3.17 ).   \n3.21     Abrupt Power Failure \n Abrupt battery power failure could occur in the vehicle due to several reasons. So, \nit is important for the software to know when the battery power is about to go down \nand it must initiate a power-down sequence algorithm to keep the critical data stor-\nage safely stored, and then retained after power-up sequence is executed. \n In order to furnish this talk, it is prudent to deploy a hardware block to detect \nbattery voltage ramping-down. A hardware block shown in Fig.  3.18  could be \ndesigned to detect the threshold voltage at 8 V . So when the voltage goes less than \n8 V , it immediately triggers a non-maskable interrupt to the microcontroller of the \ndigital input port. The purpose of this essential block is to act extremely fast to \nencounter any sudden drop of voltage thereby enabling software to give ample time \nto execute microcontroller house-keeping and emergency power need be kept at a \nsafe energy level.    12VDC\nA/D CHANNELVOLTAGE \nMONITORINGSAFETY & \nPROTECTION\nSIGNAL \nCONDITIONER\nSIGNAL SCALING\nMODULE MICROSoftware  \nTask \nV Monitor\n  Fig. 3.17    Continuous battery voltage monitoring block        3 Fundamental Blocks Topologyzamann@us.panasonic.com\n127\n3.22     Exercise \n        1.    The vehicle manufacturer has assigned a fuse with the intention of blowing the \nfuse if an overload occurs. Draw a fusing strategy diagram, showing the com-\nplete current path including the printed circuit board traces. \n The module fusing diagram is shown in Fig.  3.19   \n The battery is feeding the power to the module through the fuse and the igni-\ntion switch. However the current path includes the termination points, connector 12VDC\nDigital InputTHRESHOLD \nDETECTIONSAFETY & \nPROTECTION\nSIGNAL \nCONDITIONER\nMODULE MICROSoftware  \nTask \nDetection  Fig. 3.18    Abrupt Power \nShut-down threshold \ndetection       \n Side Bar \n  Majority of the vehicle OEM\u2019s do not actually design electronic control mod-\nules rather outsource the development work to different companies like \nPanasonic, Harman and Backer", " Abrupt Power \nShut-down threshold \ndetection       \n Side Bar \n  Majority of the vehicle OEM\u2019s do not actually design electronic control mod-\nules rather outsource the development work to different companies like \nPanasonic, Harman and Backer, Alpine, Continental, Delphi, Visteon, TRW, \nLear, Temec, Siemens, Bosch, Motorola, Denzo, and dozens of other. The vehi-\ncle OEMs, however, develops the speci\ufb01  cations of their intended design \nscope, needs and wants. And also support development activities required to \ntest and validate the appropriate module in a particular vehicle. Suppliers of \nelectronics modules are responsible for their core design, selection of compo-\nnents, tests, and validations. The suppliers are also responsible to submit \nquality and reliability data of their entire design. The electronic components \nused by the module suppliers must be quali\ufb01  ed for the automotive applica-\ntions. The automotive electronic parts quali\ufb01  cation in itself relies on elevated \ntests at higher temperatures, thermal shocks, and vibration in every possible \nworst case condition. An unof\ufb01  cial term \u201cshake and bake\u201d sometimes refers \nto the vibration and thermal testing.    3.22  Exercisezamann@us.panasonic.com\n128\npins, wiring resistance and printed circuit board traces. Ground strategy also \nplays an important role when the energizing current has to complete its paths to \npower the module. There are multiple grounds normally utilized in a typical \nvehicle and it is a standard practice to use the multiple ground points in order to \nreduce the ground offset voltages.   \n   2.    A vehicle is equipped with a total of 12 modules, 5 modules works only when \nthe ignition switch is turned-on, however rest of the modules stay alive even if \nthe ignition switch is turned-off. If each module is consuming 1.5 mA after the \nignition switch has been turned-off, calculate the key-off load current (KOL)? \n The total number of modules consuming key-off-load current are 12 \u2212 5 = 7, \nso the battery would consume 10.5 mA (7 \u00d7 1.5 mA). \n Please see the OrCAD/PSpice simulation below where each module is simu-\nlated by an 8K resistor to show 1.5", " the battery would consume 10.5 mA (7 \u00d7 1.5 mA). \n Please see the OrCAD/PSpice simulation below where each module is simu-\nlated by an 8K resistor to show 1.5 mA consumption for each module (Fig.  3.20 ).  \n Note: In the real word KOL or Dark current varies in each module \n Please see another view of the identical calculation by using the TINA simu-\nlation where each module is simulated by an 8K resistor to consume 1.5 mA \neach. Please note how the digital multi-meters are connected to each module \nand \ufb01  nally to the vehicle battery. Digital multi-meters could be easily invoked \nin the TINA simulation software (Fig.  3.21 ).    \n1 \n2 \n3 \n4 \n5 10. Connection  \nProtection Circuit  Power Supply Module Printed Circuit Board  2.Connection  3. Wiring \n12.Termination  Battery Fuse \n4. Termination  \nTraces 5. Termination  \n6. Wiring\n9 Wiring 7. Termination  8. Termination  \nTraces 11. Connection  Ignition Switch  \n1.Termination  \nGND A GND A \n  Fig. 3.19    Fusing path        3 Fundamental Blocks Topologyzamann@us.panasonic.com\n8k\n0\n8k\n0\n8k\n0\n8k\n0\n8k\n0\n8k\n08k\n0\n1.5mA1.5mA1.5mA\n10.5mA1.5mA\n1.5mA1.5mA1.5mAVehicle BatteryModule 1\nModule 2\nModule 3\nModule 4\nModule 5\nModule 6\nModule 7012V\n  Fig. 3.20    OrCAD/PSpice KOL or dark current calculation       \n8KA\n+\n-V/\nAVmDMM1\n8KA\n+\n-V/\nAVmDMM2\n8KA\n+\n-V/\nAVmDMM3\n8KA\n+\n-V/\nAVmDMM4\n8KA\n+\n-V/\nAVmDMM5\n8KA\n+\n-V/\nAVmDMM6Vehicle Battery\n8KA\n+\n-V/\nAVmDMM7A\n+\n", "\n+\n-V/\nAVmDMM4\n8KA\n+\n-V/\nAVmDMM5\n8KA\n+\n-V/\nAVmDMM6Vehicle Battery\n8KA\n+\n-V/\nAVmDMM7A\n+\n-V/\nAVmDMM8\nA\n+\n-V/\nAVDMM9Module#2\nModule#3\nModule#4\nModule#5\nModule#6\nModule#7Module#1\n  Fig. 3.21    TINA simulation of KOL or dark current calculation        \n zamann@us.panasonic.com\n130\n   3.    Show a Low-side switch and a High-side switch operation? (Fig.  3.22 )  \n A high-side driver used to drive a solenoid sourcing a current of 4.25 A \n(Fig.  3.23 )      \n2N6755VF1VF22.2K1k12V Battery\n5W Lamp+\nVG1Low Side Driver\n397.58mA549.74mV\n3.44V\n  Fig. 3.22    Low side driver       \nVF1\nVF2100k1k12V BatteryT1\n5V Bias\nL1High Side Driver\n4.25A-7.17E-16V4.95V\n  Fig. 3.23    High side driver        \n 3 Fundamental Blocks Topologyzamann@us.panasonic.com\n131\n   4.    You are challenged to design a module performing seven (7) different functions. \nAssume that only one (1) function is required to be activated when the ignition \nkey is off, two (2) functions are required to work when the driver-door is opened, \nand rest of the four (4) functions must work when all the doors are closed and \nthe engine is running. Draw the Mealy state machine diagram showing module \noperational modes with all of its entry and exit conditions for each mode.   \n   5.    If the maximum time allocated for an interrupt service routine (ISR) is 50 ms \nand that is the longest time routine in your application then what will be earliest \npossible time where the watch-dog timer must initiate a hardwired RESET to \nthe microcontroller?   \n   6.    If a Microchip CAN protocol controller MCP2515 is selected for a high-speed \noperation", " what will be earliest \npossible time where the watch-dog timer must initiate a hardwired RESET to \nthe microcontroller?   \n   6.    If a Microchip CAN protocol controller MCP2515 is selected for a high-speed \noperation then; (a) what will be the bit timing for a single binary digit (b) De\ufb01  ne \nlogical segmentation of bit quanta\u2019s.   \n   7.    Draw a block diagram of a module showing switches and solenoids to control \nfour (4) door-locks using FreeScale Star 12 processor. Also show the port \nassignment for the MS-CAN connectivity to other module?      \nVV\nFF\n11\nV\nF\n2\nF\nF\n1001\nk\n1\nk\n12\nV\nB\na\ntt\ne\nr\ny\n5\nV\nR\ne\nR\nR\nl\na\ny\n+\n -\nM\no\nM\nt\no\nr\nT\n1\nHigh Side Drive r\n4\n.\n03\nA\n17\n.\n5\nm\nA\nm\nm\n1\n.\n75\nV\n4\n.\n95\nV\n   \n     A high-side driver used to drive a relay sourcing 17.5 mA. The relay contacts get closed and the \nmotor starts spinning.   3.22  Exercisezamann@us.panasonic.com\n132\n   8.    Draw a simple block diagram showing protection against high energy transients \nwhen the battery terminals are abruptly removed while the vehicle alternator \nwas still running. Assume peak energy spike at 50 V . \n    \nV1Z1L1\nC1C2\nU1\nR1VF1\n  \n        9.    Design a protection block diagram to safeguard the module from 24VDC? \n    \nV1\nR2VF2Z1VF1A+\n-V/?\nA?V\n  3 Fundamental Blocks Topologyzamann@us.panasonic.com\n133\n        10.       (a)    Draw a reverse battery protection block by using a series blocking diode. \n    \nV1\nR1VF1Module\n343.46mA11.33V\n  \n         (b)    Draw a reverse battery protection block using parallel diode topology. \n    \nR1VF1\nV1\nZ1F1Module\n12V", "\nR1VF1Module\n343.46mA11.33V\n  \n         (b)    Draw a reverse battery protection block using parallel diode topology. \n    \nR1VF1\nV1\nZ1F1Module\n12V\n  \n    The battery is simulated as V1, set at 12VDC. Fuse F1 must blow when \nthe excessive current \ufb02  ows in reverse direction because power supply \npolarity is applied in reverse inadvertently   3.22  Exercisezamann@us.panasonic.com\n134\n    (c)    If a module consumes 15 A, what is the drawback of using a series diode? \n     Simulated with trace resistance = 0 \u2126. (simulation)   \n  \nR1VF1\nBattery\nA+R2V+\nModuleTrace\n  \n        Simulated with trace resistance = 20 m \u2126. (simulation)   \n  \nR1VF1\nBattery\nA+R2V+\nModuleTrace1.14V\n14.61A10.86V\n  \n\u2022        The device is consuming 14.61 A  \n\u2022   V oltage drop across the diode with trace resistance of 20 m \u2126 is 1.14  \n\u2022   Available operating voltage at the module is 10.86, when the battery \n=12VDC               3 Fundamental Blocks Topologyzamann@us.panasonic.com\n135 \u00a9 Springer International Publishing Switzerland 2015 \nN. Zaman, Automotive Electronics Design Fundamentals , \nDOI 10.1007/978-3-319-17584-3_4    Chapter 4   \n Power Delivery and Functional Attributes \n4.1                              Introduction \n Vehicles developed today are highly sophisticated. When it comes to ride and han-\ndling, engine performance, auto-park, collision-detection, adaptive cruise-control, \nsafe-lane assistance, and a variety of other functions\u2014it requires electronics with \ncomputing architectures be utilized carefully to support customer features. These \nextremely sophisticated functions and features are not all required to function con-\ncurrently. The non-concurrency of functions emboldens the need of smart choices \nto execute functions. These smart choices are dependent upon the vehicle attributes, \nsuch as whether the engine is running or not running, whether the vehicle moving \nor stationary, vehicle ignition switch status, engine status, or whether the doors, \nwindows are open or closed", ". These smart choices are dependent upon the vehicle attributes, \nsuch as whether the engine is running or not running, whether the vehicle moving \nor stationary, vehicle ignition switch status, engine status, or whether the doors, \nwindows are open or closed, and so on. \n In this chapter we will explore about these smart choices with special reference \nto module and vehicle attributes. These smart choices are interlinked with software \nand hardware features of vehicle and module attributes to execute the functions \nneeded in the vehicle based on the real-time dynamic nature of information gather-\ning by each individual module. \n The functions are clearly required to be executed even if the ignition switch is off \nor ignition switch is on. A simpli\ufb01  ed diagram in Fig.  4.1  shows the linkage of func-\ntions and ignition switch status.   \n4.2     Power Delivery Mechanism \n In order to achieve the functionality of module when the ignition switch is off there \nhas to be a smart power delivery mechanism that must be incorporated to achieve \nfunctionality of the module. The power delivery mechanism of module is an impor-\ntant concept in automotive design. It affects the overall software, and hardware \naspects of the modules. zamann@us.panasonic.com\n136\n Fundamentally, the power delivery mechanism to each module is based on the \nmodule functions. Functions like vehicle security, applicable vehicle systems, enter-\ntainment, and battery energy management are the key factors to categorize the mod-\nules in two groups:\n\u0081    Type 1 Modules  \n\u0081   Type 2 Modules    \n Type 1 module gets the power when the ignition switch has turned-on as depicted \nin Fig.  4.2 , here a partial module is shown for the sake of simplicity. All the func-\ntions are either begin to function or gets ready to function after the ignition switch \nhas turned-on. The functions are then being executed based on module and vehicle \nattributes explained earlier in Fig.  4.1 .  \n The Type 2 module gets the power, only when the S1 switch inside the module is \nturned-on. The ignition switch in this case is only utilized as the input interface to \nknow the status of switch. The keep-alive circuit includes, but not limited to the \nmicrocontroller and few electronic devices required managing the incoming power \nto the module. The Type 2 modules are required to perform number", " the input interface to \nknow the status of switch. The keep-alive circuit includes, but not limited to the \nmicrocontroller and few electronic devices required managing the incoming power \nto the module. The Type 2 modules are required to perform number of tasks even \nafter the ignition switch is turned-off, and the key is removed.  \n4.3     Type 2 Modules Operation \n Modules are designed to get power regardless of ignition switch position meaning \nthat modules software get power even after the ignition switch has  turned-off ; like \nfor example; a real-time clock, a song playing through the radio, a CD inserted or \nejected, a remote key-less entry function or an anti-theft function, etc. The purpose \nof type-2 power delivery mechanism is to service customer even after the customer \nhas exited the vehicle, but the modules in the vehicle are still required to be executing \ncritical tasks. FUNCTIONS\nIgnition Switch OFF Ignition Switch ON\nModule Attribute Functions\nVehicle Attribute Functions\n  Fig. 4.1    F   unctional allocation        4 Power Delivery and Functional Attributeszamann@us.panasonic.com\n137\n The operation of blocks (Fig.  4.2  bottom sketch) serving the Type 2 modules is \nlisted below:\n\u0081     Input Interface  for the ignition switch is a mandatory requirement, when the \nmodule functionality governs the usage of either position like START, RUN or \nOFF; however unlike Type 1 modules; it is not utilized to turn-on the power to \nthe module rather required to get the sensing circuit block to sense the ignition \nswitch status.  \n /checkbld   Keep Alive Circuit  is the section of Type 2 modules required to establish control \nover the S1 switch, and that is not possible without energizing the mandatory \nelectronics switching circuits and the microcontroller. The keep-alive circuit is \ndirectly connected to the battery and requires extraordinary caution, and safety \ncompliance to develop a robust design. Furthermore the keep-alive circuits con-\nsume battery energy at all-times consequently resulting key-off load current con-\nsumption. A key-off load current consumption is a critical module attribute that \nmust comply with the FMVSS requirement.  \n\u0081    Power Supply and S1 Switch  operates in conjunction with each other; the switch \nS1 could be an external switch or embedded inside the power supply. However \nas can", " that \nmust comply with the FMVSS requirement.  \n\u0081    Power Supply and S1 Switch  operates in conjunction with each other; the switch \nS1 could be an external switch or embedded inside the power supply. However \nas can be noted that battery power is not feeding the power supply rather, an \nadditional electronic switch S1 inside the module is connected to the battery \npower. The S1 switch is feeding the power supply under the control of applica-\ntion software. This mechanism of providing power to the module gives it a \ntotal control over its power switching, irrespective of ignition switch position. B+\nPOWER\nSUPPLY\nINPUT\nINTERFACE\nKEEP\nALIVE CIRCUIT\nS1\nPOWER\nSUPPLYIgnition Switch\nTYPE 2 MODULES ( module shown partially)TYPE 1 MODULES (module shown partially)\nAPPLICATION\nSOFTWARE\n  Fig. 4.2    Power delivery scheme        4.3 Type 2 Modules Operationzamann@us.panasonic.com\n138\nThe S1 switch requires a small segment of electronics be energized at all times \nalong with a software command to turn-on. The small piece of electronics is \nde\ufb01 ned as the keep-alive circuit; the keep-alive circuit gets energized as soon as \nthe vehicle battery is connected irrespective of ignition switch position. The \nkeep-alive circuit is the key enabler to perform the software controlled S1 switch \noperations.    \n A good example is safety and security module, which requires to be optimally \nenergized to keep performing its critical functions to service vehicle safety func-\ntions\u2014regardless of customer\u2019s presence in the vehicle. In other words it does not \nmatter if the customer has switched-off the ignition key, locked the door and got out \nof the vehicle\u2014the module must function at all times\u2014at all cost.  \n4.4     Type 1 Modules Operation \n The module functionality rests on ignition switch on-position so that when the igni-\ntion switch is turned-on the module performs its function normally. In other words \nit means that module functionality is only required when the ignition key is in the \non-position and the vehicle engine is running, in some cases. The purpose of provid-\ning power in this style is to service customer when the vehicle is ready to roll. The \ntopology is presented Fig.  4.2 . Please note how the ignition switch is", " is running, in some cases. The purpose of provid-\ning power in this style is to service customer when the vehicle is ready to roll. The \ntopology is presented Fig.  4.2 . Please note how the ignition switch is directly feed-\ning the power supply and the module power supply only gets the power when the \nignition switch is in the ON position. \n We can run through some cases like for example anti-lock braking function is not \neven needed if the vehicle is parked. Likewise steering control module functionality \nis only required when the ignition switch is turned-on and engine is running to build \nsteering hydraulic pressure. The Type 1 modules do not require power supply soft-\nware controls, so there is no need for keep-alive circuits like the one used in Type 2 \nmodule, and only gets power when the ignition switch is turned-on. The anti-lock \nbrake module is a one good example where the module power is only needed when \nthe ignition switch is turned-on. (It is quite logical as anti-lock braking mechanism \nneed not to function if the vehicle is not rolling). \n If the modules power is controlled by the ignition switch then there is no soft-\nware component required to control the incoming power, however if the power is \nfed by the battery directly then the smart power supply software algorithm is needed. \nWe will also explicate how the power to the module is partially delivered to the \nmodule electronics subject to functional needs and wants. The rationale behind the \npower delivery strategy is to conserve energy, and stay safe. \n If a module is needed to be energized at all times like Type 2 modules then a \nsmart power-switching, and monitoring must have to be carried out throughout the \nentire life-cycle of the module. This mandatory monitoring requirement has been \nimposed due to the fact that once the modules have been placed in a vehicle; the \nbattery power is the only power source made available as long the vehicle battery is \nalive and connected. 4 Power Delivery and Functional Attributeszamann@us.panasonic.com\n139\n However, bear in mind that the smart power-switching must have to be done with \nsafety and intelligence in mind. Safety is critical because a continuous electrical \ncurrent is \ufb02  owing inside the modules. \n Intelligently in the sense that the power-switching scheme must have to be opti-\nmized for the continuous battery power", " intelligence in mind. Safety is critical because a continuous electrical \ncurrent is \ufb02  owing inside the modules. \n Intelligently in the sense that the power-switching scheme must have to be opti-\nmized for the continuous battery power drain because an un-necessary battery drain \ncould kill the battery. There were incidents in the automotive industry where cata-\nstrophic damages have occurred due to the component (s) failure in TYPE 2 \nmodules  \n4.5     Type 2 Modules Vehicle Life \n A very important event happens when these modules begin their \u2018vehicle-life\u2019 and \nthe vehicle battery gets connected to the vehicle electrical system for the \ufb01  rst time. \nThis \u2018historical event\u2019 happens in the vehicle manufacturing line where the module \nand its associated vehicle harnesses and interfaces are connected and operational. \nAs soon as the vehicle battery is electrically connected, the module gets energized \nand within a very short time ready to become operational, and from that point \nonwards the module smart software algorithm meant for power supply switching \nmechanism takes control of the module power management scheme for the rest of \nits \u2018 energized-happy-vehicle-life\u2019.  \n In essence, these modules could only go \u2018lifeless\u2019 if the battery is disconnected \nfor any reason or discharged below a minimum voltage level. The module smart \nsoftware determines the requirement of providing operational power to the module \nby monitoring the ignition switch activity sensed through the input interface circuits \nas shown in Fig.  4.2 . By knowing the position of ignition switch, it decides when to \ntoggle the S1 switch. Toggling S1 switch ultimately controls the module power, and \nwhen the S1 switch is placed to off position the module enters in the sleep-mode, \nwhere it consumes minimum power to conserve battery energy. There are modules \nin a typical vehicle to perform critical functions even when the ignition switch is in \nthe position of \u201cstart\u201d meaning when engine is cranking. Engine cranking is a short- \nduration event that lasts less than \u00bd s, yet, the sophisticated electronics inside vehi-\ncle electronics has to perform functions to perform many tasks related engine start \nsequence.  \n4.6     Module Functional Attributes \n It is high time to discuss the details of module functional attributes. It is an impor-\ntant concept being applied across the board in the vehicle applications. It is de\ufb01  ned \nas the", "  \n4.6     Module Functional Attributes \n It is high time to discuss the details of module functional attributes. It is an impor-\ntant concept being applied across the board in the vehicle applications. It is de\ufb01  ned \nas the module readiness to perform pre-de\ufb01  ned tasks under a well-de\ufb01  ned set of \nconditions. It could be re-stated in other words that it is the state of hardware and \nsoftware readiness to execute various well-de\ufb01  ned tasks by the module. 4.6 Module Functional Attributeszamann@us.panasonic.com\n140\n In order to solidify the understanding of module attributes, we de\ufb01  ne an imagi-\nnary module namely \u2018Clock Display Module\u2019. The purpose of this imaginary mod-\nule is to clearly learn, how different modes of operation could occur in a typical \nmodule. However this is not a real life example, and meant only for the purpose of \neducation. The module functional attributes are also referred by different naming \nconventions such as \u2018Power Modes\u2019 or \u2018Power Moding\u2019 in the industry. \n The imaginary \u201cClock Display Module\u201d has the following hardware \nspeci\ufb01  cations:\n    1.    A display to display hour and minutes   \n   2.    A computing node to compute time.   \n   3.    An input electronics interface to learn if the ignition switch is in RUN position   \n   4.    An input electronics interface to learn the vehicle speed.   \n   5.    An output interface to turn-off or turn-on the display     \n The Clock Display Module has the following functional behavior (   Fig.  4.3 ): \n /checkbld   Always compute real time even if the vehicle speed is zero and ignition switch is \nnot in RUN position  \n /checkbld  Monitor vehicle speed, but do not display time or vehicle speed  \n /checkbld  Display vehicle speed if vehicle speed is >50 mph  \n /checkbld  Display time if vehicle speed is >50 mph    \n We now de\ufb01  ne our three modes of operation: \n When the ignition switch is OFF, the module stays at  Sleep mode  , where it com-\nputes the time, but does not displays time, rather keeps the time computation inter-\nnal to computing node but with dynamic updates, however it does consumes a \nminimal level of current. \n When the", "  Sleep mode  , where it com-\nputes the time, but does not displays time, rather keeps the time computation inter-\nnal to computing node but with dynamic updates, however it does consumes a \nminimal level of current. \n When the ignition switch is ON, the module enters in  Standby mode  , while in \nstandby mode it monitors the vehicle speed, still computes the time but does not \ndisplays it. \n When the vehicle speed reaches to 51 mph the module enters to  Operational \nmode   and at that moment it displays both the vehicle speed and time together. \n Both time and speed display stays-on while the module remains in operational \nmode, but once the vehicle speed falls below 25 mph, the display turns off and no \ntime or vehicle speed is visible to the customer. The modes can be explained in a \nstate transition diagram shown in Fig.  4.4 .  \nHour MininuteElectronics Display\nVehicle SpeedEmbedded \nController\n  Fig. 4.3    An imaginary clock display module        4 Power Delivery and Functional Attributeszamann@us.panasonic.com\n141\n Please note how every attribute has an entry and exit condition. But for the \nsake of simplicity, the Sleep Mode entry condition is not shown, let\u2019s assume that \nsome condition like \ufb01  rst time battery power turning on is the entry point for the \nsleep mode. \n The purpose of this imaginary module is to clearly understand the conditions like \nsleep-mode, standby-mode and operational-mode. The question comes to mind why \nwe need all these modes? Well!, it helps to partition the software and hardware \nwhere it follows many fundamental software engineering principles like coupling, \ncohesion, information-hiding etc.    Sleep Mode Standby ModeOperational Mode\nIGNSW=RUNIGNSW=OFF\nVSS>50mphVSS<25mph\n  Fig. 4.4    State transition diagram        4.6 Module Functional Attributeszamann@us.panasonic.com\n143 \u00a9 Springer International Publishing Switzerland 2015 \nN. Zaman, Automotive Electronics Design Fundamentals , \nDOI 10.1007/978-3-319-17584-3_5    Chapter 5   \n Fundamental Blocks Design \n5.1                        Introduction \n    So far, we have studied the basic topology of many fundamental blocks exists in a \ntypical electronics module. We", "-3-319-17584-3_5    Chapter 5   \n Fundamental Blocks Design \n5.1                        Introduction \n    So far, we have studied the basic topology of many fundamental blocks exists in a \ntypical electronics module. We can now go a little deeper into understanding the \nbasic design of each block with a simple circuit design, to solidify our understand-\ning with the topology. \n In order to design such a block, we have to de\ufb01  ne our hardware and software \nrequirements. A simple arbitrary requirement would suf\ufb01  ce to understand each \nblock. After we have de\ufb01  ned and understood the arbitrary requirements of a particu-\nlar block, we can then walk our way through the hardware topology by using SPICE \nsoftware meant for the electronic design simulation. SPICE stands for Simulation \nProgram with Integrated Circuit Emphasis. \n Although SPICE in itself is a general term whose fundamental principles are \nmirrored in many SPICE programs available in the market, such as SABER, \nOrCAD/PSpice, LT Spice (Linear Technology), TINA (Texas Instruments Nodal \nAnalysis), MultiSim, SPICE 3F5, XSPICE from Georgia Tech, ADISim by Analog \nDevices and numerous more. In addition to these programs, which can be install in \nyour computer, an on-line SPICE tools are also available like WEBBENCH by \nTexas Instruments, or CIRCUIT Lab by a company named Circuit Lab and TINA \nCloud by TINA. \n SPICE takes a fundamental step towards the software de\ufb01  nition of an electronics \ndesign; it builds the mathematical models of electronic components for active and \npassive components de\ufb01  ned as SPICE models. The SPICE models are the core fun-\ndamental building blocks of any SPICE program. The models made available either \nby original software company or through many other contributors. The technology \nof software electronics modeling is far advance that majority of semiconductor \nmanufacturers\u2019 offers the SPICE models free of charge at their web site. The soft-\nware design tools space that uses the computing power to solve the equations zamann@us.panasonic.com\n144\nof electronics, semi-conductor behavior, and logical outcomes of sequential, \n combinational, and VHDL logic are categorize as electronic design automation \nabbreviated as EDA. The EDA tools have established an", "us.panasonic.com\n144\nof electronics, semi-conductor behavior, and logical outcomes of sequential, \n combinational, and VHDL logic are categorize as electronic design automation \nabbreviated as EDA. The EDA tools have established an extremely powerful pres-\nence in the industry, for not only the electronics circuit design and simulation, but \nalso one-step ahead by adding the intelligence of printed circuit board design auto-\nmation. The printed circuit board automation are so powerful in nature that it even-\ntually generates real world productivity Gerber outputs \ufb01  les that are essentially \nrequired by the board-house to build printed circuit boards. The board house requires \nGerber \ufb01  les because it de\ufb01  nes the copper layers, components layout, silk-screen, \ntraces, trace- widths, board size, solder-mask, and drill information required for the \nmachines that crank out wonderful printed circuit boards. \n However If you are not familiar with SPICE software, just treat it as a sophisti-\ncated graphing calculator, which can do electronics calculations based on semicon-\nductor behavior when connected electrically with linear and non-linear devices \nappropriately. Nevertheless, please bear in mind that while conducting the analysis \nall electronics simulations require mathematical models of each active and passive \ndevice to run through an automated way of simulations and calculations. Throughout \nthe chapter, you will see the graphs, and plots based on calculations with sophisti-\ncated modeling behavior of circuits and design. \n The simulation software usage is a common practice in electronics design and \nautomotive design space is no exception. Simulation of automotive electronics \ndesign achieve lots of corrections right before it goes wrong\u2014earlier than the prac-\ntical circuit implementation takes place. \n Following are the key advantages of using the SPICE software:\n    1.    Design, tweak, test and verify before building the practical circuits. Hence, you \ndo not have to buy parts, make printed circuit board or use breadboard to work \non it.   \n   2.    Design, and calculate the optimal operating conditions and consequently deter-\nmine the operational envelop best \ufb01  t to the application   \n   3.    Determine the boundary conditions over temperatures variations, and voltage \nranges that may affect the design of the module.   \n   4.    Calculate optimal design behavior under varying conditions by running statisti-\ncal analysis like Monte Carlo estimation, root-sum square and", " Determine the boundary conditions over temperatures variations, and voltage \nranges that may affect the design of the module.   \n   4.    Calculate optimal design behavior under varying conditions by running statisti-\ncal analysis like Monte Carlo estimation, root-sum square and extreme value \nanalysis.   \n   5.    In general, the technique of worst-case circuit analysis is utilize in the industry \nto reduce upfront testing-cost, and shrink the development time to learn the \nbehavior of a design before the real printed circuit board is materialized. \nIndeed\u2014it is rather quicker to react and redesign within the realm of computer \naided electronics design tools rather than to recover after the prototype printed \ncircuit board is build. \n A good analogy is an airplane \ufb02  ight simulator, where a trainee pilot could \n\u2018crash-land\u2019 hundreds of times without damaging the airplane or impacting a \nsingle human life compared to a real \u2018crash-landing\u2019 that may end up with an \nunimaginable consequences. 5 Fundamental Blocks Designzamann@us.panasonic.com\n145\n A worst case circuit analysis 1  and simulation is analogous to a \ufb02  ight simula-\ntor, where design engineers can \u2018crash land\u2019 hundreds of times before a viable \ndesign comes to existence that saves the product development team dozens of \nhardships in the real world if the error of design is transferred to an actual prod-\nuct on a printed circuit board. The worst-case circuit analysis is a mathematical \nprocess to \ufb01  nd out effects on the circuit due to component tolerances, voltage \nchanges, temperature variations, and part manufacturing variations\u2014in normal \nand extreme environments. On top of that, statistically driven tasks over the \nselected parameters can be perform to determine the variations of the key- \nparameters of circuit design over a wide range of randomly selected conditions.   \n   6.    A question may be ask why we need to worry for so many parameters in an auto-\nmotive design.\u2014simply answered, we have to design electronics for a vehicle \nthat could be moving in coldest to warmest weather, highest to lowest peaks, and \nover the plane \ufb01  eld where people may be driving under or below the sea level. \nLast but not the least through the world of unseen radiant energy surrounding all \nof us every day. This unseen radiant energy radio frequency spectrum meant for \nmany different reasons in the system", "d where people may be driving under or below the sea level. \nLast but not the least through the world of unseen radiant energy surrounding all \nof us every day. This unseen radiant energy radio frequency spectrum meant for \nmany different reasons in the system are like:   \n   \u2022    Cell phone transmitting towers, boosters, repeaters,   \n   \u2022    Radio stations transmitters,   \n   \u2022    TV stations transmission,   \n   \u2022    Powerful radar transmitters,   \n   \u2022    GPS or GNSS satellite signals   \n   \u2022    Electromagnetic effects of vehicle being driven   \n   \u2022    Electromagnetic effects of local or far distant objects from upper atmosphere \nlike sun or others in our environments.   \n   \u2022    Car-to-Car interference like the one being propose for the intelligent transporta-\ntion systems.     \n We will use one of the electronic design automation categorized as EDA soft-\nware tool where we could deploy multiple SPICE models to simulate the designs. \nThe purpose of this exercise is to give our valued reader the idea of a circuit topol-\nogy, and an intuitive design for the purpose of education. We will try our best to \ndesign it in the simplest possible way to augment one\u2019s understanding of each block. \n However, these circuits are drawn here for the purpose of understanding the con-\ncepts, and it lags many industry standard techniques to \ufb01  ne tune for the vehicle \nusage, so do not try these circuits without understanding the real world usage in a \ntypical vehicle. \n Here is the orderly list we like to follow through this chapter:\n    1.    Battery Switching Circuit Design   \n   2.    Ignition Switch Start Circuit Design   \n   3.    Sensors Power Switching Circuit Design   \n1   Worst Case Circuit Analysis is abbreviated as WCCA in the industry. 5.1  Introductionzamann@us.panasonic.com\n146\n   4.    A Low-Side Output Device Driver Circuit Design   \n   5.    A High-Side Output Device Driver Circuit Design   \n   6.    B+ Detection Circuit Design   \n   7.    B+ Monitoring Circuit Design   \n   8.    Input Sensor Signal Design   \n   9.    Reset Circuit Design   \n   10.    Reverse Battery Protection Circuit Design   \n   11.    Power Supply Design     \n We have to de\ufb01  ne what we intend to design to furnish any of the circuit design", "   \n   9.    Reset Circuit Design   \n   10.    Reverse Battery Protection Circuit Design   \n   11.    Power Supply Design     \n We have to de\ufb01  ne what we intend to design to furnish any of the circuit design \nlisted above. We can de\ufb01  ne it by expressing it at different abstraction levels like 0, \n1, 2, 3 purposefully to communicate clearly\u2014exclusively written for this book. \nNevertheless, there is no such of\ufb01  cial de\ufb01  nition like abstraction levels 0, 1, 2, 3 but \njust to engage readers\u2019 interest and understanding:\n\u2022    Abstraction Level 3: a short descriptive statement  \n\u2022   Abstraction Level 2: a simple block diagram with a truth table  \n\u2022   Abstraction Level 1: a block diagram of the electronics design  \n\u2022   Abstraction Level 0: an actual schematics of electronics design    \n Please note that for the sake of simplicity we are purposely avoiding the timing \nconsiderations, impedance matching, and software requirements. \n Requirements capture is a great topic in any design, and automotive design space \nis no exception. It is an area of engineering, where requirements capture necessi-\ntates disciplined approach of hardware, software and system integration de\ufb01  nition. \nIn the automotive design space, integration of software and systems in a typical \nvehicle plays a vital role for the success of module electronics when installed in a \ntypical vehicle.  \n5.2     Battery Switching Block De\ufb01  nition \n Let us de\ufb01  ne the battery switching block at all abstraction levels, 3,2,1,0 \n5.2.1     Abstraction Level 3: A Short Description \n\u2022     Design a battery switch that can handle a maximum current of 1 A to the intended \nload  \n\u2022   Turn-on the battery switch to apply power to the intended load when the output \nport of microcontroller changes to logic one.  \n\u2022   Turn-off the battery switch to remove power from the intended loads when the \noutput of microcontroller switches to logic zero     5 Fundamental Blocks Designzamann@us.panasonic.com\n147\n5.2.2     Abstraction Level 2: A Simple Block Diagram \nwith a Truth Table \n Please refer to Fig.  5.1  and its truth table as", " Designzamann@us.panasonic.com\n147\n5.2.2     Abstraction Level 2: A Simple Block Diagram \nwith a Truth Table \n Please refer to Fig.  5.1  and its truth table as the level 2 abstraction. The block dia-\ngram shows that we need to drive a high-current switch by utilizing a low-current \nswitch. The power input \u201cVin\u201d will then be switch as \u201cV out\u201d available for the exter-\nnal load. The \u201cVcontrol\u201d originates from the microcontroller to turn on the low \npower switch that eventually turns on the high power switch.  \n The truth table is de\ufb01  ned to switch \u201cVin\u201d to V out when Vcontrol logic = 1, the \nV out will switch to 0 V when the Vcontrol logic = 0. In addition to that, when the \nVcontrol is in the Hi Impedance state the switched output is OFF or 0 V \n The reasons listed below:\n\u2022    It saves the sink current from the microcontroller not to exceed to its limits  \n\u2022   It acts as a buffer or a safety circuit so that it should not expose directly to the \nexternal interface to protect itself from damage, should there be a faulty \ncondition.  \n\u2022   It can bias the power transistor ef\ufb01  ciently to drive it into saturation.     \n5.2.3     Abstraction Level 1: Designed Blocks and Interfaces \n The level 1 abstraction depicted in Fig.  5.2  is the implementation of electronic \nswitches de\ufb01  ned earlier in the abstraction level 2 namely low-power switch and a \nhigh-power switch. The implementation zoomed in and re-de\ufb01  nes a low power \ndigital- switch and a high power switch (S2) with the intention of showing how \nthe high-level interconnections to the battery, fuse and ultimately the switch S2 is \nused to transfer power to the vehicle-loads\u2014arranged to provide power either to a \nlow- side driver or a high-side driver. The battery is feeding the switch S2 through \nthe fuse intended for safety purposes.  \nVin Vout\nTruth Table\nVcontrol Vin Vout\n01 2 V 0 V\n11 2 V 1 2 V\nHi-Z 12V 0VHIGH POWER \nSWICTH\nLOW POWER \nSWITCH\n", "out\nTruth Table\nVcontrol Vin Vout\n01 2 V 0 V\n11 2 V 1 2 V\nHi-Z 12V 0VHIGH POWER \nSWICTH\nLOW POWER \nSWITCH\nMICRO OUTPUT \nPORTVcontrol\n  Fig. 5.1       Battery switch requirements        5.2  Battery Switching Block De\ufb01  nitionzamann@us.panasonic.com\n148\n Nevertheless, our intent and scope here is to design the circuit to toggle S2-switch \nusing microcontroller digital output port with the assistance of a Digital-Switch. \nThe Digital-switch is like a pilot switch to bias the S2-switch and ultimately the \nS2-switch is utilize to transfer the battery power to the intended loads. The digital- \nswitch can be de\ufb01  ne as a digital transistor that will be implemented in the circuit. \nThe digital transistors are commonly available through different manufacturers to \nsupport many such designs.  \n5.2.4     Abstraction Level 0: Switched Battery Schematics \n Figure  5.3  represents the classic example of a battery switching circuit at the \nabstraction level 0, where the hardware is fully de\ufb01  ne with actual components \nselected for the design.  \n The schematics is showing the actual schematics with simulated load, simulated \nmicrocontroller output and simulated battery power to understand how the circuit \nwould behave when each of the inputs and output are selected to a \ufb01  xed value or \nvaried. It is standard to perform the circuit design this way because these are the \ninputs and outputs of the design. \n The V1 power supply is actually simulating the microcontroller output, where \nwe can sweep the voltage from 0 to 5 V . It is customary in any SPICE software to \nrepresent a microcontroller logic output by a voltage source; indeed, in the real \nworld a logic output from the microcontroller is a voltage source with limited cur-\nrent sourcing capabilities. Battery             Fuse\n Battery Switch\nS2 Switch\nH-Driver Load\nDigital-Switch\nLoad L-Driver\n Digital Port Micro Bias to turn-on S2\n  Fig. 5.2    Battery switching application block diagram: abstraction Level 1        5 Fundamental Blocks Designzamann@us.panasonic.com\n149\n The V2 power is the battery power", " Bias to turn-on S2\n  Fig. 5.2    Battery switching application block diagram: abstraction Level 1        5 Fundamental Blocks Designzamann@us.panasonic.com\n149\n The V2 power is the battery power available for the switching transistor to \ndeliver power to the load, the value can vary from 11 to 13.5 V to simulate for the \ndesign, but the software allows varying to other values as well. \n The resistor R4 represents the loading of the device, which can tailor to the \ncurrent- loading best \ufb01  t as per the transistor data sheet of Q8. In place of a load resis-\ntor, a solenoid-load, a lamp-load or a relay-coil-load can be a good alternative. \n At 10 \u2126-resistive-load, it is consuming about 1.302 A, calculated by the OrCAD/\nPSpice bias-point simulations shown in Fig.  5.4 . The \ufb01  ltered power supply simu-\nlated by V2, where it can simulate voltage from 11 to 13.5 V , however for the sake \nof simplicity it is de\ufb01  ne as the \ufb01  xed power of 13.5VDC. Nevertheless, our intent \nand scope is to design the circuit to toggle S2-switch by utilizing the microcon-\ntroller output so that it could turn-off or turn-on the battery power to the intended \nload. The circuit uses a digital transistor BCR103 to drive the BD234 to function \nlike battery switch. The BD 234 could handle 1.5 A.  \n Figure  5.5  represent the simulation of the circuit behavior when the test probes \nare connected to switching transistor (Q8) collector and emitter, the collector is \ndriving power to the loads, the V1 simulates the microcontroller output.  \n The plot shows the behavior of the low-power digital transistor (Q4) switches to \nsaturation when logic 1 is applied, which then turns on Q8. The battery voltage V2 \nwaiting at the emitter of Q8 then transfers to the external loads. The input and output \nswitching transfer function is simulated using PSpice/OrCAD simulation software. \nAs can be noted that the switching transistor Q8 is in full saturation when V1 = 3 V , \nplease see the switched", ". The input and output \nswitching transfer function is simulated using PSpice/OrCAD simulation software. \nAs can be noted that the switching transistor Q8 is in full saturation when V1 = 3 V , \nplease see the switched battery output plot and the plot shown in Fig.  5.5 . The test \nprobes can be notice in Fig.  5.3 .  VVVR34\n33K2\n1\nC3\n.1u12\n0R4\n102\n1\n00\nV2\n13.5Vdc\nQ4\nBCR103 FILTERED BATTERY SIMULATIONQ8\nBD234\nR33\n3.3K2 1\nC2\n.1u12\n SIMULATING MICRO OUTPUTInfineonVout[11V to 13.5V]\nVcontrol[0 +5V]\nV1\n5\n0 SIMULATING DEVICE LOAD\n  Fig. 5.3    Battery switching circuit abstraction level 0        5.2  Battery Switching Block De\ufb01  nitionzamann@us.panasonic.com\n150\n  Fig. 5.4    OrCAD/PSpice battery switching circuit bias points       \nV_V10V 1.0V 2.0V 3.0V 4.0V 5.0V\nV(Q8:c) V(C2:2) V(Q8:e)0V5V10V15V\nBattery Power SwitchedBattery Power\nMicrocontroller Simulated Output\n  Fig. 5.5    OrCAD/PSpice battery switching circuit simulation        \n 5 Fundamental Blocks Designzamann@us.panasonic.com\n151\n5.2.5     Temperature Envelop Testing \n A very powerful feature of EDA tools is to \ufb01  nd out the effectiveness of electronics \ndesign over a wide range of variations. One of the attribute we must \ufb01  nd out is tem-\nperature base performance of the design. In order to do so, we ran the temperature \nanalysis at 85, 70, 27 and \u221240 \u00b0C as shown in Fig.  5.6 . The analysis is showing wide \nmargin of switching voltage at Q8 transistor because switching at 85 \u00b0C = 2.5 V , \n70 \u00b0C = 3 V , 27", " as shown in Fig.  5.6 . The analysis is showing wide \nmargin of switching voltage at Q8 transistor because switching at 85 \u00b0C = 2.5 V , \n70 \u00b0C = 3 V , 27 \u00b0C = 3 V and \u221240 \u00b0C is around 4 V forming the range of 2.5\u20134 V . As \nwe established earlier that microcontroller output is simulated, so in order to know \nexactly how the microcontroller output would behave over the temperature range of \n85 to \u221240 \u00b0C we must refer to microcontroller data sheet and make sure that logic \nlevels guaranteed over the temperature range are good for the design.    \n5.3     Ignition Start Sensing Block De\ufb01  nition \n Let us outline the scope and de\ufb01  nition of a very simple Start Sensing Block. The \nStart Sensing Block is required to sense the position of the ignition switch at the \n\u2018START\u2019 detent position. However, it is known facts that while the engine is \ncranking, the battery voltage immediately dips, and cycles through the dips for a \nshort period of time until the engine auto ignition kicks in and it begins to run. It \nhappens due to an extremely high current surge towards the starter motor. \nTherefore, the START circuit must take into account the voltage dip of 6 V to \nwork correctly. \nV_V10V 0.5V 1.0V 1.5V 2.0V 2.5V 3.0V 3.5V 4.0V 4.5V 5.0V\nV(Q4:3) V(Q8:c) V(R33:1)0V5V10V15V\nB+ Switch\nMicrocontroller Output85C\n27C 70C\n-40C\n  Fig. 5.6    OrCAD/PSpice battery switching circuit temperature analysis        5.2  Battery Switching Block De\ufb01  nitionzamann@us.panasonic.com\n152\n5.3.1     Abstraction Level 3: A Descriptive Statement \n We de\ufb01  ne here a level translator to convert ignition switch voltage as below:\n\u2022    The start switch position sensed by the electronics.  \n\u2022   The start switch must translate voltage level of 0", " 3: A Descriptive Statement \n We de\ufb01  ne here a level translator to convert ignition switch voltage as below:\n\u2022    The start switch position sensed by the electronics.  \n\u2022   The start switch must translate voltage level of 0 V to 16 V to a TTL logic level.  \n\u2022   The start detent position must translate 0\u20139 V range as TTL logic level 0  \n\u2022   The start detent position must translate 10\u201316 V range as TTL logic level 1    \n These conditions are valid when ignition switch is place at the start position. In \nother words, when the input reads to logic 0 V , the switch position is at start detent \nand when the voltage read out is less than 9 V , it indicates that battery voltage is \ndipping due to engine cranking.  \n5.3.2     Abstraction Level 2: A Simple Block Diagram \nwith a Truth Table \n The simple block diagram is showing how the ignition switch is connected to the \nprotection mechanism then to a level translator and \ufb01  nally to the microcontroller \noutput. The truth table shows that translator must function to output V out as 5 V to \nthe microcontroller when the voltage is in the range of 10\u201316 V , whereas it must \nread to 0 V when the voltage is in the range of 0\u20139 V (Fig.  5.7 )   \n5.3.3     Abstraction Level 1: Designed Blocks and Interfaces \n The designed block diagram is showing how the ignition switch is connected to the \nprotection mechanism then to a level translator, and \ufb01  nally to the microcontroller \ninput. A high level shows how the ignition switch is interface with the protection \nblock. As a standard practice, the protection is always required when inputs or out-\nputs are expose to the vehicle wiring. In this particular case, protection and level- \ntranslation is just like killing two birds with one stone (Fig.  5.8 ).   \n5.3.4     Abstraction Level 0: Ignition Switch Start Schematics \n Figure  5.9  represents the classic example of Ignition switch circuit at the abstraction \nlevel 0, where the hardware is fully de\ufb01  ne with actual components selected for the \ndesign.  \n The schematics is showing the circuit with simulated ignition voltage, simulated \nmicro", " classic example of Ignition switch circuit at the abstraction \nlevel 0, where the hardware is fully de\ufb01  ne with actual components selected for the \ndesign.  \n The schematics is showing the circuit with simulated ignition voltage, simulated \nmicrocontroller input port and simulated module power to understand how the cir-\ncuit would behave when each of the inputs and output are selected to a \ufb01  xed value \nor varied. 5 Fundamental Blocks Designzamann@us.panasonic.com\n153\n As depicted, the V3 is simulating the ignition voltage, so it could vary from 0 to \n12 V . The microcontroller input port is simulate at 1,000 K impedance loading to \nemulate sink-current, and the module power is adjusted at 5 V to bias the Q7 transis-\ntor. The Zenor diode D3 is place to limit the voltage at 4.7 V and additionally to bias \nthe transistor Q5 at an appropriate voltage subject to series resistor value. \n We have installed three probes to the circuit, one at the ignition voltage source, one \nat the base of Q5 and one at the input of the microcontroller digital port. The purpose Vin\nVout\n5V\n0VVin\n10V -16V\n0V -9VPROTECTION\nLEVEL TRANSLATOR\nVout\nMICRO INPUT PORTTruth Table\n  Fig. 5.7    Ignition switching abstraction level 2       \nOFF  P1\nACC  P2\n   B+\nRUN  P3\nSTART  P4\n    Digital PortIgnition Switch\nLevel \nTranslatorProtection\nMicro \n  Fig. 5.8    Ignition switching application block        \n 5.3  Ignition Start Sensing Block De\ufb01  nitionzamann@us.panasonic.com\n154\nis to understand the circuit pro\ufb01  le when the ignition source is varied from 0 to \n12 V . We will review the dynamic behavior later, but let us see how the circuit is react-\ning in static calculations de\ufb01  ned as bias points.  \n5.3.5     Bias Point Analysis \n We can do different type of calculations based on our needs. First, let us do the bias \npoint calculations at 12 V ignition voltage shown in Fig.  5.10 . As we see the micro-\ncontroller, digital port is sitting", " We can do different type of calculations based on our needs. First, let us do the bias \npoint calculations at 12 V ignition voltage shown in Fig.  5.10 . As we see the micro-\ncontroller, digital port is sitting at 4.995 V warning microcontroller that ignition \nvoltage is stable and the engine is not cranking. The beauty of the EDA tool is just \nto plug the value of 12 V at V3, run through the bias point simulation and you will \nsee the revised calculated value in the window  \n Let us continue to perform bias point simulation to see what happens when \n ignition voltage drops to \u22646 V\u2014which happens when engine is cranking. \n The EDA tool allows you to quickly, plug in the new value of 6 V at V3, and here \nyou go after running through the bias point simulation. The value at the micro digital V VV\nQ5\nBCR103\n SIMULATING IGNITION VOLTAGEInfineonV3\n12\n0Q7\nBCR562R29\n1000K2\n1\n0MICRO DIGITAL PORT\nV4\n5VInfineon\n5V MODULE POWERR30\n1k2\n1\nR31\n15K2 1D3\nBZV55C4V7\n  Fig. 5.9    Ignition switch start schematics        5 Fundamental Blocks Designzamann@us.panasonic.com\n155\nport drops to 6.483 \u03bcV , which essentially is logic 0 consequently meaning that \nengine is cranking. \n Now it is the turn of microcontroller, embedded software to do the magic of per-\nforming tasks needed for the module operation (Fig.  5.11 ).  \n Another important attribute worth showing here is to see how quickly and easily \n\u201ccurrent (I)\u201d and \u201cwattages (W)\u201d can be compute in a fraction of second just by \npressing the \u201cI\u201d button or \u201cW\u201d button to see the values (Figs.  5.12  and  5.13 ).   \n Figure  5.14  represent the simulation of the circuit behavior when the test probes \nare connected to the ignition simulation voltage, base of the switching transistor and \nthe input of the microcomputer digital port.  \n The plot shows the behavior of the low-power digital transistor (Q", " represent the simulation of the circuit behavior when the test probes \nare connected to the ignition simulation voltage, base of the switching transistor and \nthe input of the microcomputer digital port.  \n The plot shows the behavior of the low-power digital transistor (Q5) switches to \nsaturation when the ignition voltage is in the range of 10\u201312 V indicating the condi-\ntion that engine is not cranking. During the window of 10\u201312 V the microcontroller \ninput is reading 4.995 V that equates to logic 1. However, when the voltage dips \nbelow 9.5 V the microcontroller is reading logic 0 indicating a crank condition.  \n  Fig. 5.10    Bias point calculations at V3 = 12 V        5.3  Ignition Start Sensing Block De\ufb01  nitionzamann@us.panasonic.com\n156\n5.3.6     Temperature Envelop Testing \n The temperature envelop testing is extremely important, and it must be carefully \nperformed to understand the circuit behavior of electronic components in a typical \nvehicle. It is a well-established fact that different types of temperature related fail-\nures have been witness and reported in the industry. The temperatures we see in our \ndaily life like in summer and winter seasons. There is a condition in automotive \ndesign segment refereed as cold cranking prevalent in cold weather when battery \nvoltage could dip as low as 3 V due to cold cranking, attributed to many factors like \nfrigid temperatures, engine-dynamics, starter-motor and battery-chemistry. The \nnew advance vehicles are increasingly adapting start-stop engine control, where a \nsmart algorithm shuts-down the engine when not needed and re-starts when needed, \nlike for example at traf\ufb01  c stop. The engine shut-down and restart sequence is con-\ntrolled by the electronic engine controller thereby spawning a new era of fuel- saving \nmethod for the customers, where customers without even initiating an engine-crank \nor engine shut-down could notice that a smart computer is taking control of engine \n  Fig. 5.11    Bias point calculations at V3 = 6 V        5 Fundamental Blocks Designzamann@us.panasonic.com\n157\nstart and stop events. The smart way of engine controls necessities the use of elec-\ntronics and ignition crank signal sensing in more profound way than it was predi-\nc", " Fundamental Blocks Designzamann@us.panasonic.com\n157\nstart and stop events. The smart way of engine controls necessities the use of elec-\ntronics and ignition crank signal sensing in more profound way than it was predi-\ncated in the early day of automotive electronics (Fig.  5.15 ).    \n5.4     Sensors Power Switching Block De\ufb01  nition \n Let us outline the scope and de\ufb01  nition of sensors power switching block. The sensor- \nswitching block is required to apply power to the sensors in the system. Sensors do \nnot consume high current rather these are categorize as low-current devices. \nHowever, control of power to apply power to the sensors is part of the overall system \ndesign strategy. The reason being that, it is not desired to power sensors unnecessar-\nily for many good engineering reasons including battery power conservation to sus-\ntain long time bene\ufb01  ts of key-off load current that consequently works in the favor \nof vehicle battery life, customer bene\ufb01  t, and the car manufacturer. \n  Fig. 5.12    Bias point calculations at 12 V , selected window is I (Current)        5.4  Sensors Power Switching Block De\ufb01  nitionzamann@us.panasonic.com\n158\n  Fig. 5.13    Bias point calculations at 12 V , selected window is W (Wattage)       \nV_V30V 2V 4V 6V 8V 10V 12V\nV(R29:2) V(D3:AN) V(R31:1)0V4.0V8.0V12.0V\nQ5 BaseMicrocontroller Input Port\nIgnition Voltage Simulation\n  Fig. 5.14    Ignition Switch Plot showing translation of 12 V to 5 V        \n 5 Fundamental Blocks Designzamann@us.panasonic.com\n159\n5.4.1     Abstraction Level 3: Descriptive Statement \n We de\ufb01  ne here sensors power-switching block with features list below:\n\u2022    The sensors switching block controls the power to the external sensors.  \n\u2022   The control is establish by a microcontroller.  \n\u2022   The sensors switching block will get the regulated power for the external \nsensors  \n\u2022   The sensor switch will turn-on to provide", " block controls the power to the external sensors.  \n\u2022   The control is establish by a microcontroller.  \n\u2022   The sensors switching block will get the regulated power for the external \nsensors  \n\u2022   The sensor switch will turn-on to provide power to the sensors when logic 1 is \napplied to the switch  \n\u2022   The sensor switch will turn-off to disconnect power to the sensors when logic 0 \nis applied to the switch  \n\u2022   The applied voltage from the regulator to the sensors must not drop more than \n300 mV at full-load when conserving 10 mA to the sensors     \n5.4.2     Abstraction Level 2: Sensors Switch Block Diagram \nwith a Truth Table \n The simple block diagram is showing how the regulated output connected to the \nregulator switch, whereby regulator switch is transferring the regulated output to \nthe sensors. The regulator switch is control by the microcontroller output. \n The truth table shows when micro logic 0 is applied to the regulator switch, the \nV out will output 0 V , however when logic 1 is applied the regulator switch turned-on \nand transfers the Vreg to the V out (Fig.  5.16 )   V_V30V 1V 2V 3V 4V 5V 6V 7V 8V 9V 10V 11V 12V\nV(D3:AN) V(Q7:3) V(R31:1)0V4.0V8.0V12.0V\n  Fig. 5.15    Ignition switch plot showing temperature effects        5.4  Sensors Power Switching Block De\ufb01  nitionzamann@us.panasonic.com\n160\n5.4.3     Abstraction Level 1: Sensor Switch Designed Blocks \nand Interfaces \n The designed block diagram is showing how the sensor switch S3 connected to the \nsensors regulator power and then feeds to the sensors. The S3 switch is control by \nthe digital switch driven by the logic output of the microcontroller (Fig.  5.17 ).   \n5.4.4     Abstraction Level 0: Sensor Switch Schematics \n Figure  5.18  represents an example of sensor switch circuit as the abstraction level \n0, where the hardware is fully de\ufb01  ne with an actual components selected for the \ndesign.", " 0: Sensor Switch Schematics \n Figure  5.18  represents an example of sensor switch circuit as the abstraction level \n0, where the hardware is fully de\ufb01  ne with an actual components selected for the \ndesign.  \n The schematics is showing the real components in the design with simulated sen-\nsor voltage, simulated microcontroller output port and simulated vehicle wiring to \nunderstand how the circuit would behave when installed in the vehicle. \n As depicted, the V5 is simulating the sensor voltage, so it could vary from 0 to \n5 V . The microcontroller output port is simulated by Vcontrol = V6 that could be \nadjusted to 5 V to bias the Q10 low-current digital transistor, consequently \nswitching the secondary digital transistor to transfer sensors power to the sen-\nsors. An important addition to the circuit is the simulation of vehicle harness to \nensure proper voltage is deliver to the sensors even if the resistance of the wiring \nhas changed over the life of the vehicle, and/or under extreme temperature \nconditions. \n We have installed three probes to the circuit, one at the sensor power source, one \nat the base of Q10, and one at the sensors power-receiving end. The purpose is to \nunderstand the circuit pro\ufb01  le when the microcontroller output vary from 0 to 5 V .  Vreg   Vout\nVout\n0V\nVreg0\n1 Regulator Switch\nLow Power Switch\nLogic\nMicrocontroller \nOutput PortTruth Table\nMicro Logic\n  Fig. 5.16    Sensors power switching abstraction level 2        5 Fundamental Blocks Designzamann@us.panasonic.com\n161\n5.4.5     Bias Point Analysis \n The \ufb01  rst thing we like to conduct is to make sure that the circuit is not performing \nincorrectly meaning that sensor power has not turned on when not desired, so let\u2019s \ncheck the circuit at 2 V from the micro output. The 2 V output must not turn on the \ntransistor. So, in Fig.  5.19 , the bias point analysis selected at 2 V , which is the output \nof the microcontroller. The result indicates that the sensor switcher (Q12) has not \nturned-on, and the sensors are not receiving 5 V from the sensor regulator as could S3 Switch\nSensors\nDigital", " is the output \nof the microcontroller. The result indicates that the sensor switcher (Q12) has not \nturned-on, and the sensors are not receiving 5 V from the sensor regulator as could S3 Switch\nSensors\nDigital-Switch\n Digital PortBias to turn-on S3\nMicro Sensors \nRegulator\n  Fig. 5.17    Sensors power switching abstraction level 1       \nQ12V\nVVR37\n1K2\n1R38\n0.252 1L1\n1uH1 2WIRING SIMULATION\ndta114R35\n1K2\n1\nC4\n0.01\n12\n0R54.7k2\n10\n0V5\n5V\nSENSOR POWER SIMULATION\nR36\n33k2 1\nC5\n.1u12\n SIMULATING MICRO OUTPUTVout[4.75 TO 5.25]\nVcontrol[0 +5V]\nV6\n3\n0 SIMULATING SENORS 1,2,3Q10\ndtc124R66202\n1\n0R72k2\n1\n0\n  Fig. 5.18    Sensors power switch schematics abstraction level 0        \n 5.4  Sensors Power Switching Block De\ufb01  nitionzamann@us.panasonic.com\n162\n  Fig. 5.19    Sensors power switch bias points V6 = 2 V       \nbe noticed in the simulating sensors 1,2,3 block, where it shows 5.372 nV with an \nextremely low-current consumption for each sensor. It is a great helping tool to \nunderstand the circuit behavior just by tweaking the values deemed important to do \nthe sanity check on the design.  \n In Fig.  5.20 , however, the bias point analysis selected at 3 V , which is the output \nof the microcontroller. The result indicates that the sensor switcher (Q12) has \nturned-on, and the sensors are now receiving 4.672 V from the sensor regulator as \ncould be noticed in the simulating sensors 1,2,3 block. Also notice, how each sensor \nis now consuming some current like 7.5 mA, 994 \u03bcA, and 2.33 mA. At Q12-emitter, \na total current draw for", "1,2,3 block. Also notice, how each sensor \nis now consuming some current like 7.5 mA, 994 \u03bcA, and 2.33 mA. At Q12-emitter, \na total current draw for the sensors is 10.99 mA that matches the sum of currents,  \n In Fig.  5.21 , all probes attached to sensor regulator, microcontroller output, and \nthe sensor switcher is simulated. The DC Sweep from 0 to 6 V is selected for the \nmicrocontroller output to test the circuit behavior. The simulations shows that at \n2.5 V the transistor begins to go in to the saturation and at 3 V it is in full saturation \nproviding power to the sensors, also notice the drop of voltage for the sensors \nmainly due to transistor (Q12) drop.   5 Fundamental Blocks Designzamann@us.panasonic.com\n163\n  Fig. 5.20    Sensors power switch bias points V6 = 3 V       \nV_V60V 1.0V 2.0V 3.0V 4.0V 5.0V 6.0V\nV(Q10:b) V(R35:2) V(Q12:c)0V2.0V4.0V6.0V\nSensor Switcher\nMicrocontroller OutputSensor Regulator\n  Fig. 5.21    Sensors power switch simulation        \n 5.4  Sensors Power Switching Block De\ufb01  nitionzamann@us.panasonic.com\n164\nV_V60V 1.0V 2.0V 3.0V 4.0V 5.0V 6.0V\n... V(Q10:b) ... V(R35:2) ... V(Q12:c)0V2.0V4.0V6.0V\n  Fig. 5.22    Sensors power switch temperature envelop testing        Additionally the circuit can be simulate to do many different analyses like:\n\u2022    Sensor regulator voltage sweep to check for optimum voltage selection.  \n\u2022   Vehicle wiring resistance changes to check the drop in the vehicle wiring  \n\u2022   Sensors current consumption to check for minimum and maximum values     \n5.4.6     Temperature Envelop Testing \n The useful feature of temperature envelop testing is conducted at different tempera-\ntures shown in Fig", " check the drop in the vehicle wiring  \n\u2022   Sensors current consumption to check for minimum and maximum values     \n5.4.6     Temperature Envelop Testing \n The useful feature of temperature envelop testing is conducted at different tempera-\ntures shown in Fig.  5.22 . As could be noticed that sensor switcher turned-on voltage \nhas widen, and now it begins to operate from 2 to 3 V . It is important to run through \nmany iterations of the design in different scenarios to learn useful attributes of the \ndesign like what happens to the sensor current consumption at extreme temperatures. \nAlternatively, what happens to the sensor switcher when the microcontroller logic \nlevels are affect by the temperature variation? On the other hand, what happens to the \nregulated output over the temperature variations?  \n It is not always possible to run every parameter for a wide range of options by \ndrawing just one single schematic. Therefore, it is necessary to perform many other \n 5 Fundamental Blocks Designzamann@us.panasonic.com\n165\ntasks to connect the dots of worst-case circuit analysis to make the full use of design \ntool. In case of sensor power switching example, we need to be reviewing the \n microcontroller data-sheets and/or running the worst-case circuit analysis of sensor- \nregulator power-supply separately to complete the analysis. \n All EDA tools are helpful tools, but in the realm of automotive electronics design \nit is not the panacea for the wide range of vehicle electronics design needs that \ninvolves wiring, harness, terminations, distributed processing architecture, high- \ncurrent devices and unknown factors embedded software.   \n5.5     Low-Side Output Device Driver \n5.5.1     Abstraction Level 3: Descriptive Statement \n We de\ufb01  ne here a low-side driver to drive an external load. The key features listed \nbelow:\n\u2022    The low-side driver is required to drive a load connected to the power.  \n\u2022   The low-side driver must provide power to the load when logic level 0 is applied  \n\u2022   The low-side driver must turned-off power to the load when logic level 1 is \napplied  \n\u2022   The low-side driver must be capable of delivering 10 A of current continuously.  \n\u2022   The microcontroller must be able to read the status of the low-side driver.    \n This low-side driver must add the capability to report to the microcontroller", " The low-side driver must be capable of delivering 10 A of current continuously.  \n\u2022   The microcontroller must be able to read the status of the low-side driver.    \n This low-side driver must add the capability to report to the microcontroller that \nthe load has received power, and it is operating appropriately after the command \nfrom the microcontroller has executed.  \n5.5.2     Abstraction Level 2: A Low-Side Driver Block Diagram \nwith a Truth Table \n The simple block diagram is showing how the low-side driver connected to the \npower, load and the MOSFET drive. The MOSFET drive is taking commands from \nthe microcontroller, and when the logic 0 apply, the load gets energized because the \nMOSFET switch will complete the ground path to the load. \n The truth table shows MOSFET drive will drive the MOSFET Switch to provide \nground path to the load when logic 0 is applied, however on the contrary the ground \npath will stay incomplete when logic 1 is applied\u2014disabling the load to get ener-\ngized (Fig.  5.23 ).   5.5  Low-Side Output Device Driverzamann@us.panasonic.com\n166\n5.5.3     Abstraction Level 1: Low-Side Driver Designed Blocks \nand Interfaces \n The low-side switch designed block diagram is showing how the load has connected \nto the low-side switch that connects to the ground path. The low-side MOSFET \nswitch gate driven by the MOSFET drive. There is a feedback mechanism, which \nhas over-voltage protection, and level-translation mechanism to transfer informa-\ntion back to microcontroller that the load has energized or not energized. This acts \nas a closed-loop mechanism incorporated for the software to verify if the intended \noperation indeed executed. When the software sees, negative results it kicks-off fail- \nsafe strategy algorithm to mitigate the impact to the system operational features. As \na standard practice fuse connected between the path of energizing source (battery) \nand the load (Fig.  5.24 ).   \n5.5.4     Abstraction Level 0: Low-Side Driver Schematics \n Figure  5.25  represents an example of low-side switch circuit at abstraction level 0, \nwhere the hardware fully de\ufb01  ned with actual components selected", "     Abstraction Level 0: Low-Side Driver Schematics \n Figure  5.25  represents an example of low-side switch circuit at abstraction level 0, \nwhere the hardware fully de\ufb01  ned with actual components selected for design with \nall the SPICE models deployed.  \n The schematics is showing the actual circuit with simulated microcontroller \ninput and output, and simulated vehicle wiring to understand the voltage drop across Power\nMdrive\nMOSFET Switch\nON\nOFF Logic 1Power\nFeedback Load\nMOSFET Drive MOSFET Switch\nGND\nTruth Table\nMdriveGnd\nLogic 0\n  Fig. 5.23    Low-side driver abstraction level 2        5 Fundamental Blocks Designzamann@us.panasonic.com\n167\nthe wiring. There is a differential probe connected across the simulated wiring to \nlearn how much voltage drop has encounter when the load current is around \n10 A. The load current of ~10 A consumes when a resistive load of 1.2 \u2126 connected \nto the P-Channel MOSFET. \n As depicted, the V10 is simulating the microcontroller output, so it could vary \nfrom 0 to 5 V . The microcontroller input port simulated at 1,000 K impedance \n loading to emulate a typical microcontroller input loading. The battery power has \nadjusted to 13.5VDC to apply power to the load connected to the low-side driver. \n The Zenor diode D4, placed to limit the voltage at 4.7. Additionally it utilizes to \nfeed the voltage-divider resistors to provide digital information to the microcon-\ntroller, signaling if the MOSFET has turned-on or turned-off. \n We have installed four probes to the circuit, one differential voltage probe mea-\nsures across the L2 and R42 simulating the vehicle wiring, one voltage probe at the \ninput of microcontroller, and one load-current measuring probe at the MOSFET to \nlearn how much load-current is being consumed. \n The Q6 digital transistor kicks in to apply 12 V to the voltage-controlled biasing \nof MOSFET, and when Q6 is in full saturation, the MOSFET is off because source \nto drain voltage is zero. We will review the dynamic behavior later, but let us see \nhow the circuit is reacting in static calculations", "of MOSFET, and when Q6 is in full saturation, the MOSFET is off because source \nto drain voltage is zero. We will review the dynamic behavior later, but let us see \nhow the circuit is reacting in static calculations by using bias points.  Battery             Fuse\nLow-side Switch\nMOSFET\nLoad\nMOSFET Drive\n Digital Port\nProtection\n Digital Port Level ShiftMicro \n  Fig. 5.24    Low side driver application diagram        5.5  Low-Side Output Device Driverzamann@us.panasonic.com\n168\n5.5.5     Bias Point Analysis Low-Side Switch Is Off \n In Fig.  5.26 , bias point calculations simulated at 5 V or logic 1. As computed, the \nlow-side switch is not conducting and the logic at microcontroller is indicating logic \n1. This is very important for the software to know that switch is off. The other place \nis vehicle wiring showing no voltage drop. (13.50\u201313.50)   0PSMN025-100DR42\n0.102 1L2\n0.25uH1 2\nVEHICLE WIRING SIMULATIONV+\nVIV-\nR39\n1.22\n10V7\n13.5\nD4BZV55C4V7 R40\n1K2\n1\n0\nQ6\nBCR103R41\n1k2 1\nC7\n.1u\n12\nSIMULATING MICRO OUTPUTInfineonVcontrol[0 +5V]\nV10\n5\n0SIMULATING\nDEVICE LOAD\nSIMULATING MICRO INPUT\nR46\n1000K\n21\n0R43\n1K2 1\nR44\n1.2k2\n1\nR45\n1.2K2\n1\n  Fig. 5.25    Low side driver schematics with feedback        5 Fundamental Blocks Designzamann@us.panasonic.com\n169\n5.5.6     Bias Point Analysis: Low-Side Switch Is On \n In Fig.  5.27  bias point calculations simulated at 0 V or logic zero meaning the switch \nhave to be completely turned-on. As computed, the low-side switch is in full- saturation \nand the logic at microcontroller output logic has programmed", " 5.27  bias point calculations simulated at 0 V or logic zero meaning the switch \nhave to be completely turned-on. As computed, the low-side switch is in full- saturation \nand the logic at microcontroller output logic has programmed it to logic zero.  \n At the simulated microcontroller input, it is reading 186.4 \u03bcV , which is logic 0, so \nthe software must treat logic zero as the switched-on condition. On the contrary, the \nlogic 1 reads when the switch is off. The other place to look is vehicle wiring, show-\ning voltage drop of 64 mV (13.50\u201312.48), which is valuable information to learn \nabout the actual voltage 12.48 at the load after a drop of 64 mV . The most critical \nthing is to note that the overall current passing through the MOSFET is around \n10 A. The simulations are performed at ambient temperature of 25 \u00b0C, however if we \nperform the temperature envelop testing, we can \ufb01  ne tune the design for summer and \nwinter temperatures.   \n  Fig. 5.26    Bias point calculations at V10 = 5 V        5.5  Low-Side Output Device Driverzamann@us.panasonic.com\n170\n5.6     High-Side Output Device Driver \n5.6.1     Abstraction Level 3: Descriptive Statement \n We de\ufb01  ne here a high-side driver to drive an external load. The key features listed \nbelow:\n\u2022    The high-side driver is required to drive a load connected to the switch.  \n\u2022   The high-side driver must provide power to the load when logic level 1 is applied  \n\u2022   The high-side driver must turned-off power to the load when logic level 0 is \napplied  \n\u2022   The high-side driver must be capable of delivering 6 A of load current  \n\u2022   The microcontroller must be able to read the status of the high-side driver, so that \nit could know if the control applied is the control achieved.    \n  Fig. 5.27    Bias point calculations at V10 = 0 V        5 Fundamental Blocks Designzamann@us.panasonic.com\n171\n This high-side driver must have to have additional circuit to report to the micro-\ncontroller that the load has received the power and it is operating appropriately after \nthe", " V        5 Fundamental Blocks Designzamann@us.panasonic.com\n171\n This high-side driver must have to have additional circuit to report to the micro-\ncontroller that the load has received the power and it is operating appropriately after \nthe command from the microcontroller executed.  \n5.6.2     Abstraction Level 2: A High-Side driver Block Diagram \nwith a Truth Table \n The simple block diagram is showing how the high-side driver connected to the \npower, load and the MOSFET drive. The MOSFET drive is taking commands from \nthe microcontroller, and when the logic 1 applies, the load is energize because the \nMOSFET switch will provide power to the load. \n The truth table shows MOSFET drive will drive the MOSFET Switch to provide \npower to the load when logic 1 is applied, however on the contrary the power to the \nload will not be switched to the load when logic 0 is applied\u2014disabling the load to \nget energized (Fig.  5.28 ).   \n5.6.3     Abstraction Level 1: High-Side Driver Designed Blocks \nand Interfaces \n The high-side switch designed block diagram is showing how the load, connected \nto the high-side switch that is connected to the power. The high-side MOSFET \nswitch gate has driven by the MOSFET drive. There is a feedback mechanism with \nVdc\nMdrive\nPower\nMOSFET Switch\nOFF\nONFeedback\nGndPower\nTruth TableMOSFET Switch\nMdrive\nLogic 0\nLogic 1LoadMOSFET Drive\n  Fig. 5.28    High-side driver abstraction level 2        5.6  High-Side Output Device Driverzamann@us.panasonic.com\n172\nprotection and level translation mechanism to transfer information back to the \nmicrocontroller whether the load has energized or not energized. This closed-loop \nincorporated for the software to verify if the intended operation was indeed success-\nful. Nevertheless, when the software sees unsuccessful results it kicks-off fail-safe \nstrategy algorithm to mitigate the impact to the system operational features. As a \nstandard practice, fuse is connected between the path of energizing source (battery), \nto the high-side switch and \ufb01  nally to the load (Fig.  5.29 ).", " impact to the system operational features. As a \nstandard practice, fuse is connected between the path of energizing source (battery), \nto the high-side switch and \ufb01  nally to the load (Fig.  5.29 ).   \n5.6.4     Abstraction Level 0: High-Side Driver Schematics \n Figure  5.30  represents high-side switch as the abstraction level 0, where the hard-\nware has fully de\ufb01  ned with actual components selected for the design.  \n The schematics is showing the components with simulated microcontroller out-\nput, simulated microcontroller input port and power to the high-side switch. The \nPCB trace simulation has added to check voltage drop across the traces because the \nn-channel MOSFET can be place on a circuit board. \n As depicted V11 is simulating the microcontroller output, so that it can be switch \nto logic-zero or logic-one. The microcontroller input port simulated at 1,000 K and \nit is reading the high-side switch status, so when the switch has turned-on it reads \nlogic 1, and when the switch has turned-off, it reads logic 0. \n The Zenor diode D4 is place to limit the voltage at 4.7 V and additionally to the \nvoltage divider to feed logical voltage to the simulated microcontroller input port. \nThe D4, R52, R53 and R54 are performing the protection and level translation. \n We have installed \ufb01  ve probes to the circuit, one voltage-probe at the digital \n transistor, one current-probe at high-side switch and one voltage-probe to the input Battery             Fuse\nHigh-side Switch\nMOSFET\nLoad\nMOSFET Drive\n Digital Port\nProtection\nLevel ShiftMicro \n  Fig. 5.29    High side driver application diagram        5 Fundamental Blocks Designzamann@us.panasonic.com\n173\nof the microcontroller. The last two probes installed across the PCB trace resistor \nsimulator to measure the voltage drop across the PCB traces. \n We will review the dynamic behavior later, but let us see how the circuit is react-\ning in the static calculations by using bias points.  \n5.6.5     Bias Point Analysis: High-Side Switch-On \n The high-side switch shown in switched-on condition. The current draw at the load \nis ", " circuit is react-\ning in the static calculations by using bias points.  \n5.6.5     Bias Point Analysis: High-Side Switch-On \n The high-side switch shown in switched-on condition. The current draw at the load \nis 6.40 A. The voltage drop across the PCB traces is 64 mV (13.50\u201312.86). It is \nimportant information for the PCB designers in order to compensate for the VI\nVV- V+\nV 10A/20Vmmsf4205/ON\n0R47\n0.102 1PCB Trace Simulation\nR48\n22\n10V8\n13.5\nD5BZV55C4V7 R49\n3302\n1\n0Q9\nBCR103R50\n1k2 1\nC8\n.1u12\nSIMULATING MICRO OUTPUTVcontrol[0 +5V]\nInfineonV11\n0\n0SIMULATING\nDEVICE LOADSIMULATING MICRO INPUT\nR51\n1000K\n21\n0R52\n1K2 1\nR53\n1.2k2\n1\nR54\n1.2K2\n1\n  Fig. 5.30    High side driver schematics with feedback to microcontroller        5.6  High-Side Output Device Driverzamann@us.panasonic.com\n174\nhigh- current load factor that must account for a better trace width, and grounding. \nThere are design rules checks (DRC) for the PCB layout where this information \nneeds to be factor in for better performance. \n The simulating microcontroller output selected at 5 V and the read out at the digital \ntransistor Q9 is showing full-saturation as the current \ufb02  ows through is about 39 mA. \nThe high-switch is in full conduction state and 6.40 A of current is \ufb02  owing through \nthe load. \n The simulating microcontroller input is reading logic 1 to convey to the software \nthat the high-side switch had turned-on after the software had sent the command to \nturn it on (Fig.  5.31 ).   \n5.6.6     Bias Point Analysis: High-Side Switch Cut-Off \n The high-side switch shown in switched-off condition. The current draw at the load \nis ", "turn it on (Fig.  5.31 ).   \n5.6.6     Bias Point Analysis: High-Side Switch Cut-Off \n The high-side switch shown in switched-off condition. The current draw at the load \nis 13.52 \u03bcA. The voltage drop across the PCB traces is zero (13.50\u201313.50). \n The simulating microcontroller output selected at 0 V and the read out at the \ndigital transistor Q9 is showing cut-off state as the current \ufb02  ows through it is about \n  Fig. 5.31    Bias point calculations at V11 = 5 V        5 Fundamental Blocks Designzamann@us.panasonic.com\n175\n17 pA. The high-side switch is not in conduction state and a 13 \u03bcA of current is \n\ufb02 owing through the load. \n The simulating microcontroller input is reading logic 0 to convey to the software \nthat the high-side switch had turned off after the software had sent the command to \nperform a switch off condition (Fig.  5.32 ).   \n5.6.7     Simulation Analysis: High-Side Switch \n Figure  5.33  is showing how each probe has gathered data when the simulating \nmicrocontroller voltage has changed from logic 0 to logic 1. The gate to drain volt-\nage shows conduction has begun around ~2 V and NMOS switch is in full- saturation \nwhen it is near zero. The load-current of 6.4 A indicates that NMOS switching is \nvalid and the electrical current is passing through the load. Also can be seen is the \nvoltage-drop.     \n  Fig. 5.32    Bias point calculations at V11 = 0 V        5.6  High-Side Output Device Driverzamann@us.panasonic.com\n176\n5.7     B+ Detection Block \n5.7.1     Abstraction Level 3: Descriptive Statement \n We de\ufb01  ne B+ Detection block as follows:\n\u2022    The B+ Detection block will monitor the abrupt battery voltage drop  \n\u2022   The B+ Detection block will detect the voltage \u22648.5 V  \n\u2022   The B+ Detection block will detect the voltage \u22659 V  \n\u2022   The B+ Detection block will immediately declare abnormal condition if the \n voltage falls below a certain threshold  \n", "+ Detection block will detect the voltage \u22648.5 V  \n\u2022   The B+ Detection block will detect the voltage \u22659 V  \n\u2022   The B+ Detection block will immediately declare abnormal condition if the \n voltage falls below a certain threshold  \n\u2022   The B+ Detection block will not declare any abnormal condition if the voltage is \nabove to a certain threshold.     \n5.7.2     Abstraction Level 2: B+ Detection Block Diagram \nwith a Truth Table \n The simple block diagram is showing how the B+ detection is being realize. It is \nfeeding the B+ detection block and then generating a fast output to inform that bat-\ntery voltage is going down. \n The truth table shows when B+ voltage is below 8 V , the detection-circuit trig-\ngers a logic 0 to the microcontroller. In the second scenario when the voltage is \ngreater than 9 V , it changes to logic state 1 (Fig.  5.34 ).   V_V110V 0.5V 1.0V 1.5V 2.0V 2.5V 3.0V 3.5V 4.0V 4.5V 5.0V\nV(Q9:3) V(R47:1,R49:2) V(R54:2) I(10A/20V:s) V(Q9:1)051015\nDROP ACROSS WIRINGMICRO OUTPUTSWITCH STATUSREAD BY MICROGATE T TO DRAIN VOLTAGE\nLOAD CURRENT ~6.40A\n  Fig. 5.33       Simulation conducted with Five Data Probes        5 Fundamental Blocks Designzamann@us.panasonic.com\n177\n5.7.3     Abstraction Level 1: B+ Detection Designed Blocks \nand Interfaces \n The B+ Detection designed block diagram is showing how the battery connected to \nthe low-voltage detector, and then to a level translator to inform microcontroller that \nthe battery voltage has suddenly dropped and the software must perform housekeep-\ning tasks to store critical information deemed necessary to the memory registers. \nLike for example, many customer settings, which were stored before the battery \nvoltage had abruptly dropped below the threshold (Fig.  5.35 ).   \n5.7.4     Abstraction Level 0: B+ Detection Schematics \n Figure  5", " settings, which were stored before the battery \nvoltage had abruptly dropped below the threshold (Fig.  5.35 ).   \n5.7.4     Abstraction Level 0: B+ Detection Schematics \n Figure  5.36  represents B+ Detection schematics as the abstraction level 0, where the \nhardware fully de\ufb01  ned with actual components selected for the design.  \n The schematic is showing the components with simulated microcontroller input \nand simulated battery voltage source. \n The Zenor diode D1 and resistor R2 are place to limit the voltage to set the \nthreshold of detection. Q4 and Q5 perform the switching and inform to the micro-\ncontroller that the battery voltage has suddenly dropped. We had explained earlier \nthat this block is essential to give software enough time to execute housekeeping \ntasks. In other words, this input to the microcontroller is like a non-maskable inter-\nrupt triggering a service routine to store all the critical information related to cus-\ntomer and the memory. B+ Micro \n<=8.5V Logic 0\n>=9V Logic 1Truth TableB+\nB+ Detection  Fig. 5.34    B+ detection block \nabstraction level 2        5.7  B+ Detection Blockzamann@us.panasonic.com\n178\n We have installed two probes to the circuit, one voltage-probe at the battery volt-\nage, and the second probe to the microcontroller input. The simulation programs the \nbattery voltage to go from 0 to 15 V to check what happens to the microcontroller \ndigital input. \n In Fig.  5.37 , the circuit is simulated and it is showing that when the battery volt-\nage is at \u22659 V , the microcontroller input port is reading logic 1 and when the voltage \nis below 8.5 the logic 0 is being read.   \n5.7.5     Temperature Envelop Testing \n The tests shows variation of B+ detection at the microcontroller port for 27, 70 and \n\u221240 \u00b0C, the operational envelop is 8\u20139 V (Fig.  5.38 )    Battery \n     Digital PortLevel \nTranslatorLow Voltage \nDetector\nMicro   Fig. 5.35    B+ detection \nabstraction level 2       \nR2\n3.3KR3\n1k\nV1\n", "38 )    Battery \n     Digital PortLevel \nTranslatorLow Voltage \nDetector\nMicro   Fig. 5.35    B+ detection \nabstraction level 2       \nR2\n3.3KR3\n1k\nV1\n8V2\n5VR5\n1000K\n0Q4\nBCR103Q5\nBCR158\nD1\n1N4099\n12Simulating Battery VoltageSimulating Micro Port\nC1\n.01uV\nV\n  Fig. 5.36    B+ detection abstraction level 0        \n 5 Fundamental Blocks Designzamann@us.panasonic.com\n179\n5.8     B+ Monitoring Block \n5.8.1     Abstraction Level 3: Descriptive Statement \n The purpose of this monitoring block is to engage and disengage voltage \noperational envelop of the intended module design. The software has the \nauthority to log faults or no-faults or downgrade the functional performance. A deg-\nradation of performance is possible based on module classi\ufb01  cation. It is for this very \nreason that the monitoring is done \u201c24/7\u201d hours, minutes and every seconds. We \nde\ufb01 ne B+ Monitoring block as follows:\n\u2022    The B+ Monitoring requires monitoring the B+ voltage  \n\u2022   The B+ Monitoring is performed to determine the actual battery voltage at all \ntimes  \n\u2022   The B+ Monitoring performs by the microcontroller ADC port.     V_V10V 1V 2V 3V 4V 5V 6V 7V 8V 9V 10V 11V 12V 13V 14V 15V\nV(R2:1) V(R5:2)0V5V10V15V\nMicro Detection PortB+ Voltage\n  Fig. 5.37    B+ detection simulation       \nV_V10V 1V 2V 3V 4V 5V 6V 7V 8V 9V 10V 11V 12V 13V 14V 15V\nV(R2:1) V(R5:2)0V5V10V15V\n  Fig. 5.38    B+ detection simulation at 27, 70 and \u221240 \u00b0C        \n 5.8  B", "(R2:1) V(R5:2)0V5V10V15V\n  Fig. 5.38    B+ detection simulation at 27, 70 and \u221240 \u00b0C        \n 5.8  B+ Monitoring Blockzamann@us.panasonic.com\n180\n5.8.2     Abstraction Level 2: B+ Monitoring Block Diagram \nwith a Truth Table \n The simple block diagram is showing how the B+ monitoring carries out. The B+ \nline feeding the B+ monitoring block and then sending this to the microcontroller \nADC port. The truth table shows B+ voltage is being monitored in the range of \n0\u201315 V , if the voltage exceeds 15 V or go below 0 V , the system will respond as out \nof range (Fig.  5.39 ).   \n5.8.3     Abstraction Level 1: Designed Blocks and Interfaces \n The abstraction level 1 designed blocks are shown in Fig.  5.40 , where battery volt-\nage is being scaled down to be handled by the microcontroller system after a protec-\ntion is placed to avoid any exceedingly unwanted overvoltage condition.   \n5.8.4     Abstraction Level 0: B+ Monitoring Schematics \n Figure  5.41  B+ Monitoring schematics as the abstraction level 0, where the battery \nvoltage is realized at full scale 16 V , and the voltage divider is realized to read full- \nscale 5 V , so keeping the microcontroller ADC ports safe and within the range.  \n The simulation conducted in Fig.  5.42  shows the battery voltage-range and the \nscaling to the ADC port. The accuracy of measured values is the subject to number \nB+ Micro \n0-15V A/D PortB+ Monitoring\nTruth TableB+  Fig. 5.39    B+ monitoring \nblock abstraction level 2        5 Fundamental Blocks Designzamann@us.panasonic.com\n181\nof bits used by the ADC port. A 10 bits to 12 bits ADC suf\ufb01  ce to monitor the battery \nvoltage to engage or disengage the operational envelop of the automotive intended \nmodule design.   \n Two additional factors also require attention for the design, a very stable ADC \nreference voltage required by every ADC as a standard design practice, and the \npower supply used", " to engage or disengage the operational envelop of the automotive intended \nmodule design.   \n Two additional factors also require attention for the design, a very stable ADC \nreference voltage required by every ADC as a standard design practice, and the \npower supply used by the ADC like 5 or 3.3 V . If the microcontroller is functioning \nat 3.3 V then the scaling must re\ufb02  ect 3 V full-scale and if it is operating at 5 V then \nit could go to 5 V .   \n5.9     Input Signal Senor Block \n There are many types of sensor used in a typical vehicle like knock sensor, pres-\nsure sensor, mass-air \ufb02  ow senor, rain sensor, windshield washer sensor, cam-\nshaft position sensor, wheel-speed sensor, sun-load sensor, ambient light sensor, \nposition sensor so on and so forth. In all cases, the physical existence of quantity Battery \n     A/D PortProtection\nMicro Voltage \nScaling  Fig. 5.40    B+ monitoring \nblock abstraction level 1       \nV3\n13.5R8\n1000K\n012\nSimulating Battery Voltage10bit ADCPort\nR9\n47KR10\n100K\nVV\n  Fig. 5.41    B+ monitoring block abstraction level 0        \n 5.9  Input Signal Senor Blockzamann@us.panasonic.com\n182\nmust converted into electrical voltage or current, so that it can be present as dis-\ncrete, analog or digital format. The typical applications of sensors are being real-\nized by utilizing many different types of sensors like piezoelectric, optical, \nhall-effect, capacitive, thermocouple (Peltier effect principle) or by many other \ntype of sensing mechanism. \n A fundamental principle applies that electrical signal proportional to the physical \nquantity must be converted to a well-de\ufb01  ned electrical scale readable by the elec-\ntronics. The correlation of sensing quantity verses electrical representation can be \nde\ufb01 ne by a transfer function. The transfer function dictates how the software must \nfunction based on the input range of the senor. It is critical to accurately de\ufb01  ne and \nmeasure the physical quantity, lots of upfront work is required before a reliable, and \nrepeatable measurement is established. \n However, transfer function is additionally dependent on the electronics inter-\nfaced", " It is critical to accurately de\ufb01  ne and \nmeasure the physical quantity, lots of upfront work is required before a reliable, and \nrepeatable measurement is established. \n However, transfer function is additionally dependent on the electronics inter-\nfaced with the sensor, so no matter how accurate, repeatable and perfect a sensor \ncan be; the signal conditioning electronics is the key factor for the accurate mea-\nsurements. To make an accurate signal-conditioning network, a lot of upfront \ndetailed design work must complete, where tolerance of components over the oper-\national envelops must satisfy accurate representation of signal and mitigate the \nmeasurement inaccuracies.  \n5.10     Reset Block \n A reset is an input to the microcontroller to initiate code execution stored in a pre- \nde\ufb01 ned memory space directed by the reset vector. Reset line in some of the micro-\ncontrollers is bidirectional to allow other devices to get reset signal from the \nmicrocontroller. Nevertheless, reset is an extremely sensitive circuit that must be V_V30V 1V 2V 3V 4V 5V 6V 7V 8V 9V 10V 11V 12V 13V 14V 15V 16V\nV(R10:2) V(R8:2)0V4V8V12V16V\nVoltage at ADC PortBattery Voltage\n  Fig. 5.42       B+ monitoring simulation battery scaling to ADC port        5 Fundamental Blocks Designzamann@us.panasonic.com\n183\ndesign with great care. In order to send a reset correctly, the power to the microcon-\ntroller must also be monitor by a voltage detector to track stable output by the aid of \ncomparators, and after that, a valid reset signal is issued to the microcontroller. \n5.10.1     Abstraction Level 3: Descriptive Statement \n\u2022     The reset pulse must be generated when the input voltage above a pre-de\ufb01  ned \nvalue  \n\u2022   The reset pulse must not be generated if it is not in the pre-de\ufb01  ned window of \noperation  \n\u2022   The reset pulse must reject all sorts of noise and should not spuriously issue a \nreset pulse to the microcontroller.     \n5.10.2     Abstraction Level 2: Reset Block Diagram \nwith a Truth Table  \n The simple", "\u2022   The reset pulse must reject all sorts of noise and should not spuriously issue a \nreset pulse to the microcontroller.     \n5.10.2     Abstraction Level 2: Reset Block Diagram \nwith a Truth Table  \n The simple block diagram is showing how the reset achieved in typical microcon-\ntroller environments. The supply voltage detected by the detector circuit, and fed to \nthe comparator. The comparator determines if the supply set point has reached sta-\nble condition to send signal to a triggering mechanism that issues a valid reset \n(Fig.  5.43 ).   \n5.10.3     Abstraction Level 1: Reset Block Designed Blocks \nand Interfaces \n This a power-on reset topology, so when the regulated power providing power to the \nmicrocontroller is stabilized; a reset is issued to the microcontroller. As could be \nnoticed that the regulated power is feeding the reset electronics and as well as the \nmicrocontroller. If you are thinking that there has to be, a delay added to the reset \ncircuit before the reset has issued then you are right in your understanding\u2014we \nneed to give enough time for the microcontroller power to stabilize before a reset \nhas issued to the microcontroller. On top of that, it is extremely important to wait for \nthe crystal clock provided to the microcontroller is stabilize. We need to make sure \nthat the power to microcontroller and the crystal clock is stabilize before a valid \nreset has issued (Fig.  5.44 ).   5.10  Reset Blockzamann@us.panasonic.com\n184\n5.10.4     Abstraction Level 0: Reset Block Schematics \n There are many options in the form of off-the-shelf reset IC is available in the mar-\nket that can be utilize in the module reset circuit design. These integrated circuits so \ncleverly designed that it captures the under-voltage, and/or over voltage set-pints to \nissue a valid reset. Also embedded is the \ufb02  exibility to adjust the set points, and the \n\ufb02 exibly of adjusting the incoming voltage being monitored. \n These integrated circuits are extremely bene\ufb01  cial in the industry to countermea-\nsure false and spurious reset issues mainly due to the advantages of precise com-\nparator threshold adjustments made inside the silicon chip. The variations over the \ntime and temperature has known, and guaranteed. The", " cial in the industry to countermea-\nsure false and spurious reset issues mainly due to the advantages of precise com-\nparator threshold adjustments made inside the silicon chip. The variations over the \ntime and temperature has known, and guaranteed. The accuracy of such scale is \ndif\ufb01 cult to achieve if discrete components have made to work on a printed circuit \nboard for a particular application or a module design. An important aspect of auto-\nmotive module microcontroller\u2019s reset worth sharing is the fact that some modules Supply Voltage\nDetector Comparator Trigger\nReset\nSupply Voltage Reset\nUnstable No Reset\nStable Apply ResetTruth Table\n  Fig. 5.43    Reset block abstraction level 2       \nRegulated Output\n        ResetComparatorDetec/g415on\nMicro \nDelayed Trigger\n  Fig. 5.44    Reset block abstraction level 1        \n 5 Fundamental Blocks Designzamann@us.panasonic.com\n185\nreceives reset only once in lifetimes in a vehicle, and after that\u2014protected by the \nsmart software restarts as long as battery is alive and connected. \n There were \u2018old school times\u2019 when a pulled-up RC circuit could be added with \na Schmidt trigger on to the reset line of a Zilog Z-80 microprocessor, and that actu-\nally works in the lab, however in today\u2019s vehicle harsh electrical environments, \nthose days are over. The automotive design space has already learned many tricks of \nthe trade to make a reliable and robust reset design and strategy for a typical system, \nmodule and components due to inherently noisy environments inside the vehicle. \n Microchip Technology Incorporated had introduced the concept of brown-out- \nreset in their line of microcontrollers. Where a low voltage detection namely brown-\nout- detection (BOD) generates a brown-out-reset (BOR) to keep the microcontroller \nunder safe operational envelop, it has determined that a low-voltage paradox could \ninitiate a false binary data in the memory, triggering an unpredictable program exe-\ncution lead to a data or code error in the memory bits i.e. operation-code or \noperation- end (OP-CODE, or OPERAND) \n A long-duration sustained brownout condition in an automotive module design \nis avoidable because there is a well-de\ufb01  ned low-voltage detection mechanism that \nkicks-off an early warning. The early-warning triggers the shutdown sequence algo-\nrithm already retained", " brownout condition in an automotive module design \nis avoidable because there is a well-de\ufb01  ned low-voltage detection mechanism that \nkicks-off an early warning. The early-warning triggers the shutdown sequence algo-\nrithm already retained in the artwork of module fundamental blocks. Nevertheless, \nat the start-up sequence a narrow window of reset brownout condition could be a \npossibility, which require counter measure by designing a reliable power supply that \npasses the tight transient and thermal pro\ufb01  le over a wide range of input voltages. \nA gradient of input voltage and temperature on a slow test pro\ufb01  le is the key require-\nment to make sure that the reset functions engages and disengages correctly in the \nreal world. At the end of the day, nonetheless, the actual electronics hardware must \nundergo detailed electrical and thermal overstress not just the EDA software tools. \n The TPS3700 is an off-the-shelf reset integrated circuit manufactured by \nTexas Instruments to function as a reset circuit, it monitors the incoming voltage \nwith set points that could generate active-low and active-high reset signals. \nThe device can be utilize as a window comparator or as an independent comparator \nfor two  different supplies monitoring. It is design to work with wide power supply \nrange of 1.8\u201318 V . The details of many different types of applications are available \nby looking at the data-sheet of TPS3700. \n The TPS3700 simulated in TINA and presented in Fig.  5.45 . The application \ncircuit is placed with three test probes namely  SENSE1  ,  OUTA  :  2 ,  OUTB  :  3 . The \nR1, R2 and R3 are adjusted to set the trigger points. It is subject to the application \nto tailor the design as per needs and wants of the microcontroller reset.  \n The voltage being monitored is simulated using V_MON voltage generator, pro-\ngrammed to 15 V max with an interval of 1 ms ramp-up, 1 ms constant and then \n1 ms ramp down. \n A time domain transient analysis is conducted for 3 ms to see how the window \ncomparators are responding when the incoming voltage V_MON is applied through \nR1, R2 and R3, where relationship of R1, R2 and R3 are explained in the datasheet \n", "3 ms to see how the window \ncomparators are responding when the incoming voltage V_MON is applied through \nR1, R2 and R3, where relationship of R1, R2 and R3 are explained in the datasheet \nof TPS3700 2  (Fig.  5.46 ).  \n2   Texas Instruments Data sheet TPS3700-Q1 SLVSCI7A\u2014March 2014\u2014Revised April 2014. 5.10  Reset Blockzamann@us.panasonic.com\n186\n It is always a best practice to review the data sheet with great care to under-\nstand the part usage recommended design practice. After all, the integrated elec-\ntronics is solely design by the semiconductor manufacturer, but the buyer is \nadapting that \u2018baby\u2019 for his own interest, and environment. Another example uses \ntwo separate power supplies being monitored V_MON1 and V_MON2 (Figs.  5.47  \nand  5.48 ).     \n5.11     Reverse Battery \n A reverse battery protection block is essential for all modules intend to be install in \nvehicles where battery is the primary source of energy. The reverse battery protec-\ntion is part of a \u2018packaged deal\u2019 namely safety and protection mechanism that V1 3.3 C1 100n\n+\nV_MONR1 2.5M\nR3 69.3kR2 13.7kR4 49.9k R5 49.9kSENSE: 1\nOUTA: 2\nOUTB: 3\nTPS3700\nTRANSIENT MODELINA+\nGND INB-OUTBVDD OUTA\nU1 TPS3700_TRANS\n  Fig. 5.45    Reset block abstraction level 0       \nSENSE\nOUTA\nOUTB\nTime (s)0.00 1.00m 2.00m 3.00mSENSE\n0.0020.00\nOUTA\n0.004.00\nOUTB\n0.004.00\nOUTBOUTASENSE\n3.3V\n11.5V13.1V\n  Fig. 5.46    Reset timing simulation        \n 5 Fundamental Blocks Designzamann@us.panasonic.com\n187\nincludes double battery, and load-dump. It is", "V\n11.5V13.1V\n  Fig. 5.46    Reset timing simulation        \n 5 Fundamental Blocks Designzamann@us.panasonic.com\n187\nincludes double battery, and load-dump. It is assume in this section for this block \nthat other two protections are already in place. The reverse battery protection can be \nachieve by deploying three different topologies:\n\u2022     Topology 1 : \n A series diode be utilize if the module is not consuming high current and the \ndrop-across the diode will not impact the safe operational envelop of the module \nfunctions under extreme conditions.  \nV1 3.3 C1 100n\nR1 2.2M\nR3 100kR4 49.9k R5 49.9k\nOUTA:2\nOUTB:3\nTPS3700\nTRANSIENT MODELINA+\nGND INB-OUTBVDD OUTA\nU1 TPS3700_TRANS+\nV_MON2R2 100k\nR6 390k\n+\nV_MON1\n  Fig. 5.47    Reset schematic monitoring two separate sources       \nOUTA\nOUTB\nV_MON 1\nV_MON 2\nTime (s)0.00 1.00m 2.00m 3.00mOUTA\n0.004.00\nOUTB\n0.004.00\nV_MON1\n0.0020.00\nV_MON2\n0.005.00\nV_MON 2V_MON 1OUTBOUTA\n  Fig. 5.48    Reset timing two separate sources simulation        \n 5.11 Reverse Batteryzamann@us.panasonic.com\n188\n\u2022    Topology 2:  \n A reversely placed diode be utilize if the vehicle fuse is require to blow under \nreversed battery polarity condition. A detailed analysis is require to carry out to \nmake sure that the fuse sizing and timing is correct for \u2018both parties\u2019 and not \n\u2018hurting\u2019 each other. A slow-fuse or over-rated fuse size could easily \u2018toast\u2019 the \nmodule electronics, or traces.  \n\u2022    Topology 3 : \n An MOSFET switch can be utilize serving two purposes: \n     1.    It will not allow reverse current to \ufb02  ow due to source to", " \nmodule electronics, or traces.  \n\u2022    Topology 3 : \n An MOSFET switch can be utilize serving two purposes: \n     1.    It will not allow reverse current to \ufb02  ow due to source to drain reverse \nbiasing   \n   2.    It will give gate control to the microcontroller to actually turn-off or turn-on \nthrough the gate   \n   3.    It can be wire in either topology i.e. a high-side switch or a low-side switch   \n   4.    It can be place at either the battery + line or battery negative line        \n If it is desire to make use of gate control to apply or remove module power then \nthere is one pre-condition to meet to utilize the MOSFET switch. The microcon-\ntroller must be power up by a separate source, so that the gate control is achieve. \n In case it is not required to control the switch then the gate can be bias directly \nfrom the source power. \n5.11.1     Abstraction Level 3: Descriptive Statement \n\u2022     Design a circuit where a series diode could protect against the reverse battery \nconnections de\ufb01  ned in Topology 1  \n\u2022   Design a circuit where a reversely placed diode could protect against the reverse \nbattery connections de\ufb01  ned in Topology 2  \n\u2022   Design a circuit where a MOSFET could protect against the reverse battery \n connections de\ufb01  ned in Topology 3     \n5.11.2     Abstraction Level 2: Reverse Battery Series Diode Block \nDiagram with a Truth Table \n A simple block diagram of Topology 1 is showing how the series diode is not \n allowing a reverse polarity damaging impact be applied to the module electronics \n(Fig.  5.49 )  \n A simple block diagram of Topology 2 is showing how the reverse diode is utilize \nto blow vehicle system fuse before any harm to the electronics. The key factors in \norder to successfully blow the fuse, rests on fuse timing, fuse characteristic, module \nelectronics components, and off-course the printed circuit board traces (Fig.  5.50 ).  5 Fundamental Blocks Designzamann@us.panasonic.com\n189\n A simple block diagram of Topology 3 is showing how a MOSFET switch is \nutilized to protect against the reverse polarities, what", ".50 ).  5 Fundamental Blocks Designzamann@us.panasonic.com\n189\n A simple block diagram of Topology 3 is showing how a MOSFET switch is \nutilized to protect against the reverse polarities, what it does, it never allows current \nto \ufb02 ow through the circuit when battery polarity is reversed\u2014essentially means no \ndamage to the electronics\u2014because MOSFET gets reversed biased due to battery \nreversed polarity. An added advantage is gate control that allows external control if \nneeded by the module design. However, it is an option available for the design engi-\nneer (Fig.  5.51 ).   \nVin\nVin\nReverse Polarity\nCorrect PolarityModule\nSeries Diode\nElectronics\nNo Power\nNormal PowerModuleTruth Table  Fig. 5.49    Reverse battery \nseries diode abstraction \nlevel 2       \n   Module\nVin Fuse\nVin\nReverse Polarity\nCorrect PolarityReverse Diode\nElectronicsVehicle\nTruth Table\nModule\nBlown Fuse\nNormal Power\n  Fig. 5.50    Reverse battery reverse diode abstraction level 2        \n 5.11  Reverse Batteryzamann@us.panasonic.com\n190\n5.11.3     Abstraction Level 1: Reverse Battery Designed Blocks \nand Interfaces \n5.11.3.1     Series Diode \n The schematics of series diode is shown here to demonstrate the fact that at the load- \ncurrent consumption of 2.25 A, it has the diode drop of 747 mV and the voltage at \nthe module is measured 11.25 V as simulated. If the module was design to handle \nthe drop across the diode, and works \ufb01  ne for all the intended functions in extreme \nvalue temperature and voltage conditions then it is a classic example of series diode \nutilization against the reverse-battery protection (Fig.  5.52 ).  \n The simulation reconstructed by connecting the battery with reverse polarity. \nThe current consumed and the voltage across the module load is showing no sign of \ndamaging current through the module. When selecting the diode keep in mind that \nthe diode junction must be capable of suppressing initial surge current when it is \nreverse biased (Fig.  5.53 ).   \n5.11.3.2     Reverse Diode \n The schematic of reversed", "ode keep in mind that \nthe diode junction must be capable of suppressing initial surge current when it is \nreverse biased (Fig.  5.53 ).   \n5.11.3.2     Reverse Diode \n The schematic of reversed diode shown below to demonstrate the fact that at load- \ncurrent of 2.39 A, the voltage across the module is 11.95 V . As could be noticed that \nwhen operating correctly the diode has no role to play, it is just an inert semiconductor- \njunction placed in reversed order. However when the polarity of the battery termi-\nnals are reversed, the diode loops back inrush-current through the fuse and passes Module\nVin\nVin\nReverse Polarity\nCorrect PolarityElectronics\nTruth Table\nModule\nNo Current\nNormal PowerMOSFET\n  Fig. 5.51    Reverse battery MOSFET abstraction level 2        5 Fundamental Blocks Designzamann@us.panasonic.com\n191\nthrough the battery path that eventually blow the fuse. It is a technique successful in \nthe real world of automotive electronics design. However, the module will not func-\ntion after the blown-fuse, so the replacement instructions must issue to the cus-\ntomer, and then the replacement of fuse must carry out to re-energize, and reinitialize \nthe module (Fig.  5.54 ).  \n The schematic shown below modi\ufb01  ed in order to place battery in reversed order. \nIt can be notice that there is no damaging current passing through the module. The \nsimulation conducted had actually showed the blown fuse by marking \u2018x\u2019 across the \nfuse. It is understandable why the fuse has blown? As we already know that battery \ncould deliver in excess of 100 A (subject to battery speci\ufb01  cation), so the weakest link \nin the circuit must \u2018surrender\u2019, and the weakest link designed to be is the Fuse. \n Yet, a \u2018dilemma\u2019 of mismatched components (fuse, diode, wiring, printed circuit \nboard trace) could damage other components. Please bear in mind that the fuse is \nnot placed inside the module, it is part of the vehicle fuse-box (Fig.  5.55 ).   D1 1N1206\nR1 5 Battery 12A+Load Current\n+\n-A?VmDVM", "not placed inside the module, it is part of the vehicle fuse-box (Fig.  5.55 ).   D1 1N1206\nR1 5 Battery 12A+Load Current\n+\n-A?VmDVM\nV+\nVModule Load11.25V-2.25A\n  Fig. 5.52    Normal battery series diode schematics abstraction level 0       \nD1 1N1206\nR1 5 Battery Reversed\nPolarityA+Load Current\nV+\nVModule Load-180.06nV36.01nA\n  Fig. 5.53    Reversed battery series diode schematics abstraction level 0        \n 5.11  Reverse Batteryzamann@us.panasonic.com\n192\n5.11.3.3     P-FET Reverse Protection \n The schematic of P-MOS reverse battery protection shown here. The gate is bias by \nthe negative potential and correctly turning the P-MOS in saturation, the current is \n\ufb02 owing normally. A potential drop across the P-MOS has measured, and displayed \nby the simulation. \n It is important to understand that the topology drawn here to convey the existence \nof an option. In this speci\ufb01  c case, for example, the drain-to-source on-resistance \n(Rds on) is high and a drop of 354 mV as recorded by the measurement DVM. In \nreal life, select an optimum P-FET with a minimum drop. Additionally, it is worth \nnoting here that a high gate-to-source voltage may be stressful to the junction, so in \norder to protect that high electrical stress, a zener protection is applied. Last but not \nthe least semiconductor companies like ST Microelectronics, International Recti\ufb01  ers \nand In\ufb01  neon have developed line of MOSFET that can be utilize in reverse battery \nprotection with additional bene\ufb01  ts of low Rds-on at higher currents. The MOSFETs \ngate can also have a soft-start to mitigate the high in-rush current of the module if \ndesired. A soft-start is a processor of slowly, ramping up the inrush current to avoid \nstresses on the module electronics (Fig.  5.56 ).  \n The schematic reconstructed by changing the battery polarity, the P-MOS is \nreverse biased, and", " a processor of slowly, ramping up the inrush current to avoid \nstresses on the module electronics (Fig.  5.56 ).  \n The schematic reconstructed by changing the battery polarity, the P-MOS is \nreverse biased, and there is no current \ufb02  owing across the module. The DVM is read-\ning 12 V indicating that the P-MOS is in the cut-off region. The load current is \n27.02 \u03bcA, positively indicating that no damaging current is \ufb02  owing through the D2 1N1183R2 5 Battery 12A+Load Current\nV+\nVFuse 3.15A\nModule Load11.95V-2.39A\n  Fig. 5.54    Reversed diode normal operation       \nD2 1N1183R2 5 Battery Reversed\nPolarityA+Load Current\nV+\nVF1 3.15A\nModule Load-60pV12pA\n  Fig. 5.55    Reversed diode abnormal operation        \n 5 Fundamental Blocks Designzamann@us.panasonic.com\n193\nmodule. The module voltage is reading 270.18 nV indicating correctly that there is \nnothing available for module to get the reversed power (Fig.  5.57 ).   \n5.11.3.4     N-MOS-FET Reverse Protection \n The schematic is reconstructed for the N-channel MOSFET connected with the bat-\ntery negative terminal, it is similar to P-MOSFET reverse protection in the earlier \nexample, however the N-MOSFET is being utilized and it is functioning correctly \nwhen the polarity is correct, and the drop across the transistor is 456 mV , the module \nis getting 11.54 V at the load current of 1.15 A (Fig.  5.58 ).  R4 10 V + \nAcross Load  Battery 12  A + Load Current  \n+ \n- A ? V - m DVM\nT1 2N6849  \nModule Load  -1.16A \n11.65V  \n  Fig. 5.56    Battery correctly connected P-MOS normal Operation       \nR3 10V+\nAcross LoadBattery Reversed \nConnectionsA+Load Current\n+\n-AVDVM\nT3 2N6849\nModule Load27.02", " 5.56    Battery correctly connected P-MOS normal Operation       \nR3 10V+\nAcross LoadBattery Reversed \nConnectionsA+Load Current\n+\n-AVDVM\nT3 2N6849\nModule Load27.02nA\n-270.18nV?\n  Fig. 5.57    Battery polarity reversal P-MOS abnormal operation        \n 5.11  Reverse Batteryzamann@us.panasonic.com\n194\n The schematic reconstructed by reversing the battery polarity, the N-MOS is \nreverse biased, and there is no current \ufb02  owing across the module. The DVM is read-\ning 12 V indicating that the P-MOS is in the cut-off region. The load current is 8 \u03bcA, \npositively indicating that no damaging current is \ufb02  owing through the module. The \nmodule voltage is reading 80 \u03bcA indicating positively that there is nothing available \nfor module to get the reversed power (Fig.  5.59 ).     R8 10 V+\nAcross LoadBattery 12A+Load Current\nT2 2N6757\n+\n-A? V- mDMM2 1kModule Load-1.15A\n11.54V\n  Fig. 5.58    Battery polarity reversal N-MOS normal operation low side       \nR9 10\nV+\nAcross LoadA+Load Current\nT4 2N6757Battery 12\n+\n-AVDMM1 1kModule Load8uA\n-80uV\n?\n  Fig. 5.59    Battery polarity reversal N-MOS abnormal operation Low Side        \n 5 Fundamental Blocks Designzamann@us.panasonic.com\n195\n5.12     Power Supply Block \n The power supply topologies that are being realize in automotive modules have \ndiversi\ufb01  ed in nature. There are different \ufb02  avors of power supply topologies avail-\nable as an option for the automotive module design team like for example:\n\u2022    Linear Regulators  \n\u2022   Discrete Regulators  \n\u2022   Switch Mode Power Supplies (SMPS)  \n\u2022   Low Dropout Regulators (LDO)    \n Linear, Discrete and Low dropout are all same family of regulators, however due \nto their different scenarios of usage these are named differently\u2014although not for-\nmally. However, it is the task of module", " Regulators (LDO)    \n Linear, Discrete and Low dropout are all same family of regulators, however due \nto their different scenarios of usage these are named differently\u2014although not for-\nmally. However, it is the task of module design team to select the regulator best \ufb01  t \nto the application. In reality, many module components inherently mandate the \n multiple uses of regulators due to different type of passive electronic devices. The \nef\ufb01 ciency of switch-mode regulators are best in class. \n For example, 3  a 12\u20133.3 V linear regulator could only achieve 27.5 % ef\ufb01  ciency \nverses more than 90 % on a buck convertor. Likewise, a buck converter offered by \nTexas Instruments TPS40200 shows 94 % ef\ufb01  ciency when the buck voltage is select \nto 5 V with input energy of 12 V at full loading of 2.5 A 4  \n Nonetheless, it is always a challenge to comply with EMC compliance when \ndeveloping SMPS solutions. It is rather a signi\ufb01  cant event in an automotive design \nspace if the SMPS could qualify EMC compliance by the \ufb01  rst iteration of a new \ndesign. Yet, switching regulators still have a strong presence in automotive design \nspace. There are pros and cons of regulator topologies, and few important ones are \ntabulate below (Table  5.1 )\n   SMPS works on the fundamental principle of inductor attributes that allows stor-\ning and releasing energy by means of specialized electronics. Inductor\u2019s \u2018mystical\u2019 \nattributes are the core fundamental block of any SMPS solution. We all understand \ninductor properties based on Faraday and Lenz\u2019s law; still a new dimension to \ninductors is the ability to store and release energy in a time-sliced fashion with mini-\nmum losses when it comes to \u2018trapped\u2019 energy by the assistance of magnetic \ufb01  eld. \nThe magnetic \ufb01  eld surrounding the inductor, \u2018self-energizes\u2019 the inductor that truly \nhelps electrical enhancement aspects of the inductor. On top of that, there is a com-\nplex interaction of magnetic and electrical \ufb01  elds, de\ufb01  ned by Maxwell Equations and \nGuess\u2019s law. These interactions governs the delightfully helpful features of", " inductor. On top of that, there is a com-\nplex interaction of magnetic and electrical \ufb01  elds, de\ufb01  ned by Maxwell Equations and \nGuess\u2019s law. These interactions governs the delightfully helpful features of SMPS \nsolutions. We will only restrict our self with \u2018energy switching phenomena\u2019. An \n\u2018energy switching phenomena\u2019 is easily understandable by reiterating the facts that \nwe can inject time-sliced energy to an inductor to get the bene\ufb01  ts of magnetic, and \nelectric properties that will allow us to scale-down or scale-up the applied energy. \n3   Source: Linear Technology application note AN140-5. \n4   Source: Texas Instruments, TPS40200 data-sheet page 16. 5.12  Power Supply Blockzamann@us.panasonic.com\n196\nAll SMPS solutions exploit the \u2018energy switching phenomena\u2019 directed to induc-\ntance effects is the heart of all switch mode power supply designs. \n There are two distinct ways; inductor energy can exploit just as a single inductor \nor dual inductor solutions. A single inductor will be more relying towards the elec-\ntrical aspects of the inductor. The dual inductors solution takes advantages of elec-\ntrical and magnetic features together, but surely more by magnetic \ufb02  ux properties. \nA magnetic \ufb02  ux rides on ferrite material comfortably, just like electrical current \nrides on copper wire quite comfortably. \n We take an example to de\ufb01  ne the usage. If two inductors are place side-by-side \nvia a shortest-possible air-gap, and an electric current is switching on the primary \ninductor then the second-inductor placed next to it, will automatically be energize \neven though it has not connected electrically. This unique feature of generating \nelectrical energy on the secondary inductor has based on the fundamental principle \nof changing magnetic-\ufb01  eld-coupling satisfying the Faradays Law of induction dis-\ncovered more than 180 years ago in 1832. The dynamics of changing magnetic \ufb02  ux \ninteraction will greatly enhance if we put a ferrite material between these two induc-\ntors. A very interesting behavior could be explained where we can say that if a pri-\nmary inductor enclosed by ferrite material interacts with the secondary-inductor it \ninduces electrical", " if we put a ferrite material between these two induc-\ntors. A very interesting behavior could be explained where we can say that if a pri-\nmary inductor enclosed by ferrite material interacts with the secondary-inductor it \ninduces electrical potential to the secondary inductor quite ef\ufb01  ciently. Nevertheless, \nthe corollary of this behavior is more exciting than the original experiment. It states \nthat the secondary inductor potential will be higher if the number of turns in the \nsecondary inductor is more than the number of turns in primary inductor, and like-\nwise if the secondary inductor turns are less than the induced potential will be less. \n On top of that, another feature highly bene\ufb01  cial in vehicle electronics is the \n bene\ufb01  t of \u201celectrical isolation\u201d. The isolation of electrical circuits by the virtue of \nmagmatic \ufb02  ux properties is the integral part of many SMPS topologies optimized \nfor variety of automotive design solutions. The isolation of high-energy electrical \ncircuits from the low-energy circuits is an added safety feature in automotive \n module design. \n SMPS uses electronic switching to store energy into the inductor and then let the \nenergy released when the switch is turned-off. This process has repeated to generate \na stable output that has \ufb01  ltered, and applied to the load. A closed-loop feedback \nmechanism, inserted to accomplish the line and load regulation. The duty-cycle \nestablishes control via the closed-loop. Additional digital control logic is required \nto optimize the design in different type of fault scenarios.    Table 5.1    Automotive module regulators topologies   \n Ef\ufb01 ciency  EMC risk  Board space  Heat \n Linear regulators  Low  Low  Medium  High \n Discrete regulators  Low  Low  High  High \n Switch mode regulators  High  High  Medium  Low \n Low dropout regulators  Medium  Low  Small  Medium 5 Fundamental Blocks Designzamann@us.panasonic.com\n197\n The EMC risks are higher due to switching speeds, dynamic switching currents, \nand switching speed of switching devices. Additional noise suppression circuits \nneed addition for speci\ufb01  c cases in order to harden the design to meet automotive \nstrict EMC compliance. The \u2018snubber-circuits\u2019 are like \u2018rescue vehicle\u2019 when it \ncomes to instantaneous rate of change, pulse rise and fall", "i\ufb01  c cases in order to harden the design to meet automotive \nstrict EMC compliance. The \u2018snubber-circuits\u2019 are like \u2018rescue vehicle\u2019 when it \ncomes to instantaneous rate of change, pulse rise and fall time, and high current \nswitching to counter-measure switch-mode power supply inherent design issues. \nThe control-loop stability is another factor critical to build a classic good stable \ndesign. Just a decade ago, designing a switch-mode-power-supply was an art, today \nit is in option available for any design engineer to get the successful power supply \nup and running in a very short time. Thanks to semiconductor companies like Texas \nInstruments, Analog Devices, NXP, Microchip, In\ufb01  neon, ST Microelectronics, \nROHM and many more who have developed powerful designs, design tools, com-\nponents, and tier-2 support networks to provide inductor coils, chokes, high- \nfrequency ferrite-core transformers, and switching devices to help customers build \nthe right kind in right time. \n The application notes by the semiconductor companies are so deeply involved \nthat you can \ufb01  nd all sorts of application drawings with actual component selection \nnotes, components placements locations, and recommended printed circuit board \nlayout to avoid pitfalls, and fallacies. \n Texas Instruments have developed line of switching power supplies that supports \nmany different types of topologies as listed below 5 :\n\u2022    Buck convertor  \n\u2022   Boost convertor  \n\u2022   Buck-boost convertor  \n\u2022   SEPIC convertor  \n\u2022   Fly-back convertor  \n\u2022   Forward convertor  \n\u2022   Two-Switched Forward convertor  \n\u2022   Active Clamped Forward convertor  \n\u2022   Half-Bridge convertor  \n\u2022   Push-Pull convertor  \n\u2022   Full-Bridge convertor  \n\u2022   Phase Shift convertor    \n The automotive design space has clearly demonstrated the lion\u2019s share of, buck, \nboost, buck-boost and \ufb02  y-back convertors. The \ufb02  y-back convertor has been exten-\nsively utilize in Vacuum Fluorescent Displays (VFD) where 20\u201356 V or more step-\n up conversions may be required to meet the needs of high anode-to-cathode voltage. \nA \ufb02 y-back convertor is a dual-inductor topology. \n5   Source, Texas Instruments Poster  http://static.el", " step-\n up conversions may be required to meet the needs of high anode-to-cathode voltage. \nA \ufb02 y-back convertor is a dual-inductor topology. \n5   Source, Texas Instruments Poster  http://static.elitesecurity.org/uploads/3/2/3253984/topologije.pdf  5.12  Power Supply Blockzamann@us.panasonic.com\n198\n The boost convertors are well suited when battery voltage needs to get boost for \ninstantaneous short-durations like start-stop events thus compensating the battery \nvoltage-dips while engine is cranking. The start-stop function deployed in newer \nvehicles is the catalyst for modern day fuel-economy where computers take control \nof engine start and stop events without any manual initiations, and are completely \ntransparent from the customer. The other application includes, but is not limited to \nboost battery voltage to a higher level of voltage to drive displays, headlamps, high \nintensity discharge lamps, high energy LED\u2019s connected in series, motors, Thin \nFilm Transistors displays or higher voltages devices. Another important application \nof boost and \ufb02  y-back convertor is far-reaching use of Class-D ampli\ufb01  ers that require \nhigher voltage to crank out more power for the expensive audio systems available \nin mid to high luxury vehicles. \n The buck convertors are well suited when battery voltage is required to be scaled \ndown to a lower voltage like for example 5, 3.3, 1.2 or 1.8 V or else. Majority of \nmodule designs could deploy multiple tapings of operational voltages needed for \nthe module and system design. \n When both topologies literally merged, it forms buck-boost convertor. The buck- \nboost convertor is well suited when tight-tolerance of regulation is required for a \nmodule that could see a wide-margin of input voltages. For example if a module is \ndesigned to function \ufb01  rmly at 12 V with a tight tolerance, but the battery operational \nenvelop ranges 9\u201316 V then a buck-boost convertor could be deployed because \nboost-block will function at lower-limits of 12 V incoming source and buck-block \nwill function at the upper-limits of incoming source of 12 V . Nevertheless, this prin-\nciple is not forcefully enforced and convertor may utilize based on", "-block will function at lower-limits of 12 V incoming source and buck-block \nwill function at the upper-limits of incoming source of 12 V . Nevertheless, this prin-\nciple is not forcefully enforced and convertor may utilize based on the needs, wants, \navailability, and development time constraints as per design team discretion. Last \nbut not the least the skills, lessons-learned, EMC compliance data, and a feasible \nbusiness case are the signi\ufb01  cant considerations before selecting the SMPS solutions \nin the corporate culture. \n The low dropout (LDO) has a recommended usage where the difference of input \nto the output voltage must maintain at a minimum level so that the device could not \ndissipate much heat. There is a pass transistor with a precision comparator to regu-\nlate incoming voltage to the required level of regulation. The linear regulators and \nlow-dropout are the same family of regulators; however, the names are interchange-\nably subject to their usage in the design. \n It is pretty advantages to drive the LDO input-rail with an existing regulated volt-\nage to get the bene\ufb01  ts of sustained regulation with minimum heat loss. Module \ndesign team can actually use a \ufb01  xed voltage high-current buck-convertor, and then \nscale down further tapings by adding Low dropout regulator for multiple usage. \n The discrete regulators are also part of linear regulator family, but these called \ndiscrete because by putting discrete components on the board, it be build. The only \ndisadvantages are more board space and excessive number of components. A down \nside of excessive number of components means manufacturing constraints like \nmore time to build parts, more parts inventory, more test point for in-circuit testing, \nparts placement etc. 5 Fundamental Blocks Designzamann@us.panasonic.com\n199\n5.12.1     Abstraction Level 3: Descriptive Statement \n We de\ufb01  ne here a switch-mode power supply block as follows:\n\u2022    Design a buck convertor to convert 12 into 5 V  \n\u2022   Design a boost convertor to convert 5 V to 12  \n\u2022   Design a low dropout to convert 5 V to 3.3 V     \n5.12.2     Abstraction Level 2: Buck Convertor Block Diagram \nwith a Truth Table \n An educational buck block diagram is shown; a piecewise", " Design a low dropout to convert 5 V to 3.3 V     \n5.12.2     Abstraction Level 2: Buck Convertor Block Diagram \nwith a Truth Table \n An educational buck block diagram is shown; a piecewise source energy is injected \nthrough a switching mechanism to an inductor that \u2018plays\u2019 with energy to perform \n\u2018inductor-magnetization-energy\u2019 interactions. An inductor unlike capacitor is a dif-\nferent type of device, it is not an energy-absorbing device like capacitor rather it is \na device that performs mystical actions with incoming energy. There it can appreci-\nate or depreciate or sustain an incoming energy pulses. The inductor sustains energy \nat the rate determined by the duration of time it gets the energy. The energy then \ntransferred to the load \u2018hungry\u2019 and \u2018waiting\u2019. The transferred energy then measured \nand a determination has made if the load requires more or less energy. If it requires \nmore energy than the duration of time to inject energy is increased and if it requires \nless energy than the duration of time to provide energy has reduced. The injection \nof energy to the inductors has many possible ways where inductance effects are \nrealize as tabulated below (Table  5.2 )\n   A dual inductor when packaged in a proper shape is refer as transformer. A trans-\nformer with ferrite core has merits to \ufb01  t for high frequency operations common to \nSMPS solutions. On the contrary, low frequency operations require iron core trans-\nformer, iron core transformers are bulky, heavy and loss of magnetic \ufb02  ux are higher. \n A classical attribute related to inductor has de\ufb01  ned as discontinuous conduction \nmode (DCM) and continuous conduction mode (CCM). A DCM operation de\ufb01  ned \nas a scenario where injected energy to the inductor has completely ejected out from \nthe inductor each time a switching cycle is completed. On the contrary, the CCM \n   Table 5.2    Inductor usage   \n Inductor (copper wire)  Energy \ntransfer rate  Magnetic \ncoupling  Energy \nlosses  SMPS \nusage  PWM \ncontrol \n Single air inductor  >100 K  Low  Low  Yes  Yes \n Single ferrite core inductor  >100 K  Medium  Low  Yes  Yes \n Single", " \nlosses  SMPS \nusage  PWM \ncontrol \n Single air inductor  >100 K  Low  Low  Yes  Yes \n Single ferrite core inductor  >100 K  Medium  Low  Yes  Yes \n Single iron core inductor  5,060,400 Hz  High  High  No  No \n Dual inductor Ferrite core  >100 K  Highest  Low  Yes  Yes \n Dual inductor iron core  5,060,400 Hz  High  High  No  Yes 5.12  Power Supply Blockzamann@us.panasonic.com\n200\nhas de\ufb01  ned as a scenario where injected energy to the inductor has partially ejected, \nand inductor always keeps some energy, so by next switching cycle it does not need \nto get full energy transfer. The DCM is more stressful to the design with reference \nto the EMC compliance of the modules (Fig.  5.60 ).  \n The truth table is showing the realization of feedback mechanism, so when the \nenergy to the load increases beyond a certain limit, \u201cFeed\u201d gets positive that means \nthe \u201cRate\u201d has to decrease thereby reducing the energy transfer to the energy stor-\nage. Likewise when the \u201cFeed\u201d is negative than the \u201cRate\u201d must be increased to \ncompensate for the energy shortage.  \n5.12.3     Abstraction Level 1: Buck Convertor Topology \nDemonstration \n A simple buck-block without the feedback mechanism shown to prove the concept. \nThe T1 switching transistor is switching at a 300 Hz frequency to transfer energy in \nthe inductor L1. The 300 Hz switching frequency is not practical in the real world, \neven so for the sake of de\ufb01  nition at abstraction level 1 we chose to use it to prove \nthe topology. The inductor L1 = 10 mH is selected just as an easy option, the purpose \nto store energy and transfer energy to the load R1 when the switching transistor \nis on, and it then releases energy to the load R1 again when the transistor is off. \nA diode D1 shown in the diagram does the magic trick of not allowing energy \n getting to the load when the transistor is off, and no energy is available from the \nenergy source either. \n A 1 K load will allow switching regulator to source about 110 mA", " in the diagram does the magic trick of not allowing energy \n getting to the load when the transistor is off, and no energy is available from the \nenergy source either. \n A 1 K load will allow switching regulator to source about 110 mA due to the \nadded factor of T1 and L1. There is no control-loop mechanism in place, so in \n reality, this is just one block of a buck convertor, and at the end of the day, the buck \nconvertor will have many more blocks (Fig.  5.61 ).     Rate\nFeedBuck Energy \nStorage\nEnergy Transfer \nto Load\nEnergy \nMeasurementEnergy \nSwitching RateEnergy\n  Fig. 5.60    Buck convertor block diagram with block diagram        5 Fundamental Blocks Designzamann@us.panasonic.com\n201\n The buck-block simulated with 300 Hz at 50 % duty cycle in order to do a quick \nsanity check and to verify if the schematic is functioning correctly, a transient anal-\nysis iconducted for 100 ms to check how the buck convertor is behaving. \n The voltage is stepped-down from 12 to 11 V and the current consumption is \n110 mA. The purpose is just to prove the point that after a 25 ms stabilization time \nthe buck-voltage is possible to achieve (Fig.  5.62 ).  \n The schematics below is modi\ufb01  ed by changing the value of capacitor to 100 \u03bcF \nand the PWM frequency is adjusted to 1 kHz with the duty cycle of 30 % and then \nto 50 % to verify that the buck-voltage is changing, so in real life when the voltage \nattempts to go up or down, the duty-cycle will manage the regulation. This is the \nmost important aspect of SMPS regulation control, but at the same time very risky \nfor the module EMC compliance due to high to low switching currents (Fig.  5.63 ).  R1 100\nEnergy\nC1 470uEnergy Interaction Energy Transfer Rate\nPWM 300PWMBuck Voltage\nLoad CurrentD1 1N1183Energy User\n  Fig. 5.61    Buck convertor schematic (partial block)       \nTime (s)0.00 25.00m 50.00m 75.00m 100.00mLoad Current\n-120.00", " Fig. 5.61    Buck convertor schematic (partial block)       \nTime (s)0.00 25.00m 50.00m 75.00m 100.00mLoad Current\n-120.00m-100.00m\nLoad Voltage\n10.0012.00\nPWM 300Hz 50%\n-10.0020.00~11V~ 110mA\n  Fig. 5.62    Buck convertor simulation at 300 Hz 50 % duty cycle        \n 5.12  Power Supply Blockzamann@us.panasonic.com\n202\n It is for this very good reason that snubber-circuits added at this point to suppress \nnegative effects of high current switching to mitigate the overall negative impact to \nthe EMC compliance. It is obvious that when the module is being testing for radi-\nated emissions the worst-case battery voltage must adjust to check the radiations at \nthe extreme value of regulation control. \n The characterization of regulation control adjusted to understand the impact of \noutput voltage verses the pulse width modulation of the switching frequency. We \nwill maintain a \ufb01  xed 1 kHz switching frequency, and only adjust the pulse width to \n30 % and then to 50 % to show the duty cycle control. \n The tests in simulation have elaborated in Fig.  5.64  below shows that at 30 % \nduty cycle the output voltage is 10.64 V verses 11.02 when the duty cycle shifted to \n50 %.  \n In the real world, the control loop will have the capability of adjusting the pulse \nwidth based on the voltage feedback or current feedback to maintain the regulated R1 100 Battery\nC1 100uL1 10mT1 2N6849\nPWM 1kPWMBuck Voltage\nBuck CurrentD1 1N1183\n  Fig. 5.63    Buck convertor schematics with revised frequency and \ufb01  lter cap       \nTime (s)0.00 25.00m 50.00m 75.00m 100.00 mLoad Current\n-120.00m-90.00m\nPWM30%, 1 KHz\n-10.0020.00\nBuck Voltage\n9.0012.00106mA\n10.64Va b\n  Fig. 5.", ".00m-90.00m\nPWM30%, 1 KHz\n-10.0020.00\nBuck Voltage\n9.0012.00106mA\n10.64Va b\n  Fig. 5.64    Buck convertor simulation 30 % 1 kHz        \n 5 Fundamental Blocks Designzamann@us.panasonic.com\n203\noutput. Figure  5.65  below shows when duty-cycle changes to 30 % at 1 kHz and \nactually outputting 10.64 V with the input of 12 V .  \n The key success and many advantages of SMPS design rests on high frequency \noperation of energy transfer. Unlike conventional design with mains frequency of \n50, 60 or 400 Hz (Avionics electrical power is 115 V , 400 Hz) the size of supporting \ncomponents are bigger, SMPS designs are different, and by the virtue of their opera-\ntion well above 100 kHz to MHz range could be built with delightfully small size of \nparts. The size of ferrite-core transformers, \ufb01  lter capacitor makes it easy to get rid \nof big size, iron-core transformers, and bulky \ufb01  lter capacitors utilized in conven-\ntional design. \n There are protection mechanisms in place to counter measure faults that could \nhave occurred in the \ufb01  eld. For example a question comes to mind, what happens if \nsource energy goes down so low that it won\u2019t be able to provide enough \u2018juice\u2019 to \nsustain buck voltage? \n Yes, it is a valid real life scenario where battery voltage could dip dangerously so \nlow that it could not withhold buck designed intent voltage, such a scenario has \nprotected by under voltage lock out (UVLO) logic. The logic uses analog \n comparators and digital gates, \ufb02  ip-\ufb02 ops, and latches to shut down the buck conver-\ntor when the condition has detected. \n Another important attribute of switch-mode-power-supply is the ability to con-\ntrol in-rush current of a high-current device ready to get energize when the power \nsupply has \ufb01  rst powered on. This scenario is counter measured by \u2018soft start\u2019; the \nsoft start is a process of providing power to the external device slowly and gradually \nthereby eliminating initial in-rush current surge that could be stressful to many \ndevice", " rst powered on. This scenario is counter measured by \u2018soft start\u2019; the \nsoft start is a process of providing power to the external device slowly and gradually \nthereby eliminating initial in-rush current surge that could be stressful to many \ndevice over a longer period of time by repetitive \u2018hard-starts\u2019. It could be analogues \nto an airplane hard or soft landing where a hard landing is a major stress on an air-\nplane structure compared to a minor stress when landing softly. Time (s)0.00 25.00m 50.00m 75.00m 100.00mLoad Current\n-120.00m-100.00m\nPWM 50% 1K\n-10.0020.00\nBuck Voltage\n10.0012.00110mA\n11.02 Va b\n  Fig. 5.65    Buck convertor simulation 50 % 1 kHz        5.12  Power Supply Blockzamann@us.panasonic.com\n204\n A soft start means a low electrical stress thus a good design practice for the \nrobustness and reliability of the design. Few critical parameters of SMPS solutions \nhave listed below:\n\u2022    Start-up Sequence  \n\u2022   Switching Frequency  \n\u2022   Soft Start  \n\u2022   Under voltage Lockout  \n\u2022   Closed-loop control  \n\u2022   Inductor and Filters matching at full load    \n We can state here just for the sake of a rough contrast that if transistor was the revo-\nlution in the age of vacuum tubes then the SMPS may be the revolution against all \nother types of linear power supply regulators, and stands as unchallenged competitor.  \n5.12.4     Abstraction Level 0: Buck Convertor TI TPS40200 \nSchematics \n A buck convertor with 5 V output at 2.5 A max load to run at \u226512 V is designed in \nthis section. The Texas Instrument TPS 40200-buck convertor presented here, and \nsimulated in the frequency of operation is selected at 300 kHz, to be exact it is run-\nning at 297 kHz based on the selected components of R3 = 68.1 K and C5 = 4,700 pF. \n The TPS40200 model is transient model, so a transient analysis has conducted. \nThe VDD simulated for 3 ms at ", " components of R3 = 68.1 K and C5 = 4,700 pF. \n The TPS40200 model is transient model, so a transient analysis has conducted. \nThe VDD simulated for 3 ms at 12 V . A resistive loading of 1.7 A realized. The buck \nvoltage at 5 V has stabilized after 1.4 ms. The convertor switching  frequency func-\ntioning correctly as no abnormal current is sinking (Figs.  5.66 ,  5.67 ,  5.68 ,  5.69 , \n 5.70 , and  5.71 ).       R6 16.2kR3 68.1kC5 470p\nC8 1.5nC7 10pC6 47n\nC4 470pR4 2k\nR2 20m\nR5 0\nD2 MBR330\nC11 1uQ2 FDC654P_AEIR1 10C3 100nR8 300kR12 3MD1\nVCOMP\nR13 50VOUTTPS40200\nRC\nSS\nCOMP\nFB GNDGDRVISNSVDDU1 TPS40200\nL1 33u\nC1 470u\nR10 100k\nR7 3VF1 \nI_IN:1\nR11 50m+\nVG1VDD\nFBCOMP\nOUT\n  Fig. 5.66    TPS40200 buck convertor schematics        5 Fundamental Blocks Designzamann@us.panasonic.com\nTime (s)0.00 1.00m 2.00m 3.00mLoad Current\n-1.004.00\nCompensation\n0.002.00\nInput Energy =12V\n0.0020.00\nSwitching Frequency=297KHz\n0.0020.00\nBuck Voltage\n0.006.00\n  Fig. 5.67    TPS40200 buck convertor simulation results       \n  Fig. 5.68    TPS40200 buck convertor start-up sequence 2 ms window       \nI_IN\nVCOMP\nVF1\nVOUT\nTime (s)560.00u 660.", "or simulation results       \n  Fig. 5.68    TPS40200 buck convertor start-up sequence 2 ms window       \nI_IN\nVCOMP\nVF1\nVOUT\nTime (s)560.00u 660.00u 760.00u 860.00u 960.00u 1.06m 1.16m 1.26mI_IN\n-1.004.00\nVCOMP\n0.002.00\nVF1\n0.0020.00\nVOUT\n2.006.00\nVOUTVF1VCOMPI_IN\n  Fig. 5.69    TPS40200 buck convertor start-up sequence zoomed in        \n \n zamann@us.panasonic.com\n206\n The convertor switching frequency has stopped functioning and the output voltage \nhas seized to exist because the convertor detected an overcurrent condition  \n5.12.5     Boost Convertor Block Diagram with a Truth Table \n An educational boost block diagram shown here where the energy injected to \nthe energy storage inductor through the switching mechanism in a loop before the \nenergy has applied to the load. As noticeable, the switch placed in parallel to the \nload compared to buck convertor where the diode was in-series delivering power as \nR6 16.2kR3 68.1k C5 470p\nC8 1.5nC7 10pC6 47n\nC4 470pR4 2k\nR2 20m\nR5 0\nD2 MBR330\nC11 1uQ2 FDC654P_AEIR1 10C3 100nR8 300kR12 3MD1\nR13 50VOUTTPS40200\nRC\nSS\nCOMP\nFB GNDGDRVISNSVDDU1 TPS40200\nL1 47u\nC1 100u\nR10 100kVF1 \nI_IN:1\nR11 50m+\nVG1\nVCOMP\nR7 3t\nSW1 VDD\nFBCOMP\nOUT\n  Fig. 5.70    TPS40200 buck convertor overcurrent simulation SW1 shorted to GND       \nI_IN\nVCOMP\nVF1\nVOUT\nTime (s)0.00", "BCOMP\nOUT\n  Fig. 5.70    TPS40200 buck convertor overcurrent simulation SW1 shorted to GND       \nI_IN\nVCOMP\nVF1\nVOUT\nTime (s)0.00 1.00m 2.00m 3.00mI_IN\n-1.006.00\nVCOMP\n0.003.00\nVF1\n0.0020.00\nVOUT\n0.006.00\nVOUTVF1VCOMPI_IN\n  Fig. 5.71    TPS40200 buck convertor overcurrent test        \n 5 Fundamental Blocks Designzamann@us.panasonic.com\n207\nsoon as the switch is on. Therefore, there is a tendency of boosting voltage due to \nthe inductor coil electromagnetic effects in itself. Similar features that were apply to \nthe boost topology apply to the buck topology like the feedback mechanism, switch-\ning frequency and the duty-cycle (Fig.  5.72 ).  \n The truth table is showing the importance of feedback mechanism, so when the \nenergy to the load is in excess then the \u201cFeed\u201d is positive so the \u201cRate\u201d of output \ndecreases eventually reducing the energy transfer to the energy storage, and when \nthe \u201cFeed\u201d is negative than the \u201cRate\u201d is increased to compensate for the loss.  \n5.12.6     Abstraction Level 1: Boost Convertor Block Schematics \n A boost convertor block diagram shown without the details of control loop struc-\nture. The switching transistor is switching at 1 kHz to store energy in the inductor. \nThe inductor stores the energy when the switching transistor is on, and it then \nreleases energy to the load when the transistor is off (Fig.  5.73 ).  \n A boost convertor simulated shows that it could generate 12.71 V at the switch-\ning frequency of 1 kHz with 50 %, duty cycle; however, when the duty cycle was \nchange to 90 % the boost voltage is down to 12.58. Both plots show the details of \nprobes to measure many aspects of this educational block to help understand the \ntopology. The key point to learn is that the control-loop can utilize duty-cycle to \nmanage regulation (Figs.  5.74 ,  5.75 ).          Rate\nFeed", " of this educational block to help understand the \ntopology. The key point to learn is that the control-loop can utilize duty-cycle to \nmanage regulation (Figs.  5.74 ,  5.75 ).          Rate\nFeed\nFeed Rate\nPositive Decrease\nNegative IncreaseEnergy \nSwitching Rate\nEnergy Transfer \nto Load\nEnergy \nMeasurement\nTruth TableEnergy Energy Storage  Fig. 5.72    Boost convertor \nblock diagram        5.12  Power Supply Blockzamann@us.panasonic.com\nR1 100\nEnergy C1 470u\nSwitching 1kPWMBoost Voltage\nBoost CurrentCoil Output\nT1 SwitchingCoil CurrentSD1 1N5823\nC2 1uEnergy Storage\n  Fig. 5.73    Boost convertor block topology abstraction level 2       \nTime (s)0.00 2.50m 5.00m 7.50m 10.00 mBoost Current\n116.00m128.00m\nBoost Voltage\n11.6012.80\nCoil Current\n-5.005.00\nCoil Output\n11.0013.00\nPWM 50% 1K\n-10.0020.00127ma\n12.71\n  Fig. 5.74    Boost convertor simulation 50 % 1 kHz V out = 12.71       \nTime (s)0.00 2.50m 5.00m 7.50m 10.00 mBoost Current\n116.00m128.00m\nBoost Voltage\n11.6012.80\nCoil Current\n-5.005.00\nCoil Output\n11.0013.00\nPWM 90% 1K\n-10.0020.00125mA\n12.58\n  Fig. 5.75    Boost convertor simulation 90 % 1 kHz V out = 12.58        \n \n zamann@us.panasonic.com\n209 \u00a9 Springer International Publishing Switzerland 2015 \nN. Zaman, Automotive Electronics Design Fundamentals , \nDOI 10.1007/978-3-319-17584-3_6    Chapter 6   \n Lincoln Motor Company: Case Study 2015 \nLincoln\u2014MK C  \n6.1                              Introduction \n    Ford Motor Company", "DOI 10.1007/978-3-319-17584-3_6    Chapter 6   \n Lincoln Motor Company: Case Study 2015 \nLincoln\u2014MK C  \n6.1                              Introduction \n    Ford Motor Company has de\ufb01  ned hundreds of electronics applications realized by \nproper \ufb01  t, form and function in the portfolio of their vehicle electronics architecture. \nThe usage based on the target market, corporate needs, wants, global compliance, and \nvehicle attributes. \n As de\ufb01  ned earlier all automotive electronics architectures exist today utilizes dis-\ntributed processing architecture where computational needs are fully handle by the \nindividual modules, however the modules interactions all across the vehicle are share \nthrough the message-passing scheme. The message-passing scheme is accomplish by \ninstalling communication node in each module. It is obvious that due to the high num-\nber of communication nodes in a typical vehicle, not all the modules can be place on a \nsingle communication backbone\u2014primarily due to the bandwidth limitation of CAN \nspeed of 500 kHz bits per second. Nonetheless, additionally it is also rests on to the \nsafety and system design robustness. It is apparent that every vehicle manufacture has \nto de\ufb01  ne its own de\ufb01  nition of modules communication backbone. Therefore, the num-\nber of communication backbones rests and varies subject to vehicle manufacturer. \n Ford Motor Company, Electrical and Electronics Systems Engineering de\ufb01  ne \nfew communication backbones with many additional features satisfying the corpo-\nrate directives, and strategies. However, we will restrict the discussion only to the \ncommunication backbone architectures:\n\u2022    A arhitecture de\ufb01  nes  three CAN backbones , one on medium-speed, and two are \non high-speed. Each bus is terminated by two far apart modules, pre-de\ufb01  ned, \nbased on the length of the vehicle harness. A architecture is depicted in Fig  6.2 .  \n\u2022   B arhitecture de\ufb01  nes  four CAN backbones , one on medium speed, and three are \non the high speed. Each bus is terminated by smart data link connector,\u2014alias \ngateway module. The gateway module is an intelligent node, which allows all zamann@us.panasonic.com\n210\nSmart\nDLC\nHigh Speed CAN Backbone 3\n High Speed CAN Backbone 1\nMediumSpeedC A NB", "alias \ngateway module. The gateway module is an intelligent node, which allows all zamann@us.panasonic.com\n210\nSmart\nDLC\nHigh Speed CAN Backbone 3\n High Speed CAN Backbone 1\nMediumSpeedC A NB ackbone 4\n HighS p e edCAN Ba ckbone2\nA\nB\nZ\nA\nB\nZ\nZ\nB\nA\nB\nZ\nA\nT\nT\nT\nT\nT\nT\nT\nTTerminating Node\nTerminating Node\nTerminating Node\nTerminating Node\n  Fig. 6.1       B arhitecture Communication backbone       \nfour backbones to talk to each other, it manages message passing among the mod-\nules, and all module backbones must pass through it before each node can talk to \neach other. The B arhitecture communication backbone depicted in Fig.  6.1 . \nAs can be noticed each backbone could have number of modules represented by  6 Lincoln Motor Company: Case Study 2015 Lincoln\u2014MK C zamann@us.panasonic.com\n211\nA to Z, where \u2018A\u2019 module must have to have the bus-termination resistor installed \nin that module due to the farthest distance from the smart DLC module which is \nthe second point of all terminations (   Fig.  6.2 ).       \n6.2     Lincoln Motor Company 2015 Lincoln Brand MK  C  \n The Lincoln brand vehicle MK C  is available in the United States of America. The \nelectronics architecture has based on a topology where modules share information, \nand perform either self-contained or group based systematic functions. We will \nreview some of the electronic modules and systems based on the information avail-\nable through the service manual for the purpose of education.  High Speed CAN Back bone 1\nHigh Speed CAN Back bone 2A B Z\nZ B AT\nTZT\nMedium Speed CAN Back bone 3Z B A\nTZT\n  Fig. 6.2    A arhietcure Communication backbone        6.2 Lincoln Motor Company 2015 Lincoln Brand MK  C zamann@us.panasonic.com\n212\n6.3     MK C  Communication Backbone Architecture \n The modules processing and network nodes are distributed on four CAN communi-\ncation backbones namely Medium Speed 1, High Speed 1, High Speed 2, and", "asonic.com\n212\n6.3     MK C  Communication Backbone Architecture \n The modules processing and network nodes are distributed on four CAN communi-\ncation backbones namely Medium Speed 1, High Speed 1, High Speed 2, and High \nSpeed 3. All four buses have one common intelligent gateway processing node \nnamely Gateway Module. It has no other major function; rather just allow buses to \nshare information among modules that are distributed on each backbone. It also acts \nas a one-end of terminations for all buses. The other end rests on each backbone in a \nmodule pre-de\ufb01  ned for that backbone in the architecture. A table of CAN backbones, \nand how each module is connected to its backbone is tabulated is shown in Table  6.1 \n   The modules shown with their bus-speed and bus backbone assignments, the only \nmodule, interfaced to all buses, is the gateway module. The gateway module, so physi-\ncally constructed that OBD II connector becomes the integral part of module. The \nData Link Connector (DLC) in Ford terminology also referred as Smart DLC (Fig.  6.3 ).   \n6.4     Body Control Module (BCM) \n The BCM comprises of relays, fuses, electronics, embedded controllers, and embed-\nded software to control vehicle body functions, exterior and interior lamps, safety \nand security functions, and many system sensors, devices connected digitally on to \nthe LIN bus. The BCM shares messages on to the High Speed CAN Bus backbone \n1 as shown in Fig.  6.4 . The BCM also houses Park Aid Module (PAM) within its \nphysical real state. The block diagram of park aid module is explain in next \nsection.  \n The BCM is a highly integrated functional module. The partial block diagram in \ndepicted in Fig.  6.4 .  \n6.5     Restraint Control Module (RCM) \n The Restraint Control Module utilizes number of sensors, and actuators to deploy \nthe airbags effectively, and safely. The CAN bus is utilized to inform status of the \nairbag readiness, however it is not required for the safe operation of the airbag \nshould the bus fail at the time of impact. The weight sensors connected to the seats \ndetermine the occupant-weight through the OSCM (Occupant Safety Classi\ufb01  cation \n", " required for the safe operation of the airbag \nshould the bus fail at the time of impact. The weight sensors connected to the seats \ndetermine the occupant-weight through the OSCM (Occupant Safety Classi\ufb01  cation \nModule) in order to select the \ufb01  ring mechanism appropriate for infant, or adult. \nAdditionally, \u2018seat position sensors\u2019 are also installed to determine the seat track- \nposition for a calibrated airbag deployment. The impact-sensors positively identi\ufb01  es \nthe crash and sends the appropriate signal to the processing node for onward pro-\ncessing subject to vehicle speed and attitude. The buckle sensors manages the seat \nbelt warnings if the driver or passenger have not properly buckled. Nevertheless, \nonce the seat belt fastened, airbag system prerequisites are complete. 6 Lincoln Motor Company: Case Study 2015 Lincoln\u2014MK C zamann@us.panasonic.com\n213\n   Table 6.1    2015 MKC modules communication node   \n Gateway \nmodule (GWM)  Modules nomenclature  CAN buses backbone \n MS1  HS1  HS2  HS3 \n Smart data link \nconnector \n(SDLC) \n OBDII \nconnector  TRM (Trailer Module)  X \n RTM (Radio Transceiver Module)  X \n SOD-L (Side obstacle Detector\u2014Left)  X \n SOD-R (Side obstacle Detector\u2014Right)  X \n DDM (Driver Door Module)  X \n DSM (Driver Seat Module)  X \n GPSM (Global Positioning System Module)  X \n FCIM (Front Control Interface Module) [T]  X \n PDM (Passenger Door Module)  X \n RGTM (Rear Gate Trunk Module)  X \n HSWM (Heated Steering Wheel Module)  X \n SCME (Front Seat Climate Control Module)  X \n PCM (Powertrain Control Module) [T]  X \n BCM (Body Control Module)  X \n PAM (Park Aid Module)  X \n HCM (Headlamp Control Module)  X \n RCM (Restraint Control Module)  X \n ABS (Antilock Brake System)  X \n VDM (Vehicle Dynamics Module)  X \n HUD (Heads-up Display)  X \n PSCM (Power Steering Control Module)  X \n GSM (Gearshift Module) ", " ABS (Antilock Brake System)  X \n VDM (Vehicle Dynamics Module)  X \n HUD (Heads-up Display)  X \n PSCM (Power Steering Control Module)  X \n GSM (Gearshift Module)  X \n IPM-A (Image Processing Module A)  X \n TRCM (Transmission Range Control Module)  X \n CCM (Cruise Control Module) \n[Adaptive Sensing]  X \n OCSM (Occupant Classi\ufb01  cation System Module)  Local CAN Bus to RCM \n SCCM (Steering Column Control Module) [T]  X \n APIM (Auxiliary Protocol Interface Module)  X  X  X \n TCU (Telematics Control Unit)  X \n ACM (Audio Control Module)  X \n ANC (Active Noise Cancellation) Module  X \n DSP (Audio Digital Signal Processing Module)  X \n IPC (Instrument Panel Cluster) [T]  X \n The pre-tensioner holds the occupant tightly on to the seat once it has determined \nthat the air bag deployment is unavoidable, and it positions the occupant securely by \nautomatically tightening the belt on to the seat\u2014right before deploying the airbags \n(Fig.  6.5 ).  \n After the airbags deployment, module performs the post-crash processing. The \n\u2018event noti\ufb01  cation signal\u2019 is then asserted to the body control module to turn on the 6.5 Restraint Control Module (RCM)zamann@us.panasonic.com\n214\nSmart \nDLC High Speed CAN Backbone 3 High Speed CAN Backbone 1Medium Speed CAN Backbone 4 High Speed CAN Backbone 2T\nTT\nTTRMRTMSOD LDSMFCIM\nPDMRGTMHSWM\nSCME\nSOD RGPSMDDM\nPCM BCM\nPAMHCM\nGSMPSCMHUDVDMABS\nSCCMOSCMC-CMTRCMIPM-A\nRCMDSPANC\nACMTCU\nAPIMIPC\nLOCAL CAN BUSTT\nT\nT\nTerminating\nNodeTerminating\nNodeTerminating \nNode\nTerminating\nNode\nConnected to\nbackbone 2Connected to\nbackbone 4\n  Fig. 6.3    2015 MKC modules and communication backbones        6 Lincoln Motor", "\nNodeTerminating \nNode\nTerminating\nNode\nConnected to\nbackbone 2Connected to\nbackbone 4\n  Fig. 6.3    2015 MKC modules and communication backbones        6 Lincoln Motor Company: Case Study 2015 Lincoln\u2014MK C zamann@us.panasonic.com\n215\nhorns, \ufb02  ashes the headlamps, and send CAN commands to SYNC to dial 911 call if \nthe customer cell phone has already been paired earlier through the Bluetooth wire-\nless. Once the call to 911 operator is connected, the SYNC system reports and \nannounces to 911 operator that the crash has occurred to a Ford vehicle at location \nso and so, and then relinquishes open line for the operator to engage occupants in \nthe vehicle.  \nHorn AUX Locks Keypad LEDs\nChild Lock Fuel Flap Fuel Pump\nDoor Locks/Un Li\ufb05gate Motor Reversing Lamps\nAlarm RKE Start Bu/g372on Wiper Motor\nAutolamps Ambient Lights Run/Start Relay\nDelayed Acc Hazard Lamps Gear shi\ufb05 Module\nIgnition Status Door LED's Fog Lamps\nWindow De/g352ost Ba/g372ery Saver Marker Lamps\nGateway\nModulePROCESSINGHID Drivers Exterior LightsBattery Monitoring   2015 MKC - Body Control Module  (Partial)\nHeadlamp Control Headlamps\nHeadlamp Leveling Module\n(Only for China)\nHS-CAN 500Kbs \nPhysical LayerKeyless Entry Pad \nDoor Ajar  ( all doors)\nCA N BUSBrake System Interior Lights\nRelays\nFET DrivesSystem Sensors\nSystem  Switches\nENS (RCM)\nRTM (TPMS)\nIgnition Start/Stop \nDimming SwitchLevel Shift\nHS1\nHS3\nHS2\nMS1LINBUS\nLevel Shift\nLevel Shift\nLINBUSLINBUS\nLINBUS\nLevel Shift\nLevel Shift\nLevel Shift\nLevel Shift\nLevel Shift\n  Fig. 6.4    Partial body control functions       \nCAN BUSEvent Notification Signal\nIPC SYNC\n)))) Turn on Horns\n   Customer Cell Phone\nTurn on Head LampsBody Control ModuleCAN Bus\nGateway \nModulePROCESSING Electronic Drivers Pre-tensioners    2015 MKC - Restraint Control Module\nOSCM Electronic Drivers Retractors\nHS-CAN", " Customer Cell Phone\nTurn on Head LampsBody Control ModuleCAN Bus\nGateway \nModulePROCESSING Electronic Drivers Pre-tensioners    2015 MKC - Restraint Control Module\nOSCM Electronic Drivers Retractors\nHS-CAN 500Kbs \nPhysical LayerSeat Sensors Airbag Firing Squibs Airbags with sealed inflators\nImpact SensorsLevel Shift\nLevel Shift\nHS3HS2\n  Fig. 6.5    Restraint control module        \n 6.5 Restraint Control Module (RCM)zamann@us.panasonic.com\n216\n6.6     Instrument Panel Cluster (IPC) \n The Instrument Panel Cluster is self-contained module. It receives two hardwired \ninputs, one for fuel level indicator, and other for low-washer \ufb02  uid level. The rest of \nthe status information is available by CAN messages sharing through different \nmodules installed at High-Speed-1, High-Speed-2 and Medium-Speed-1 CAN \nbackbones. The IPC utilizes no mechanical dial pointers rather all the displayed \ninstruments actively simulate on the LCD. A speaker in the IPC is a redundant \nresource to play chimes. The block diagram in Fig.  6.6  represents an educational \nconsolidated view.   \n6.7     Park Aid Module (PAM) \n The park aid module assists driver for a safe reverse, and forward small movements \nto align vehicle as per customer desire, and intentions. The PAM is physically \nlocated inside the body control module (BCM)\u2014nevertheless it has a separate CAN \nnode identity (Fig.  6.7 ).   PCM PAM\nTRCM VDM IPMA ABS PSCM SCCM RCM\nSOD-L SOD-R GPSMCAN Bus HS3\nGateway \nModuleWasher Fluid\n Sensor\nPROCESSINGLED Drivers LED Indicators\nDisplay\nDriver2015 MKC - Instrument Panel Cluster (IPC)\nFuel Level Sensor Driver Speaker to play Chimes\nHS-CAN 500Kbs\nPhysical LayerLevel ShiftLevel Shift\nHS2\nMS1HS1HS3\n  Fig. 6.6    2015 MKC instrument panel cluster        6 Lincoln Motor Company: Case Study 2015 Lincoln\u2014MK C zamann@us.panasonic.com\n217\nPCM\nIPC ACM\nFCIM TRM   2015 MKC - Parking Aid Module ", "C instrument panel cluster        6 Lincoln Motor Company: Case Study 2015 Lincoln\u2014MK C zamann@us.panasonic.com\n217\nPCM\nIPC ACM\nFCIM TRM   2015 MKC - Parking Aid Module  (PAM)\nRear Park Aid \nSensors\nHS-CAN 500Kbs \nPhysical Layer CAN Bus HS1\nGateway \nModuleFront Park Aid \nSensors\nPROCESSING\nCautions and \nWarnings\nLevel ShiftLevel Shift\nMS1HS1\nHS3\n  Fig. 6.7    2015 MKC park aid assistance       \n6.8     Tire Pressure Monitoring System (TPMS) \n The Tire Pressure Monitoring System informs driver if any of the tire pressure has \nfallen below the recommended value, so that the driver can take measures to \ufb01  ll the \ntire pressure\u2014if necessary. All tires are equipped with battery operated pressure \nsensors transmitting the tire pressure to the radio transceiver module (RTM). The \ninformation is then properly translated, formatted and transmitted over to the vehi-\ncle CAN bus through the gateway module. The gateway module is conduit to have \nthe information available for the body control module (BCM), where it is processed \nand decoded to route to the Instrument Cluster Panel. The BCM does all the pro-\ncessing of TPMS functions including sensors-position decoding for wheel-identity, \nsensors-signal temperature compensation, and cautioning the driver by sending \nappropriate messages to the IPC (Fig.  6.8 ).    6.8  Tire Pressure Monitoring System (TPMS)zamann@us.panasonic.com\n218\n6.9     Shift by Wire System \n The shift-by-wire is a way of controlling the gears by pressing the push buttons \nrather than manually moving the stick. This is a neat way of saying that the gears \nshifted by electronics is actually a \u2018shift-by-wire\u2019 system. The TRCM connects \nmanually with the transmission gear lever. The PCM functions as master. The IPC \ndisplays gear position (Fig.  6.9 ).   \n6.10     In-Vehicle Invertor \n The vehicle is equipped with an inverter module that runs without any time limit \nwhen engine is running. However, it is important to note that while utilizing inverter \nwithout being charge through the alternator, the vehicle battery will discharge. \nIn", " The vehicle is equipped with an inverter module that runs without any time limit \nwhen engine is running. However, it is important to note that while utilizing inverter \nwithout being charge through the alternator, the vehicle battery will discharge. \nIn order to prevent that scenario the PCM sends information to the BCM that the \nengine had shut down and vehicle battery is no longer getting charge. The BCM \nthen takes action, and turns off inverter after a predetermined period. The BCM \nsends shutdown instructions over the LIN bus (Fig.  6.10 ).   IPC\nBCMLF Tire Sensor )))\nPROCESSING2015 MKC - Tire Pressure Monitoring Ssystem\nRF Tire Sensor )))\nRR Tire Sensor )))\nMS-CAN 125Kbs\nPhysical Layer CAN Bus MS1\nGateway \nModuleBattery\nBattery\nBattery\nBatteryLR Tire Sensor )))Radio\nTransceiver\nModule\nMS1\nHS3\nHS1\n  Fig. 6.8    2015 Tire pressure monitoring system        6 Lincoln Motor Company: Case Study 2015 Lincoln\u2014MK C zamann@us.panasonic.com\nP\nR\nN\nD\nS\nOverride\nSwitch\nRCM TRCM\nIPC\nPCM BCMHS-CAN 500Kbs\nPhysical Layer CAN Bus HS2\nGateway \nModulePROCESSING2015 MKC - Shift-by-Wire\nLevel Shift\nHS2\nHS3Level Shift\nHS1\n  Fig. 6.9    2015 Shift by wire system       \nControl\nPCM BCMInverter\nGateway\nModulePROCESSING\nLIN\nPhysical Layer\nHS3\nHS2\nMS1HS1LINBUS\n  Fig. 6.10    2015 In-vehicle invertor processing        \n zamann@us.panasonic.com\n220\n6.11     Powertrain Control Module \n The powertrain control module is responsible for engine electronics control, battery \ncharging, transmission gearshifts, air-conditioning monitoring, and cruise control. \nIn addition to that, it supports other vehicle modules through the gateway module by \nthe abundance of sensors information it has to share with other systems. The block \ndiagram is shown in Fig.  6.11    \n6.12     Cruise Control Module (CCM) \n The powertrain module controls the cruise control functions. However, the cruise \ncontrol module supports the adaptive cruise functionality. It is an added feature for", " in Fig.  6.11    \n6.12     Cruise Control Module (CCM) \n The powertrain module controls the cruise control functions. However, the cruise \ncontrol module supports the adaptive cruise functionality. It is an added feature for \nthe customer convenience to maintain a safe distance from the vehicle ahead in the \nsame lane provided the adaptive cruise control feature is engage. The CCM houses \nthe RADAR (RAdio Detection And Ranging) sensing mechanism where radio \nenergy is send and receive to determine the distance of vehicle moving ahead. \nThe CCM also bene\ufb01  ts another intriguing function of collision avoidance explained \nin next section (Fig.  6.12 )   \n6.13     Steering Column Control Module (SCCM) \n The SCCM utilizes embedded controller to receive steering control switches status \nand positions of multifunction levers, takes local actions and then translates the \nswitch positions and multifunction levers into the appropriate CAN messages that Gateway\nModule DRIVERS\nTransmission , A/CPROCESSING Coil On-plugs ( Spark Ignition)\nEngine Sensors  Relays, Fuel Pump, Fans\nHS-CAN 500Kbs \nPhysical LayerBattery Charging, AWDCAN BUSThrottle Control Motor\nCritical Sensors Fuel Injectors\nControl SwitchesLevel Shift\nLevel Shift\nLevel Shift\nHS1\nHS3\nHS2\nMS1\n  Fig. 6.11    2015 Powertrain control module        6 Lincoln Motor Company: Case Study 2015 Lincoln\u2014MK C zamann@us.panasonic.com\n221\nare sent on to the high speed CAN bus 2. The messages related to wiper motor and \nwasher \ufb02  uid pump relayed via LIN bus. The block diagram depicted in Fig.  6.13  \nshow the interconnection of functions.   SCCM BCM\nIPC\nABS RCM CCM\nEmitted Radar PulsesCA N BUS\nGateway \nModuleReflected Radar PulsesAccelerator Pedal\n DRIVERSBrake Switches PROCESSING\nThrottle Control MotorCruise Control \nSwitches\nHS-CAN 500Kbs \nPhysical LayerLevel Shift\nLevel Shift\nLevel Shift\nHS1\nHS3\nHS2Vehicle\nAhead\n  Fig. 6.12    Cruise control with adaptive module (CCM)       \nPCM BCM\nGateway \nModuleWasher Fluid Pump\nWasher MotorPROCESS", " Shift\nLevel Shift\nHS1\nHS3\nHS2Vehicle\nAhead\n  Fig. 6.12    Cruise control with adaptive module (CCM)       \nPCM BCM\nGateway \nModuleWasher Fluid Pump\nWasher MotorPROCESSING\nLIN\nPhysical LayerHS-CAN 500Kbs \nPhysical LayerSwitches\nLINBUS\nHS3\nHS2MS1HS1\n  Fig. 6.13    Steering column control module        \n 6.13 Steering Column Control Module (SCCM)zamann@us.panasonic.com\n222\n6.14     Collision Avoidance System \n The collision avoidance system is an added advantage of the CCM installed for the \nadaptive cruise control, but now has been exploit to assist collision avoidance. The \nforward collision warning alerts the driver for an impending collision risk. The \naural warning and red LED\u2019s display warning alerts the driver. The block diagram \ndepicted in Fig.  6.14  show the interconnection of functions.   \n6.15     Blind Spot Monitoring System (BLIS) \n The blind spot detection mechanism augments the driver a safe lane change sce-\nnario. It displays a blinking LED to the side view mirror indicating an unsafe condi-\ntion to change lane. Multiple modules and players share the system design. The left \nside obstacle detector left (SOD-L) arguments left lane change assistance, and right \nside obstacle (SOD-R) assists right side lane change. The block diagram depicted in \nFig.  6.15  show the interconnection of functions. The Driver Door Module (DDM) \nand Passenger Door Module (PDM) processes the information received over the \nMedium Speed 1 CAN bus and then drives the corresponding blinking LED for an \nunsafe lane change warning.   \n6.16     Climate Control System \n The climate control system is the air-conditioning and heating system meant for vehi-\ncle cabin. The powertrain control module (PCM) and Front Control Interface Module \n(FCIM) are two major players handling the cabin temperature. The PCM interfaces BCM\nACM IPC\nHUD CCM\nEmitted Radar PulsesGateway \nModuleReflected Radar Pulses   2015 MKC - Collision Avoidance\n DRIVERSPROCESSING\nRED LED's Warning\nHS-CAN 500Kbs \nPhysical Layer\nHS1\nHS3\nHS2Vehicle\nAhead\n  Fig. 6", "ses   2015 MKC - Collision Avoidance\n DRIVERSPROCESSING\nRED LED's Warning\nHS-CAN 500Kbs \nPhysical Layer\nHS1\nHS3\nHS2Vehicle\nAhead\n  Fig. 6.14    Collision avoidance system        6 Lincoln Motor Company: Case Study 2015 Lincoln\u2014MK C zamann@us.panasonic.com\n223\ndirectly with the engine driven compressor by a clutch to engage and disengage the \nvariable displacement compressor. Furthermore, it reads the ambient air temperature, \nand compressed Freon gas pressure. The block diagram depicted in Fig.  6.16  show \nthe interconnection of functions. The door actuators are air outlet registers meant to \nrelease hot/cold air subject to customer settings. The blower motor fan barrels the \nthough the ducts to each air outlet registers. The blower motor allows multiple speed \nsettings to cycle through air as per customer needs and wants. The FCIM also pro-\nvides user interface to manage customer interactions of climate settings.   BCM ACM IPC\nSCCMLH Mirror LED's\nRH Mirror LED's\nGateway \nModulePDM Processing and \nDriverSOD-R ProcessingDDM Processing and \nDriverSOD-L Processing\nHS1\nHS3\nHS2MS1\n  Fig. 6.15    Blind spot detection       \nCAN BUS\nVariable Displacement \nCompressor\nA/C Clutch Relay/Field Coil\nAmbient Air Temperature \nSensorPCM                2015 MKC - Front Control Interface Module\nProcessing\nControl SignalBlower Motor \nSpeed Control\nMS-CAN 125Kbs \nPhysical LayerBlower Motor\nGateway \nModuleA/C Pressure TransduserTemperature\nSensors\nAutolamp-Sunload \nSensorH-Bridges Door Actuators\nUser Controls\nLevel Shift\nHS1Level Shift\nLevel Shift\n  Fig. 6.16    Climate control system        \n 6.16 Climate Control Systemzamann@us.panasonic.com\n224\n6.17     Passive Anti-theft System (PATS) \n The Passive Anti-Theft System dictates the conditions to secure the vehicle to its key \nholder who had all the ownership rights to start the engine. If key were not present \nwithin a speci\ufb01  ed distance inside the cabin, the computers would not let the engine to \nstart even by pressing the START/STOP button.", "holder who had all the ownership rights to start the engine. If key were not present \nwithin a speci\ufb01  ed distance inside the cabin, the computers would not let the engine to \nstart even by pressing the START/STOP button. The BCM receives the key authenti-\ncation code through multiple wireless antennas (RKE, PATS, Door) sensing a weak \nradio signal, when a correctly coded key comes close transmitting valid key code. \nAfter an embedded software-decoding process utilizing RTM, PCM and BCM inter-\nactions, the authentication validates the engine-start sequence\u2014once the START but-\nton is pressed. (Please note that the vehicle is not equipped with conventional keys or \nignition cylinder). The block diagram depicted in Fig.  6.17  show the interconnection \nof functions. The coded key inside the cabin interacts wirelessly with RTM and three \nother antennas namely RKE antenna, Door antenna and PATS antenna.   \n6.18     Lane Departure Warning \n The Lane Departure cautions and warnings are available to assist vehicle driving \nsafely in the lane. The system takes advantage of camera looking at the white mark-\nings on the road lane. The user has authority to engage or disengage the lane depar-\nture warning functions. The camera or Image processing module-A (IPMA) has its CAN BUS\nRKE \n  )))\n  ((( Door\n       )))\n  )))\nPATSLIN\nPhysical Layer\nAll Engine ControlsRTM\nPCMHS-CAN 500Kbs \nPhysical Layer\nGateway \nModuleBCM Processing2015 MKC - Passive Anti-theft System (PATS)\nRF Input\nGSM-Start/Stop Level Shift\nMS1\nHS1Coded\nKey\n  Fig. 6.17    Passive anti-theft system        6 Lincoln Motor Company: Case Study 2015 Lincoln\u2014MK C zamann@us.panasonic.com\n225\ninstallation location in the rear-view camera\u2014looking ahead. The IPMA shares \ninformation on the High speed 2 CAN Bus. In addition to that, a critical and signi\ufb01  -\ncant feature of camera is its location and look-ahead capability without any hazi-\nness, hindrance, fog, mist or frozen ice. To countermeasure, all these weaknesses, \nthe aperture of windshield section \ufb01  tted with defrost heater. The defrost heater also \ncontrols", "-ahead capability without any hazi-\nness, hindrance, fog, mist or frozen ice. To countermeasure, all these weaknesses, \nthe aperture of windshield section \ufb01  tted with defrost heater. The defrost heater also \ncontrols by the IPMA. \n The RCM informs the vehicle attitude on the bus, PSCM sends steering vibration \nand torque assist to align the vehicle between the markings. The CCM disables the \nlane departure system if collision warning gets to engage (Fig.  6.18 ).   \n6.19     Battery Charging \n The Body Control Module and Powertrain Control Module works in harmony to \ncharge the vehicle battery. The battery-monitoring sensor feeds BCM; Generator \ncurrent-sensor feeds PCM. BCM sends message to IPC through gateway if the bat-\ntery charging current is not taking place correctly (Fig.  6.19 ).   \n6.20     Anti-lock Brake System and Stability Control \n The Anti-Lock Brake and Stability Control is self-contained module with electron-\nics and actuators to provide added safety when icy a slippery condition tends to lock \nwheel after the application of brakes. The module is married to the hydraulic \n assembly unit, so a simpler block diagram depicted in Fig.  6.20 . The wheel-sensors \nprovide wheel-spinning movements. The brake \ufb02  uid level being sense by the BCM, \nand transferred to the gateway module for onward delivery to the ABS module. \nThe hydraulic pump motor provides the necessary hydraulic pressure to maintain BCM PCM `\nIPC\nSCCM PSCM RCM CCM IPMAGateway \nModuleCamera Windshield Defrost Heater   2015 MKC - Lane Departure\nSteering Column \nVibrations\nSteering Column Torque \nadjsutement\nHS-CAN 500Kbs \nPhysical Layer DRIVERSPSCM Processing\nHS1\nHS3\nHS2White Color \nRoad Markings\n  Fig. 6.18    Lane departure system        6.20  Anti-lock Brake System and Stability Controlzamann@us.panasonic.com\n226\nautomatic braking when ABS takes control of the brake. In normal braking opera-\ntion, human foot pressure applies the brakes. While the ABS takes control of the \nbrakes, pump motor is required to generate necessary brake force.   \n6.21     Exterior Lighting System \n The exterior lighting gets control by the BCM. It includes headl", " human foot pressure applies the brakes. While the ABS takes control of the \nbrakes, pump motor is required to generate necessary brake force.   \n6.21     Exterior Lighting System \n The exterior lighting gets control by the BCM. It includes headlamps, brake lamps \nincluding auto lamps functions.    BCM\nIPC\nRCM VDMDrivers Hydrualic Pump Motors\nHS-CAN 500Kbs \nPhysical Layer\nGateway \nModule                     2015 MKC - ABS \nPROCESSINGDrivers  Apply & Release Valves \nWheel Sensors\nBrake Fluid Level \nSwitchLevel Shift\nLevel Shift\nHS1\nHS3\nHS2\n  Fig. 6.20    ABS module       IPC\nGateway \nModuleBattery Windings GeneratorPCMGenerator Current Sensor\nBCMBattery Monitoring SensorHS1\nHS3\n  Fig. 6.19    Battery charging system        \n 6 Lincoln Motor Company: Case Study 2015 Lincoln\u2014MK C zamann@us.panasonic.com\n227 \u00a9 Springer International Publishing Switzerland 2015 \nN. Zaman, Automotive Electronics Design Fundamentals , \nDOI 10.1007/978-3-319-17584-3_7    Chapter 7   \n Module and Vehicle EMC Compliance \n7.1                        Introduction \n    We live in a world of oxygen and we cannot survive without it that is a universal \ntruth. However, there is another truth that goes beyond geographical area, demo-\ngraphics, and technological achievements, where people cannot \u2018live\u2019 without the \nradio energy present around them. The radio energy around them can be found in \nthe form of a cellular phone signal, a FM radio signal, a Wi-Fi hotspot, or a GPS \nsignal. These high-tech gadgets, not only run on the battery power, but do require \nradio energy to get fully operational. The presence of \u2018radio energy atmosphere\u2019 \naround us plays a vital role in our daily lives. \n Although the usage of these devices is second nature to us, their existence creates \nanother issue that must be resolved before any new electronics gadget is thrown into \nthe \u201cradio energy atmosphere\u201d. Contrary to \u201coxygen-\ufb01  lled atmosphere\u201d that creates \nno fundamental intelligent design issue in the \u201coxygen space\u201d\u2014even though every \nminute new \u2018products\u2019 are \ufb01  lling the atmosphere. The scenario of radio energy \natmosphere is full of issues. \n Unlike", "\u201d that creates \nno fundamental intelligent design issue in the \u201coxygen space\u201d\u2014even though every \nminute new \u2018products\u2019 are \ufb01  lling the atmosphere. The scenario of radio energy \natmosphere is full of issues. \n Unlike \u2018no-issues\u2019 scenario of oxygen atmosphere, the \u201cradio energy atmo-\nsphere\u201d require calculated, and a sort of an \u2018intelligent design\u2019 to follow compliance \nso that each new \u2018specie\u2019 come to existence ready to get \u2018naturalized\u2019 in the \u2018radio \nenergy atmosphere\u2019\u2014could survive and function correctly. \n The \u2018radio energy atmosphere\u2019 command and control is maintained by the \nrespective country, region, and governmental agency. The rules and regulations to \n\u2018live\u2019 under a particular \u2018radio energy atmosphere\u2019 are de\ufb01  ned under an electromag-\nnetic compliance by the respective agency for that particular region. It is absolutely \nmandatory for a newly designed automotive electronics module to live in the \u2018radio zamann@us.panasonic.com\n228\natmosphere energy\u2019 peacefully and to become a    \u2018law-abiding citizen\u2019. In order to do \nso, it must comply with the electromagnetic compliance regulations of the target \nmarket. The modules need compliance\u2014indeed\u2014we all must agree. But do vehi-\ncles require compliance? Yes, vehicles require compliance as well because this is \nwhere the modules have to be installed. So, vehicles must also follow the electro-\nmagnetic compliance guidelines. These guidelines are de\ufb01  ned in the governing \ndocuments released by the respective authority of target market. Both modules and \nvehicles usually require separate set of testing to comply with the electromagnetic \ncompliance. The target market requirements and compliance is essential for any \nelectronics module designed for motor vehicle application. \n In United States of America, Federal Communications Commission (FCC) regu-\nlates the governing documents required for the electromagnetic compliance of any \nelectronics equipment desired to be introduced in the United States of America. \nMotor Vehicle manufacturers are bound by law to comply with the certi\ufb01  cation \nprocess before their vehicles are placed in the target market. The vehicles, electronic \nsystems, electrical machines along with all electronic modules have to comply with \nthe regulatory requirements. \n In general, electromagnetic compatibility requirements not only cover the envi-\nronmental radio energy, but also cover the local energy-transmitters inside any vehi-\ncle. These local vehicle energy-transmitters", " electronic modules have to comply with \nthe regulatory requirements. \n In general, electromagnetic compatibility requirements not only cover the envi-\nronmental radio energy, but also cover the local energy-transmitters inside any vehi-\ncle. These local vehicle energy-transmitters are not exactly the actual radio transmitters \n(except for few like Wi-Fi, Bluetooth, or Cellular phone module\u2026) rather represent \nvariety of other electronic devices mounted inside the modules in addition to electro-\nmagnetic devices installed in the vehicle. The transient energy events due to these \ndevices may disturb the safe operation of vehicle by infringing into the safe opera-\ntional envelop of a system component, sensor, device or a new module. For example, \na high energy pulse may generate a false reset to a system already in the middle of a \ncritical decision under the supervision of an intelligent algorithm. \n So, the EMC compliance of modules not only covers the environmental radio \nspectrum, but also the local energy from the vehicle unintended transmitters initi-\nated by transients event in the vehicle electrical systems. \n In    Fig.  7.1 , multiple sources of RF transmitters are shown signifying the vulnera-\nbility of an automotive module in the radio energy atmosphere. The biggest concern \nin automotive domain is the dynamic nature of vehicle attributes. A moving vehicle \ncould pass by any transmitter at any time in an unpredictable fashion. The generalized \ncategory and simple de\ufb01  nition of electromagnetic interference are listed below:  \n7.1.1     Radiated Emissions (RE) \n It is de\ufb01  ned as the radio energy emitted by the electronic device wirelessly that may \nbe harmful to other electronic devices who are listening to known wirelessly- \nidenti\ufb01  ed intelligent radio energy (a FM station, a cell phone call, a GPS signal or \nmore). In simple terms we can state that \u201cDon\u2019t disturb neighbors by talking loud\u201d.  7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n229\n7.1.2     Conducted Emissions (CE) \n It is de\ufb01  ned as the radio energy conducted by the electronic device through the \nwires that are providing power to device that may be harmful to other electronic \ndevices sharing the same power distribution lines. The conducted emissions over \nthe limits energy could kick off the secondary failure by radiating more emissions \nthrough the wires because wires now acts like", " that are providing power to device that may be harmful to other electronic \ndevices sharing the same power distribution lines. The conducted emissions over \nthe limits energy could kick off the secondary failure by radiating more emissions \nthrough the wires because wires now acts like antenna regardless of the fact that it \nwere providing power.  \n7.1.3     Radiated Immunity (RI) \n It is de\ufb01  ned as the quality of electronic device where it can absorb the radio energy \nbeamed wirelessly on the electronic device. The quality of absorbing radio energy \nwithout affecting the device electronics for its intended operation is de\ufb01  ned as the \nimmunity against radio energy that is applied on the electronic device wirelessly. \nIn other words you can say \u201cI don\u2019t get disturbed when neighbors talk loudly\u201d  \n7.1.4     Conducted Immunity (CI) \n It is de\ufb01  ned as the quality of electronic device where it can absorb the radio energy \ninjected physically to the electronic device through electrical wires connected with \nthe device. The quality of absorbing radio energy without affecting the device \nModuleCell Phone\nTX/RX Radio Station \nTransmitters\nTV Station \nTransmitters\nRadar \nTransmittersCell Tower\nTransmitters\nVehicle \nTransmitters\nSatellite \nTransmittersPortable \nTransmittersRF Energy\nRF Energy RF Energy\nRF Energy RF Energy\nRF EnergyRF Energy\nRF Energy\nBluetooth\nWi-FiRF Energy\n  Fig. 7.1       Radio Energy Atmosphere affecting a module        7.1  Introductionzamann@us.panasonic.com\n230\nelectronics for its intended operation is de\ufb01  ned as the immunity from the radio \nenergy when the radio energy is transferred by electrical conduction. In simple \nterms we can say \u201cI don\u2019t get disturbed when neighbors knock my doors or walls\u201d.   \n7.2     Automotive Radiated Emission \n In automotive design space radiated emissions are de\ufb01  ned as the radio frequency \nenergy radiated by the module into the atmosphere due to the energized electronics \nembedded inside the module. In order to determine the effects of radiated emis-\nsions, it is desired that emissions are measured by the measuring equipment to \nunderstand the limits of the emissions to determine their impact to the United States \nFrequency Spectrum. The Radio Frequency allocation table and spectrum is de\ufb01  ned \nby the U.S.", " is desired that emissions are measured by the measuring equipment to \nunderstand the limits of the emissions to determine their impact to the United States \nFrequency Spectrum. The Radio Frequency allocation table and spectrum is de\ufb01  ned \nby the U.S. Department of Commerce, National Telecommunications and \nInformation Administration. A latest copy of US frequency spectrum may be down-\nloaded online (Fig.  7.2 ).  \n Protecting the target market radio frequency spectrum is the primary reason to \ncomply with radiated emissions limits de\ufb01  ned by the target market. However, the \nmajority of the automotive OEM\u2019s perform the testing based on a global compli-\nance, which means they test almost every frequency band covered globally. This \nmakes it easy to market their products across the board without re-doing the focused \ntesting for a new market. \n The second reason to perform radiated emissions testing is to understand if the \nexisting quali\ufb01  ed already installed modules inside the vehicle are fully operational \nthroughout the well-de\ufb01  ned operational envelop of a  new module . In order to verify \nthat the new module is not radiating emissions detrimental to the other vehicle mod-\nules, it requires testing the new module by installing it inside of a real vehicle. The \nnew module must be installed at its pre-de\ufb01  ned location next to new or old \n \u2018neighborhood\u2019. At the end of the day all new and old modules are placed inside the \nvehicle, powered up and then con\ufb01  gured to function as per design intent. After pre-\nparing the vehicle systems, the team must conduct a thorough vehicle operational \ntesting to con\ufb01  rm if the radiated emissions originating from every module inside the \nvehicle is not causing any negative effect to any vehicle electronics system. \nModule RE BatteryAtmosphere  Fig. 7.2    Radiated Emissions \nto the atmosphere        7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n231\n When all has done with the intent of con\ufb01  rming modules operational integrity to \nfunction correctly, the vehicle itself has to go through the radiations emissions test-\ning to qualify for the target market electromagnetic compliance.  \n7.3     Automotive Conducted Emission \n Conducted emissions are de\ufb01  ned as the radio energy conducted by the module \nthrough the electrical wiring, generated due to the electronics embedded inside", " to qualify for the target market electromagnetic compliance.  \n7.3     Automotive Conducted Emission \n Conducted emissions are de\ufb01  ned as the radio energy conducted by the module \nthrough the electrical wiring, generated due to the electronics embedded inside the \nmodule. It is desired that conducted emissions are measured by the measuring \nequipment to understand the level of conducted emissions energy that may impact \nthe typical vehicle wiring. A conducted emissions level must not infringe negatively \non the US frequency spectrum de\ufb01  ned by the Department of Commerce, \nU.S. National Telecommunications and Information Administration (Fig.  7.3 ).   \n7.4     Automotive Radiated Immunity \n Radiated Immunity is de\ufb01  ned as the resilience of electronics module to sustain its \noperation undisturbed without getting impacted by the radiant energy already pre-\nsented in the atmosphere. It is desired that the device resilience to the radiated \nimmunity must be quanti\ufb01  ed by beaming the radiant energy onto the module while \nits key functions and features are measured, observed and recorded. This ensures \nthat the module will perform as per design intent. It is required that when perform-\ning these tests a fully compliant calibrated specialized equipment must be used to \naim radiant energy onto the module. The module must not deviate from its pre- \nde\ufb01 ned operational envelop. \n In simple terms, it is the inverse of radiated emissions meaning that now the \nmodule has to face the simulated US frequency spectrum radiant energy. In addition \nto this fundamental principle, there are more steps automotive design space has to \ntake to countermeasure many other types of radiated immunity tests. This will be \nexplained in later sections (Fig.  7.4 ).   \n7.5     Automotive Conducted Immunity \n Conducted immunity is de\ufb01  ned as the resilience of an electronics module to sustain \nits undisturbed operation when the undesired electrical energy is imposed by the \nvehicle electrical, electronics and electromagnetic systems over the electrical \nModule CE Battery   Fig. 7.3    Conducted \nEmissions to the atmosphere        7.5  Automotive Conducted Immunityzamann@us.panasonic.com\n232\nconnections of the module. Conducted immunity requires that power feeding elec-\ntrical wires of module must be subjected to many different electrical disturbances \ninherently found in a typical vehicle (Fig.", "amann@us.panasonic.com\n232\nconnections of the module. Conducted immunity requires that power feeding elec-\ntrical wires of module must be subjected to many different electrical disturbances \ninherently found in a typical vehicle (Fig.  7.5 )   \n7.6     Automotive Radiated Emissions Testing \n This test requires that the module is turned on completely while its entire electronics \nand clock sources are powered. All other frequency related electronics required for \nnormal operation must be up and running. If pulse width modulated signals are used \nthen the module must be programmed to send pulses at the rate of 50 % duty cycle or \nat the rate proven to be the worst for the emissions to the simulated loads. The purpose \nof radiated emissions test is to verify that the module is not radiating energy harmful \nfor an already existing radio frequency energy space present in the real world. \n How would you test the radiations originating from the module when the radiant \nenergy in the real world is actively present? For example in the from of existing \nreal-world radio transmitting towers, cellular phone towers, radar stations, satellite \ntransmissions, and local RF energy emitters like, Bluetooth, cell phone, Wi-Fi, and \nvariety of other gadgets. \n The answer is not that simple; we must hide, and hide in a cave far from the \nmodern world, nonetheless it is dif\ufb01  cult to run away from the modern world, so we \nneed to \ufb01  nd a space free from radio energy where we can hide from the existing \nradiant energy to make our case. The hiding place is de\ufb01  ned as a space or room that \nmust now allow any radio energy inside. This room must be capable of absorbing \nall radio energy, which means it must not allow even the weakest signal of radio \nenergy inside the room. This room exists and in a technical term recognized as the \nRF Chamber. The RF Chamber had been a great topic for the writers of EMC \n speci\ufb01  cations; one of the speci\ufb01  cation writers is CISPR. It is a French committee to \ndevelop wide variety of speci\ufb01  cation on the subject EMC. However famous speci-\n\ufb01 cations of RF Chamber designs are recognized by CISPR25, and CISPR22. \n  CISPR     The Comite International Special des Perturbations Radio", "\ufb01  cation on the subject EMC. However famous speci-\n\ufb01 cations of RF Chamber designs are recognized by CISPR25, and CISPR22. \n  CISPR     The Comite International Special des Perturbations Radioelectriques or in \nEnglish the International special committee on Radio Interference is best known by \nModule RI Battery   Fig. 7.4    Radiated Immunity, \na quality to absorb radio \nwireless energy       \nModule CI Noise  Fig. 7.5    Conducted \nImmunity to absorb unwanted \nconducted energy        \n 7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n233\nits abbreviation CISPR, is a special committee under the sponsorship of the \nInternational Electrotechnical Commissions (IEC). The membership is from national \ncommittees of the IEC, and other number of other international organizations inter-\nested in the reduction of the radio interference. CISPR was founded in 1934. \n   http://www.cclab.com/cispr.htm      \n In Fig.  7.6 , a module is shown inside the chamber. It is powered by the vehicle \nbattery, a standard mandatory requirements while the EMC testing has been con-\nducted inside the chambers. All EMC test sites across the board use the vehicle \nbattery for similar set of EMC testing inside the chambers due to the fact that battery \npower is the only non-electronic cleanest \ufb01  ltered power source available to do the \njob. No other electronic power can replace the battery power.  \n The module must be powered up with all of its clock-sources fully operational. \nAll frequency related functions must be active. All PWM outputs must be at 50 % \nduty cycle with correct loading current. RF Radiated emissions are then received by \nthe antenna, which feeds the sophisticated electronic measuring system meant to \nunderstand the limits of radiations de\ufb01  ned by the respective vehicle manufacturer. \nMultiple antennas are utilized to capture the radiated emissions for many different \nfrequency bands like for example:\n\u0081    Rod Antenna to cover 0.15\u201330 MHz range  \n\u0081   Log Periodic Antenna to cover 200\u20131,000 MHz range  \n\u0081   Bi-conical Antenna to cover 30\u2013200 MHz range  \n\u0081   Horn Antenna to cover above 1 GHz range    \nBattery RF \nRece", "ic Antenna to cover 200\u20131,000 MHz range  \n\u0081   Bi-conical Antenna to cover 30\u2013200 MHz range  \n\u0081   Horn Antenna to cover above 1 GHz range    \nBattery RF \nReceivers\nComputer\nbased \nmeasuring\nSystemModule RE\n  Fig. 7.6    Module radiated emissions test set-up        7.6  Automotive Radiated Emissions Testingzamann@us.panasonic.com\n234\n It is an interesting fact that radiated emissions testing set-up is pretty simple to \nmake compared to other immunity tests set-up. It only requires battery-power to \nturn-on the module when it is placed inside an anechoic chamber. However, this is \nthe most expensive test setup for the EMC lab to undertake due to the expensive \nconstruction of an anechoic chamber. It requires compliance with the EMC stan-\ndards de\ufb01  ned in CISPR, IEC, SAE and others speci\ufb01  cations and by far the most \nexpensive real state in any EMC lab. \n The bus does not stop here, and on the same token, vehicle level EMC compli-\nance testing is a capital investment too. Yet, there are vehicle manufacturers who \ninvested in their own vehicle level EMC test chambers. It is amazing to see a \nvehicle parked in an anechoic chamber, big enough to accommodate not only a \nlarge size vehicle, but antenna and movement space to conduct radiated and con-\nducted emissions testing for the entire vehicle. However, the EMC compliance is \nso fundamental in nature that the commercial and military airplanes \ufb02  ying over our \nheads are also required to pass the EMC testing. Imagine the size of an anechoic \nchamber being utilized in the aerospace industry where the airplane has to be \nbrought in to perform testing based on strict aerospace safety and compliance stan-\ndards. A picture of a small airplane parked in an anechoic chamber in a controlled \nenvironment to perform EMC compliance testing could be an impressive reason to \nsay \u2018wow\u2019. \n It is impractical to build an EMC chamber to \ufb01  t large commercial jet liners like \nB777, A380 or B747, however EMC test compliance of jetliners are still required. \nHence it is accomplished by \u2018divide and conquer\u2019 strategy, where an engine may be \ntested separately or avion", " jet liners like \nB777, A380 or B747, however EMC test compliance of jetliners are still required. \nHence it is accomplished by \u2018divide and conquer\u2019 strategy, where an engine may be \ntested separately or avionics systems separately, and so on. \n Another interesting example of EMC compliance that may blow you away is the \ncompliance needed for a cruise missile launched to destroy an enemy target. You \nmay wonder why we needed EMC compliance for a missile designed to wreck \ndestruction on the enemy target. We should not be worrying for enemy airspace \nlet alone the frequency spectrum space. The answer may intrigue you because now \nit is more essential to design electronics and navigation systems to safely function \nin both \u2018radio energy atmosphere\u2019. A negative effect of either RF energy spectrum \nmay jeopardize the navigation, guidance or on-board electronics. \n It is a pretty common practice in the automotive industry that the module EMC \ncompliance is neither conducted by the module manufacturer nor by the vehicle \nmanufacturer. Rather it is the job of an independent EMC lab to perform the EMC \ntesting. There are two major milestones for any EMC lab to achieve before they can \nbe tasked to test the automotive vehicle module:\n\u0081    A2LA accreditation (American Association of Laboratory Accreditation)  \n\u0081   Vehicle manufacturer recognition    \n EMC labs cannot perform a well-de\ufb01  ned set of EMC testing without the accredi-\ntation of A2LA. In addition to A2LA, it is also required that the EMC lab must be \nrecognized by the vehicle manufacturer. So it is mandatory for any module design \ncenter to test and validate their products in an approved test facility recognized by \nthe vehicle manufacturer to get the engineering sign-off on the product or module. 7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n235\n If the EMC lab is not located in USA, then it can work with International \nLaboratory of Accreditation Corporation (ILAC), and A2LA subsequently to get \nthe bene\ufb01  t of being recognized by both entities. Additionally, vehicle manufacturer \napproved test \ufb01  xture set-up is essentially required to conform to the speci\ufb01  cations \nreleased by the respective vehicle manufacturer to carry out the respective OEM \nway of testing. It is important to understand that each automotive OEM owns EMC \ntest procedures, and test \ufb01  xture set-up as per", "i\ufb01  cations \nreleased by the respective vehicle manufacturer to carry out the respective OEM \nway of testing. It is important to understand that each automotive OEM owns EMC \ntest procedures, and test \ufb01  xture set-up as per their corporate speci\ufb01  cations. EMC \nlabs need to get the approval of vehicle manufacturer before it can kick-off any \nEMC testing. \n Some of the CISPR, ISO and IEC speci\ufb01  cations are listed below:\n\u0081    IEC and CISPR 25\u2014Anechoic Chamber for Radiated Emissions  \n\u0081   ISO 11452-2\u2014Anechoic Chamber Radiated Immunity  \n\u0081   ISO 11452-4\u2014Bulk Current Injection  \n\u0081   ISO 11452-8\u2014Immunity to Magnetic Field  \n\u0081   ISO 11452-9\u2014Immunity to Portable transmitter  \n\u0081   ISO 7637-3\u2014Transient Immunity  \n\u0081   ISO 10605\u2014Electrostatic Discharge    \n CISPR, a French EMC committee, has established a variety of standards for the \nEMC related documents. One of its standards, CISPR 25, is well known in EMC \nindustry for the anechoic chamber. The CISPR 25 outlines the needs and wants of a \nroom isolated from real world radio-energy around us, so that the electronics devices \ncould be tested without the effects of existing radio energy spectrum that will impact \nthe device under test. In Fig.  7.7  a picture of chamber is shown. As can be seen, the \nsurrounding cones on the chamber walls are used to insulate the RF energy to com-\npletely absorb the energy from the outside radio energy. The table is used to place \nthe module, where antenna is used to learn about the emissions from the module. It \nis required that many antennas must be used to cover all the frequency spectrum \nmandated for the testing and the target market frequency spectrum.   \n  Fig. 7.7    CISPR 25 EMC \nchamber        7.6  Automotive Radiated Emissions Testingzamann@us.panasonic.com\n236\n7.7     Automotive Conducted Emissions Testing \n This test requires that the module must turn on completely with all clock-sources, \nand generating pulses required for normal operation. The purpose of this test", "ann@us.panasonic.com\n236\n7.7     Automotive Conducted Emissions Testing \n This test requires that the module must turn on completely with all clock-sources, \nand generating pulses required for normal operation. The purpose of this test is to \nverify that module power and return lines are not conducting harmful energy to the \nvehicle battery power distribution network. This harmful energy can feed other \nmodules and thereby create another issue. \n This issue is that the primary non-compliance of conducted emissions to the bat-\ntery power distribution network could create secondary non-compliance by trigger-\ning radiated emissions through the vehicle wires because now the vehicle wires act \nlike a transmit antenna. \n In order to test the conducted emissions from the module, the power feeding \nlines are monitored by the measuring equipment, which must pass through the line \nimpedance stabilization network (LISN). The conducted emissions have a de\ufb01  ned \nfrequency envelop and in order to measure as per ISO standards, an appropriate \nLISN has to be placed between the measuring equipment and the originator of the \nemissions. As the name suggests it stabilizes the line impedance to have measure-\nment consistency even though the noise frequency spectrum may be changing. \nAs we know varying frequency will change the dynamics of impedance. The LISN \nis used across the board by the EMC labs, and it is potentially not dependent on the \nvehicle OEM unless otherwise directed by the vehicle OEM (Fig.  7.8 ).  \n The conducted emissions testing set-up does not require an anechoic chamber. \nThe module power and return lines are monitored for the conducted emissions orig-\ninating from the module.  \n7.8     Testing RF Radiated Immunity Above 400\u20133,100 MHz \n It is the reverse process of radiated emissions and now the predator is the prey. In \nradiated emissions, we measured noise exiting out of the module. However in RF \nradiated immunity we purposely aim the module to try absorbing radio energy from \nthe transmitting antenna in order to check how good the module is to ignore, absorb \nor get \u2018annoyed\u2019 by the noise transmitted by the transmit antenna. So in reality we \ntry to \u2018irritate\u2019 the module by sending radio energy towards the module. \n This test requires that the unit must be turned on completely to function as per \ndesign intent by making it fully operational, and then a series of radio frequency", " \ntry to \u2018irritate\u2019 the module by sending radio energy towards the module. \n This test requires that the unit must be turned on completely to function as per \ndesign intent by making it fully operational, and then a series of radio frequency \nMeasuring \nEquipment\nLine Impedance Stabliza/g415on Network (LISN)Module CE Battery \n  Fig. 7.8    Module conducted emissions test set-up        7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n237\nenergy is bombarded on the overall chassis of the module. The module must func-\ntion correctly throughout the period of time while the radiant energy is targeted onto \nthe module. There are good chances that in a \ufb01  rst-time design the module may devi-\nate from its operational envelop functions. However based on the module designed \nscope there is some room for degradation of functions allowed. \n There are many bands of radiated immunity tests that the automotive module must \nhave to go through to learn \u2018quality\u2019 or resilience of module to absorb energy thereby \nachieving a \u2018thumbs-up\u2019 scenario. Earlier in radiated emissions testing, we had used \nmultiple receive antennas to measure radiated emissions. But now the positions has \nreversed and in this scenario the transmit antenna is sending the radio energy to the \nmodule under test. The frequency envelop of this test is 400\u20133,100 MHz \n In this test it is required that the transmit antenna must be positioned at a pre- \nde\ufb01 ned distance from the module. After the antenna is powered up, a low-stress \nlevel radio transmission (400\u20133,100 MHz) must be bombarded on to the module, \ntreating the module as one piece even if the module has a plastic case, a glass shield, \na metal chassis or mixture of any combination. \n The entire body of the module must have to be oriented towards the radiant \nenergy transmit antenna bombardment. Even so, a single orientation may not suf\ufb01  ce \nto simulate the real world usage pro\ufb01  le. So for all practical purposes, different orien-\ntations are selected to test the module in order to understand how the vehicle move-\nments in the real world will play out to the module resilience against radio energy. \n While the tests are being conducted the functions of the module are being \nobserved to see the degradation of operation in order to", " order to understand how the vehicle move-\nments in the real world will play out to the module resilience against radio energy. \n While the tests are being conducted the functions of the module are being \nobserved to see the degradation of operation in order to determine if it is safe to \ndeploy the new module in a costly vehicle launch. Often it is not easily determined, \nso a cross-functional team may need to gather for a review of EMC lab \ufb01  ndings, if \nit is critical for the system to go or no-go for the vehicle use. If the scenario is a \nno-go then a proper redesign is needed. The failure of radiated compliance had, on \nmany occasions, resulted in a metallic chassis or apertures and openings to be re- \ndesigned. Nevertheless electronics re-design is often the case as well! (Fig.  7.9 )   \nModule\nFunctional \nVerification\nSet-UpRF \nTrnasmittersModule Battery\nComputer\nControl \nSystemOptical Link Optical Link\n \n  Fig. 7.9    Module radiated immunity test set-up        7.8  Testing RF Radiated Immunity Above 400\u20133,100 MHzzamann@us.panasonic.com\n238\n7.9     Testing Radiated Immunity Bulk Current Injection \nMethod \n In a second scenario, there is a way to inject bulk current pulses over the wire bun-\ndle connected to the module. The purpose is to inject controlled RF stress levels to \nthe module harness. The test\u2019s intent is to capture weakness in the module by virtue \nof a harness connected to the module and system components. It is called the RF \nenergy susceptibility test with the frequency envelope of 1\u2013400 MHz \n It is important to understand the method by which the controlled RF stress is \napplied. Unlike the previous method where the transmit antenna was utilized, this \ntest does not employ any transmit antenna for many good engineering reasons. All \nit does is that it uses the injection probe to apply RF stress levels without being \nelectrically connected to the harness. The test simulates the conditions that exist \ninside the vehicle where wires or harnesses may be in\ufb02  uenced by localized coupling \nthat may act like transmit antenna unintentionally. It is a well-established scenario \nwhere you could have transmitters installed in a module or system components. \n The smart way to provide the RF stress level without physically connecting the", " uenced by localized coupling \nthat may act like transmit antenna unintentionally. It is a well-established scenario \nwhere you could have transmitters installed in a module or system components. \n The smart way to provide the RF stress level without physically connecting the \nwires is to employ a clamp. The clamp is a mechanical device with a moveable jaw \nso that the harness may be placed inside the clamp openings. Inside of the clamp a \nwire-loop representing the secondary of a transformer is enclosed, where the pri-\nmary loop is connected to the RF ampli\ufb01  er. The one round of secondary connected \nto the RF ampli\ufb01  er is needed to induce the RF currents. The energy of RF stress \nlevels is now sent to the injection probe thereby creating RF disturbances. \n The clamp attachment-points to the harness are subject to a vehicle manufactur-\ner\u2019s governing document\u2019s recommended positions. These positions are de\ufb01  ned in \nthe EMC test set-up and procedures. These are the documents the EMC lab follows \nto conduct module level testing. The \u2018passing grades\u2019 are de\ufb01  ned in the module \nEMC test plan submitted to the vehicle OEM. The module design team requires \nsubmitting the proposal for pass-fail grades. Nevertheless, the owner of the system \nand vehicle manufacturer have the \ufb01  nal say to determine the \u2018grading\u2019. Safety criti-\ncal modules must get [A] or [A+] grade. \n In Fig.  7.10  a typical set-up utilized by the EMC labs is shown. But before the \ntest begins, the set-up requires connecting the module to the pre-de\ufb01  ned length of \nharness. This is the basic requirement of the bulk current injection test to have the \nharness built just for this test, let\u2019s call it a BCI harness. The length of BCI cable is \nnot disclosed here due to con\ufb01  dentiality issues. So, one-end of the BCI cable is \nattached with the module, and the other-end to the module functional load box. The \ndistance simulates the vehicle harness length that could see the unintended RF \nenergy inside the vehicle.  \n When the module is powered-up and running, the key operational features are \nbeing monitored. This is done by utilizing the monitoring equipment to make sure \nthat module key functional parameters are seen on the measuring equipment for \nrecording purposes", " the vehicle.  \n When the module is powered-up and running, the key operational features are \nbeing monitored. This is done by utilizing the monitoring equipment to make sure \nthat module key functional parameters are seen on the measuring equipment for \nrecording purposes. The purpose of this exercise is to learn later if the degradation of \nperformance is actually happening during the tests. The tests are then conducted by \ninjecting RF currents utilizing bulk current injection probe wrapped around over the \nharness. The clamp is used to secure the bulk current injection probe over the harness. 7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n239\nAfter a \ufb01  rm set-up the disturbances are applied depicted in Fig.  7.10 . While the \n disturbances are applied the operation of modules is monitored and recorded by \nemploying the relevant equipment. The BCI probe position is moved over the harness \nto simulate closer or farther distance proximity from the RF stress level. A total of \nthree positions have been used by many vehicle OEM\u2019s. Figure  7.10  [move left \narrow] and [move right arrow] demonstrates the fact that it could be moved in any \ndirection to place in three different positions. \n There is an important aspect of BCI testing, where testing must be conducted to \nunderstand the impact of noise nullifying the effects of common mode and differen-\ntial mode rejection ratio. In order to pursue that avenue the set-up must be modi\ufb01  ed \nby removing all the return lines (ground lines) from the injection probe, and placing \nthem separately on the test set-up ground plane. \n BCI testing has been incorporated in automotive, aerospace and military. The criti-\ncal feature of bulk current injection probe is to inject RF level within the vehicle atmo-\nsphere to understand the impacts on the module performance. The lengths of the cable \nalong with copper conductors connected to the module are the foremost target of bulk \ncurrent injection. The reason for doing that is to test and qualify different scenarios in \na typical vehicle when the harness and modules are routed inside the vehicle  \n7.10     Cellular Phone Immunity Tests \n As shown in Fig.  7.1  at the beginning of the chapter, the cell phone was shown as a \ntransmitter and as a receiver. It is essential to test radio energy transmitted by the cel-\nlular phone transmitter because it may disturb", " Fig.  7.1  at the beginning of the chapter, the cell phone was shown as a \ntransmitter and as a receiver. It is essential to test radio energy transmitted by the cel-\nlular phone transmitter because it may disturb the module operation within its range. \nThis happens when the cell phone is placed close to the vehicle module where the \ntransmit power may impact the safe operation of the module in a close proximity. As \nstated the word \u2018close proximity\u2019 ampli\ufb01  es the meaning that not all modules are really \nrequired falling in the category of testing the compliance. The detail of distance \nrequirements to test or not to test is based on the close proximity of the module verses \nthe cell phone placement, even so the fundamental principle applies how powerful the \ncell phone transmitter is verses how close the module is installed inside the vehicle. Move Left Move Right\n     Clamp\nMonitoring\nEquipment\nHarness Length Defined  by the Vehicle ManufacturerBattery Module\nFunctional\nLoad Box Module\nLISN\nRF  1MHz-400 MHz\nComputer Control Bulk Current Injection\n  Fig. 7.10    Bulk current injection test set-up        7.10  Cellular Phone Immunity Testszamann@us.panasonic.com\n240\n A test set-up shown in Fig.  7.11  is pretty similar to BCI test set-up. Nonetheless \nit is a different test. The RF transmit antenna is hooked with the RF transmitter \nelectronics that could transmit frequency envelop of 360\u20132,700 MHz with different \ntransmit powers covering cell phone range globally including GSM band used in \nEurope or many major portions of the world. The transmit antenna is moved over \nthe module at multiple pre-de\ufb01  ned locations with a distance [d] by the help of a cali-\nbrated moving arm in order to maintain consistency over the antenna positions. As \nper normal practice in all immunity tests, the module operational functions are mon-\nitored through the module functional load box.   \n7.11     Testing Conducted Immunity \n This test requires that the module must be turned on completely to function as per \ndesign intent and after that a sequence of radio frequency energy is bombarded on \nthe overall chassis of the module. The module must function correctly throughout \nthe period of time while the radiant energy is bombarded on to the module. However \nthere is room for some degradation of functions based", " of radio frequency energy is bombarded on \nthe overall chassis of the module. The module must function correctly throughout \nthe period of time while the radiant energy is bombarded on to the module. However \nthere is room for some degradation of functions based on the module functions \nperformance.  \n7.12     Testing Automotive Conducted and Coupled Immunity \n Counter measuring the events in the vehicle due to local electromagnetics switch-\ning, motor-rotations, relay-chattering, back EMF and inductive-load in-rush current \nevents creates a different kind of failure mechanism, where noise could either be \ncoupling or conducted through the copper wires running all across the vehicle. It is \na major challenge faced by the vehicle manufacturer. Taking this challenge in their \nown hands is like a corporate directive to comply with corporate standards of \u201cvehi-\ncle energy atmosphere\u201d. The vehicle atmosphere compliance is needed to become Monitoring\nEquipmentLISN\nRF 360MHz to 2700MHz\nComputer Control\nBattery \nHarness Length Defined  by the Vehicle ManufacturerMoveable arm antennaModule \nFunctional \nLoad BoxModule\n  Fig. 7.11    Cell phone transmission test set-up        7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n241\nthe best among the competition. However all it relies how the corporate require-\nments are de\ufb01  ned, the more stringent requirements means kind a \u2018radio salience\u2019 1  \nenvironment which could bene\ufb01  t greatly\u2014not only the safe operation of electrical \nsystems, but also a reception performance dearly\u2014installed in a typical vehicle. \n There are many areas of concern in the vehicle wiring, devices and modules \nenclosed in a rigidly tied space. Here we examine a few major contributors listed \nbelow, and shown in Fig.  7.12  affecting the noise coupling and conducting that \ncould impact overall system performance: \n\u0081    Module wires cross-coupling or conducted noise  \n\u0081   System components, devices cross-wire coupling or conducted noise  \n\u0081   Electromagnetic devices coupling or conducted noise    \n As shown in Fig.  7.12 , a vehicle system may see noise due to wiring, module and \nelectromagnetic devices. However, it is a complex interaction of synergies among \nthe emitters and the absorbers. Yet for the sake of further clari\ufb01  cation, we list and \n", " due to wiring, module and \nelectromagnetic devices. However, it is a complex interaction of synergies among \nthe emitters and the absorbers. Yet for the sake of further clari\ufb01  cation, we list and \nde\ufb01 ne additional governing factors affecting the EMC compliance:\n\u0081     Modules:  A module could be an emitter of energy, and at the same time it could \nbe an absorber because of its good ground plane or highly conductive large sur-\nface area or by the design of a fully enclosed chassis. Furthermore, module \ninstallation location near, far or attachment to the vehicle body could be an \nadvantage or disadvantage depending on which side of the \u2018story\u2019 plays out more \neffectively. There have been issues recorded by a vehicle manufacturer where the \nlocation next to an emitter has caused neighboring system faults.  \n\u0081    Number of wires:  The number of wires routed in the vehicle few or many could \ngenerate secondary effects of disturbance subject to the proximity of wires near \n1   Radio silence terminology is used when navy submarine turns-off all radio communication to \navoid detection by enemy sonar. However it generally means no radio energy being generated by \nthe equipment. Noise\nA Vehicle System\nElectromagnetic devices\nModule\n WiringoElectromagnetic devices coupling or conducted noise\n  Fig. 7.12    A vehicle system interaction of noise        7.12  Testing Automotive Conducted and Coupled Immunityzamann@us.panasonic.com\n242\nor far from the disturbing source. If the wire is being used to enable or disable a \nsystem resource, it may get falsely triggered. In other scenarios when the wires \nare bundled, a different type of failure could happen where source disturbance \nplays down a cross-coupling role to affect the degradation of the signal\u2019s com-\nmon mode rejection ratio.  \n\u0081    Event Timing:  The time of the event is another factor to consider because a \nsource disturbance at a critical time for a system may induce a failure with no \nrecovery from the module software. It is a well-established fact that when an \nengine crank happens, all \u201chell breaks loose\u201d because battery voltage dips, and \ncycles through the dips pending engine start. The starter motor \u201ckicks in\u201d and \n\u2018hogs\u2019 all \u2018juice\u2019 from the battery until the starter motor stops, and while waiting \nfor the starter motor", " battery voltage dips, and \ncycles through the dips pending engine start. The starter motor \u201ckicks in\u201d and \n\u2018hogs\u2019 all \u2018juice\u2019 from the battery until the starter motor stops, and while waiting \nfor the starter motor to \ufb01  nish hogging the battery juice, every module struggles \nto keep up the timing to get their \u201cact together\u201d.  \n\u0081    Characteristics of wires  like wire gauge, shielding, and twisting have some role \nto play when the energy is induced on the wires. A shielded cable is a better \nchoice to absorb energy for signals sensitive to noise. It is a good practice to fol-\nlow to have shielding when the system resource requires traveling far distance \nroute subject to module-sensor cable length, routing or installation location of \nthe components. A twisted pair of wiring within the vehicle is needed when the \ncommon mode rejection ratio (CMRR) advantages are available.  \n\u0081    Length of wires or harness , play a vital role as they may induce noise at termina-\ntion points, along the routes of attachments near or far from the source distur-\nbances. An electrically terminated wire, or un-terminated will impact the noise \nor may generate antenna effects subject to signal attributes.  \n\u0081    Electrical grounding  is a major factor for the radiated emissions, and immunity \ncompliance testing. In actual fact every vehicle OEM issues a directive within \nthe module EMC test plan to make sure to test the module correctly. When the \nmodule is installed in the vehicle rigidly attached to the vehicle chassis, then the \ntesting must have to be conducted by placing the module on a ground-plane \ninside the EMC chambers, and on the other hand if the module is insulated from \nthe vehicle chassis then it must be placed on the insulated foam in the EMC \nchambers. It makes a huge difference on the overall performance of radiated \nemissions, and radiated immunity when the module is placed on the ground \nplane verses insulated and placed on the foam. However, the debate of \u201cgood, \nbad or ugly\u201d rests on the test results, and not necessarily based on insulated foam \nplacement or vehicle chassis ground. While the module is in the EMC chambers \nfor testing, a grounded module will see a perfect ground. However in the real \nworld of vehicles there exists no perfect ground. Rather all grounded terminals \nare available as noisy grounds or quiet grounds. A", " While the module is in the EMC chambers \nfor testing, a grounded module will see a perfect ground. However in the real \nworld of vehicles there exists no perfect ground. Rather all grounded terminals \nare available as noisy grounds or quiet grounds. A noisy ground is where electri-\ncal currents are surging badly. A quiet ground is where low currents are surging \nbadly, so in reality there is no such thing like perfectly good quiet ground.  \n\u0081    Numbers of electromagnetic devices like relays, motors, solenoids are  key \nenablers for the electrical noise injected in vehicle electrical systems. An effect \nof these devices is to induce unwanted energy either through the wires or coupled \nmagnetically or radiated over the air. Actually this is the biggest source of noises 7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n243\nacross the board. A blower motor control over the PWM is like generating type \nof noises requires so much to invest to counter it.  \n\u0081    High current switching  in a typical vehicle could be realized either by transistor \nswitching or through the relay-contacts. Each may generate different kind of noise \nscenario depending on the load-current, switching-speed, relay-coil current, and \nrelay contacts arching subject to load current, length of wire, and copper contents.  \n\u0081    Distance of harness  from the electromagnetic devices and other noise source \nemitters is a signi\ufb01  cant factor which could play out positively or negatively.  \n\u0081    Vehicle Communication buses  are differential pair of wires routed across the \nvehicle chassis, so does its susceptibility to the electromagnetic devices and \nother noise source emitters. There are de\ufb01  ned rules for the bus terminations, bus \nimpedance, capacitive loading of the bus to comply with safe operation. It \nincludes, but not limited too high, and low voltage margins, matched termina-\ntions. A mismatched termination could cause serious EMC concerns. A mis-\nmatched bus impedance could be a module having improper impedance or \nmissing termination resistors.    \n The vehicle atmosphere or playground represents all the electronic components, \nharnesses, wires, battery power feeds and the modules as shown in Fig.  7.13 . It is \nshown here to emphasize the fact that each device, module and battery is connected \nthrough wires enclosed inside a vehicle. The vehicle chassis", "es, wires, battery power feeds and the modules as shown in Fig.  7.13 . It is \nshown here to emphasize the fact that each device, module and battery is connected \nthrough wires enclosed inside a vehicle. The vehicle chassis universally worked as a \nbattery negative. The devices close to the engine are connected directly to the battery \nby shorter distances; however, this creates a noisy ground (NG) because the majority \nof high current surges are happening closer to the engine. The starter motor, steering \nwheel high-torque motor and many other high-current switching are the enablers. \nThere are points at the vehicle chassis, where ground placements have the bene\ufb01  t of \nnot as noisy, and could be referred as quite ground (QG). But this is just a relative term.  QG\n    NGHarness\nSolenoids\nMotorsHarness\nWires\nBatteryB+ \nGNDModuleStarter\nRelay Coils\nRelay Contacts\nAlternator Windings\nSwitching TransistorsVehicle Chassis\nVehicle Chassis\n  Fig. 7.13    Vehicle \u2018playground\u2019 for EMC noise coupling and conduction        7.12  Testing Automotive Conducted and Coupled Immunityzamann@us.panasonic.com\n244\n It is absolutely required to test, verify that the conductive noise, and coupled \nnoise generated locally are not negatively in\ufb02  uencing the safe operation of module, \nand systems. A typical vehicle comprises of small signals, medium current signals, \nand high-current power current \ufb02  owing onto the wiring. The vehicle energy atmo-\nsphere is \ufb01  lled with \u2018cocktail\u2019 of \u2018juices\u2019 de\ufb01  ned in Fig.  7.1  earlier. \n Based on these factors and many different vehicle related factors, vehicle manu-\nfacturers have come to rescue the vehicle electrical and electronic system by de\ufb01  n-\ning EMC test coverage and delineated some recommended test \ufb01  xtures. The details \nof these tests and test set-up are copyright protected information to the vehicle \nmanufacturers. Nonetheless for the sake of education we are listing generalized \nareas of weaknesses in the vehicle electrical system with reference to EMC compli-\nance, and how these weaknesses would have been addressed to test and evaluate by \ndeploying the specialized test set-up vehicle manufacturer have", " the sake of education we are listing generalized \nareas of weaknesses in the vehicle electrical system with reference to EMC compli-\nance, and how these weaknesses would have been addressed to test and evaluate by \ndeploying the specialized test set-up vehicle manufacturer have de\ufb01  ned. \n A quick synopsis of test coverage is listed below:\n\u0081    Module vehicle system wiring that carries signals operates safely. It must not \ncouple noise detrimental for the signal integrity on the wire.  \n\u0081   Module vehicle wiring that carries B+ line operates safely, and must not incor-\nrectly provide power unsafe for module operation.  \n\u0081   Module vehicle wiring that carries GND line operates safely, and offset voltage \ndrop to ground for each independent module must not go beyond a certain limit.  \n\u0081   Module must not get damaged while the load dump pulse is applied to the power feeds  \n\u0081   Module must not get damaged when the Electrostatic Discharge is applied to \neach and every pin exposed to the vehicle harness or wiring or human body touch \nin powered condition in vehicles, repair centers, test and research centers  \n\u0081   Module must not get damaged when the Electrostatic Discharge is applied to \neach and every contact exposed to the human body touch in unpowered condi-\ntion like it happens in transportation mode when the module is not powered  \n\u0081   Module must not get permanently damaged when the module enclosure is sub-\njected to the electrostatic discharge test.  \n\u0081   Module must not get damaged when the battery polarities are reversed for a short \nor a prolong period of time  \n\u0081   Module must detect if the battery voltage increases above its operational envelop, \nand module must not get damaged if the overvoltage sustains for a prolong \nperiod of time either transient or steady-state.  \n\u0081   Module must not get damaged when dual battery power in-series is applied inad-\nvertently for a short or longer period of time.  \n\u0081   Module must perform normally even when the battery B+ is exposed to voltage \n\ufb02 uctuations, noise injections, transient and continuous disturbance  \n\u0081   Module must survive all crank events for all practical purposes needed for its \nfunctions, if any de\ufb01  ned in the functional scope  \n\u0081   Module must recover after a short-duration of battery drop-out.    \n In Table  7.1  the summary of conducted immunity tests coverage are tabulated.", " \nfunctions, if any de\ufb01  ned in the functional scope  \n\u0081   Module must recover after a short-duration of battery drop-out.    \n In Table  7.1  the summary of conducted immunity tests coverage are tabulated. \nThe attributes are listed in the \ufb01  rst column, and next to each attribute type of con-\nducted immunity is de\ufb01  ned. It is interesting to note that B+ has the highest number \nof coverage listed as listed twice in top and bottom rows. The wire-coupling tests \nare covered across the board for all attributes.7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n245     Table 7.1    Conducted immunity coverage   \n Attributes  Conducted immunity test coverage \n B+  Wire coupling  ESD unpowered  Reverse polarity  Continuous disturbance  Noise injection  Transient Disturbances  \u2013 \n GND  Wire coupling  ESD unpowered  Ground shift  \u2013  \u2013  \u2013  \u2013 \n All Signals  Wire coupling  ESD unpowered  Short to GND a   Short to B+ a   Shorted together a   \u2013  \u2013 \n Chassis  Floating  ESD unpowered  Orientation \n(RF Immunity)  Grounded  \u2013  \u2013  ESD \n Start Switch  Wire coupling  ESD unpowered  Cold Crank \nrecovery  \u2013  Warm Crank \nrecovery  Transient disturbances  \u2013 \n CAN Bus  Wire coupling  ESD unpowered  Short to GND  Short to B+  Shorted together  Cold Crank recovery  ESD \n Customer \nTouchable Surface  \u2013  ESD unpowered  \u2013  \u2013  \u2013  \u2013  ESD \n B+  Double battery  Cold Crank recovery  Load dump  Drop-out recovery  Warm Crank recovery  \u2013 \n   a Tests covered in design validation testing, these are short-term conditions  7.12  Testing Automotive Conducted and Coupled Immunityzamann@us.panasonic.com\n246\n7.13        Immunity Tests Operational Classi\ufb01  cations \n All immunity tests require operational veri\ufb01  cation of the modules, which is differ-\nent than the emissions tests where corporate and regulatory compliance is needed to \neither comply or non-compliance the test-criterion set-forth by the vehicle manufac-\nturer to meet the federal regulatory requirements", " of the modules, which is differ-\nent than the emissions tests where corporate and regulatory compliance is needed to \neither comply or non-compliance the test-criterion set-forth by the vehicle manufac-\nturer to meet the federal regulatory requirements. \n While performing the immunity tests, module operational performance is moni-\ntored with great interest. In order to see how minor or major degradation of  functions \nis achievable in the simulated world of radiant energy. The possible outcome of \nresults must be reviewed with reference to system performance. Furthermore the \nresults require reviewing under the guidelines of vehicle manufacturer approved-\nEMC- test-plan, system design authority, and relevant cross-functional team to take \ndecision either to \u2018\ufb01  x it\u2019 or \u2018don\u2019t \ufb01  x it\u2019 scenario. \n The degradation of functional performance has been classi\ufb01  ed by de\ufb01  ning mul-\ntiple cases of failures or performance degradation to the module required to be \ntested. Let\u2019s summarized for the sake of education some categories de\ufb01  ned as \nOperational Classi\ufb01  cations. \n Depending upon the vehicle manufacture it could have different nomenclature or \nnaming convention. The purpose of this exercise is to communicate to the reader \nabout the functional performance degradation allowed under certain conditions. \n7.13.1     Operational Classi\ufb01  cation 1 \n There is no performance degradation allowed. The module must function to its \ndesigned operational envelop during and after the exposure to the radiant or conducted \nenergy disturbances. A good example is an airbag module where no performance deg-\nradation is possible. The sole responsibility of \ufb01  ring the airbag squib to deploy the \nairbag cannot be compromised. The safety of airbag system for in-time airbag deploy-\nment, and to greater extent occupant\u2019s safety equipment must not be compromised.  \n7.13.2     Operational Classi\ufb01  cation 2 \n There is a minor performance degradation allowed. The module may deviate from \nits designed operational envelop during exposure to radiant or conducted energy \ndisturbances, but the safety of the vehicle and occupants must not be compromised. \nFurthermore the module must return to normal operational mode automatically \nonce the radiated or conducted energy disturbances have been removed. \n A good example is a module losing functionality when the disturbances have \nbeen applied; however, after the disturbances are removed", " compromised. \nFurthermore the module must return to normal operational mode automatically \nonce the radiated or conducted energy disturbances have been removed. \n A good example is a module losing functionality when the disturbances have \nbeen applied; however, after the disturbances are removed the module recovers \nwithout out any degradation of functions either because of a fail-safe hardware or \nby a software procedure through a controlled recovery.  7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n247\n7.13.3     Operational Classi\ufb01  cation 3 \n There is some performance degradation allowed. The module may deviate from its \ndesigned operational envelop during the exposure by the radiant or conducted \nenergy disturbances, but the safety of the vehicle and occupants must not be com-\npromised. Furthermore the module must return to normal with some minor manual \nintervention when the radiated or conducted energy disturbances have been \nremoved. The Operational Classi\ufb01  cation 3 module must not be allowed to experi-\nence irrecoverable damage to the module software and hardware. \n A good example is a module working as a slave module for an up-level master \nmodule, the disturbances causes the slave-module to enter in a degraded perfor-\nmance, but immediately upon learning that slave module is not responding, master \ntries to restart the operational readiness of the slave-module by sending commands \neither through the manual intervention or by an automatic procedure. So, if the slave \nmodule gets back to work after the disturbances are removed then the slave module \ncomplies with operational classi\ufb01  cation 3.  \n7.13.4     Operational Classi\ufb01  cation 4 \n A complete loss of function or a major degradation of performance is allowed. The \nmodule must not experience permanent damage to its electronics, printed circuit \nboard and software features after working through series of conducted or radiated \ndisturbances that have been applied\u2014while the module was either powered-up or \npowered-down \n A good example is an electrostatic discharge (ESD) testing where module must \nsurvive the high voltage ESD discharge points, the module may render unresponsive \nfor a short or long period of time, yet after \ufb01  nishing the tests it must recover when \nreenergized or get back to fully operational mode upon receiving a master reset \nsignal de\ufb01  ned in software as the cold start. \n In", " period of time, yet after \ufb01  nishing the tests it must recover when \nreenergized or get back to fully operational mode upon receiving a master reset \nsignal de\ufb01  ned in software as the cold start. \n In the real world a lightning strike may drive the modules to go in an unde\ufb01  ned \nstate that could render module completely unresponsive, or where it may become \npermanently damaged. But this is a situation that may not be comprehended in any \nelectronics design let alone automotive design space.   \n7.14     Module Wire Coupling Tests \n This is where rubber meets the road. In previous sections we had de\ufb01  ned how the \nnoise coupling could affect systemic wiring issue in a typical vehicle. The question \nis what type of signal noise coupling is possible in a real vehicle harness? There are \nmany, and the answer is tabulated in Table  7.2 .7.14  Module Wire Coupling Testszamann@us.panasonic.com\n248\n   Table 7.2    Signal coupling chart   \n Source  Type of signal  Attribute  Copper wire  Current  Coupling  EMC coverage \n Module  PWM dimming  Duty Cycle Modulated  Single  Low to medium  High  Required \n Module  Digital, discrete  Differential, Single  Twisted, single  Low  Low  Optional \n Module  Analog  Differential  Twisted  Low  Low  Optional \n Relay Contacts  Transient pulse  Subject to loading type  Single  Extremely high  High  Required \n Transistor Switch  Impulse  Subject to loading type  Single  High to low  Extremely high  Required \n Starter Motor  In-rush current  Transient inductive voltages  Single  High  Extremely high  Required \n Relay Coil Drive  Chattering relay  Pulsating noise  Single  Low  High  Required \n Alternator  Charging current  Duty Cycle Modulated  Single  Low to high  High to low  Required \n Blower Motor  High current  Duty Cycle Modulated  Single  Medium to high  Medium to high  Required \n Ampli\ufb01  er  Audio  Differential  Twisted shielded  Low to medium  Low  Optional \n RF Antenna  Low energy  Spectrum  Twisted shielded  Extremely low  Subject to spectrum  Required 7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n249\n", "ed  Low to medium  Low  Optional \n RF Antenna  Low energy  Spectrum  Twisted shielded  Extremely low  Subject to spectrum  Required 7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n249\n   Coupling issues in the vehicle are attributed to the signal variations, source type, \nand proximity of wiring. So a unique test \ufb01  xture is devised to test the coupling by \nsimulating the signals, and/or by changing the signal attributes. The \ufb01  xture is \naccordingly designed that it allows one-wire from the module harness, and one-wire \nfrom the noise-source placed side-by-side to couple electrically\u2014but bear in mind\u2014\n not connected electrically . A well-de\ufb01  ned length of wire is utilized to pair the wire-\nunder-test with noise-inducing-wire [wire under test in Fig.  7.14 ]. Both wires \ncoexist to simulate condition in the vehicle where neighboring wire could be gener-\nating noise. The noise inducing wire is de\ufb01  ned as [noise inducing conductor] in \nFig.  7.14 . The noise inducing conductor is connected to the noise injection electron-\nics driven by the computer controlled DC ampli\ufb01  er so that the application software \ncould generate different types of signal attributes with varying current and pulses.  \n The red lines show the path of noise travelling through the wire-loop, inducing \nnoise to the module wire. If the module is equipped with 40 wires, then the test has \nto be repeated 40-times. The Junction Point 1 to Junction Point 2 is the mechanical \ntest \ufb01  xture that could be built by different methods like employing a \ufb01  xed thick cop-\nper conductor with a \ufb01  xed plastic enclosure on a wire-grooved-door to secure the \nwire under test, or by an aluminum enclosure or an aluminum foil. \n The details of \ufb01  xture design rests with the vehicle manufacturer. While the tests \nare being performed\u2014each wire must have to be brought in to the \ufb01  xture, and then \nreturned back to the harness before the next wire is ready for testing. \n The monitoring equipment works exactly the same way as it does in other immu-\nnity tests. However the test requires that the harness of the module must split open \nwith each wire capable of being exposed", " the next wire is ready for testing. \n The monitoring equipment works exactly the same way as it does in other immu-\nnity tests. However the test requires that the harness of the module must split open \nwith each wire capable of being exposed to the noise-inducing-coupling-wire in the \n\ufb01 xture. Noise Injection\nHarness Length Defined  by the Vehicle ManufacturerNoise Coupling Conductor Length Defined by the Vehicle Manufacturer\nMonitoring\nEquipmentBattery Noise Inducing Electronics\nComputer ControlJunction\nPoint 2Junction\nPoint 1\nModuleModule\nFunctional\nLoad BoxWire Under TestNoise Coupling Conductor\n  Fig. 7.14    Wire coupling tests        7.14  Module Wire Coupling Testszamann@us.panasonic.com\n250\n If the twisted and shielded pairs are the established part of the vehicle harness, \nthen it must be cracked open partially for a small length of opening to be exposed to \n[noise coupling conductor]\u2014while the coupling tests are being performed. \n It is a standard practice in the automotive EMC testing that two sets of harness \nare deployed to run tests smoothly, where one set is used for coupling tests and other \nfor rest of the testing. \n  Knowledge Test  \n   Q :  If a module is attached to a harness having a total of 100 pins, how long it takes \nto \ufb01  nish the wire coupling tests?   \n  Answer: If each wire has to be coupled by \ufb01  ve perturbations simulated by the noise \ninducing electronics, and if an average of 3 min is required to complete one pertur-\nbation test then a total of 100   \u00d7  5  \u00d7  3 = 1,500 min are required to test the module. \nThis equates to 25 man hours of workload. If calculated at the rate of $57.35 per \nhour, a total of $1433.75 is needed for this test. About three shifts are required to \nfurnish the testing     \n7.15     Module ESD Test \n The ESD tests on modules simulate the conditions of the real world. A person walking \non a carpet could be charged up to 25,000 V or 25 kV subject to relative humidity, see \nTable  7.3  for details. However If that person touches an unpowered module, an unfor-\n", " \non a carpet could be charged up to 25,000 V or 25 kV subject to relative humidity, see \nTable  7.3  for details. However If that person touches an unpowered module, an unfor-\ngiving 25 kV Electrostatic Discharge surely applied right there at the touch point.\n   An ESD test on a module must be conducted either in powered-off or powered- on \nconditions. A powered-off condition exists while the modules are handled and trans-\nported. A power-on condition mostly resides for in-vehicle usage. Yet lab testing \ncould not be ruled out for a possible ESD event. In the vehicle if module is hidden \nunder the seat away from human touch then the likelihood of ESD discharge are \nremote, but if the module, or module\u2019s surface is touchable by the customer then \nthere are good chances that an ESD event could happen over the life of the vehicle. \n To countermeasure such events in the module, a testing method is required so \nthat the weakness in the electronics design could be found. Before the test begins it \nshould be known to the A2LA certi\ufb01  ed EMC lab where to apply the electrostatic \n   Table 7.3    Static voltage generation examples (Source: ESD Association)   \n Scenario  RH 10\u201325 % (V)  RH 65\u201390 % (V) \n Walking across carpet  35,000  1,500 \n Walking across vinyl tile  12,000  250 \n Worker at bench   6,000  100 \n Poly bag picked up from bench  20,000  1,200 \n Chair with urethane foam  18,000  1,500 \n   RH  relative humidity  7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n251\ndischarge points to perform testing by utilizing the ESD gun. The ESD gun is the \nonly equipment required for the tests. The test strike points are de\ufb01  ned inside the \nEMC test plan with clear pictorial representation like Fig.  7.16 . It is imperative to \nde\ufb01 ne strike points that are relevant to the electronics with a good sound under-\nstanding of highly likely use-case of human body touch. \n In the world of modules, many modules have customer touchable surfaces and \nthese touchable", " to \nde\ufb01 ne strike points that are relevant to the electronics with a good sound under-\nstanding of highly likely use-case of human body touch. \n In the world of modules, many modules have customer touchable surfaces and \nthese touchable surfaces are enormously critical for the ESD testing. However that \ndoes not mean that rest of the modules does not need ESD testing; almost all other \nmodules require ESD testing. \n If the electronics behind the control knobs in a vehicle has human touchable \nsurfaces like station tuning knob, temperature adjustment knob, or fan speed con-\ntrol, it is the best starting point to de\ufb01  ne the strike points right at the knobs because \ncustomer will touch these knobs more often than others. \n Figure  7.15  shows the powered ESD test set-up, the module is required to be \npowered-up, but the monitoring is not forcefully desired. It is a standard protocol to \ncheck the functionality of the module after the testing has completed. As stated \nearlier it is the operational classi\ufb01  cation 4, where a module could go completely \n\u2018wondering\u2019, but will return back to normal when the power is re-cycled, or a mas-\nter reset is issued.  \n The ESD gun could be programmed to strike 1\u201325 kV . Depending upon the type \nof module and the installation location in the vehicle, different voltage levels could \nbe selected to perform testing. The 4, 8 or 25 kV are some of the common selections \nused in the testing. Multiple strike points are required to cover the testing. The strike \npoints could strike ESD as contact discharge or air discharge. Both conditions may \napply subject to module attributes and the location in the vehicle. Imagine yourself \nwalking towards a vehicle, and if you can touch any module without even entering \ninside the car then there is a remote chance for it to an ESD event. Such conditions \nwarrant a 25 kV air discharge test. ESD GunModule \nFunctional\nLoad BoxModule\nBatteryZAP\n  Fig. 7.15    An ESD Testing, module Powered-On        7.15  Module ESD Testzamann@us.panasonic.com\n252\n The results of these tests usually encompass the weak electronic component that \ngets damaged during the tests. The permanent corrective of damaged component is \nthe robust", "        7.15  Module ESD Testzamann@us.panasonic.com\n252\n The results of these tests usually encompass the weak electronic component that \ngets damaged during the tests. The permanent corrective of damaged component is \nthe robustness improvement of the product. It is pretty common in the industry that \nfailures happen in the \ufb01  eld and happens at the module manufacturing locations, or \nin the vehicle manufacturing plants and the accountability goes to the electrical \noverstress (EOS). \n The EOS related failures are subject to thorough investigative review by the \nsemiconductor industry to understand their side of the story. The \ufb01  eld warranty \nreturns across the board in the industry \ufb01  nd EOS as a signi\ufb01  cant contributor of fail-\nures. However it is handled case by case basis, and at the end of the day, ESD is \n\u2018blamed\u2019 for all the \u2018ills\u2019. \n So, it is greatly needed to develop strike points relevant to real world usage so \nthat the weakness of the design could be found before the real world failures are \ngoing to occur (Fig.  7.16 ).  \n The unpowered ESD tests are simpler to perform. There are no wires, and no \npre-de\ufb01  ned length of harness needed to get attach with the module. Yet, there is a \nneed to bring out all the connector pins in a wider space so that the exposure to the \nESD gun is optimally spaced. \n In unpowered ESD testing all the module pins and enclosures are subject to ESD \ndischarge path. The contacts discharge is required to perform testing on each and \nevery pin.  \n7.16     Module Conducted Immunity Tests \n The conducted immunity tests have a broader spectrum on the B+ line. However \nother attributes de\ufb01  ned in Table  7.1  are covered as well. In order to comply with \nconducted immunity, a test set-up is utilized to control B+ line of the module. X\nX\nX\nX\nFront\nX\n     X = Strike Points\nX\nX\nXXTop\nSide  Fig. 7.16    ESD strike points        7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n253\nThe purpose of controlling the B+ line is to drive the module in controlled environ-\nments so that all the", " 7.16    ESD strike points        7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n253\nThe purpose of controlling the B+ line is to drive the module in controlled environ-\nments so that all the conditions speci\ufb01  ed in Table  7.1  could be veri\ufb01  ed. There are \nISO documents that could help to understand the wisdom and compliance, one of \nthe documents worth reading is ISO 16750-2. Even so, in order to make it easier and \nsimpler a broad spectrum of testing is listed below:\n\u0081    Fixed frequency noise to B+  \n\u0081   B+ V oltage Fluctuations  \n\u0081   Ground shift to B+  \n\u0081   Controlled B+ thresholds and Transient Noise  \n\u0081   Load dump pulse to B+    \n7.16.1     Fixed Frequency Noise to B+ \n The set-up requires that the noise is injected to the power input of the module. In \norder to add noise a programmable function generator is attached to the program-\nmable power source to superimpose noise on a clean DC power to verify the module \noperational performance under a noisy power rails. The test set-up drawing is \ndepicted in Fig.  7.18 . \n A noise coupled on B+ 13.5 is shown in Fig.  7.17 .  \n The test set-up is inducing noise by the help of programmable function genera-\ntor, whereas the programmable power source is providing power to the module. The \nmodule is connected to the functional load box to make it correctly operational \nbefore the monitoring equipment is hooked up with the set-up, the monitoring \nequipment could be just speci\ufb01  c to the module system design or may utilized stan-\ndard measuring equipment (Fig.  7.18 ).   \nT\nTime (s)0.00 2.50m 5.00m 7.50m 10.00 mVoltage (V)\n0.005.0010.0015.0020.00\n13.5V\n  Fig. 7.17    B+ \ufb01  xed frequency noise induction        7.16  Module Conducted Immunity Testszamann@us.panasonic.com\n254\n7.16.2     B+ Voltage Fluctuations \n", "7.17    B+ \ufb01  xed frequency noise induction        7.16  Module Conducted Immunity Testszamann@us.panasonic.com\n254\n7.16.2     B+ Voltage Fluctuations \n The set up requires that the module must undergo conditions where the power to the \nmodule must be interrupted at multiple voltage ramps for a brief interval to check \nthe functional degradation of the module. Furthermore to this scenario, the module \nmust see the noise injection during that brief interval. The module power must also \nbe tested for 14 V , 11 V , 10 V , 8 V to verify intervals with noise injections. The test \nset-up drawing is depicted in Fig.  7.19  for educational purposes   T\nTime (s)0.00 25.00m 50.00m 75.00m 100.00mVoltage (V)\n0.005.0010.0015.0020.00\n  Fig. 7.19    B+ line voltage \ufb02  uctuations       Harness Length Defined  by the Vehicle ManufacturerProgrammable \nFunction \nGeneratorModule Functional\nLoad BoxModule\nProgrammable \nPower Source\nMonitoring\nEquipment\n  Fig. 7.18    B+ line \ufb01  xed frequency noise induction test set-up        \n 7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n255\n7.16.3     GND Shift to B+ \n The set-up requires that a controlled shift to ground-line is exercised to verify the \noperation of the module under GND shift conditions. A controlled ground shift \nranging from 100 mV to 1.1 V can be tested to simulate the vehicle harness voltage \ndrop. The test set-up drawing is depicted in Fig.  7.20 .  \n While the module under goes the GND shifts testing, the key features of the \nmodule are monitored to make sure that it complies with manufacturer\u2019s pre-de\ufb01  ned \nfail-pass criterion. There are different intervals, and ground shift levels adapted by \nthe vehicle manufacture, nonetheless an educational version of ground shift pulse is \nshown in Fig.  7.21 .   Harness Length Defined  by the Vehicle ManufacturerGROUND SHIFT\nCONTROLModule Functional\nLoad BoxModule\nProgrammable\nPower Source\nMonitoring\nEquipment Computer \nControl\n  Fig", " shift pulse is \nshown in Fig.  7.21 .   Harness Length Defined  by the Vehicle ManufacturerGROUND SHIFT\nCONTROLModule Functional\nLoad BoxModule\nProgrammable\nPower Source\nMonitoring\nEquipment Computer \nControl\n  Fig. 7.20    GND shift test set-up       \nTime (s)0.00 50.00m 100.00m 150.00m 200.00mVoltage (V)\n0.00250.00m500.00m750.00m1.00\n  Fig. 7.21    GND shift pulse application        \n 7.16  Module Conducted Immunity Testszamann@us.panasonic.com\n256\n7.16.4     Controlled B+ Threshold and Transient Noise \n These tests require that B+ is varied with sustained controlled thresholds and tran-\nsient pulse behavior to check the module susceptibility against these conditions as \nshown in Fig.  7.22 .  \n There are variety of B+ threshold adjustment which must be tested based on the \nmodule pro\ufb01  le like for example if the module is designed to absorb power loss for \n100 ms then tests must be performed in controlled environment to make sure that \nmodule sustain 100 ms drop-out conditions. Likewise on the same token the thresh-\nold levels must be mixed with random noise to perform testing  \n7.16.5     Load Dump Pulse \n The load dump pulse is an electrical overstress applied to the module, it is required \nthat the module must have to survive with all of its electronics, when the load dump \npulse is applied. The ISO standards 16750 could be utilized to perform testing, \nhowever in the real world, a test of 37 V for a period of 150 ms may suf\ufb01  ce, but \nwhen developing electronics module for a particular vehicle manufacturer a review \nof load dump pulse requirement must be de\ufb01  ned. The vehicle alternator design and \nthe centralized load dump protection placed inside the alternator is a contributing \nfactor to determine the actual load dump pulse requirements. \nHarness Length Defined  by the Vehicle ManufacturerModule Functional\nLoad BoxModule\nProgrammable\nPower Source\nMonitoring\nEquipment Programmable\nTransient\nGenerator\n  Fig. 7.22    B+ line transient noise        7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n257\n The module must", "able\nPower Source\nMonitoring\nEquipment Programmable\nTransient\nGenerator\n  Fig. 7.22    B+ line transient noise        7 Module and Vehicle EMC Compliancezamann@us.panasonic.com\n257\n The module must be functionally tested before the load dump pulse is applied, it \nis then thoroughly inspected visually, and retested after the load dump pulse testing \nhas furnished. A visual veri\ufb01  cation of power supply components and load dump \nprotection mechanism is absolutely mandatory to determine the pass and fail crite-\nrion (Fig.  7.23 ).      Module Load Dump Pulse  Fig. 7.23    Load dump test \nset-up        7.16  Module Conducted Immunity Testszamann@us.panasonic.com\n259 \u00a9 Springer International Publishing Switzerland 2015 \nN. Zaman, Automotive Electronics Design Fundamentals , \nDOI 10.1007/978-3-319-17584-3  A  \n  Abstraction , 146\u2013150, 152\u2013154, 159\u2013161, \n165\u2013168, 170\u2013173, 176\u2013194, 199\u2013208   \n  Active noise cancellation (ANC) module , 213   \n  Alternator , 77, 78, 83, 92, 102, 107, 132, \n218, 256   \n  Android , 45   \n  Anti-lock brake mechanism , 3   \n  Antilock brake system (ABS) , 3, 30, 56\u201357, \n61, 62, 69, 225\u2013226   \n  Audio control module (ACM) , 213   \n  Audio digital signal processing (DSP) module , \n13, 14, 213   \n  Automatic transmission , 1, 95   \n  Automotive open system architecture \n(AUTOSAR) , 46\u201347   \n  Auxiliary protocol interface module \n(APIM) , 213    \n  B  \n  Background/foreground loop , 45, 52\u201353   \n  Battery , 8, 75, 101, 135, 145, 217, 227   \n  B+ detection , 146, 176\u2013179   \n  Bias point analysis , 154\u2013156, 161\u2013164, \n168\u2013170, 173\u2013175   \n  Bluetooth , 20, 45, ", "227   \n  B+ detection , 146, 176\u2013179   \n  Bias point analysis , 154\u2013156, 161\u2013164, \n168\u2013170, 173\u2013175   \n  Bluetooth , 20, 45, 215, 228, 232   \n  B+ monitoring , 146, 179\u2013181   \n  Body control module (BCM) , 61, 63, 64, 69, \n70, 212\u2013216, 218, 224\u2013226   \n  Boost , 197\u2013199, 206\u2013208   \n  Bootstrap loader , 35, 40, 124   \n  Brake-by-wire , 5, 6   \n  Buck , 195, 197\u2013207   \n  Bulk current injection (BCI) , 235, 238\u2013240      C  \n  Calibration and con\ufb01  guration , 33, 34   \n  Capability maturity model (CMM) level , 45   \n  Car-to-car , 145   \n  Cell phone tower , 115, 145, 232   \n  Cellular phone , 115, 227, 228, 232, 239\u2013240   \n  CISPR25 , 232   \n  Closed loop control , 3, 204   \n  Communication link , 16, 28\u201335, 45, 47, 82, 91   \n  Complex instruction set computer (CISC) , 36, \n83, 85   \n  Conducted emissions (CE) , 8, 47, 229, 231, \n234, 236   \n  Conducted immunity (CI) , 229\u2013230, 232, 240, \n244, 245, 252\u2013257   \n  Continuous mode , 199   \n  Controller area network (CAN) bus , 26, 29, \n36, 40, 43, 59, 60, 62, 64, 66, 67, 69, \n76, 87, 89, 90, 92, 96, 98, 117, \n120\u2013126, 212\u2013218, 220, 221, 225   \n  Conventional radio , 13, 14   \n  Coupled immunity , 240\u2013245   \n  Cruise control , 1, 10, 70, 71, 139,", ", 220, 221, 225   \n  Conventional radio , 13, 14   \n  Coupled immunity , 240\u2013245   \n  Cruise control , 1, 10, 70, 71, 139, 213, 221, 222   \n  Cruise control module (CCM) (adaptive \nsensing) , 213, 220\u2013221    \n  D  \n  Data Flow Diagram (DFD) \n abnormal shutdown , 49  \n battery processing , 49  \n communication bus , 50\u201351  \n ignition processing , 48, 49  \n internal self-test , 52  \n switch de-bounce , 50                      Index zamann@us.panasonic.com\n260\n Data Flow Diagram (DFD) ( cont. ) \n temperature sensor , 50  \n watch dog timer , 51\u201352   \n  DDM.   See Dridoor module (DDM)  \n  Diagnostics , 2, 17, 19, 29\u201333, 39, 41, 48, 61, \n69, 77, 87, 90, 91, 96\u201398, 112   \n  Discontinuous mode , 199   \n  Discrete regulator , 195, 196, 198   \n  Distributed vehicle architecture , 16\u201318   \n  Drive-by-wire , 5\u20137   \n  Driver door module (DDM) , 213, 222   \n  Driver seat module (DSM) , 213   \n  Dual battery , 101, 102, 244    \n  E  \n  EDA.   See Electronic design automation \n(EDA) tools  \n  EEPROM , 18, 32, 39, 52, 82, 87, 98, 118   \n  EEPROM microcontroller , 37\u201338   \n  Electrically Programmable Read Only \nMemory (EPROM) , 18, 32, 36\u201339, 82, \n87, 98, 118   \n  Electromagnetic compliance (EMC) , 195\u2013198, \n200\u2013202, 227\u2013257   \n  Electromagnetic compliance (EMC) \ufb01  lters , \n103, 106   \n  Electronic design automation (EDA) tools , \n107, 144, 145, 151, 154, 165, 185   \n  Electrostatic discharge (ES", "C) \ufb01  lters , \n103, 106   \n  Electronic design automation (EDA) tools , \n107, 144, 145, 151, 154, 165, 185   \n  Electrostatic discharge (ESD) , 235, 244, 245, \n247, 250\u2013252   \n  Embedded function , 9\u201313, 17, 19\u201320, 61, 65, 71   \n  Embedded radio , 13\u201316   \n  Embedded systems booting , 40   \n  Engine controller , 1, 2, 8, 11, 30, 54, 56, 64, \n82, 83, 93, 95, 156\u2013157    \n  F  \n  FCIM.   See Front control interface module (FCIM)  \n  Ferrite core , 197, 199, 203   \n  Flash memory , 18, 34, 38\u201341, 43, 91, 98, \n115, 117   \n  Flash memory microcontroller , 36   \n  Flash programming , 30, 32\u201334, 38, 39, 44   \n  Flash programming port , 75, 88   \n  Fly-back , 197, 198   \n  Fly-by-wire (FBW) , 4\u20135, 7   \n  Forward , 26, 67, 197, 216, 222   \n  Front control interface module (FCIM) , 213   \n  Front Seat Climate Control Module \n(SCME) , 213   \n  Full bridge , 197   \n  Functional attributes , 139\u2013140, 209      G  \n  Gearshift module (GSM) , 213, 240   \n  Global positioning system (GPS) , 10, 97, 145, \n227, 228   \n  Global positioning system module (GPSM) , 213   \n  GNSS satellite signals , 145    \n  H  \n  Half bridge , 197   \n  Harvard architecture , 36, 82, 84   \n  H-bridge motor driver , 26\u201328   \n  Headlamp control module (HCM) , 213   \n  Heads-up display (HUD) , 213   \n  Heated steering wheel module (HSWM) , 213   \n  High level software context diagram , 48\u201352", "   \n  Headlamp control module (HCM) , 213   \n  Heads-up display (HUD) , 213   \n  Heated steering wheel module (HSWM) , 213   \n  High level software context diagram , 48\u201352   \n  High-side driver , 23, 111, 112, 130, 131, 147, \n170\u2013176   \n  HPIB , 36    \n  I  \n  I  2 C bus , 40, 117, 118   \n  IEEE-488 , 34, 35   \n  Ignition switch , 17, 20, 48\u201349, 75, 77, 80\u201381, \n94, 98, 104, 109\u2013110, 127\u2013128, \n135\u2013139, 145, 151\u2013154, 159\u2013161   \n  Image processing module-A (IPM-A) , 213, 224   \n  Inductor , 195\u2013197, 199\u2013200, 204, 206, 207   \n  Instrument cluster , 2, 30, 54\u201355, 58, 79, 81, \n88, 95, 119, 217   \n  Instrument panel cluster (IPC) , 213, 216, \n218, 225    \n  J  \n  JTAG , 77, 87, 88    \n  K  \n  Key-off load current , 20\u201321, 25, 104, 112, \n128, 136, 157, 167, 170, 174\u2013175, \n190\u2013193, 201\u2013204    \n  L  \n  Linear regulator , 80, 195, 196, 198   \n  Line impedance stabilization network \n(LISN) , 236   \n  Load dump , 92, 99, 101, 102, 186\u2013187, 244, \n245, 253, 256\u2013257   \n  Low dropout regulators (LDO) , 195, 196, 198   \n  Low pass \ufb01  lter (LPF) , 103\u2013105   \n  Low-side Driver , 23, 59, 112\u2013113, 147, 165\u2013168    Indexzamann@us.panasonic.com\n261\n  M  \n  Masked read only memory (MROM)", "   \n  Low-side Driver , 23, 59, 112\u2013113, 147, 165\u2013168    Indexzamann@us.panasonic.com\n261\n  M  \n  Masked read only memory (MROM) \nmicrocontroller , 37, 38   \n  Metal oxide varistor (MOV) , 107   \n  Micro ITRON , 47   \n  Millions of instructions per second (MIPS) , \n36, 76, 82, 85, 99   \n  Motor Industry Software Reliability \nAssociation (MISRA) , 45   \n  MOV .   See Metal oxide varistor (MOV)   \n  N  \n  Nissan ABS/TCS/VDC , 61, 62   \n  Nissan ADP , 65, 70   \n  Nissan BCM , 63, 64, 69, 70, 212, 213, 216, \n218, 224\u2013226   \n  Nissan CU , 68\u201370   \n  Nissan DSCU , 65, 67, 70   \n  Nissan ECM , 61, 63\u201365, 68\u201370   \n  Nissan FACU , 66\u201367, 70   \n  Nissan IPDM , 61, 65, 69, 70   \n  Nissan Quest , 59\u201370, 93   \n  Nissan SDCU , 63, 70   \n  Nissan SRS , 61\u201363, 69, 70   \n  Nissan TCU , 68, 70, 213   \n  Nucleus RTOS , 8, 45, 47, 77, 85, 91\u201392    \n  O  \n  OBD II , 31, 42, 77, 90, 97, 98, 213   \n  OCSM (Occupant Classi\ufb01  cation System \nModule) , 213   \n  One-Time-Programmable (OTP) \nMicrocontroller , 36\u201338   \n  Operational classi\ufb01  cation , 246\u2013247, 251   \n  Operational Mode , 30, 43, 104, 131, 139, 140, \n246, 247   \n  OrCAD/PSpice , 128, 129, 143, 149\u2013151   \n  OSEK , 46    \n  P  \n ", ", 131, 139, 140, \n246, 247   \n  OrCAD/PSpice , 128, 129, 143, 149\u2013151   \n  OSEK , 46    \n  P  \n  Park aid module (PAM) , 212, 213, 216, 217   \n  Passenger door module (PDM) , 213, 222   \n  Phase Shift convertor , 197   \n  Portable transmitter , 235   \n  Power reservoir , 75, 79, 98, 103, 105   \n  Power steering , 3, 8, 57, 65, 213   \n  Power Steering Control Module (PSCM) , \n213, 225   \n  Power supply , 3, 71, 75, 77, 79, 80, 98, \n101\u2013107, 109, 133, 136\u2013138, 146, 148, \n149, 165, 181, 185, 195\u2013208, 257     Powertrain control module (PCM) , 213, 218, \n222, 225   \n  Primary boot-loader (PBL) , 41, 42, 77, 87, 91, \n97, 98, 122   \n  Processing engine , 62, 75, 77, 79, 87, 98, \n102, 105   \n  Programmable Read Only memory (PROM) , \n37, 39   \n  Program storage , 38, 75, 77, 82, 87, 97   \n  Pulse width modulated (PWM) , 12, 24\u201326, 83, \n113, 114, 199, 201, 233, 243, 248   \n  Push-Pull convertor , 197    \n  Q  \n  QNX , 45, 47    \n  R  \n  Radar , 1, 47, 71, 115, 145, 232   \n  Radiated emissions (RE) , 202, 228\u2013237, 242   \n  Radiated immunity (RI) , 229, 231, 232, \n235\u2013239, 242   \n  Radio transceiver module (RTM) , 213, 217, 224   \n  Radio transmitter , 228", "  Radiated immunity (RI) , 229, 231, 232, \n235\u2013239, 242   \n  Radio transceiver module (RTM) , 213, 217, 224   \n  Radio transmitter , 228   \n  Rear gate trunk module (RGTM) , 213   \n  Reduced instruction set computer (RISC) , 36, \n72, 84, 85, 99   \n  Relays , 23, 48, 59, 61, 62, 65, 67, 70, 77, 78, \n80, 92\u201393, 95, 108, 111, 131, 149, 212, \n221, 240, 242, 243, 248   \n  Reset , 40, 42, 43, 51, 72, 75, 77, 78, 80, 83, \n85\u201387, 98, 99, 103, 104, 114\u2013117, 146, \n182\u2013186, 228, 247, 251   \n  Restraint control module (RCM) , 212\u2013216, 225   \n  Reverse battery , 101, 102, 133, 146, \n186\u2013194   \n  ROM , 18, 36, 37, 39   \n  RS232C , 35   \n  Run , 12, 32, 47, 48, 51, 52, 63, 75, 78\u201381, 86, \n88\u201392, 94, 97\u201399, 102, 109, 115, 116, \n118, 123, 131, 132, 136, 137, 139, 144, \n151, 154, 164, 197, 204, 213, 218, 227, \n232, 238, 240, 250    \n  S  \n  Safe lane assistance , 139   \n  Safety and protection , 75\u201378, 98, 101\u2013104, \n107\u2013109, 111, 113, 114, 126, 127, \n186\u2013187   \n  Satellite , 145, 229, 232   \n  SBL.   See Secondary boot-loader (SBL)  \n ", "\u2013109, 111, 113, 114, 126, 127, \n186\u2013187   \n  Satellite , 145, 229, 232   \n  SBL.   See Secondary boot-loader (SBL)  \n  SBW.   See Steer-by-wire (SBW)  Indexzamann@us.panasonic.com\n262\n  Schematic , 146, 148\u2013150, 152\u2013154, 160\u2013161, \n164, 166\u2013168, 172\u2013173, 177\u2013178, \n180\u2013181, 184\u2013186, 190\u2013193, 201, 202, \n204\u2013208   \n  SCME.   See Front Seat Climate Control \nModule (SCME)  \n  Secondary boot-loader (SBL) , 41, 42, 97   \n  Sensor power , 108\u2013109, 160, 161, 165   \n  SEPIC convertor , 197   \n  Serial Communication Interface (SCI) bus , 36, \n117, 118, 122   \n  Serial Peripheral Interface (SPI) bus , 36, 40, \n88, 117, 118, 122, 125   \n  Side obstacle detector-left (SOD-L) , 213, 222   \n  Side obstacle detector-right (SOD-R) , 213, 222   \n  Sleep mode , 20\u201321, 138\u2013140   \n  SMPS.   See Switch mode power supply (SMPS)  \n  Soft start , 194, 203, 204   \n  Software controlled switch , 103\u2013105, 122, 137   \n  Software Process Improvement and Capability \nDetermination (SPICE) , 45, 143\u2013145, \n148, 166   \n  Solenoids , 3, 9, 10, 23, 48, 57, 61\u201363, 65, 67, \n68, 70, 77, 78, 80, 88, 92\u201393, 95, 108, \n111, 130, 131, 149, 242   \n  SPI bus.   See Serial Peripheral Interface (SPI) bus  \n  Stand-alone \ufb02  ash programming , 34\u201335   \n  Standby-mode , 139, 140   \n  Start , 9,", ", 242   \n  SPI bus.   See Serial Peripheral Interface (SPI) bus  \n  Stand-alone \ufb02  ash programming , 34\u201335   \n  Standby-mode , 139, 140   \n  Start , 9, 35, 63, 75, 77, 78, 80\u201381, 85, 86, 92, \n94, 95, 109, 110, 114, 116, 131, 136, \n138, 151\u2013154, 156, 185, 192, 198, \n203\u2013205, 224, 242, 247   \n  Steer-by-wire (SBW) , 5, 6   \n  Steering column control module (SCCM) , 213   \n  Switched battery , 75, 79, 107, 148\u2013150   \n  2-Switched forward , 197   \n  Switch mode power supply (SMPS) , 195\u2013199, \n201, 203, 204    \n  T  \n  Telematics control unit (TCU) , 213   \n  Temperature envelop , 151, 156\u2013157, 164\u2013165, \n169, 178\u2013179   \n  Texas instruments nodal analysis (TINA) , 128, \n129, 134, 143, 185   \n  ThreadX , 45   \n  Tire pressure monitoring system (TPMS) , 7\u20138, \n217\u2013218   \n  Trailer module (TRM) , 213     Transient voltage suppressor (TVS) , 107   \n  Transmission range control module (TRCM) , \n213, 216   \n  Truth table , 146, 147, 152, 159\u2013160, 165\u2013166, \n171, 176\u2013177, 180, 183\u2013184, 188\u2013190, \n199\u2013200, 206\u2013207   \n  TV station , 145    \n  U  \n  Under voltage lock out (UVLO) , 203, 204   \n  Universal Asynchronous Receiver Transmitter \n(UART) , 40, 65, 77, 88, 117   \n  Universal module , 19\u201320   \n  Universal Serial Bus (USB) , 20, 29, 34, 35, \n40, 43, 47", ", 65, 77, 88, 117   \n  Universal module , 19\u201320   \n  Universal Serial Bus (USB) , 20, 29, 34, 35, \n40, 43, 47, 55    \n  V  \n  Vacuum \ufb02  uorescent displays (VFDs) , 197   \n  Vehicle Dynamics Module (VDM) , 213   \n  Vehicle harness , 22, 57\u201358, 89, 107, 109, 124, \n138, 160, 238, 244, 247, 250, 255   \n  Vehicle module programming , 40, 42\u201343   \n  Vehicle programming , 39\u201343   \n  VFDs.   See Vacuum \ufb02  uorescent displays \n(VFDs)  \n  VHDL , 143\u2013144   \n  V on Neumann Architecture , 36, 82   \n  12V/42V electrical system , 21   \n  VxWorks , 45    \n  W  \n  Watch Dog Timer , 51, 72, 75, 85\u201387, 99, \n114\u2013117, 131   \n  WEBBENCH , 143   \n  Wi-Fi , 20, 43, 97, 227, 228, 232   \n  Wire coupling , 241, 244, 245, 247\u2013250   \n  Worst case circuit analysis (WCCA) , 107, 113, \n144, 145, 164\u2013165    \n  X  \n  X-by-wire , 4\u20137    \n  Z  \n  Zener diode , 192   \n  Zero-insertion-force (ZIF) socket , 34, 99         Indexzamann@us.panasonic.com"]